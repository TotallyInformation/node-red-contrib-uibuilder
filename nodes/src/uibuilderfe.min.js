"use strict";if("undefined"!=typeof require&&void 0===io)var io=require("socket.io-client");(function(){function e(e,t){null!==t&&void 0!==t||(t="payload"),"string"!=typeof t&&(console.warn("makeMeAnObject:WARNING: property parameter must be a string and not: "+typeof t),t="payload");var n={};return"object"==typeof e?n=e:null!==e&&(n[t]=e),n}var t=this,n=t.uibuilder,i=function(){var t=this;return t.version="1.0.2",t.debug=!1,t.uiDebug=function(e,n){if(t.debug){switch(this.myLog={},e){case"error":this.myLog=console.error;break;case"warn":this.myLog=console.warn;break;case"info":this.myLog=console.info;break;case"dir":this.myLog=console.dir;break;default:this.myLog=console.log}this.myLog(n)}},t.me=function(){return!0===t.debug?t:"uibuilderfe.js Version: "+t.version},t.setIOnamespace=function(){var e="";if(""===(e=document.cookie.replace(/(?:(?:^|.*;\s*)uibuilder-namespace\s*\=\s*([^;]*?).*$)|^.*$/,"$1"))){var n=window.location.pathname.split("/").filter(function(e){return""!==e.trim()});n[n.length-1].endsWith(".html")&&n.pop(),e=n.join("/")}return e="/"+e,t.uiDebug("log","uibuilderfe: IO Namespace: "+e),e},t.autoSendReady=!0,t.allowScript=!0,t.allowStyle=!0,t.removeScript=!0,t.removeStyle=!0,t.msg={},t.ctrlMsg={},t.sentMsg={},t.msgsSent=0,t.msgsReceived=0,t.msgsSentCtrl=0,t.msgsCtrl=0,t.ioConnected=!1,t.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},t.retryMs=2e3,t.retryFactor=1.5,t.timerid=null,t.ioNamespace=t.setIOnamespace(),t.ioPath="/uibuilder/socket.io",t.ioTransport=["polling","websocket"],t.set=function(e,n){t[e]=n,t.uiDebug("log","uibuilderfe: prop set - prop: "+e+", val: "+("object"==typeof n)?JSON.stringify(n):n),t.emit(e,n)},t.socket=io(t.ioNamespace,{path:t.ioPath,transports:t.ioTransport}),t.checkConnect=function(e,n){var i=i++||1;t.uiDebug("log","checkConnect. Depth: ",i," , Delay: ",e,", Factor: ",n),t.timerid&&window.clearTimeout(t.timerid),t.timerid=window.setTimeout(function(){t.uiDebug("log","checkConnect timeout. SIO reconnect attempt, timeout: "+e+", depth: "+i),t.socket.close(),t.socket.connect(),t.timerid=null,t.checkConnect(e*n,n)},e)},t.socket.on("connect",function(){t.uiDebug("log","uibuilderfe: SOCKET CONNECTED - Namespace: "+t.ioNamespace),t.set("ioConnected",!0),t.timerid&&(window.clearTimeout(t.timerid),t.timerid=null)}),t.socket.on(t.ioChannels.server,function(n){t.uiDebug("info","uibuilderfe: socket.on.server - msg received - Namespace: "+t.ioNamespace),t.uiDebug("dir",n),n=e(n,"payload"),t.allowScript&&n.hasOwnProperty("script")&&(t.newScript(n.script),t.removeScript&&delete n.script),t.allowStyle&&n.hasOwnProperty("style")&&(t.newStyle(n.style),t.removeStyle&&delete n.style),t.set("msg",n),t.set("msgsReceived",t.msgsReceived+1)}),t.socket.on(t.ioChannels.control,function(e){t.uiDebug("info","uibuilder:socket.on.control - msg received - Namespace: "+t.ioNamespace),t.uiDebug("dir",e),null===e?e={}:"object"!=typeof e&&(e={uibuilderCtrl:e}),e.hasOwnProperty("debug")&&(t.debug=e.debug),t.set("ctrlMsg",e),t.set("msgsCtrl",t.msgsCtrl+1)}),t.socket.on("disconnect",function(e){t.uiDebug("log","SOCKET DISCONNECTED - Namespace: "+t.ioNamespace+", Reason: "+e),t.set("ioConnected",!1),"io server disconnect"===e&&t.checkConnect(t.retryMs,t.retryFactor)}),t.send=function(n,i){null!==i&&void 0!==i||(i=t.ioChannels.client),t.uiDebug("info","uibuilderfe: msg sent - Namespace: "+t.ioNamespace+", Channel: "+i),t.uiDebug("dir",n),i===t.ioChannels.client?n=e(n,"payload"):i===t.ioChannels.control&&((n=e(n,"uibuilderCtrl")).hasOwnProperty("uibuilderCtrl")||(n.uibuilderCtrl="manual send"),n.from="client"),t.set("sentMsg",n),i===t.ioChannels.client?t.set("msgsSent",t.msgsSent+1):i===t.ioChannels.control&&t.set("msgsCtrl",t.msgsCtrl+1),t.socket.emit(i,n)},t.events={},t.emit=function(e){var n=t.events[e];if(n)for(var i=Array.prototype.slice.call(arguments,1),o=0;o<n.length;o++)n[o].apply(t,i)},t.newScript=function(e){if(!0===t.allowScript&&""!==e&&void 0!==e){t.uiDebug("log","uibuilderfe: newCode - script: "+e);var n=document.createElement("script");n.type="text/javascript",n.defer=!0,n.textContent=e,document.getElementsByTagName("body")[0].appendChild(n)}},t.newStyle=function(e){if(!0===t.allowStyle&&""!==e&&void 0!==e){t.uiDebug("log","uibuilderfe: newStyle - style: "+e);var n=document.createElement("style");n.textContent=e,document.getElementsByTagName("head")[0].appendChild(n)}},t.uiReturn={set:function(e,n){-1===["version","debug","msg","ctrlMsg","sentMsg","msgsSent","msgsSentCtrl","msgsReceived","msgsCtrl","ioConnected","ioChannels","retryMs","retryFactor","timerid","ioNamespace","ioPath","ioTransport","events","autoSendReady","set","get","send","sendCtrl","onChange","socket","checkConnect","emit","uiReturn","newScript","newStyle","uiDebug","me","self","setIOnamespace"].indexOf(e)?t.set(e,n):t.uiDebug("warn",'uibuilderfe:uibuilder:set: "'+e+'" is in list of excluded properties, not set')},get:function(e){return t[e]},onChange:function(e,n){t.events[e]?t.events[e].push(n):t.events[e]=[n]},msg:t.msg,send:t.send,sendCtrl:function(e){t.send(e,t.ioChannels.control)},autoSendReady:function(e){!0!==e&&(e=!1),t.autoSendReady=e},debug:function(e){if(void 0===e)return t.debug;"boolean"==typeof e&&(t.debug=e)},uiDebug:t.uiDebug,me:t.me},window.addEventListener("load",function(){!0===t.autoSendReady&&t.send({uibuilderCtrl:"ready for content",cacheControl:"REPLAY"},t.ioChannels.control)}),t.checkConnect(t.retryMs,t.retryFactor),t.uiReturn}.call(t);i.noConflict=function(){return t.uibuilder=n,i},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.uibuilder=i):t.uibuilder=i}).call(this);