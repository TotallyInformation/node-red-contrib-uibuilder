"use strict";if("undefined"!=typeof require&&void 0===io)var io=require("socket.io-client");(function(){var e=this,t=e.uibuilder,i=function(){String.prototype.endsWith||(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});var o=this;o.version="2.0.5",o.debug=!1,o.moduleName="uibuilder",o.uiDebug=function(){o.debug&&console[arguments[0]].apply(console,[].slice.call(arguments,1))},o.me=function(){return!0===o.debug?o:"uibuilderfe.js Version: "+o.version},o.uiDebug("log","uibuilderfe: uibuilder.debug = true, fe version: ",o.version),o.setIOnamespace=function(){var e="";if(""===(e=document.cookie.replace(/(?:(?:^|.*;\s*)uibuilder-namespace\s*\=\s*([^;]*?).*$)|^.*$/,"$1"))){var t=window.location.pathname.split("/").filter(function(e){return""!==e.trim()});0<t.length&&t[t.length-1].endsWith(".html")&&t.pop(),e=t.join("/"),o.uiDebug("log","uibuilderfe: IO Namespace - Found via url path: "+e)}else o.uiDebug("log","uibuilderfe: IO Namespace - Found via cookie: "+e);return e="/"+e,o.uiDebug("log","uibuilderfe: IO Namespace: "+e),e},o.autoSendReady=!0,o.allowScript=!0,o.allowStyle=!0,o.removeScript=!0,o.removeStyle=!0,o.msg={},o.ctrlMsg={},o.sentMsg={},o.sentCtrlMsg={},o.msgsSent=0,o.msgsReceived=0,o.msgsSentCtrl=0,o.msgsCtrl=0,o.ioConnected=!1,o.serverTimeOffset=null,o.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},o.retryMs=2e3,o.retryFactor=1.5,o.timerid=null,o.ioNamespace=o.setIOnamespace(),o.ioTransport=["polling","websocket"],o.loaded=!1;var e=window.location.pathname.split("/").filter(function(e){return""!==e.trim()});return 0<e.length&&e[e.length-1].endsWith(".html")&&e.pop(),o.url=e.pop(),o.httpNodeRoot="/"+e.join("/"),o.ioPath=function(){return("/"+Array.prototype.slice.call(arguments).map(function(e){return e.replace(/^\/|\/$/g,"")}).filter(function(e){return e}).join("/")).replace("//","/")}(o.httpNodeRoot,o.moduleName,"vendor","socket.io"),o.uiDebug("debug","uibuilderfe: ioPath: "+o.ioPath+", httpNodeRoot: "+o.httpNodeRoot+", uibuilder url (not used): "+o.url),o.set=function(e,t){o[e]=t,o.uiDebug("debug","uibuilderfe: prop set - prop: "+e+", val: "+("object"==typeof t)?JSON.stringify(t):t),o.emit(e,t)},o.checkConnect=function(e,t){var i=i++||1;o.uiDebug("debug","uibuilderfe:checkConnect. Reconnect - Depth: "+i+", Delay: "+e+", Factor: "+t,o.ioNamespace,o.ioPath),o.timerid&&window.clearTimeout(o.timerid),o.timerid=window.setTimeout(function(){o.uiDebug("debug","uibuilderfe:checkConnect timeout. SIO reconnect attempt, timeout: "+e+", depth: "+i,o.ioNamespace,o.ioPath),console.info("[uibuilderfe:checkConnect:setTimeout] Socket.IO reconnection attempt. Current delay: "+e),o.socket.close(),o.socket.connect(),o.timerid=null,o.checkConnect(e*t,t)},e)},o.checkTimestamp=function(e){if(e.hasOwnProperty("serverTimestamp")){var t=new Date(e.serverTimestamp),i=Math.round((new Date-t)/36e5);i!==o.serverTimeOffset&&(o.set("serverTimeOffset",i),o.uiDebug("log","uibuilderfe:"+o.ioChannels.server+" (server): Offset changed to: "+i))}},o.ioSetup=function(){o.uiDebug("debug","uibuilderfe:ioSetup: About to create IO. Namespace: "+o.ioNamespace+", Path: "+o.ioPath+", Transport: ["+o.ioTransport.join(", ")+"]"),o.socket=io(o.ioNamespace,{path:o.ioPath,transports:o.ioTransport}),o.socket.on("connect",function(){o.uiDebug("info","uibuilderfe:ioSetup: SOCKET CONNECTED - Namespace: "+o.ioNamespace," Server Channel: ",o.ioChannels.server," Control Channel: ",o.ioChannels.control),o.set("ioConnected",!0),o.timerid&&(window.clearTimeout(o.timerid),o.timerid=null)}),o.socket.on(o.ioChannels.server,function(e){o.uiDebug("debug","uibuilderfe:ioSetup:"+o.ioChannels.server+" (server): msg received - Namespace: "+o.ioNamespace,e),e=n(e,"payload"),o.checkTimestamp(e),o.allowScript&&e.hasOwnProperty("script")&&(o.newScript(e.script),o.removeScript&&delete e.script),o.allowStyle&&e.hasOwnProperty("style")&&(o.newStyle(e.style),o.removeStyle&&delete e.style),o.set("msg",e),o.set("msgsReceived",o.msgsReceived+1)}),o.socket.on(o.ioChannels.control,function(e){if(o.uiDebug("debug","uibuilder:ioSetup:"+o.ioChannels.control+" (control): msg received - Namespace: "+o.ioNamespace,e),null===e)e={};else if("object"!=typeof e){var t={};t["uibuilderCtrl:"+o.ioChannels.control]=e,e=t}switch(e.hasOwnProperty("debug")&&(o.debug=e.debug),o.checkTimestamp(e),o.set("ctrlMsg",e),o.set("msgsCtrl",o.msgsCtrl+1),e.uibuilderCtrl){case"ready for content":o.uiDebug("debug","uibuilderfe:ioSetup:"+o.ioChannels.control+' Received "ready for content" from server');break;case"shutdown":o.uiDebug("debug","uibuilderfe:ioSetup:"+o.ioChannels.control+' Received "shutdown" from server');break;case"client connect":!0===o.autoSendReady&&(o.uiDebug("debug","uibuilderfe:ioSetup:"+o.ioChannels.control+' Received "client connect" from server, auto-sending REPLAY control msg'),o.send({uibuilderCtrl:"ready for content",cacheControl:"REPLAY",from:"client"},o.ioChannels.control));break;default:o.uiDebug("debug","uibuilderfe:ioSetup:"+o.ioChannels.control+' Received "'+e.uibuilderCtrl+'" from server')}}),o.socket.on("disconnect",function(e){o.uiDebug("info","uibuilderfe:ioSetup: SOCKET DISCONNECTED - Namespace: "+o.ioNamespace+", Reason: "+e),o.set("ioConnected",!1),console.warn("[uibuilderfe:socket-disconnect] Reason: "+e),o.checkConnect(o.retryMs,o.retryFactor)}),o.socket.on("connect_error",function(e){o.uiDebug("error","uibuilderfe:ioSetup: SOCKET CONNECT ERROR - Namespace: "+o.ioNamespace+" ioPath: "+o.ioPath+", Reason: "+e.message)}),o.checkConnect(o.retryMs,o.retryFactor)},o.send=function(e,t){null==t&&(t=o.ioChannels.client),o.uiDebug("log","uibuilderfe: sending msg - Namespace: "+o.ioNamespace+", Channel: "+t,e),t===o.ioChannels.client?e=n(e,"payload"):t===o.ioChannels.control&&((e=n(e,"uibuilderCtrl")).hasOwnProperty("uibuilderCtrl")||(e.uibuilderCtrl="manual send"),e.from="client"),t===o.ioChannels.client?(o.set("sentMsg",e),o.set("msgsSent",o.msgsSent+1)):t===o.ioChannels.control&&(o.set("sentCtrlMsg",e),o.set("msgsSentCtrl",o.msgsSentCtrl+1)),o.socket.emit(t,e)},o.events={},o.emit=function(e){var t=o.events[e];if(t)for(var i=Array.prototype.slice.call(arguments,1),n=0;n<t.length;n++)t[n].apply(o,i)},o.newScript=function(e){if(!0===o.allowScript&&""!==e&&void 0!==e){o.uiDebug("log","uibuilderfe: newCode - script: "+e);var t=document.createElement("script");t.type="text/javascript",t.defer=!0,t.textContent=e,document.getElementsByTagName("body")[0].appendChild(t)}},o.newStyle=function(e){if(!0===o.allowStyle&&""!==e&&void 0!==e){o.uiDebug("log","uibuilderfe: newStyle - style: "+e);var t=document.createElement("style");t.textContent=e,document.getElementsByTagName("head")[0].appendChild(t)}},o.uiReturn={set:function(e,t){-1===["version","debug","msg","ctrlMsg","sentMsg","msgsSent","msgsSentCtrl","msgsReceived","msgsCtrl","ioConnected","ioChannels","retryMs","retryFactor","timerid","ioNamespace","ioPath","ioTransport","events","autoSendReady","set","get","send","sendCtrl","onChange","socket","checkConnect","emit","uiReturn","newScript","newStyle","uiDebug","me","self","setIOnamespace"].indexOf(e)?o.set(e,t):o.uiDebug("warn",'uibuilderfe:uibuilder:set: "'+e+'" is in list of excluded properties, not set')},get:function(e){return o[e]},onChange:function(e,t){o.events[e]?o.events[e].push(t):o.events[e]=[t]},msg:o.msg,send:o.send,sendCtrl:function(e){o.send(e,o.ioChannels.control)},autoSendReady:function(e){!0!==e&&(e=!1),o.autoSendReady=e},debug:function(e){if(void 0===e)return o.debug;"boolean"==typeof e&&(o.debug=e)},uiDebug:o.uiDebug,me:o.me,start:function(e,t){void 0!==e&&(o.ioNamespace=e),void 0!==t&&(o.ioPath=t),o.ioSetup()}},window.addEventListener("load",function(){o.uiDebug("debug","uibuilderfe:load: All resources loaded"),o.loaded=!0}),o.uiReturn}.call(e);function n(e,t){null==t&&(t="payload"),"string"!=typeof t&&(console.warn("[uibuilderfe:makeMeAnObject] WARNING: property parameter must be a string and not: "+typeof t),t="payload");var i={};return"object"==typeof e?i=e:null!==e&&(i[t]=e),i}i.noConflict=function(){return e.uibuilder=t,i},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.uibuilder=i):e.uibuilder=i}).call(this);