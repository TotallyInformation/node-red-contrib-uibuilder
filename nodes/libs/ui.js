var s,u=class{constructor(t,e){document||s(0,"Ui:constructor","Current environment does not include `document`, UI functions cannot be used.")(),s=t,this.syntaxHighlight=e}ui(t){let e={};t._ui?e=t:e._ui=t,this._uiManager(e)}replaceSlot(t,e){e.slot&&t&&(window.DOMPurify&&(e.slot=window.DOMPurify.sanitize(e.slot)),t.innerHTML=e.slot)}replaceSlotMarkdown(t,e){if(!t||!window.markdownit||!e.slotMarkdown)return;const r={html:!0,linkify:!0,_highlight:!0,langPrefix:"language-",highlight(n,a){if(a&&window.hljs&&window.hljs.getLanguage(a))try{return`<pre class="highlight" data-language="${a.toUpperCase()}">
                                <code class="language-${a}">${window.hljs.highlightAuto(n).value}</code></pre>`}finally{}return`<pre class="highlight"><code>${i.utils.escapeHtml(n)}</code></pre>`}},i=window.markdownit(r);e.slotMarkdown=i.render(e.slotMarkdown),window.DOMPurify&&(e.slotMarkdown=window.DOMPurify.sanitize(e.slotMarkdown)),t.innerHTML=e.slotMarkdown}loadScriptSrc(t){const e=document.createElement("script");e.src=t,e.async=!1,document.head.appendChild(e)}loadStyleSrc(t){const e=document.createElement("link");e.href=t,e.rel="stylesheet",e.type="text/css",document.head.appendChild(e)}loadScriptTxt(t){const e=document.createElement("script");e.async=!1,e.textContent=t,document.head.appendChild(e)}loadStyleTxt(t){const e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}showDialog(t,e,r){let i="";if(r.payload&&typeof r.payload=="string"&&(i+=r.payload),e.content&&(i+=e.content),i===""){s(1,"Ui:showDialog","Toast content is blank. Not shown.")();return}!e.title&&r.topic&&(e.title=r.topic),e.title&&(i=`<p class="toast-head">${e.title}</p><p>${i}</p>`),e.noAutohide&&(e.noAutoHide=e.noAutohide),e.noAutoHide&&(e.autohide=!e.noAutoHide),e.autoHideDelay?(e.autohide||(e.autohide=!0),e.delay=e.autoHideDelay):e.autoHideDelay=1e4,Object.prototype.hasOwnProperty.call(e,"autohide")||(e.autohide=!0),t==="alert"&&(e.modal=!0,e.autohide=!1,i=`<svg viewBox="0 0 192.146 192.146" style="width:30;background-color:transparent;"><path d="M108.186 144.372c0 7.054-4.729 12.32-12.037 12.32h-.254c-7.054 0-11.92-5.266-11.92-12.32 0-7.298 5.012-12.31 12.174-12.31s11.91 4.992 12.037 12.31zM88.44 125.301h15.447l2.951-61.298H85.46l2.98 61.298zm101.932 51.733c-2.237 3.664-6.214 5.921-10.493 5.921H12.282c-4.426 0-8.51-2.384-10.698-6.233a12.34 12.34 0 0 1 .147-12.349l84.111-149.22c2.208-3.722 6.204-5.96 10.522-5.96h.332c4.445.107 8.441 2.618 10.513 6.546l83.515 149.229c1.993 3.8 1.905 8.363-.352 12.066zm-10.493-6.4L96.354 21.454l-84.062 149.18h167.587z" /></svg> ${i}`);let n=document.getElementById("toaster");n===null&&(n=document.createElement("div"),n.id="toaster",n.title="Click to clear all notifcations",n.setAttribute("class","toaster"),n.setAttribute("role","dialog"),n.setAttribute("arial-label","Toast message"),n.onclick=function(){n.remove()},document.body.insertAdjacentElement("afterbegin",n));const a=document.createElement("div");a.title="Click to clear this notifcation",a.setAttribute("class",`toast ${e.variant?e.variant:""} ${t}`),a.innerHTML=i,a.setAttribute("role","alertdialog"),e.modal&&a.setAttribute("aria-modal",e.modal),a.onclick=function(o){o.stopPropagation(),a.remove(),n.childElementCount<1&&n.remove()},n.insertAdjacentElement(e.appendToast===!0?"beforeend":"afterbegin",a),e.autohide===!0&&setInterval(()=>{a.remove(),n.childElementCount<1&&n.remove()},e.autoHideDelay)}_showNotification(t){t.topic&&!t.title&&(t.title=t.topic),t.title||(t.title="uibuilder notification"),t.payload&&!t.body&&(t.body=t.payload),t.body||(t.body=" No message given.");try{const e=new Notification(t.title,t);return new Promise((r,i)=>{e.addEventListener("close",n=>{n.currentTarget.userAction="close",r(n)}),e.addEventListener("click",n=>{n.currentTarget.userAction="click",r(n)}),e.addEventListener("error",n=>{n.currentTarget.userAction="error",i(n)})})}catch{return Promise.reject(new Error("Browser refused to create a Notification"))}}async notification(t){if(typeof t=="string"&&(t={body:t}),typeof Notification>"u")return Promise.reject(new Error("Notifications not available in this browser"));let e=Notification.permission;return e==="denied"?Promise.reject(new Error("Notifications not permitted by user")):e==="granted"?this._showNotification(t):(e=await Notification.requestPermission(),e==="granted"?this._showNotification(t):Promise.reject(new Error("Notifications not permitted by user")))}loadui(t){if(!fetch){s(0,"Ui:loadui","Current environment does not include `fetch`, skipping.")();return}if(!t){s(0,"Ui:loadui","url parameter must be provided, skipping.")();return}fetch(t).then(e=>{if(e.ok===!1)throw new Error(`Could not load '${t}'. Status ${e.status}, Error: ${e.statusText}`);s("trace","Ui:loadui:then1",`Loaded '${t}'. Status ${e.status}, ${e.statusText}`)();const r=e.headers.get("content-type");if(!r||!r.includes("application/json"))throw new TypeError(`Fetch '${t}' did not return JSON, ignoring`);return e.json()}).then(e=>e!==void 0?(s("trace","Ui:loadui:then2","Parsed JSON successfully obtained")(),this._uiManager({_ui:e}),!0):!1).catch(e=>{s("warn","Ui:loadui:catch","Error. ",e)()})}_uiComposeComponent(t,e){e.attributes&&Object.keys(e.attributes).forEach(r=>{r==="value"&&(t.value=e.attributes[r]),r.startsWith("xlink:")?t.setAttributeNS("http://www.w3.org/1999/xlink",r,e.attributes[r]):t.setAttribute(r,e.attributes[r])}),e.id&&t.setAttribute("id",e.id),e.type==="svg"&&(t.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),t.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")),e.events&&Object.keys(e.events).forEach(r=>{r.toLowerCase==="onclick"&&(r="click");try{t.addEventListener(r,i=>{new Function("evt",`${e.events[r]}(evt)`)(i)})}catch(i){s("error","Ui:_uiComposeComponent",`Add event '${r}' for element '${e.type}': Cannot add event handler. ${i.message}`)()}}),e.properties&&Object.keys(e.properties).forEach(r=>{t[r]=e.properties[r]}),e.slot&&this.replaceSlot(t,e),e.slotMarkdown&&this.replaceSlotMarkdown(t,e)}uiEnhanceElement(t,e){this._uiComposeComponent(t,e)}_uiExtendEl(t,e,r=""){e.forEach((i,n)=>{s("trace",`Ui:_uiExtendEl:components-forEach:${n}`,i)();let a;i.ns=r,i.ns==="html"?(a=t,t.innerHTML=i.slot):i.ns==="svg"?(a=document.createElementNS("http://www.w3.org/2000/svg",i.type),this._uiComposeComponent(a,i),t.appendChild(a)):(a=document.createElement(i.type==="html"?"div":i.type),this._uiComposeComponent(a,i),t.appendChild(a)),i.components&&this._uiExtendEl(a,i.components,i.ns)})}_uiAdd(t,e){s("trace","Ui:_uiManager:add","Starting _uiAdd")(),t.components.forEach((r,i)=>{s("trace",`Ui:_uiAdd:components-forEach:${i}`,"Component to add: ",r)();let n;switch(r.type){case"html":{r.ns="html",n=document.createElement("div");break}case"svg":{r.ns="svg",n=document.createElementNS("http://www.w3.org/2000/svg","svg");break}default:{r.ns="dom",n=document.createElement(r.type);break}}!r.slot&&t.payload&&(r.slot=t.payload),this._uiComposeComponent(n,r);let a;r.parentEl?a=r.parentEl:t.parentEl?a=t.parentEl:r.parent?a=document.querySelector(r.parent):t.parent&&(a=document.querySelector(t.parent)),a||(s("info","Ui:_uiAdd","No parent found, adding to body")(),a=document.querySelector("body")),r.position&&r.position==="first"?a.insertBefore(n,a.firstChild):r.position&&Number.isInteger(Number(r.position))?a.insertBefore(n,a.children[r.position]):a.appendChild(n),r.components&&this._uiExtendEl(n,r.components,r.ns)})}_uiRemove(t,e=!1){t.components.forEach(r=>{let i;e!==!0?i=[document.querySelector(r)]:i=document.querySelectorAll(r),i.forEach(n=>{try{n.remove()}catch(a){s("trace","Ui:_uiRemove",`Could not remove. ${a.message}`)()}})})}_uiReplace(t){s("trace","Ui:_uiReplace","Starting")(),t.components.forEach((e,r)=>{s("trace",`Ui:_uiReplace:components-forEach:${r}`,"Component to replace: ",e)();let i;if(e.id?i=document.getElementById(e.id):e.selector||e.select?i=document.querySelector(e.selector):e.name?i=document.querySelector(`[name="${e.name}"]`):e.type&&(i=document.querySelector(e.type)),s("trace",`Ui:_uiReplace:components-forEach:${r}`,"Element to replace: ",i)(),i==null){s("trace",`Ui:_uiReplace:components-forEach:${r}:noReplace`,"Cannot find the DOM element. Adding instead.",e)(),this._uiAdd({components:[e]},!1);return}let n;switch(e.type){case"html":{e.ns="html",n=document.createElement("div");break}case"svg":{e.ns="svg",n=document.createElementNS("http://www.w3.org/2000/svg","svg");break}default:{e.ns="dom",n=document.createElement(e.type);break}}this._uiComposeComponent(n,e),i.replaceWith(n),e.components&&this._uiExtendEl(n,e.components,e.ns)})}_uiUpdate(t){s("trace","Ui:_uiManager:update","Starting _uiUpdate")(),t.components||(t.components=[Object.assign({},t)]),t.components.forEach((e,r)=>{s("trace","_uiUpdate:components-forEach",`Component #${r}`,e)();let i;if(e.id?i=document.querySelectorAll(`#${e.id}`):e.selector||e.select?i=document.querySelectorAll(e.selector):e.name?i=document.querySelectorAll(`[name="${e.name}"]`):e.type&&(i=document.querySelectorAll(e.type)),i===void 0||i.length<1){s("warn","Ui:_uiManager:update","Cannot find the DOM element. Ignoring.",e)();return}s("trace","_uiUpdate:components-forEach",`Element(s) to update. Count: ${i.length}`,i)(),!e.slot&&e.payload&&(e.slot=e.payload),i.forEach(n=>{this._uiComposeComponent(n,e)}),e.components&&i.forEach(n=>{s("trace","_uiUpdate:components","el",n)(),this._uiUpdate({method:t.method,parentEl:n,components:e.components})})})}_uiLoad(t){t.components&&(Array.isArray(t.components)||(t.components=[t.components]),t.components.forEach(async e=>{await import(e)})),t.srcScripts&&(Array.isArray(t.srcScripts)||(t.srcScripts=[t.srcScripts]),t.srcScripts.forEach(e=>{this.loadScriptSrc(e)})),t.txtScripts&&(Array.isArray(t.txtScripts)||(t.txtScripts=[t.txtScripts]),this.loadScriptTxt(t.txtScripts.join(`
`))),t.srcStyles&&(Array.isArray(t.srcStyles)||(t.srcStyles=[t.srcStyles]),t.srcStyles.forEach(e=>{this.loadStyleSrc(e)})),t.txtStyles&&(Array.isArray(t.txtStyles)||(t.txtStyles=[t.txtStyles]),this.loadStyleTxt(t.txtStyles.join(`
`)))}_uiReload(){s("trace","Ui:uiManager:reload","reloading")(),location.reload()}_uiManager(t){t._ui&&(Array.isArray(t._ui)||(t._ui=[t._ui]),t._ui.forEach((e,r)=>{if(!e.method){s("error","Ui:_uiManager",`No method defined for msg._ui[${r}]. Ignoring`)();return}switch(e.payload=t.payload,e.topic=t.topic,e.method){case"add":{this._uiAdd(e,!1);break}case"remove":{this._uiRemove(e,!1);break}case"removeAll":{this._uiRemove(e,!0);break}case"replace":{this._uiReplace(e);break}case"update":{this._uiUpdate(e);break}case"load":{this._uiLoad(e);break}case"reload":{this._uiReload();break}case"notify":{this.showDialog("notify",e,t);break}case"alert":{this.showDialog("alert",e,t);break}default:{s("error","Ui:_uiManager",`Invalid msg._ui[${r}].method (${e.method}). Ignoring`)();break}}}))}nodeGet(t,e){const r={id:t.id===""?void 0:t.id,name:t.name,children:t.childNodes.length,type:t.nodeName,attributes:void 0,isUserInput:!!t.validity,userInput:t.validity?{value:t.value,validity:void 0,willValidate:t.willValidate,valueAsDate:t.valueAsDate,valueAsNumber:t.valueAsNumber,type:t.type}:void 0};if(["UL","OL"].includes(t.nodeName)){const i=document.querySelectorAll(`${e} li`);i&&(r.list={entries:i.length})}if(t.nodeName==="DL"){const i=document.querySelectorAll(`${e} dt`);i&&(r.list={entries:i.length})}if(t.nodeName==="TABLE"){const i=document.querySelectorAll(`${e} > tbody > tr`),n=document.querySelectorAll(`${e} > thead > tr`),a=document.querySelectorAll(`${e} > tbody > tr:last-child > *`);(i||n||a)&&(r.table={headRows:n?n.length:0,bodyRows:i?i.length:0,columns:a?a.length:0})}if(t.nodeName!=="#text"&&t.attributes&&t.attributes.length>0){r.attributes={};for(const i of t.attributes)i.name!=="id"&&(r.attributes[i.name]=t.attributes[i.name].value)}t.nodeName==="#text"&&(r.text=t.textContent),t.validity&&(r.userInput.validity={});for(const i in t.validity)r.userInput.validity[i]=t.validity[i];return r}uiGet(t,e=null){const r=document.querySelectorAll(t),i=[];return r.forEach(n=>{if(e!==null&&e!==""){let a=n.getAttribute(e);if(a==null)try{a=n[e]}catch{}if(a==null)e.toLowerCase()==="value"?i.push(n.innerText):i.push(`Property '${e}' not found`);else if(a.constructor.name==="NamedNodeMap"){const o={};for(const l of a)o[l.name]=a[l.name].value;i.push(o)}else if(!a.constructor.name.toLowerCase().includes("map"))i.push({[e]:a});else{const o={};for(const l in a)o[l]=a[l];i.push(o)}}else i.push(this.nodeGet(n,t))}),i}async include(t,e){if(!fetch)return s(0,"Ui:include","Current environment does not include `fetch`, skipping.")(),"Current environment does not include `fetch`, skipping.";if(!t)return s(0,"Ui:include","url parameter must be provided, skipping.")(),"url parameter must be provided, skipping.";if(!e||!e.id)return s(0,"Ui:include","uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.")(),"uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.";let r;try{r=await fetch(t)}catch(c){return s(0,"Ui:include",`Fetch of file '${t}' failed. `,c.message)(),c.message}if(!r.ok)return s(0,"Ui:include",`Fetch of file '${t}' failed. Status='${r.statusText}'`)(),r.statusText;const i=await r.headers.get("content-type");let n=null;i&&(i.includes("text/html")?n="html":i.includes("application/json")?n="json":i.includes("multipart/form-data")?n="form":i.includes("image/")?n="image":i.includes("video/")?n="video":i.includes("application/pdf")?n="pdf":i.includes("text/plain")&&(n="text"));let a="",o="Include successful",l;switch(n){case"html":{l=await r.text(),a=l;break}case"json":{l=await r.json(),a='<pre class="syntax-highlight">',a+=this.syntaxHighlight(l),a+="</pre>";break}case"form":{l=await r.formData(),a='<pre class="syntax-highlight">',a+=this.syntaxHighlight(l),a+="</pre>";break}case"image":{l=await r.blob(),a=`<img src="${URL.createObjectURL(l)}">`,window&&window.DOMPurify&&(o="Include successful. BUT DOMPurify loaded which may block its use.",s("warn","Ui:include:image",o)());break}case"video":{l=await r.blob(),a=`<video controls autoplay><source src="${URL.createObjectURL(l)}"></video>`,window&&window.DOMPurify&&(o="Include successful. BUT DOMPurify loaded which may block its use.",s("warn","Ui:include:video",o)());break}case"pdf":case"text":default:{l=await r.blob(),a=`<iframe style="resize:both;width:inherit;height:inherit;" src="${URL.createObjectURL(l)}">`,window&&window.DOMPurify&&(o="Include successful. BUT DOMPurify loaded which may block its use.",s("warn",`Ui:include:${n}`,o)());break}}return e.type="div",e.slot=a,e.parent||(e.parent="body"),e.attributes||(e.attributes={class:"included"}),this._uiReplace({components:[e]}),s("trace",`Ui:include:${n}`,o)(),o}};module.exports=u;
//# sourceMappingURL=ui.js.map
