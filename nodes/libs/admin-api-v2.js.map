{
  "version": 3,
  "sources": ["src/libs/admin-api-v2.js"],
  "sourcesContent": ["/** v2 Admin API ExpressJS Router Handler\n *\n * See: https://expressjs.com/en/4x/api.html#router, https://expressjs.com/en/guide/routing.html\n *\n * Copyright (c) 2021-2023 Julian Knight (Totally Information)\n * https://it.knightnet.org.uk, https://github.com/TotallyInformation/node-red-contrib-uibuilder\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict'\n\n/** --- Type Defs ---\n * @typedef {import('../../typedefs.js').uibConfig} uibConfig\n */\n\nconst express = require('express')\nconst path = require('path')\nconst fs = require('fs-extra')  // https://github.com/jprichardson/node-fs-extra#nodejs-fs-extra\n// const uiblib = require('./uiblib')  // Utility library for uibuilder\nconst web = require('./web')\nconst sockets = require('./socket')\nconst packageMgt                    = require('./package-mgt')\nconst tilib  = require('./tilib')   // General purpose library (by Totally Information)\n\nconst errUibRootFldr = new Error('uib.rootFolder is null')\n\nconst v2AdminRouter = express.Router() // eslint-disable-line new-cap\n\n//#region === REST API Validation functions === //\n\n/** Validate url query parameter\n * @param {object} params The GET (res.query) or POST (res.body) parameters\n * @param {string} params.url The uibuilder url to check\n * @returns {{statusMessage: string, status: number}} Status message\n */\nfunction chkParamUrl(params) {\n    const res = { 'statusMessage': '', 'status': 0 }\n\n    // We have to have a url to work with - the url defines the start folder\n    if ( params.url === undefined ) {\n        res.statusMessage = 'url parameter not provided'\n        res.status = 500\n        return res\n    }\n\n    // Trim the url\n    params.url = params.url.trim()\n\n    // URL must not exceed 20 characters\n    if ( params.url.length > 20 ) {\n        res.statusMessage = `url parameter is too long. Max 20 characters: ${params.url}`\n        res.status = 500\n        return res\n    }\n\n    // URL must be more than 0 characters\n    if ( params.url.length < 1 ) {\n        res.statusMessage = 'url parameter is empty, please provide a value'\n        res.status = 500\n        return res\n    }\n\n    // URL cannot contain .. to prevent escaping sub-folder structure\n    if ( params.url.includes('..') ) {\n        res.statusMessage = `url parameter may not contain \"..\": ${params.url}`\n        res.status = 500\n        return res\n    }\n\n    // Actually, since uib auto-creates folder if not exists, this just gets in the way - // Does this url have a matching instance root folder?\n    // if ( ! fs.existsSync(path.join(uib.rootFolder, params.url)) ) {\n    //     res.statusMessage = `url does not have a matching instance root folder. url='${params.url}', Master root folder='${uib.rootFolder}'`\n    //     res.status = 500\n    //     return res\n    // }\n\n    return res\n} // ---- End of fn chkParamUrl ---- //\n\n/** Validate fname (filename) query parameter\n * @param {object} params The GET (res.query) or POST (res.body) parameters\n * @param {string} params.fname The uibuilder url to check\n * @returns {{statusMessage: string, status: number}} Status message\n */\nfunction chkParamFname(params) {\n    const res = { 'statusMessage': '', 'status': 0 }\n    const fname = params.fname\n\n    // We have to have an fname (file name) to work with\n    if ( fname === undefined ) {\n        res.statusMessage = 'file name not provided'\n        res.status = 500\n        return res\n    }\n    // Blank file name probably means no files available so we will ignore\n    if ( fname === '' ) {\n        res.statusMessage = 'file name cannot be blank'\n        res.status = 500\n        return res\n    }\n    // fname must not exceed 255 characters\n    if ( fname.length > 255 ) {\n        res.statusMessage = `file name is too long. Max 255 characters: ${params.fname}`\n        res.status = 500\n        return res\n    }\n    // fname cannot contain .. to prevent escaping sub-folder structure\n    if ( fname.includes('..') ) {\n        res.statusMessage = `file name may not contain \"..\": ${params.fname}`\n        res.status = 500\n        return res\n    }\n\n    return res\n} // ---- End of fn chkParamFname ---- //\n\n/** Validate folder query parameter\n * @param {object} params The GET (res.query) or POST (res.body) parameters\n * @param {string} params.folder The uibuilder url to check\n * @returns {{statusMessage: string, status: number}} Status message\n */\nfunction chkParamFldr(params) {\n    const res = { 'statusMessage': '', 'status': 0 }\n    const folder = params.folder\n\n    // we have to have a folder name\n    if ( folder === undefined ) {\n        res.statusMessage = 'folder name not provided'\n        res.status = 500\n        return res\n    }\n    // folder name must be >0 in length\n    if ( folder === '' ) {\n        res.statusMessage = 'folder name cannot be blank'\n        res.status = 500\n        return res\n    }\n    // folder name must not exceed 255 characters\n    if ( folder.length > 255 ) {\n        res.statusMessage = `folder name is too long. Max 255 characters: ${folder}`\n        res.status = 500\n        return res\n    }\n    // folder name cannot contain .. to prevent escaping sub-folder structure\n    if ( folder.includes('..') ) {\n        res.statusMessage = `folder name may not contain \"..\": ${folder}`\n        res.status = 500\n        return res\n    }\n\n    return res\n} // ---- End of fn chkParamFldr ---- //\n\n//#endregion === End of API validation functions === //\n\n/** uibuilder detailed information page\n * @param {uibConfig} uib Reference to uibuilder's master uib object\n * @param {string} urlPrefix The URL href prefix\n * @returns {string} HTML string output\n */\nfunction detailsPage(uib, urlPrefix) {\n    if (uib.rootFolder === null) throw errUibRootFldr\n    const rootFolder = uib.rootFolder\n\n    const RED = uib.RED\n    const log = RED.log\n    const routes = web.dumpRoutes(false)\n    const urlRoot = `${urlPrefix}${uib.nodeRoot.replace('/', '')}${uib.moduleName}`\n\n    // Fix for one person who had a failure on JSON parse with win32 circular ref - weird\n    let uibSummary = {}\n    try {\n        uibSummary = Object.assign({}, uib) // JSON.parse(JSON.stringify(uib))\n        delete uibSummary.me\n        delete uibSummary.RED\n    } catch (e) {\n        log.warn(`[uibuilder:apiv2:detailsPage] Could not parse uib object, some info will be missing. ${e.message}`)\n    }\n\n    // Build the web page\n    let page = `\n        <!doctype html><html lang=\"en\"><head>\n            <title>Uibuilder Index</title>\n            <link rel=\"icon\" href=\"${urlRoot}/common/images/node-blue.ico\">\n            <link type=\"text/css\" rel=\"stylesheet\" href=\"${urlRoot}/uib-brand.min.css\" media=\"screen\">\n            <style type=\"text/css\" rel=\"stylesheet\" media=\"all\">\n                h2 { border-top:1px solid silver;margin-top:1em;padding-top:0.5em; }\n                .col3i tbody>tr>:nth-child(3){ font-style:italic; }\n            </style>\n        </head><body class=\"uib\"><div class=\"container\">\n            <h1>uibuilder Detailed Information Page</h1>\n            <p>\n                Note that this page is only accessible to users with Node-RED admin authority.\n            </p>\n    `\n\n    /** Index of uibuilder instances */\n    page += `\n            <h2>Index of uibuilder pages</h2>\n            <p>'Folders' refer to locations on your Node-RED's server. 'Paths' refer to URL's in the browser.</p>\n            <table class=\"uib-info-tb table table-sm\">\n                <thead><tr>\n                    <th>URL</th>\n                    <th title=\"Use this to search for the source node in the admin ui\">Source Node Instance <a href=\"#i2\"><sup>(2)</sup></th>\n                    <th>Server Filing System Folder</th>\n                </tr></thead><tbody>\n    `\n    Object.keys(uib.instances).forEach(key => {\n        page += `\n            <tr>\n                <td><a href=\"${urlPrefix}${tilib.urlJoin(uib.nodeRoot, uib.instances[key]).replace('/', '')}\" target=\"_blank\">${uib.instances[key]}</a></td>\n                <td>${key}</td>\n                <td>${path.join(rootFolder, uib.instances[key])}</td>\n            </tr>\n        `\n    })\n    page += `\n        </tbody></table>\n        <p>Notes:</p>\n        <ol>\n            <li><a id=\"i1\"></a>\n                Each instance of uibuilder uses its own socket.io <i>namespace</i> that matches <code>httpNodeRoot/url</code>. \n                You can use this to manually send messages to your user interface.\n            </li>\n            <li><a id=\"i2\"></a>\n                Paste the Source Node Instance into the search feature in the Node-RED admin ui to find the instance.\n                The \"Filing System Folder\" shows you where the front-end (client browser) code lives.\n            </li>\n        </ol>\n    `\n\n    /** Table of Vendor Libraries available */\n    page += `\n        <h2>Vendor Client Libraries</h2>\n        <p>\n            You can include these libraries (packages) in any uibuilder served web page.\n            Note though that you need to find out the correct file and relative folder either by looking on \n            your Node-RED server in the location shown or by looking at the packages source online.\n        </p>\n        <table class=\"uib-info-tb table table-sm\">\n            <thead><tr>\n                <th>Package</th>\n                <th>Version</th>\n                <th>Browser Entry Point (est.) <a href=\"#vl1\"><sup>(1)</sup></a> <a href=\"#vl2\"><sup>(2)</sup></a></th>\n                <th>Server Filing System Folder</th>\n            </tr></thead><tbody>\n    `\n    const installedPackages = packageMgt.uibPackageJson.uibuilder.packages\n    Object.keys(installedPackages).forEach(packageName => {\n        const pj = installedPackages[packageName]\n\n        page += `\n            <tr>\n                <td><a href=\"${pj.homepage}\" title=\"Click to go to package's home page\">${packageName}</a></td>\n                <td title=\"Installed Version, Version Spec='${pj.spec}'\">${pj.installedVersion}</td>\n                <td title=\"Use this in your front-end code\">${pj.url}</td>\n                <td>${pj.installFolder}</td>\n            </tr>\n        `\n    })\n    page += `\n        </tbody></table>\n        <p>Notes:</p>\n        <ol>\n            <li><a id=\"vl1\"></a>\n                Always use relative URL's. All vendor URL's start <code>../uibuilder/vendor/</code>, \n                all uibuilder and custom file URL's start <code>./</code>.<br>\n                Using relative URL's saves you from needing to worry about http(s), ip names/addresses and port numbers.\n            </li>\n            <li><a id=\"vl2\"></a>\n                The 'Main Entry Point' shown is <i>usually</i> a JavaScript file that you will want in your index.html. \n                However, because this is reported by the authors of the package, it may refer to something completely different, \n                uibuilder has no way of knowing. Treat it as a hint rather than absolute truth. Check the packages documentation \n                for the correct library files to load.\n            </li>\n        </ol>\n    `\n\n    /** Configuration info */\n    page += `\n        <h2>Configuration</h2>\n\n        <h3>uibuilder</h3>\n        <table class=\"uib-info-tb table table-sm col3i\">\n            <tr>\n                <th>uibuilder Version</th>\n                <td>${uib.version}</td>\n                <td></td>\n            </tr>\n            <tr>\n                <th>uib.rootFolder</th>\n                <td>${rootFolder}</td>\n                <td>All uibuilder data lives here</td>\n            </tr>\n            <tr>\n                <th>uib.configFolder</th>\n                <td>${uib.configFolder}</td>\n                <td>uibuilder Global Configuration Folder</td>\n            </tr>\n            <tr>\n                <th>uib.commonFolder</th>\n                <td>${uib.commonFolder}</td>\n                <td>Used for loading common resources between multiple uibuilder instances</td>\n            </tr>\n            <tr>\n                <th>Common URL</th>\n                <td>../${uib.moduleName}/common</td>\n                <td>The common folder maps to this URL</td>\n            </tr>\n            <tr title=\"\">\n                <th>uib_socketPath</th>\n                <td>${sockets.uib_socketPath}</td>\n                <td>Unique path given to Socket.IO to ensure isolation from other Nodes that might also use it</td>\n            </tr>\n            <tr>\n                <th>uib.masterTemplateFolder</th>\n                <td>${uib.masterTemplateFolder}</td>\n                <td>The built-in source templates, can be copied to any instance</td>\n            </tr>\n        </table>\n\n        <h3>Configuration Files</h3>\n\n        <p>All are kept in the master configuration folder: ${uib.configFolder}</p>\n\n        <dl style=\"margin-left:1em;\">\n            <dt>${uib.sioUseMwName}</dt>\n            <dd>Custom Socket.IO Middleware file, also uibMiddleware.js.</dd>\n            <dt>uibMiddleware.js</dt>\n            <dd>Custom ExpressJS Middleware file.</dd>\n        </dl>\n\n        <h4>Dump of all uib master configuration settings</h4>\n        <pre>${tilib.syntaxHighlight( uibSummary )}</pre>\n\n        <h4>Dump of all uib settings.js entries</h4>\n        <pre>${tilib.syntaxHighlight( RED.settings.uibuilder ? RED.settings.uibuilder : 'NOT DEFINED' )}</pre>\n\n        <h3>Node-RED</h3>\n        <p>See the <code>&lt;userDir&gt;/settings.js</code> file and the \n        <a href=\"https://nodered.org/docs/\" target=\"_blank\">Node-RED documentation</a> for details.</p>\n        <table class=\"uib-info-tb table table-sm\">\n            <tr><th>userDir</th><td>${RED.settings.userDir}</td></tr>\n            <tr><th>httpNodeRoot</th><td>${uib.nodeRoot}</td></tr>\n            <tr><th>Node-RED Version</th><td>${RED.settings.version}</td></tr>\n            <tr><th>Min. Version Required by uibuilder</th><td>${uib.me['node-red'].version}</td></tr>\n        </table>\n\n        <h3>Node.js</h3>\n        <table class=\"uib-info-tb table table-sm\">\n            <tr><th>Version</th><td>${uib.nodeVersion.join('.')}</td></tr>\n            <tr><th>Min. version required by uibuilder</th><td>${uib.me.engines.node}</td></tr>\n        </table>\n    `\n\n    /** ExpressJS Configuration info */\n    page += `\n        <h2>ExpressJS Configuration</h2>\n        <p>\n            See the <a href=\"https://expressjs.com/en/api.html#app.settings.table\" target=\"_blank\">ExpressJS documentation</a> for details.\n            Note that ExpressJS Views are not current used by uibuilder\n        </p>\n        <table class=\"uib-info-tb table table-sm\">\n            <tr><th>Views Folder</th><td>${web.app.get('views')}</td></tr>\n            <tr><th>Views Engine</th><td>${web.app.get('view engine')}</td></tr>\n            <tr><th>Views Cache</th><td>${web.app.get('view cache')}</td></tr>\n        </table>\n        <h3>app.locals</h3>\n        <pre>${tilib.syntaxHighlight( web.app.locals )}</pre>\n        <h3>app.mountpath</h3>\n        <pre>${tilib.syntaxHighlight( web.app.mountpath )}</pre>\n    `\n\n    // Show the ExpressJS paths currently defined\n    // web.routers contains descriptive info on routes, routes.user contains the ExpressJS route stack info.\n    // console.log('>> web >>', web.htmlBuildTable( web.routers.user, ['name', 'desc', 'path', 'type', 'folder'] ))\n    page += `\n        <h2>uibuilder ExpressJS Routes</h2>\n        <p>These tables show all of the web URL routes for uibuilder.</p>\n        <h3>User-Facing Routes</h3>\n        ${web.htmlBuildTable( web.routers.user, ['name', 'desc', 'path', 'type', 'folder'] )}\n        <h4>ExpressJS technical route data for admin routes</h4>\n        <h5>Application Routes (<code>../*</code>)</h5>\n        ${web.htmlBuildTable( routes.user.app, ['name', 'path', 'folder', 'route'] )}\n        <h5>uibuilder generic Routes (<code>../uibuilder/*</code>)</h5>\n        ${web.htmlBuildTable( routes.user.uibRouter, ['name', 'path', 'folder', 'route'] )}\n        <h5>Vendor Routes (<code>../uibuilder/vendor/*</code>)</h5>\n        ${web.htmlBuildTable( routes.user.vendorRouter, ['name', 'path', 'folder', 'route'] )}\n        <hr>\n        <h3>Per-Instance User-Facing Routes</h3>\n    `\n    Object.keys(routes.instances).forEach( url => {\n        page += `\n            <h4>${url}</h4>\n            ${web.htmlBuildTable( web.routers.instances[url], ['name', 'desc', 'path', 'type', 'folder'] )}\n            <h5>ExpressJS technical route data for <code>${url}</code> (<code>../${url}/*</code>)</h5>\n            ${web.htmlBuildTable( routes.instances[url], ['name', 'path', 'folder', 'route'] )}\n        `\n    } )\n    page += `\n        <hr>\n        <h3>Admin-Facing Routes</h3>\n        ${web.htmlBuildTable( web.routers.admin, ['name', 'desc', 'path', 'type', 'folder'] )}\n        <h4>ExpressJS technical route data for admin routes</h4>\n        <h5>Node-RED Admin Routes (<code>../*</code>)</h5>\n        <p>Note: Shows ALL Node-RED top-level admin routes, not just uibuilder</p>\n        ${web.htmlBuildTable( routes.admin.app, ['name', 'path', 'folder', 'route'] )}\n        <h5>Admin uibuilder Routes (<code>../uibuilder/*</code>)</h5>\n        ${web.htmlBuildTable( routes.admin.admin, ['name', 'path', 'folder', 'route'] )}\n        <h5>Admin v3 API Routes (<code>../uibuilder/admin</code>)</h5>\n        <p>Note: This route uses the following methods: all, get, put, post, delete.</p>\n        ${web.htmlBuildTable( routes.admin.v3, ['name', 'path', 'folder', 'route'] )}\n        <h5>Admin v2 API Routes (<code>../uibuilder/*</code>)</h5>\n        ${web.htmlBuildTable( routes.admin.v2, ['name', 'path', 'folder', 'route'] )}\n    `\n\n    page += '</div></body></html>'\n\n    return page\n}\n\n/** Return a router but allow parameters to be passed in\n * @param {uibConfig} uib Reference to uibuilder's master uib object\n * @param {*} log Reference to uibuilder's log functions\n * @returns {express.Router} The v3 admin API ExpressJS router\n */\nfunction adminRouterV2(uib, log) {\n\n    /** uibuilder v3 unified Admin API router - new API commands should be added here */\n    // admin_Router_V3.route('/:url')\n\n    const RED = uib.RED\n\n    /** Create a simple NR admin API to return the content of a file in the `<userLib>/uibuilder/<url>/src` folder\n     * @param {string} url The admin api url to create\n     * @param {object} permissions The permissions required for access\n     * @param {Function} cb\n     **/\n    v2AdminRouter.get('/uibgetfile', function(/** @type {express.Request} */ req, /** @type {express.Response} */ res) {\n        //#region --- Parameter validation ---\n        /** req.query parameters\n         * url\n         * fname\n         * folder\n         */\n        const params = req.query\n\n        // @ts-ignore\n        const chkUrl = chkParamUrl(params)\n        if ( chkUrl.status !== 0 ) {\n            log.error(`[uibuilder:apiv2:uibgetfile] Admin API. ${chkUrl.statusMessage}`)\n            res.statusMessage = chkUrl.statusMessage\n            res.status(chkUrl.status).end()\n            return\n        }\n\n        // @ts-ignore\n        const chkFname = chkParamFname(params)\n        if ( chkFname.status !== 0 ) {\n            log.error(`[uibuilder:apiv2:uibgetfile] Admin API. ${chkFname.statusMessage}. url=${params.url}`)\n            res.statusMessage = chkFname.statusMessage\n            res.status(chkFname.status).end()\n            return\n        }\n\n        // @ts-ignore\n        const chkFldr = chkParamFldr(params)\n        if ( chkFldr.status !== 0 ) {\n            log.error(`[uibuilder:apiv2:uibgetfile] Admin API. ${chkFldr.statusMessage}. url=${params.url}`)\n            res.statusMessage = chkFldr.statusMessage\n            res.status(chkFldr.status).end()\n            return\n        }\n        //#endregion ---- ----\n\n        log.trace(`[uibuilder:apiv2:uibgetfile] Admin API. File get requested. url=${params.url}, file=${params.folder}/${params.fname}`)\n\n        // if fldr = root, no folder\n        if ( params.folder === 'root' ) params.folder = ''\n\n        // @ts-ignore\n        const filePathRoot = path.join(uib.rootFolder, params.url, params.folder)\n        // @ts-ignore\n        const filePath = path.join(filePathRoot, req.query.fname)\n\n        // Does the file exist?\n        if ( fs.existsSync(filePath) ) {\n            // Send back a plain text response body containing content of the file\n            res.type('text/plain').sendFile(\n                // @ts-ignore\n                req.query.fname,\n                {\n                    // Prevent injected relative paths from escaping `src` folder\n                    'root': filePathRoot,\n                    // Turn off caching\n                    'lastModified': false,\n                    'cacheControl': false,\n                    'dotfiles': 'allow',\n                }\n            )\n        } else {\n            log.error(`[uibuilder:apiv2:uibgetfile] Admin API. File does not exist '${filePath}'. url=${params.url}`)\n            res.statusMessage = 'File does not exist'\n            res.status(500).end()\n        }\n    }) // ---- End of uibgetfile ---- //\n\n    /** Create a simple NR admin API to UPDATE the content of a file in the `<userLib>/uibuilder/<url>/<folder>` folder\n     * @param {string} url The admin api url to create\n     * @param {object} permissions The permissions required for access (Express middleware)\n     * @param {Function} cb\n     **/\n    v2AdminRouter.post('/uibputfile', function(/** @type {express.Request} */ req, /** @type {express.Response} */ res) {\n        //#region ====== Parameter validation ====== //\n        const params = req.body\n\n        const chkUrl = chkParamUrl(params)\n        if ( chkUrl.status !== 0 ) {\n            log.error(`[uibuilder:apiv2:uibputfile] Admin API v2. ${chkUrl.statusMessage}`)\n            res.statusMessage = chkUrl.statusMessage\n            res.status(chkUrl.status).end()\n            return\n        }\n\n        const chkFname = chkParamFname(params)\n        if ( chkFname.status !== 0 ) {\n            log.error(`[uibuilder:apiv2:uibputfile] Admin API. ${chkFname.statusMessage}. url=${params.url}`)\n            res.statusMessage = chkFname.statusMessage\n            res.status(chkFname.status).end()\n            return\n        }\n\n        const chkFldr = chkParamFldr(params)\n        if ( chkFldr.status !== 0 ) {\n            log.error(`[uibuilder:apiv2:uibputfile] Admin API. ${chkFldr.statusMessage}. url=${params.url}`)\n            res.statusMessage = chkFldr.statusMessage\n            res.status(chkFldr.status).end()\n            return\n        }\n        //#endregion ====== ====== //\n\n        log.trace(`[uibuilder:apiv2:uibputfile] Admin API. File put requested. url=${params.url}, file=${params.folder}/${params.fname}, reload? ${params.reload}`)\n\n        // Fix for Issue #155 - if fldr = root, no folder\n        if ( params.folder === 'root' ) params.folder = '.'\n\n        const fullname = path.join(uib.rootFolder, params.url, params.folder, params.fname)\n\n        // eslint-disable-next-line no-unused-vars\n        fs.writeFile(fullname, req.body.data, function (err, data) {\n            if (err) {\n                // Send back a response message and code 200 = OK, 500 (Internal Server Error)=Update failed\n                log.error(`[uibuilder:apiv2:uibputfile] Admin API. File write FAIL. url=${params.url}, file=${params.folder}/${params.fname}`, err)\n                res.statusMessage = err\n                res.status(500).end()\n            } else {\n                // Send back a response message and code 200 = OK, 500 (Internal Server Error)=Update failed\n                log.trace(`[uibuilder:apiv2:uibputfile] Admin API. File write SUCCESS. url=${params.url}, file=${params.folder}/${params.fname}`)\n                res.statusMessage = 'File written successfully'\n                res.status(200).end()\n                // Reload connected clients if required by sending them a reload msg\n                if ( params.reload === 'true' ) {\n                    sockets.sendToFe2({\n                        '_uib': {\n                            'reload': true,\n                        }\n                    }, params.url)\n                }\n            }\n        })\n    }) // ---- End of uibputfile ---- //\n\n    /** Create an index web page or JSON return listing all uibuilder endpoints\n     * Also allows confirmation of whether a url is in use ('check' parameter) or a simple list of urls in use.\n     */\n    v2AdminRouter.get('/uibindex', function(/** @type {express.Request} */ req, /** @type {express.Response} */ res) {\n        log.trace('[uibindex] User Page/API. List all available uibuilder endpoints')\n\n        // If using own Express server, correct the URL's\n        const url = new URL(req.headers.referer)\n        url.pathname = ''\n        if (uib.customServer.port) {\n            // @ts-expect-error ts(2322)\n            url.port = uib.customServer.port\n        }\n        const urlPrefix = url.href\n\n        /** Return full details based on type parameter */\n        switch (req.query.type) {\n            case 'json': {\n                res.json(uib.instances)\n                break\n            }\n            case 'urls': {\n                res.json(Object.values(uib.instances))\n                break\n            }\n            // default to 'html' output type\n            default: {\n                const page = detailsPage(uib, urlPrefix)\n                res.send(page)\n                break\n            }\n        }\n    }) // ---- End of uibindex ---- //\n\n    /** Check & update installed front-end library packages, return list as JSON - this runs when NR Editor is loaded if a uib instance deployed */\n    v2AdminRouter.get('/uibvendorpackages', function(/** @type {express.Request} */ req, /** @type {express.Response} */ res) {\n\n        // Update the installed packages list\n        // web.serveVendorPackages()\n\n        res.json( packageMgt.uibPackageJson.uibuilder.packages )\n\n    }) // ---- End of uibvendorpackages ---- //\n\n    /** Call npm. Schema: {name:{(url),cmd}}\n     * If url parameter not provided, uibPath = <userDir>, else uibPath = <uib.rootFolder>/<url>\n     * Valid commands:\n     *    install, remove, update\n     *    * = run as npm command with --json output\n     * @param {string} [req.query.url=userDir] Optional. If present, CWD is set to the uibuilder folder for that instance. Otherwise CWD is set to the userDir.\n     * @param {string} req.query.cmd Command to run (see notes for this function)\n     */\n    v2AdminRouter.get('/uibnpmmanage', function(/** @type {express.Request} */ req, /** @type {express.Response} */ res) {\n        //#region --- Parameter validation (cmd, package) ---\n\n        const params = req.query\n\n        // Validate the npm command to be used.\n        if ( params.cmd === undefined ) {\n            log.error('[uibuilder:apiv2:uibnpmmanage] uibuilder Admin API. No command provided for npm management.')\n            res.statusMessage = 'npm command parameter not provided'\n            res.status(500).end()\n            return\n        }\n        switch (params.cmd) {\n            case 'install':\n            case 'remove':\n            case 'update':\n                break\n\n            default:\n                log.error('[uibuilder:apiv2:uibnpmmanage] Admin API. Invalid command provided for npm management.')\n                res.statusMessage = 'npm command parameter is invalid'\n                res.status(500).end()\n                return\n        }\n\n        // package name must not exceed 255 characters\n        // we have to have a package name\n        if ( params.package === undefined ) {\n            log.error('[uibuilder:apiv2:uibnpmmanage] Admin API. package parameter not provided')\n            res.statusMessage = 'package parameter not provided'\n            res.status(500).end()\n            return\n        }\n        if ( params.package.length > 255 ) {\n            log.error('[uibuilder:apiv2:uibnpmmanage] Admin API. package name parameter is too long (>255 characters)')\n            res.statusMessage = 'package name parameter is too long. Max 255 characters'\n            res.status(500).end()\n            return\n        }\n\n        // If install/update, we need the node instance as well\n        if ( params.cmd !== 'remove' ) {\n            // @ts-ignore\n            const chkUrl = chkParamUrl(params)\n            if ( chkUrl.status !== 0 ) {\n                log.error(`[uibuilder:apiv2:uibnpmmanage] Admin API. ${chkUrl.statusMessage}`)\n                res.statusMessage = chkUrl.statusMessage\n                res.status(chkUrl.status).end()\n                return\n            }\n        }\n\n        //#endregion ---- ----\n\n        const folder = RED.settings.userDir\n\n        log.info(`[uibuilder:apiv2:uibnpmmanage] Admin API. Running npm ${params.cmd} for package ${params.package} with tag/version '${params.tag}'`)\n\n        // delete package lock file as it seems to mess up sometimes - no error if it fails\n        fs.removeSync(path.join(folder, 'package-lock.json'))\n\n        // Formulate the command to be run\n        switch (params.cmd) {\n            case 'update':\n            case 'install': {\n                // @ts-expect-error\n                packageMgt.npmInstallPackage(params.url, params.package, params.tag)\n                    .then((npmOutput) => {\n                        // Get the updated package.json file into packageMgt.uibPackageJson\n                        packageMgt.getUibRootPackageJson()\n\n                        // Do a fast update of the min data in pj.uibuilder.packages required for web.serveVendorPackages() - re-saves the package.json file\n                        packageMgt.pkgsQuickUpd()\n\n                        // Update the packageList\n                        web.serveVendorPackages()\n\n                        res.json({ 'success': true, 'result': [npmOutput, packageMgt.uibPackageJson.uibuilder.packages] })\n\n                        // return success\n                        return true\n                    })\n                    .catch((err) => {\n                        // log.warn(`[uibuilder:apiv2:uibnpmmanage] Admin API. ERROR Running npm ${params.cmd} for package ${params.package}`, err.stdout)\n                        console.dir(err)\n                        log.warn(`[uibuilder:apiv2:uibnpmmanage:install] Admin API. ERROR Running: \\n'${err.command}' \\n${err.all}`)\n                        res.json({ 'success': false, 'result': err.all })\n                        return false\n                    })\n                break\n            }\n            case 'remove': {\n                // @ts-ignore\n                packageMgt.npmRemovePackage(params.package)\n                    .then((npmOutput) => {\n                        // Get the updated package.json file into packageMgt.uibPackageJson\n                        packageMgt.getUibRootPackageJson()\n\n                        // Do a fast update of the min data in pj.uibuilder.packages required for web.serveVendorPackages() - re-saves the package.json file\n                        packageMgt.pkgsQuickUpd()\n\n                        // TODO remove - just send back success\n\n                        // Update the packageList\n                        web.serveVendorPackages()\n\n                        res.json({ 'success': true, 'result': npmOutput })\n                        return true\n                    })\n                    .catch((err) => {\n                        // log.warn(`[uibuilder:apiv2:uibnpmmanage] Admin API. ERROR Running npm ${params.cmd} for package ${params.package}`, err.stdout)\n                        log.warn(`[uibuilder:apiv2:uibnpmmanage:remove] Admin API. ERROR Running: \\n'${err.command}' \\n${err.all}`)\n                        res.json({ 'success': false, 'result': err.all })\n                        return false\n                    })\n                break\n            }\n            default: {\n                log.error(`[uibuilder:apiv2:uibnpmmanage] Admin API. Command ${params.cmd} is not a valid command. Must be 'install', 'remove' or 'update'.`)\n                res.statusMessage = 'No valid npm command available'\n                res.status(500).end()\n                break\n            }\n        }\n\n    }) // ---- End of npmmanage ---- //\n\n    return v2AdminRouter\n}\n\nmodule.exports = adminRouterV2\n\n// EOF\n"],
  "mappings": "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",
  "names": ["express", "path", "fs", "web", "sockets", "packageMgt", "tilib", "errUibRootFldr", "v2AdminRouter", "chkParamUrl", "params", "res", "chkParamFname", "fname", "chkParamFldr", "folder", "detailsPage", "uib", "urlPrefix", "rootFolder", "RED", "log", "routes", "urlRoot", "uibSummary", "e", "page", "key", "installedPackages", "packageName", "pj", "url", "adminRouterV2", "req", "chkUrl", "chkFname", "chkFldr", "filePathRoot", "filePath", "fullname", "err", "data", "npmOutput"]
}
