<style>.emoji {
        font-family: 
            "Twemoji Mozilla",
            "Apple Color Emoji",
            "Segoe UI Emoji",
            "Segoe UI Symbol",
            "Noto Color Emoji",
            "EmojiOne Color",
            "Android Emoji",
            sans-serif;
    }</style><script type="text/html" data-template-name="uibuilder"><div class="form-row tabs-row"><ul id="tabs"></ul></div><div id="tabs-content" x-style="border-bottom: 1px solid silver; padding-bottom: 1em; margin-bottom: 1em;"><div id="tab-core"><div id="url-input" aria-label="Home 'page' id. Defines the URL used" class="form-row" title="Make sure this gives a unique URL. Also used as a folder name for resources."><label for="node-input-url"><i class="fa fa-globe"></i> URL</label> <input type="text" id="node-input-url" title="Cannot be 'templates. Cannot contain: space _ / \\ ..'" placeholder="Required. <20 chars. Unique"></div><div id="info" aria-label="Information and utility links" class="form-row" style="display: flex; justify-content: space-between; width:450px"><a id="uibuilderurl" title="Open the uibuilder web page" href="uibindex" target="_blank" class="red-ui-button editor-button"><i class="fa fa-globe" aria-hidden="true"></i> Open </a><a href="./uibuilder/uibindex" target="_blank" class="red-ui-button editor-button" title="Shows available libraries, configuration and other detailed uibuilder information"><i class="fa fa-info-circle" aria-hidden="true"></i> Full details </a><a id="uibinstanceconf" href="./uibuilder/instance/_url_?cmd=showinstancesettings" target="_blank" class="red-ui-button editor-button" title="Shows detailed configuration for this instance of uibuilder"><i class="fa fa-info" aria-hidden="true"></i> Node details </a><a href="./uibuilder/docs" target="_blank" class="red-ui-button editor-button" title="Shows the uibuilder documentation as a new page"><i class="fa fa-book" aria-hidden="true"></i> Docs</a></div><div id="info-webserver" class="form-row" style="width:450px"></div><div aria-label="Node Name" class="form-row" title="Node Name (descriptive only)"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name"></div><div aria-label="Topic" class="form-row" title="Adds a msg.topic to input msgs if not already provided"><label for="node-input-topic"><i class="fa fa-tasks"></i> Topic</label> <input type="text" id="node-input-topic"></div><h4>Template Settings</h4><div aria-label="Template selector" class="form-row"><label for="node-input-templateFolder" style="width:100px;"><i class="fa fa-window-restore"></i> Template</label> <select id="node-input-templateFolder" style="width:70%;"></select></div><div aria-label="Hidden unless external template is selected above" id="et-input" class="form-row" title="Input a Degit compatible repository name. e.g. totallyinformation&sol;uib-template-test" style="display:none"><label for="node-input-extTemplate"><i class="fa fa-globe"></i> External</label> <input type="text" id="node-input-extTemplate" placeholder="totallyinformation/uib-template-test"></div><div aria-label="Button to load new template" class="form-row"><label for="btn-load-template" style="width:100px;"></label> <button class="btn" id="btn-load-template" style="margin-top: 0.3em;" title="Load selected template, overwriting existing files">Load & Overwrite Files</button></div><div aria-label="How to use the template selector" class="form-row" style="max-width: 450px"><p>By default, uibuilder creates an instance root folder with the "Blank" template. If you wish to use a different template, select and load it here.</p><p>Selecting a Template from the drop-down <b>does not</b> load the template</p><p>Loading a Template <b><u>will</u> overwrite</b> existing same-named files.</p></div></div><div id="tab-files"><div aria-label="Drop-down for selecting folder & new, del buttons" class="form-row" title="Choose between the src, dist (built src) or root folders"><label for="node-input-folder" style="width:5em;"><i class="fa fa-folder-open-o"></i> Folder:</label> <select id="node-input-folder" style="width:63%;"></select> <span id="fldr-buttons"><button class="btn" id="btn-fldr-new" title="Add a new folder">New</button><div id="fldr-new-dialog" title="Create a new folder" dialog><label for="fldr-input-newname">New Folder Name</label> <input type="text" id="fldr-input-newname"><div title="" style="margin-top:.5em;">New folder will be created inside <code>&lt;uibRoot>/<span id="fldr_url">&lt;url></span></code>.<br>Do not forget to include sub-folder name if needed.<br>e.g. <code>src/mynewfldr</code></div></div><button class="btn" id="btn-fldr-del" title="Delete the selected folder">Del</button><div id="fldr-del-dialog" title="Delete the currently selected folder" dialog><b>Folder to be deleted</b><p><code id="fldr-del-name"></code></p><p id="fldr-del-recopy"></p><p style="border:2px solid brown;color:brown;font-weight:bold;padding:5px 5px;">Warning: This action cannot be undone.<br>If you delete the <code>src</code> or <code>dist</code> folders some things might not work correctly.</p></div></span></div><div aria-label="Drop-down for selecting file to edit" class="form-row"><label for="node-input-filename" style="width:5em;"><i class="fa fa-file-code-o"></i> File:</label> <select id="node-input-filename" style="width: 83%;"></select></div><div aria-label="Save, Reset, close, (message), Delete" class="form-row"><button class="btn" id="edit-save" title="Save any changes to the file">Save</button> <button class="btn" id="edit-reset" title="Reset any changes to last saved version (cancel changes)">Reset</button> <span id="file-action-message"></span><div style="position: absolute;right:1.6em;display:inline-block;"><button class="btn" id="edit-new" title="Add a new file.">New</button><div dialog id="edit_new_dialog" title="Create a new file"><label for="edit-input-newname">New File Name</label> <input type="text" id="edit-input-newname"><div style="margin-top:.5em;">New file will be created inside the <code>&lt;uibRoot>/<span id="file_url">&lt;url></span>/<span id="file_fldr">&lt;folder></span></code> folder.<br>You can include a sub-folder name if needed. Intermediate folders will be automatically created.<br>e.g. <code>src/mynewfldr/myfile.js</code></div></div><button class="btn" id="edit-delete" title="Delete the file. Will reset to the default template if Copy from templates flag is set.">Delete</button><div id="edit_delete_dialog" title="Delete the currently selected file" dialog><b>File to be deleted</b><p><code id="edit-delete-name"></code></p><p id="edit-delete-recopy"></p><p style="border:2px solid brown;color:brown;font-weight:bold;padding:5px 5px;">Warning: This action cannot be undone.</p></div></div></div><div aria-label="Edit box editor-tray-content" id="edit-outer" class="form-row node-text-editor-row" style="position:relative"><div style="height: 350px; min-height:150px;" class="node-text-editor" id="node-input-template-editor"></div><div style="height: 350px; min-height:150px;" style="display:hidden" id="node-input-template-editor-no-file">No file available, please select a different file or folder.</div></div><div aria-label="File data (hidden), language selector" class="form-row"><button id="node-function-expand-js" class="editor-button"><i class="fa fa-expand"></i></button> <input type="checkbox" id="node-input-reload" style="width:auto;" title="If set, all connected clients will reload the page they are on when any change is saved."> <label for="node-input-reload" style="width:80%;">Reload connected clients on save?.</label> <input type="hidden" id="node-input-template" data-isclean="true"><div style="position: absolute; right:1.6em;display:inline-block; text-align: right;"><select id="node-input-format" style="width:110px; padding:0;"><option value="text">Text</option><option value="html">HTML</option><option value="javascript">Javascript</option><option value="json">JSON</option><option value="css">CSS</option><option value="scss">SCSS</option><option value="handlebars">mustache</option><option value="markdown">Markdown</option><option value="yaml">YAML</option></select></div></div></div><div id="tab-libraries"><p>Install, remove or update npm packages that provide front-end libraries such as VueJS, jQuery, MoonJS, etc.<br>Search for packages on <a href="https://www.npmjs.com/" target="_blank" style="color:var(--red-ui-text-color-link);text-decoration:underline;">official npm site</a> or <a href="https://npms.io/" target="_blank" style="color:var(--red-ui-text-color-link);text-decoration:underline;">npms.io</a>.</p><div aria-label="Package List Container" class="form-row" id="package-list-container"><ol id="node-input-packageList"></ol></div></div><div id="tab-advanced"><div aria-label="Information" class="form-row form-tips node-help">uibuilder version: <b id="uib_version">--</b></div><div aria-label="Select source folder" class="form-row" title="Select the folder to serve files from"><label for="node-input-sourceFolder"><i class="fa fa-folder"></i> Serve:</label> <input type="text" id="node-input-sourceFolder" style="width:75%;"></div><div aria-label="Source folder information" class="form-row form-tips node-help">Selects the folder that will be served as the root folder of your web app.<br>The folder <b>must</b> contain an <code>index.html</code> file as a minimum.<br>If it doesn't, you will get an error.<br>Need to re-deploy for the folder to change.</div><div aria-label="Pass the msg._uib to standard message output?" class="form-row" title="If turned on, msg._uib included in standard msgs"><input type="checkbox" id="node-input-showMsgUib" style="display: inline-block; width: auto; vertical-align: top;"> <label for="node-input-showMsgUib" style="width: 90%;">Include <code>msg._uib</code> in standard msg output.</label></div><div aria-label="msg._uib information" class="form-row form-tips node-help">This includes the <code>clientId</code>, <code>remoteAddress</code> and <code>pageName</code> properties from the client in the output<br>The <code>clientId</code> is generated in the browser and remains stable while the browser is open. It is reset when the browser restarts. Control msgs always include <code>msg.clientId</code>.</div><div aria-label="Provide a searchable file index view?" class="form-row" title="If turned on, an index page showing all available files is created. This can be a security vulnerability and not recommended in Production."><input type="checkbox" id="node-input-showfolder" style="display: inline-block; width: auto; vertical-align: top;"> <label for="node-input-showfolder" style="width: 90%;">Show web view of source files (deploy before you can use it)</label> <span id="show-src-folder-idx-url">_</span>.</div><div aria-label="For old client library only. Allow scripts/styles to be passed to front-end?" class="form-row" title="Add msg.script&sol;msg.style to the input msg. This can be a security issue as the data is NOT VETTED.">Allow passing to the front-end<br>(old client library only, use msg._ui for new libraries):<br><input type="checkbox" id="node-input-allowScripts" style="display: inline-block; width: auto; vertical-align: top;"> <label for="node-input-allowScripts">Scripts? (JS)</label> <input type="checkbox" id="node-input-allowStyles" style="display: inline-block; width: auto; vertical-align: top;"> <label for="node-input-allowStyles">Styles? (CSS)</label></div><div aria-label="Forward flag" class="form-row" title="forward inbound msg's direct to the output"><input type="checkbox" id="node-input-fwdInMessages" style="display: inline-block; width: auto; vertical-align: top;"> <label for="node-input-fwdInMessages" style="width: 90%;">Forward input msgs to output?</label></div></div></div></script><script type="text/html" data-help-name="uibuilder"><p>Provides a stand-alone web server that allows for interfacing with Node-RED, while giving you help and complete freedom to create custom web interfaces.<br><br>You need at least one of these in order to make full use of all of uibuilder's features.</p><p>It is this node that creates a custom web server. You can have many nodes if that best meets your needs. But each node can serve many pages.</p><p>It also creates a set of filing system folders and files on the Node-RED server. These define the front-end UI you see in the browser as well as providing some important configuration.</p><p>This node is also where you configure much of uibuilder's web server such as installing helper libraries that you may wish to use to support your interfaces (e.g. VueJS, jQuery, etc). You can also use it to edit your custom UI code.</p><p id="uib_help_docs">Detailed documentation can be found <a href="./uibuilder/docs" target="_blank">HERE</a>.</p><p>More information on how to configure this node: <a href="./uibuilder/docs/#/nodes/uibuilder" target="_blank">uibuilder node configuration</a>.</p><p>Specific information on how to use the front-end library: <a href="./uibuilder/docs/#/uibuilder.module" target="_blank">Client Library</a>.</p><h3>Status display</h3><p>Each instance (node) of uibuilder has a status display. Normally, the icon is blue. When 1 or more clients are connected, the text will show how many clients are connected.</p><h3>Inputs</h3><dl class="message-properties"><dt class="optional">payload <span class="property-type">string | buffer</span></dt><dd>Optionally, the payload of the message to send to all connected client browser tabs.</dd><dt class="optional">_uib <span class="property-type">object</span></dt><dd>Optionally, trigger low-code front-end events such as <a href="./uibuilder/docs/#/pre-defined-msgs?id=ui-notification-toast-control-message-partially-deprecated-in-v51" target="_blank">showing a notification message</a>. Also used to <a href="uibuilder/docs/#/pre-defined-msgs?id=browser-client-reload-page" target="_blank">signal to the front-end that the page should reload automatically</a>. Useful when developing front-end code via the node's editor.</dd><dt class="optional">topic <span class="property-type">string</span></dt><dd>Optionally, the MQTT topic to use. Takes preference over the topic defined in settings.</dd><dt class="optional">script <span class="property-type">string | string[]</span></dt><dd>Optionally, a string or array of strings containing valid JavaScript. This will be added to the web page dynamically. Currently contains minimal validation so care is required. This feature is <b>off</b> by default, turn on in the Advanced Settings.</dd><dt class="optional">style <span class="property-type">string | string[]</span></dt><dd>Optionally, a string or array of strings containing valid CSS for styling the front-end page. This will be added to the web page dynamically. Currently contains minimal validation so care is required. This feature is <b>off</b> by default, turn on in the Advanced Settings.</dd></dl><h3>Outputs</h3><ol class="node-ports"><li>Standard output (data from front-end)<dl class="message-properties"><dt class="optional">payload <span class="property-type">string | buffer</span></dt><dd>Typical data sent by the client.</dd><dt class="optional">uibDomEvent <span class="property-type">object</span></dt><dd>Used by the <code>uibuilder.eventSend()</code> front-end function. See the <a href="./uibuilder/docs/#/client-docs/features?id=eventsend-function" target="_blank">eventSend feature in the documentation</a> for specifics.</dd><dt>topic <span class="property-type">string</span></dt><dd>A copy of the last inbound topic if present. Otherwise, the topic from the node's settings. Could also be changed by the front-end.</dd><dt class="optional">_uib <span class="property-type">string</span></dt><dd>Included only if turned on in advanced settings. Provides detailed information about the sending client. Useful for custom security processing.<br><br>See the control output below for more specifics.</dd><dt>other</dt><dd>The client may send other data on the <code>msg</code> object.</dd></dl><p>Note that input messages are not forwarded to the output unless the flag is set in the advanced settings.</p></li><li>Control output (controls from front-end or server)<dl class="message-properties"><dt>uibuilderCtrl <span class="property-type">string</span></dt><dd>The name/id of the control message. See the <a href="./uibuilder/docs/#/pre-defined-msg" target="_blank">documentation</a> for details.</dd><dt>cacheControl <span class="property-type">string</span></dt><dd>Use in your flow to control the sending or clearing of a cache of messages to be sent to new/refreshed clients.<br>This requires a separate function node to capture and replay inbound messages.<table><tr><th>REPLAY</th><td>Indicate to the back-end flow that a copy of the cached messages should be dumped to the front-end. Retaining the <code>_socket.id</code> will send the cache contents back to the requesting client.<hr></td></tr><tr><th>CLEAR</th><td>Indicate to the back-end flow that any cache should be completely cleared for everyone.</td></tr></table>See the <a href="./uibuilder/docs/#/pre-defined-msg" target="_blank">documentation</a> for details.</dd><dt>from <span class="property-type">string</span></dt><dd>Identifies the source of the msg since both <i>server</i> (back-end) and <i>client</i> (front-end) control messages will appear out of port #2.</dd><dt>Other <span class="property-type">string</span></dt><dd>Additional details about the client the message relates to is included. This varies somewhat between the different control message types. See <a href="./uibuilder/docs/#/pre-defined-msg" target="_blank">the documentation</a> for more details.</dd></dl></li></ol><h3>Node Settings</h3><dl class="message-properties"><dt>Name <span class="property-type">string</span></dt><dd>A short description shown in the admin interface</dd><dt>Topic <span class="property-type">string</span></dt><dd>A topic name to use if the incoming msg does not contain one.</dd><dt>URL <span class="property-type">string</span></dt><dd>There is no default and this entry is required.<br>The URL path that the resulting page and other resources will be served from. Must be unique across Node-RED. Will also use the Node-RED scheme (http/https) and port or the custom uibuilder scheme and port if specified in settings.js. Will also be prefixed by the Node-RED setting <i>httpNodeRoot</i>.<br>The url is also used to define the server filing system path for front-end code files.<br>The url must be valid as a filename as well as a url path. It may not exceed 20 characters.</dd><h4>Files tab</h4><p>Clicking this tab will display a file editor allowing you to edit the front-end files that define your user interface.<br>All text-based files in the <code>&lt;uibRoot>/&lt;url>/</code> folder on the server's filing system will be available to edit.</p><p>Note that you can expand the edit panel by clicking on the <kbd class="help-key">&#x2921;</kbd> arrow button underneath the panel. To exit fullscreen, press the same button (now highlighted) or the <kbd class="help-key">Esc</kbd> key.</p><p></p></dl><h4>Template Settings</h4><dl class="message-properties"><dt>Template <span class="property-type">drop-down</span></dt><dd>Select one of the built-in templates or load an external template.</dd><dt>Ext. Template <span class="property-type">text</span></dt><dd>Only if "Load an external template using Degit" is selected. <a href="https://github.com/Rich-Harris/degit" target="_blank">Degit</a> is used to load a template from an external <code>git</code> repository.<br>Try "totallyinformation/uib-template-test" as an example.</dd><dt>Load & Overwrite <span class="property-type">button</span></dt><dd>Clicking the button will display a warning dialog. If you accept the warning, all of your current front-end code will be replaced with the template.</dd></dl><h4>Libraries tab</h4><p>Clicking this tab will display a list of currently available front-end library packages. This interface allows you to add, remove and update any library that can be installed via <a href="https://www.npmjs.com/" target="_blank">npm</a>.<br>Libraries will be loaded into your <code>&lt;userDir>/</code> folder in the same place as custom nodes. uibuilder retains an internal list of front-end libraries loaded this way. Each library will be served so that you can use it in your front-end html.</p><h4>Advanced tab</h4><dl class="message-properties"><dt>Serve <span class="property-type">drop-down</span></dt><dd>Choose which folder to serve files from. Only <code>src</code> and <code>dist</code> are available at the moment. This can now be changed simply by redeploying your flow, you don't need to restart Node-RED.</dd><dt>Include <code>msg._uib</code> in standard msg output <span class="property-type">check box</span></dt><dd>If selected, will show the browser clientId, page name and real IP address in standard output (it is always shown in control msgs).</dd><dt>Show web view of source files <span class="property-type">check box</span></dt><dd>If on, an extra web page is dynamically created at the indicated URL. That page shows an index listing of all files and folders on the server for this node. As this could be a security issue, it is turned off by default.<br><code>USE WITH EXTREME CAUTION</code><br>A button is exposed if this flag is on. Clicking the button will take you to the index view in a separate tab.</dd><dt>Allow scripts to be passed to front-end? <span class="property-type">check box</span></dt><dd>If on, any string(s) in <code>msg.script</code> will be dynamically added to the scripts of the web page. Turn off to prevent scripts from being dynamically added and executed.<br><b>NOTE</b>: It is better to use uibuilder's <code>msg._ui</code> low-code features for passing scripts.</dd><dt>Allow styles to be passed to front-end? <span class="property-type">check box</span></dt><dd>If on, any string(s) in <code>msg.style</code> will be dynamically added to the styles of the web page. Turn off to prevent styles from being dynamically added.<br><b>NOTE</b>: It is better to use uibuilder's <code>msg._ui</code> low-code features for passing styles.</dd><dt>Forward input to output? <span class="property-type">check box</span></dt><dd>Forwards a copy of every received message direct to the output. Adds the topic from the above setting if one isn't present in the msg.<p><i>Note</i> that this may result in multiple output messages if your front-end code also auto-sends inbound messages.</p></dd></dl><h4>Button Row</h4><dl class="message-properties"><dt><i class="fa fa-globe" aria-hidden="true"></i> Open <span class="property-type">link</span></dt><dd>The web app url for this instance. Click to see the app page in a new tab. Also available as a button at the top of the panel on all tabs.</dd><dt><i class="fa fa-info-circle" aria-hidden="true"></i> Full details <span class="property-type">link</span></dt><dd>Shows a web page with detailed information about the overall uibuilder configuration. Including details of all of the vendor modules that are available and all of the uibuilder endpoints along with both server and URL paths.</dd><dt><i class="fa fa-info" aria-hidden="true"></i> Node Details <span class="property-type">link</span></dt><dd>Shows a web page with detailed information relavent just for this instance (node) of uibuilder. May be easier to read than the full details.</dd><dt><i class="fa fa-book" aria-hidden="true"></i> Docs <span class="property-type">link</span></dt><dd>Opens the documentation for uibuilder in a separate tab. This does not require an Internet connection, the local docs are used. Also available as a button at the top of the panel on all tabs.</dd></dl><h3>File/Folder Structure</h3><p>For more information, see the <a href="./uibuilder/docs" target="_blank">uibuilder documentation</a>.</p><h3>Details</h3><p>For more information, see the <a href="./uibuilder/docs" target="_blank">uibuilder documentation</a>.</p><p>There are also examples of how to use uibuilder in the Node-RED import library, on the <a href="https://flows.nodered.org/search?term=uibuilder" target="_blank"></a>, and in the <a href="https://github.com/TotallyInformation/node-red-contrib-uibuilder/wiki" target="_blank">GitHub WIKI</a>.</p><p>uibuilder can be discussed in the <a href="https://discourse.nodered.org/tag/node-red-contrib-uibuilder" target="_blank">Node-RED Forum</a>. Issues/bugs can be raised on <a href="https://github.com/TotallyInformation/node-red-contrib-uibuilder/issues" target="_blank">GitHub</a>.</p><h3>Admin Index (Details) page</h3><p>The <a href="uibindex" target="_blank">&lt;admin url&gt;/uibindex</a> page lists all of the uibuilder endpoints and other details. You can use the following parameters:</p><dl class="message-properties"><dt>type <span class="property-type">(string)</span></dt><dd>The type of the data returned.<dl class="message-properties"><dt>html <span class="property-type">(default)</span></dt><dd>Also used if no type parameter is given. Returns an HTML page showing the details for all deployed uibuilder nodes. Shows the server file locations of the instance and for vendor libraries.</dd><dt>json</dt><dd>Returns JSON data with both the source node ID's and matching URL's.</dd><dt>urls</dt><dd>Returns a JSON array of just the URL's in use from deployed uibuilder nodes. Used internally to ensure that new nodes use unique url's.</dd></dl></dd><dt>check <span class="property-type">(string)</span></dt><dd>Passing a uibuilder instance name to the check parameter will result in a boolean (true/false) return. True if it is being delivered by a uibuilder instance, false otherwise. e.g. <code>?check=uibuilder</code></dd></dl><ul></ul></script><script>!function(){"use strict";const e="127.0.0.1"===location.hostname,n=e?console.log:function(){};if(n("[uibuilder] DEBUG ON (because running on localhost)"),Object.entries||(Object.entries=function(e){var t=Object.keys(e);let i=t.length;for(var o=new Array(i);i--;)o[i]=[t[i],e[t[i]]];return o}),!Object.values){const C=Function.bind.call(Function.call,Array.prototype.reduce),T=Reflect.ownKeys,L=Function.bind.call(Function.call,Array.prototype.concat),O=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable);Object.values=function(i){return C(T(i),(e,t)=>L(e,"string"==typeof t&&O(i,t)?[i[t]]:[]),[])}}const r="blank",l={};let d=[],i=RED.settings.uibuilderInstances;const u={format:"html",folder:"src",fname:"index.html",fullscreen:!1};let t=[];function a(o){console.log(">>>> do update",o.data.pkgName);const n=o.data.pkgName,i=o.data.node;RED.notify("Installing npm package "+n),$.get(`uibuilder/uibnpmmanage?cmd=update&package=${n}&url=`+i.url,function(e){var t=e.result[0];!0===e.success?(d=e.result[1],console.log("[uibuilder:doPkgUpd:get] PACKAGE INSTALLED. ",n,i.url,"\n\n",t,"\n "),RED.notify("Successful update of npm package "+n,"success"),$("#node-input-packageList").editableList("empty"),$("#node-input-packageList").editableList("addItems",Object.keys(d))):(console.log("[uibuilder:doPkgUpd:get] ERROR ON INSTALLATION OF PACKAGE ",n,i.url,"\n\n",t,"\n "),RED.notify("FAILED update of npm package "+n,"error")),$("i.spinner").hide()}).fail(function(e,t,i){return console.error("[uibuilder:doPkgUpd:get] Error "+t,i),RED.notify("FAILED update of npm package "+n,"error"),$("i.spinner").hide(),"addPackageRow failed"}),$.ajax({type:"PUT",dataType:"json",url:"./uibuilder/admin/"+o.data.node.url,data:{cmd:"updatepackage",pkgName:o.data.pkgName}}).done(function(e,t,i){}).fail(function(e,t,i){console.error("[uibuilder:doPkgUpd:PUT] Error "+t,i),RED.notify(`uibuilder: Package update for '${o.data.pkgName}' failed.<br>`+i,{type:"error"})}),$("#upd_"+o.data.pkgName).hide().next().text("XXX")}function o(o){if(""===o||"string"!=typeof o)return"No package";RED.notify("Starting removal of npm package "+o),$("i.spinner").show(),$.get("uibuilder/uibnpmmanage?cmd=remove&package="+o,function(e){!0===e.success?(console.log("[uibuilder:removePackageRow:get] PACKAGE REMOVED. ",o),RED.notify("Successfully uninstalled npm package "+o,"success"),d[o]&&delete d[o]):(console.log("[uibuilder:removePackageRow:get] ERROR ON PACKAGE REMOVAL ",e.result),RED.notify("FAILED to uninstall npm package "+o,"error"),$("#node-input-packageList").editableList("addItem",o)),$("i.spinner").hide()}).fail(function(e,t,i){return console.error("[uibuilder:removePackageRow:get] Error "+t,i),RED.notify("FAILED to uninstall npm package "+o,"error"),$("#node-input-packageList").editableList("addItem",o),$("i.spinner").hide(),"removePackageRow failed"})}function c(e){let t="text";e=e.split(".");if(""===e[0]&&e.shift(),1<e.length){var i=e.pop().toLowerCase().trim();switch(i){case"js":t="javascript";break;case"html":case"css":case"json":t=i;break;case"vue":t="html";break;case"md":t="markdown";break;case"yaml":case"yml":t="yaml";break;default:t=i}}return t}function s(e){$("#edit-save").prop("disabled",e),$("#edit-reset").prop("disabled",e),$("#edit-close").prop("disabled",!e),$("#node-edit-file").prop("disabled",!e),$("#node-input-filename").prop("disabled",!e),$("#node-dialog-ok").prop("disabled",!e),$("#node-dialog-cancel").prop("disabled",!e),e?($("#node-dialog-ok").css("cursor","pointer"),$("#node-dialog-cancel").css("cursor","pointer")):($("#file-action-message").text("Save Required"),$("#node-dialog-ok").css("cursor","not-allowed"),$("#node-dialog-cancel").css("cursor","not-allowed"))}function p(){var e=$("#node-input-url").val();let t=$("#node-input-folder").val(),i=(null===t&&(t=localStorage.getItem("uibuilder."+e+".folder")||u.folder),$("#node-input-filename").val());null===i&&(i=localStorage.getItem("uibuilder."+e+".selectedFile")||u.fname),u.folder=t,u.fname=i,localStorage.setItem("uibuilder."+e+".folder",u.folder),localStorage.setItem("uibuilder."+e+".selectedFile",u.fname);const o=u.format=c(i);$("#node-input-format").val(o),$.get("uibuilder/uibgetfile?url="+e+"&fname="+i+"&folder="+t,function(e){$("#node-input-template-editor").show(),$("#node-input-template-editor-no-file").hide(),u.editorSession.setValue(e),u.editorSession.setMode({path:"ace/mode/"+o,v:Date.now()}),u.editorSession.getUndoManager().isClean(),u.editor.focus()}).fail(function(e,t,i){console.error("[uibuilder:getFileContents:get] Error "+t,i),u.editorSession.setValue(""),$("#node-input-template-editor").hide(),$("#node-input-template-editor-no-file").show()}).always(function(){s(!0),$("#node-input-format option:selected").length||$("#node-input-format").val("text")})}function f(d){const a=$("#node-input-url").val();let s=$("#node-input-folder").val();var e=$("#node-input-filename").val();null===(d=void 0===d?e:d)&&(d=localStorage.getItem("uibuilder."+a+".selectedFile")||void 0),null===s&&(s=localStorage.getItem("uibuilder."+a+".folder")||void 0),$("#node-input-filename option").remove(),$("#node-input-folder option").remove(),$.ajax({type:"GET",dataType:"json",url:"./uibuilder/admin/"+a,data:{cmd:"listall"}}).done(function(e,t,i){let o="",n=!1,r=!1;var l=Object.keys(e).sort(),l=($.each(l,function(e,t){""===t&&(t="root"),$("#node-input-folder").append($("<option>",{value:t,text:t}))}),e[s]||(s=e.src?"src":"root"),$("#node-input-folder").val(s),u.folder=s,localStorage.setItem("uibuilder."+a+".folder",s),e[s]);$.each(l,function(e,t){$("#node-input-filename").append($("<option>",{value:t,text:t})),0===e&&(o=t),t===u.fname&&(n=!0),t===d&&(r=!0)}),!0===r?u.fname=d:!0===n?u.fname="index.html":u.fname=o,$("#node-input-filename").val(u.fname),u.format=c(u.fname),localStorage.setItem("uibuilder."+a+".selectedFile",u.fname)}).fail(function(e,t,i){console.error("[uibuilder:getFileList:getJSON] Error "+t,i),u.fname="",u.format="text",RED.notify("uibuilder: Folder and file listing error.<br>"+i,{type:"error"})}).always(function(){p()})}function b(){var e=$("#node-input-url").val(),e=$.ajax({async:!1,type:"GET",dataType:"json",url:"./uibuilder/admin/"+e,data:{cmd:"listfolders"}});t=e.responseJSON,$("#node-input-sourceFolder").typedInput({types:[{value:"sourceFolders",options:t}]})}function g(){let t;if(!0===u.editorLoaded){if(document.fullscreenElement)$("#edit-props").css("background-color","#f6f6f6").css("padding","1em"),t=parseInt($("#edit-props").css("height"),10),t-=25,$("#node-function-expand-js").css("background-color","black").html('<i class="fa fa-compress"></i>'),u.fullscreen=!0;else{if("auto"===$("#edit-outer").css("top"))return;$("#edit-props").css("background-color","").css("padding",""),t=$(".red-ui-tray-footer").position().top-$("#edit-outer").offset().top-35,$("#node-function-expand-js").css("background-color","").html('<i class="fa fa-expand"></i>'),u.fullscreen=!1}var i=$("#edit-props > div:not(.node-text-editor-row)");for(let e=0;e<i.length;e++)t-=$(i[e]).outerHeight(!0);$("#node-input-template-editor").css("height",t+"px"),u.editor.resize()}}function m(){var e=RED.settings.get("auth-tokens"),t=new XMLHttpRequest,i="fname="+$("#node-input-filename").val()+"&folder="+$("#node-input-folder").val()+"&url="+$("#node-input-url").val()+"&reload="+$("#node-input-reload").prop("checked")+"&data="+encodeURIComponent(u.editorSession.getValue());t.open("POST","uibuilder/uibputfile",!0),t.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&(200===this.status?($("#file-action-message").text("File Saved"),s(!0)):$("#file-action-message").text("File Save FAILED"))},t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e&&t.setRequestHeader("Authorization","Bearer "+e.access_token),t.send(i)}function h(e){$.ajax({type:"GET",async:!1,dataType:"json",url:"./uibuilder/admin/_",data:{cmd:"listinstances"},success:function(e){i=e}}),e&&(e.isDeployed=void 0!==i[e.id])}function y(e,t=!0){!0===t?($("#node-input-templateFolder, #btn-load-template").prop("disabled",!1).css({cursor:"pointer"}),$("#red-ui-tab-tab-files, #red-ui-tab-tab-libraries, #red-ui-tab-tab-security, #red-ui-tab-tab-advanced, info").css({cursor:"pointer"}),$("#red-ui-tab-tab-files>a, #red-ui-tab-tab-libraries>a, #red-ui-tab-tab-security>a, #red-ui-tab-tab-advanced>a, info>a").prop("disabled",!1).css({"pointer-events":"auto",cursor:"pointer",opacity:1}),$("#uibuilderurl, #uibinstanceconf").prop("disabled",!1).css({cursor:"pointer",opacity:1}),$("#url-errors").remove()):($("#node-input-templateFolder, #btn-load-template").prop("disabled",!0).css({cursor:"not-allowed"}),$("#red-ui-tab-tab-files, #red-ui-tab-tab-libraries, #red-ui-tab-tab-security, #red-ui-tab-tab-advanced, info").css({cursor:"not-allowed"}),$("#red-ui-tab-tab-files>a, #red-ui-tab-tab-libraries>a, #red-ui-tab-tab-security>a, #red-ui-tab-tab-advanced>a, info>a").prop("disabled",!0).css({"pointer-events":"none",cursor:"not-allowed",opacity:.3}),$("#uibuilderurl, #uibinstanceconf, #btntopopen").prop("disabled",!0).css({cursor:"not-allowed",opacity:.3}),$("#url-errors").remove(),$("#url-input").after(`
                    <div id="url-errors" class="form-row" style="color:var(--red-ui-text-color-error)">
                        ${Object.values(e).join("<br>")} 
                    </div>
                `))}function v(){var e=$("#node-input-templateFolder").val();if(RED.settings.uibuilderTemplates[e]){var t=RED.settings.uibuilderTemplates[e].dependencies||[];const i=[];if(t.forEach(e=>{d[e]||i.push(e)}),0<i.length){const o=RED.notify(`WARNING<br /><br />The selected uibuilder template (${e}) is MISSING the following dependencies:<div> ${i.join(", ")}</div><br />Please install them using the uibuilder Library Manager or select a different template.`,{type:"warning",modal:!0,fixed:!0,buttons:[{text:"OK",class:"primary",click:function(){o.close()}}]})}}else console.error("[uibuilder:checkDependencies] Template name not found: "+e)}function E(){const o=RED.notify(`WARNING<br /><br />
                Are you <b>SURE</b> you want to overwrite your code
                with the template <b><code>${$("#node-input-templateFolder").val()}</code></b>?<br /><br />
                <b>THIS CANNOT BE UNDONE.</b>`,{type:"warning",modal:!0,fixed:!0,buttons:[{text:"Cancel, don't overwrite",class:"primary",click:function(){o.close()}},{text:"OK, overwrite",click:function(){var e,t,i;e=$("#node-input-templateFolder").val(),t=$("#node-input-extTemplate").val(),i=$("#node-input-url").val(),$.ajax({type:"POST",dataType:"json",url:"./uibuilder/admin/"+i,data:{template:e,extTemplate:t,cmd:"replaceTemplate"}}).done(function(e,t,i){return RED.notify(`<b>uibuilder</b>:<br><br>${i.statusText}<br>`,{type:"success"}),"Template load succeeded"}).fail(function(e,t,i){return console.error("[uibuilder:loadTemplate] Error "+t,i),RED.notify(`<b>uibuilder</b>:<br><br>Template Load Error.<br><br>${i}<br>`,{type:"error"}),"Template load failed"}),o.close()}}]})}function w(i){$("#adv-templ").hide(),$("#show-templ-props").css("cursor","pointer"),$("#show-templ-props").on("click",function(){$("#adv-templ").toggle(),$("#adv-templ").is(":visible")?$("#show-templ-props").html('<i class="fa fa-caret-down"></i> Template Settings'):$("#show-templ-props").html('<i class="fa fa-caret-right"></i> Template Settings')});{var o=i;let e=o.templateFolder,t=[];RED.settings&&RED.settings.uibuilderTemplates?t=RED.settings.uibuilderTemplates:console.error("[uibuilder:populateTemplateDropdown] Cannot access RED.settings for node "+o.id),Object.values(t).forEach(e=>{$("#node-input-templateFolder").append($("<option>",{value:e.folder,text:e.name}))}),t[e]||(e=r),$(`#node-input-templateFolder option[value="${e}"]`).prop("selected",!0),$("#node-input-templateFolder").val(e),$("#node-templSel-info").text(t[e].description),e}v(),"external"===$("#node-input-templateFolder").val()&&$("#et-input").show(),$("#node-input-templateFolder").on("change",function(){RED.settings.uibuilderTemplates[i.templateFolder]&&$("#node-templSel-info").text(RED.settings.uibuilderTemplates[i.templateFolder].description),v(),"external"===$("#node-input-templateFolder").val()?$("#et-input").show():$("#et-input").hide()}),$("#btn-load-template").on("click",function(e){e.preventDefault(),E()})}function k(){return $(".red-ui-tray-footer").position().top-$("#package-list-container").offset().top+25}function R(l){$("#node-input-packageList").editableList({addItem:function(e,i,o){{var n=l,r=i;i=o;let t="";if(0===Object.entries(i).length)t=`
                    <div>
                        <label for="packageList-input-${r}" style="width:3em;">Name:</label>
                        <input type="text" id="packageList-input-${r}" title="" style="width:80%" placeholder="Valid npm package name">
                    </div>
                    <div>
                        <label for="packageList-tag-${r}" style="width:3em;">Tag:</label>
                        <input type="text" id="packageList-tag-${r}" title="" style="width:80%" placeholder="npm: @tag/version, GH: #branch/tag">
                    </div>
                    <div>
                        <label for="packageList-button-${r}" style="width:3em;"></label>
                        <button id="packageList-button-${r}" style="width:5em;">Install</button>
                    </div>
                `;else{let e="";(o=d[i]).outdated&&o.outdated.wanted&&o.installedVersion!==o.outdated.wanted&&(e=`<button id="upd_${i}" style="color:orange;background-color:black;" title="Click to update (or install again to get a non-standard version)">UPDATE: ${o.outdated.wanted}</button>`,$("#node-input-packageList").on("click","#upd_"+i,{pkgName:i,node:n},a)),t=`
                    <div id="packageList-row-${r}" class="packageList-row-data">
                        <div style="display:flex;justify-content:space-between;">
                            <div>
                                <a href="${o.homepage}" target="_blank" title="Click to open package homepage in a new tab">
                                    <b>${i}</b> <span class="emoji">ℹ️</span>
                                </a>
                            </div>
                            <div style="margin-left:auto;text-align:right;">
                                ${e}
                                <span title="npm version specification: ${o.spec}">${o.installedVersion}</span>
                            </div>
                        </div>
                        <div title="NB: This link is an estimate, check the package docs for the actual entry point" style="display:flex;justify-content:space-between;">
                            <div>Est.&nbsp;link:</div>
                            <div style="margin-left:auto;text-align:right;"><code style="white-space:inherit;text-decoration: underline;"><a href="${n.urlPrefix}${o.url}" target="_blank">
                                ${o.url}
                            </code></div>
                        </div>
                    </div>
                `}$(t).appendTo(e),0===Object.entries(i).length&&($("#packageList-input-"+r).tooltip({content:'Enter one of:<ul><li>An npm package name (optionally with leading)</li><li>A GitHub user/repo</li><li>A filing system path to a local package</li></ul>Ensure that you select the correct "From" dropdown.'}),$("#packageList-ver-"+r).tooltip({content:"Optional. Branch, Tag or Version to install (defaults to @latest)"})),$("#packageList-button-"+r).on("click",function(){$("i.spinner").show();const o=String($("#packageList-input-"+r).val());var e=String($("#packageList-tag-"+r).val());0!==o.length&&(RED.notify("Installing npm package "+o),$.get(`uibuilder/uibnpmmanage?cmd=install&package=${o}&url=${n.url}&tag=`+e,function(e){var t=e.result[0];!0===e.success?(d=e.result[1],console.log("[uibuilder:addPackageRow:get] PACKAGE INSTALLED. ",o,n.url,"\n\n",t,"\n "),RED.notify(`Successful installation of npm package ${o} for `+n.url,"success"),$("#node-input-packageList").editableList("empty"),$("#node-input-packageList").editableList("addItems",Object.keys(d))):(console.log("[uibuilder:addPackageRow:get] ERROR ON INSTALLATION OF PACKAGE ",o,n.url,"\n\n",t,"\n "),RED.notify(`FAILED installation of npm package ${o} for `+n.url,"error")),$("i.spinner").hide()}).fail(function(e,t,i){return console.error("[uibuilder:addPackageRow:get] Error "+t,i),RED.notify(`FAILED installation of npm package ${o} for `+n.url,"error"),$("i.spinner").hide(),"addPackageRow failed"}))})}},removeItem:o,header:$("<div>").append("<b>Installed Packages (Install again to update)</b>"),height:k(),addButton:!0,removable:!0,scrollOnAdd:!0,sortable:!1}),$("#node-input-packageList").editableList("empty"),$("#node-input-packageList").editableList("addItems",Object.keys(d)),$(".red-ui-editableList-addButton").after(' <i class="spinner"></i>'),$("i.spinner").hide()}function D(i){var e=RED.tabs.create({id:"tabs",scrollable:!1,collapsible:!1,onchange:function(e){switch($("#tabs-content").children().hide(),$("#"+e.id).show(),e.id){case"tab-files":t=i,f(),!0!==u.editorLoaded&&(""!==$("#node-input-template").val("")&&$("#node-input-template").val(""),u.editor=RED.editor.createEditor({id:"node-input-template-editor",mode:"ace/mode/"+u.format,value:t.template}),u.editorSession=u.editor.getSession(),u.editor.on("input",function(){s(u.editorSession.getUndoManager().isClean())}),u.editorLoaded=!0,document.getElementsByClassName("red-ui-editor-text-container").item(0).addEventListener("keydown",e=>{!0===e.ctrlKey&&"s"===e.key&&(e.preventDefault(),m())}),g(),p(),s(!0));break;case"tab-libraries":R(i)}var t}});e.addTab({id:"tab-core",label:"Core"}),e.addTab({id:"tab-files",label:"Files"}),e.addTab({id:"tab-libraries",label:"Libraries"}),e.addTab({id:"tab-advanced",label:"Advanced"})}function x(t){$('<button type="button" title="Open the uibuilder web page" id="btntopopen" class="ui-button ui-corner-all ui-widget leftButton"><i class="fa fa-globe" aria-hidden="true"></i> Open</button>').on("click",e=>{e.preventDefault(),window.open(""+t.urlPrefix+$("#node-input-url").val(),"_blank")}).appendTo($("div.red-ui-tray-toolbar")),$('<button type="button" title="Open uibuilder Documentation" class="ui-button ui-corner-all ui-widget leftButton"><i class="fa fa-book" aria-hidden="true"></i> Docs</button>').on("click",e=>{e.preventDefault(),RED.sidebar.help.show("uibuilder"),window.open("./uibuilder/docs","_blank")}).appendTo($("div.red-ui-tray-toolbar")),b(),$.ajax({dataType:"json",method:"get",url:"uibuilder/uibvendorpackages",async:!1,success:function(e){d=e},error:function(e){console.log("ERROR",e)}}),$("#uib_version").text(RED.settings.uibuilderCurrentVersion),void 0!==t.templateFolder&&""!==t.templateFolder||(t.templateFolder=r),i=t,$("#node-input-fwdInMessages").prop("checked",i.fwdInMessages),$("#node-input-allowScripts").prop("checked",i.allowScripts),$("#node-input-allowStyles").prop("checked",i.allowStyles),$("#node-input-copyIndex").prop("checked",i.copyIndex),$("#node-input-showfolder").prop("checked",i.showfolder),$("#node-input-useSecurity").prop("checked",i.useSecurity),$("#node-input-allowUnauth").prop("checked",i.allowUnauth),$("#node-input-tokenAutoExtend").prop("checked",i.tokenAutoExtend),$("#node-input-reload").prop("checked",i.reload),$("#node-input-showMsgUib").prop("checked",i.showMsgUib),D(t),$(`#node-input-sourceFolder option[value="${t.sourceFolder||"src"}"]`).prop("selected",!0),$("#node-input-sourceFolder").val(t.sourceFolder||"src"),$("#node-input-showfolder").on("change",function(){!1===$(this).is(":checked")?$("#show-src-folder-idx-url").hide():$("#show-src-folder-idx-url").show()}),w(t);{var i=t;let e;var o=window.origin.split(":");i.nodeRoot=RED.settings.httpNodeRoot.replace(/^\//,""),$("#info-webserver").empty(),e=!0===RED.settings.uibuilderCustomServer.isCustom?(o[0]=RED.settings.uibuilderCustomServer.type.replace("http2","https"),o[2]=RED.settings.uibuilderCustomServer.port,i.nodeRoot="","a custom"):"Node-RED's",i.urlPrefix=o.join(":")+"/"+i.nodeRoot,$("#info-webserver").append(`<div class="form-tips node-help">uibuilder is using ${e} webserver at <a href="${i.urlPrefix}${i.url}" target="_blank">${i.urlPrefix}</a><br>Server folder: <b>${RED.settings.uibuilderRootFolder}/${i.url}/${$("#node-input-sourceFolder").val()}/</b> </div>`)}$("#node-input-url").on("change",function(){!function(e){var t=$(this).val();$("#uibuilderurl").prop("href",""+e.urlPrefix+t),$("#uibinstanceconf").prop("href",`./uibuilder/instance/${t}?cmd=showinstancesettings`),$("#show-src-folder-idx-url").empty().append(`<div>at 
                        <a href="${e.urlPrefix}${t}/idx" target="_blank" 
                                style="color:var(--red-ui-text-color-link);text-decoration:underline;">
                            ${e.nodeRoot}${t}/idx
                        </a>
                    </div>`)}.call(this,t)}),void 0!==t.url&&""!==t.url||y(t.urlErrors,Object.keys(t.urlErrors).length<1),s(!0),$("#node-input-folder").change(function(){f()}),$("#node-input-filename").change(function(){p()}),$("#fldr-new-dialog_new").addClass("input-error").prop("disabled",!0),$("#fldr-input-newname").addClass("input-error").on("input",function(){0===$("#fldr-input-newname").val().length?($("#fldr-input-newname").addClass("input-error"),$("#fldr").addClass("input-error").prop("disabled",!0)):($("#fldr-input-newname").removeClass("input-error"),$("#fldr-new-dialog_new").removeClass("input-error").prop("disabled",!1))}),$("#fldr-new-dialog").dialog({autoOpen:!1,modal:!0,closeOnEscape:!0,buttons:[{text:"Create",id:"fldr-new-dialog_new",click:function(){var e,t;e=$("#fldr-input-newname").val(),t=$("#node-input-url").val(),$.ajax({type:"POST",dataType:"json",url:"./uibuilder/admin/"+t,data:{folder:e,cmd:"newfolder"}}).done(function(){return RED.notify(`uibuilder: Folder <code>${e}</code> Created.`,{type:"success"}),f(),b(),"Create folder succeeded"}).fail(function(e,t,i){return RED.notify("uibuilder: Create Folder Error.<br>"+i,{type:"error"}),"Create folder failed"}),$("#fldr-input-newname").val(null).addClass("input-error"),$("#fldr-new-dialog_new").addClass("input-error").prop("disabled",!0),$(this).dialog("close")}},{text:"Cancel",click:function(){$("#fldr-input-newname").val(null).addClass("input-error"),$("#fldr-new-dialog_new").addClass("input-error").prop("disabled",!0),$(this).dialog("close")}}]}).keyup(function(e){e.keyCode==$.ui.keyCode.ENTER&&$("#fldr_new_dialog_new").trigger("click")}),$("#btn-fldr-new").on("click",function(){$("#fldr_url").html($("#node-input-url").val()),$("#fldr-new-dialog").dialog("open")}),$("#fldr-del-dialog").dialog({autoOpen:!1,modal:!0,closeOnEscape:!0,buttons:[{text:"Delete",id:"fldr-del-dialog_del",click:function(){{var e=$("#node-input-url").val();const t=$("#node-input-folder").val();$.ajax({type:"DELETE",dataType:"json",url:"./uibuilder/admin/"+e,data:{folder:t,cmd:"deletefolder"}}).done(function(){return RED.notify(`uibuilder: Folder <code>${t}</code> deleted.`,{type:"success"}),f(),"Delete folder succeeded"}).fail(function(e,t,i){return console.error("[uibuilder:deleteFolder:delete] Error "+t,i),RED.notify("uibuilder: Delete Folder Error.<br>"+i,{type:"error"}),"Delete folder failed"})}$(this).dialog("close")}},{text:"Cancel",click:function(){$(this).dialog("close")}}]}),$("#btn-fldr-del").on("click",function(){$("#fldr-del-dialog_del").addClass("input-error").css("color","brown"),$("#fldr-del-name").text($("#node-input-folder").val()),"src"===$("#node-input-folder").val()?$("#node-input-copyIndex").is(":checked")?$("#fldr-del-recopy").css("color","").text("Copy flag is set so the src folder will be recreated and the index.(html|js|css) files will be recopied from the master template."):$("#fldr-del-recopy").css("color","brown").text("Copy flag is NOT set so the src folder will NOT be recopied from the master template."):$("#fldr-del-recopy").css("color","").text(""),$("#fldr-del-dialog").dialog("open")}),$("#edit-reset").on("click",function(e){e.preventDefault(),p(),$("#file-action-message").text("")}),$("#edit-save").on("click",function(e){e.preventDefault(),m()}),$("#edit_delete_dialog").dialog({autoOpen:!1,modal:!0,closeOnEscape:!0,buttons:[{text:"Delete",id:"edit_del_dialog_del",click:function(){{const t=$("#node-input-folder").val()||u.folder;var e=$("#node-input-url").val();const i=$("#node-input-filename").val();$.ajax({type:"DELETE",dataType:"json",url:"./uibuilder/admin/"+e,data:{folder:t,fname:i,cmd:"deletefile"}}).done(function(){return RED.notify(`uibuilder: File <code>${t}/${i}</code> Deleted.`,{type:"success"}),f(i),"Delete file succeeded"}).fail(function(e,t,i){return console.error("[uibuilder:deleteFile:delete] Error "+t,i),RED.notify("uibuilder: Delete File Error.<br>"+i,{type:"error"}),"Delete file failed"})}$(this).dialog("close")}},{text:"Cancel",click:function(){$(this).dialog("close")}}]}),$("#edit-delete").on("click",function(){$("#edit_del_dialog_del").addClass("input-error").css("color","brown"),$("#edit-delete-name").text($("#node-input-folder").val()+"/"+$("#node-input-filename").val()),"src"===$("#node-input-folder").val()?$("#node-input-copyIndex").is(":checked")?$("#edit-delete-recopy").css("color","").text("Copy flag is set so index.(html|js|css) files will be recopied from master template."):$("#edit-delete-recopy").css("color","brown").text("Copy flag is NOT set so index.(html|js|css) files will NOT be recopied from master template."):$("#edit-delete-recopy").css("color","").text(""),$("#edit_delete_dialog").dialog("open")}),$("#edit_new_dialog_new").addClass("input-error").prop("disabled",!0),$("#edit-input-newname").addClass("input-error").on("input",function(){0===$("#edit-input-newname").val().length?($("#edit-input-newname").addClass("input-error"),$("#edit_new_dialog_new").addClass("input-error").prop("disabled",!0)):($("#edit-input-newname").removeClass("input-error"),$("#edit_new_dialog_new").removeClass("input-error").prop("disabled",!1))}),$("#edit_new_dialog").dialog({autoOpen:!1,modal:!0,closeOnEscape:!0,buttons:[{text:"Create",id:"edit_new_dialog_new",click:function(){{var e=$("#edit-input-newname").val();const i=$("#node-input-folder").val()||u.folder;var t=$("#node-input-url").val();$.ajax({type:"POST",dataType:"json",url:"./uibuilder/admin/"+t,data:{folder:i,fname:e,cmd:"newfile"}}).done(function(){return RED.notify(`uibuilder: File <code>${i}/${e}</code> Created.`,{type:"success"}),f(e),"Create file succeeded"}).fail(function(e,t,i){return console.error("[uibuilder:createNewFile:post] Error "+t,i),RED.notify("uibuilder: Create File Error.<br>"+i,{type:"error"}),"Create file failed"})}$("#edit-input-newname").val(null).addClass("input-error"),$("#edit_new_dialog_new").addClass("input-error").prop("disabled",!0),$(this).dialog("close")}},{text:"Cancel",click:function(){$("#edit-input-newname").val(null).addClass("input-error"),$("#edit_new_dialog_new").addClass("input-error").prop("disabled",!0),$(this).dialog("close")}}]}).keyup(function(e){e.keyCode==$.ui.keyCode.ENTER&&$("#edit_new_dialog_new").click()}),$("#edit-new").on("click",function(){$("#file_url").html($("#node-input-url").val()),$("#file_fldr").html($("#node-input-folder").val()),$("#edit_new_dialog").dialog("open")}),$("#node-function-expand-js").on("click",function(e){e.preventDefault();const i=u.editor.getValue();RED.editor.editText({mode:$("#node-input-format").val(),value:i,width:"Infinity",cursor:u.editor.getCursorPosition(),complete:function(e,t){u.editor.setValue(e,-1),u.editor.gotoLine(t.row+1,t.column,!1),setTimeout(function(){u.editor.focus(),e!==i&&s(!1)},300)}})}),e&&n("[uibuilder] Settings:\n","\nNodeEnv: ",RED.settings.uibuilderNodeEnv,"\nCurrentVersion: ",RED.settings.uibuilderCurrentVersion,"\nRedeployNeeded: ",RED.settings.uibuilderRedeployNeeded,"\nRootFolder: ",RED.settings.uibuilderRootFolder,"\n\nTemplates: ",RED.settings.uibuilderTemplates,"\n\nCustomServer: ",RED.settings.uibuilderCustomServer,`
    
    Instances (${Object.keys(RED.settings.uibuilderInstances).length}): `,RED.settings.uibuilderInstances,`
    
    editorInstances (${Object.keys(l).length}): `,l,`
    
    packages (${Object.keys(d).length}): `,d)}RED.events.on("nodes:add",function(e){"uibuilder"===e.type&&(l[e.id]=e.url)}),RED.events.on("nodes:change",function(e){"uibuilder"===e.type&&(n("nodes:change:",e),l[e.id]=e.url)}),RED.events.on("nodes:remove",function(e){"uibuilder"===e.type&&(n(">> nodes:remove >>",e),delete l[e.id])}),RED.nodes.registerType("uibuilder",{category:"uibuilder",color:"#E6E0F8",defaults:{name:{value:""},topic:{value:""},url:{required:!0,validate:function(e){h(this),this.urlErrors={},this.urlDeployedChanged=i[this.id]!==e,this.urlChanged=this.url!==e;var t=Object.values(i).indexOf(e);return this.urlDeployedDup=-1<t&&Object.keys(i)[t]!==this.id,t=Object.values(l).indexOf(e),this.urlEditorDup=-1<t&&Object.keys(l)[t]!==this.id,!1===this.isDeployed&&!0===this.urlEditorDup&&(this.urlErrors.config="Pasted or imported, URL must be changed",e="",this.url=this.oldUrl=void 0,$("#node-input-url").val(""),n("[uib] >> Copy/Paste >>",this.id,"this.url:",this.url,", value:",e,", this.oldUrl:",this.oldUrl)),void 0===e&&(this.urlErrors.config="Not yet configured, valid URL needed"),void 0===e||""===e?this.urlErrors.none="Must not be empty":(20<e.length&&(this.urlErrors.len="Too long, must be <= 20 chars"),-1!==e.indexOf("..")&&(this.urlErrors.dbldot="Cannot contain <code>..</code> (double-dot)"),-1!==e.indexOf("/")&&(this.urlErrors.fslash="Cannot contain <code>/</code>"),-1!==e.indexOf("\\")&&(this.urlErrors.bslash="Cannot contain <code>\\</code>"),-1!==e.indexOf(" ")&&(this.urlErrors.sp="Cannot contain spaces"),"_"===e.substring(0,1)&&(this.urlErrors.strtU="Cannot start with <code>_</code> (underscore)"),"."===e.substring(0,1)&&(this.urlErrors.strtDot="Cannot start with <code>.</code> (dot)"),"templates"===e.toLowerCase().substring(0,9)&&(this.urlErrors.templ='Cannot be "templates"'),"uibuilder"===e.toLowerCase()&&(this.urlErrors.uibname='Cannot be "uibuilder" (since v5)')),!0===this.urlDeployedDup&&(this.urlErrors.dup="Cannot be a URL already deployed"),!0===this.urlEditorDup&&(this.urlErrors.dup="Cannot be a URL already in use"),void 0!==e&&""!==e&&(this.folderExists=function(e){if(void 0===e)return!1;let o=!1;return $.ajax({type:"GET",async:!1,dataType:"json",url:"./uibuilder/admin/"+e,data:{cmd:"checkfolder"},success:function(e){o=e},error:function(e,t,i){"Not Found"!==i&&console.error("[uibuilder:queryFolderExists] Error "+t,i),o=!1}}),o}(e),!0===this.folderExists&&!0===this.urlChanged&&(n(">> folder already exists >>",this.url,this.id),RED.notify(`<b>WARNING</b>: <p>The folder for the chosen URL (${e}) is already exists.<br>It will be adopted by this node.</p>`,{type:"warning"})),!1===this.folderExists)&&(this.urlErrors.fldNotExist="URL does not yet exist. You must Deploy first.<br>If changing a deployed URL, the folder will be renamed on Deploy"),this.isDeployed&&!0===this.deployedUrlChanged&&(n("[uib] >> deployed url changed >> this.url:",this.url,", this.oldUrl:",this.oldUrl,this.id),this.urlErrors.warnChange=`Renaming from ${this.url} to ${e}. <b>MUST</b> redeploy now`,RED.notify(`<b>NOTE</b>: <p>You are renaming the url from ${this.url} to ${e}.<br>You <b>MUST</b> redeploy before doing anything else.</p>`,{type:"warning"})),0<Object.keys(this.urlErrors).length?(this.urlValid=!1,y(this.urlErrors,!1)):(this.urlValid=!0,y(this.urlErrors,!0)),!(1!==Object.keys(this.urlErrors).length||!this.urlErrors.fldNotExist)||this.urlValid}},fwdInMessages:{value:!1},allowScripts:{value:!1},allowStyles:{value:!1},copyIndex:{value:!0},templateFolder:{value:r},extTemplate:{value:""},showfolder:{value:!1},oldUrl:{value:void 0},reload:{value:!1},sourceFolder:{value:"src",required:!0},deployedVersion:{validate:function(){return!(void 0!==this.url&&(void 0===this.deployedVersion?"0":this.deployedVersion)<RED.settings.uibuilderRedeployNeeded&&RED.settings.uibuilderCurrentVersion>RED.settings.uibuilderRedeployNeeded&&(RED.notify(`<i>uibuilder ${this.url}</i><br>uibuilder has been updated since you last deployed this instance. Please deploy now.`,{modal:!1,fixed:!1,type:"warning"}),this.mustChange=!0))}},showMsgUib:{value:!1}},credentials:{jwtSecret:{type:"password"}},inputs:1,inputLabels:"Msg to send to front-end",outputs:2,outputLabels:["Data from front-end","Control Msgs from front-end"],icon:"node-blue-inverted.svg",paletteLabel:"uibuilder",label:function(){var e=this.url?`<${this.url}>`:"<no url>";return(this.name?this.name+" ":"")+e},oneditprepare:function(){x(this)},onpaletteadd:function(){},oneditsave:function(){n("[uib] >> this >>",this),!0===u.editorLoaded&&(u.editor.destroy(),delete u.editor,u.editorLoaded=!1);let e;(e=""!==$("#node-input-url").val()?$("#node-input-url").val():e)!==this.url?(this.oldUrl=this.url,n(`>> oneditsave URL CHANGED >> New=${$("#node-input-url").val()}, Old=`+this.url)):void 0!==this.oldUrl&&(this.oldUrl=void 0),(this.changed||this.mustChange)&&(this.deployedVersion=RED.settings.uibuilderCurrentVersion)},oneditcancel:function(){!0===u.editorLoaded&&(u.editor.destroy(),delete u.editor,u.editorLoaded=!1)},oneditresize:function(){g();try{$("#node-input-packageList").editableList("height",k())}catch(e){}},oneditdelete:function(){if(h(this),n("[uib] >> deleting >> isDeployed? ",this.isDeployed,void 0!==i[this.id]),this.isDeployed){const e=this,t=RED.notify(`<b>DELETE</b>: <p>You are deleting a uibuilder instance with url <i>${this.url}</i>.<br>Would you like to also delete the folder?<br><b>WARNING</b>: This cannot be undone.</p>`,{modal:!0,fixed:!0,type:"warning",buttons:[{text:"Yes",click:function(){$.ajax({type:"PUT",dataType:"json",url:"./uibuilder/admin/"+e.url,data:{cmd:"deleteondelete"}}).fail(function(e,t,i){console.error("[uibuilder:oneditdelete:PUT] Error "+t,i),RED.notify("uibuilder: Request url folder delete - error.<br>Folder will not be deleted, please delete manually.<br>"+i,{type:"error"})}),t.close(),RED.notify(`The folder <i>${e.url}</i> will be deleted when you redeploy.`,{type:"compact"})}},{text:"NO",class:"primary",click:function(){t.close()}}]})}}})}();</script>