"use strict";if("undefined"!=typeof require&&"undefined"==typeof io){const io=require("socket.io-client")}!function(){var e=this,t=e.uibuilder;function n(e,t){"string"!=typeof(t=t||"payload")&&(console.warn("[uibuilderfe:makeMeAnObject] WARNING: property parameter must be a string and not: "+typeof t),t="payload");var o={};return null!==e&&"Object"===e.constructor.name?o=e:null!==e&&(o[t]=e),o}var o=function(){String.prototype.endsWith||(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});var e,i=this;return i.version="6.5.0-old",i.moduleName="uibuilder",i.isUnminified=/param/.test(function(e){}),i.debug=!0===i.isUnminified,i.originator="",i.uiDebug=function(){if(i.debug){let e;e=arguments.length<2?"log":arguments[0],console[e].apply(console,[].slice.call(arguments,1))}},i.cookies={},document.cookie.split(";").forEach(function(e){e=e.split("=");i.cookies[e[0].trim()]=e[1]}),i.clientId=i.cookies["uibuilder-client-id"],i.me=function(){return!0===i.debug?i:"uibuilderfe.js Version: "+i.version},i.uiDebug("log","\nuibuilderfe: Debug? ",i.debug,"\n\t\tVersion? ",i.version,"\n\t\tRunning Packed version? ",!i.isUnminified,"\n "),i.setIOnamespace=function(){var e,t="";return void 0===(t=i.cookies["uibuilder-namespace"])||""===t?(0<(e=window.location.pathname.split("/").filter(function(e){return""!==e.trim()})).length&&e[e.length-1].endsWith(".html")&&e.pop(),t=e.pop(),i.uiDebug("log","[uibuilderfe:setIOnamespace] Found via url path: "+t)):i.uiDebug("log","[uibuilderfe:setIOnamespace] Found via cookie: "+t),i.uiDebug("log","uibuilderfe: IO Namespace: "+(t="/"+t)),t},i.authToken="",i.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},i.retryMs=2e3,i.retryFactor=1.5,i.timerid=null,i.ioNamespace=i.setIOnamespace(),i.ioTransport=["polling","websocket"],i.loaded=!1,i.storePrefix="uib_",i.dummyAuth={id:"anonymous",jwt:void 0,sessionExpiry:void 0,userValidated:!1,info:{error:void 0,message:void 0,validJwt:void 0}},i._auth=i.dummyAuth,i.started=!1,i.pageName=window.location.pathname.replace(i.ioNamespace+"/",""),i.pageName.endsWith("/")&&(i.pageName+="index.html"),""===i.pageName&&(i.pageName="index.html"),i.autoSendReady=!0,i.allowScript=!0,i.allowStyle=!0,i.removeScript=!0,i.removeStyle=!0,i.msg={},i.ctrlMsg={},i.sentMsg={},i.sentCtrlMsg={},i.msgsSent=0,i.msgsReceived=0,i.msgsSentCtrl=0,i.msgsCtrl=0,i.ioConnected=!1,i.serverTimeOffset=null,i.isAuthorised=!1,i.authTokenExpiry=null,i.authData={},i.connectedNum=0,"uibuilder-webRoot"in i.cookies?i.httpNodeRoot=i.cookies["uibuilder-webRoot"]:(0<(e=window.location.pathname.split("/").filter(function(e){return""!==e.trim()})).length&&e[e.length-1].endsWith(".html")&&e.pop(),i.url=e.pop(),i.httpNodeRoot="/"+e.join("/")),i.ioPath=function(){return("/"+Array.prototype.slice.call(arguments).map(function(e){return e.replace(/^\/|\/$/g,"")}).filter(function(e){return e}).join("/")).replace("//","/")}(i.httpNodeRoot,i.moduleName,"vendor","socket.io"),i.uiDebug("debug","uibuilderfe: ioPath: "+i.ioPath+", httpNodeRoot: "+i.httpNodeRoot+", uibuilder url (not used): "+i.url),i.setStore=function(e,t){if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return console.error("[uibuilder:setStore] Cannot stringify object, not storing. ",e),!1}try{return localStorage.setItem(i.storePrefix+e,t),!0}catch(e){return console.error("[uibuilder:setStore] Cannot write to localStorage. ",e),!1}},i.set=function(e,t){i[e]=t,i.uiDebug("debug","uibuilderfe: prop set - prop: "+e+", val: "+("object"==typeof t?JSON.stringify(t):t)),i.emit(e,t)},i.checkConnect=function(e,t,o=1){i.uiDebug("debug","uibuilderfe:checkConnect. Reconnect - Depth: "+o+", Delay: "+e+", Factor: "+t,i.ioNamespace,i.ioPath),i.timerid&&window.clearTimeout(i.timerid),i.timerid=window.setTimeout(function(){i.uiDebug("debug","uibuilderfe:checkConnect timeout. SIO reconnect attempt, timeout: "+e+", depth: "+o,i.ioNamespace,i.ioPath),console.info("[uibuilderfe:checkConnect:setTimeout] Socket.IO reconnection attempt. Current delay: "+e),i.socket.close(),i.socket.connect(),i.timerid=null,i.checkConnect(e*t,t,o++)},e)},i.checkTimestamp=function(e){Object.prototype.hasOwnProperty.call(e,"serverTimestamp")&&(e=new Date(e.serverTimestamp),(e=Math.round((new Date-e)/36e5))!==i.serverTimeOffset)&&(i.set("serverTimeOffset",e),i.uiDebug("log","uibuilderfe:"+i.ioChannels.server+" (server): Offset changed to: "+e))},i.ioSetup=function(){i.uiDebug("debug","[uibuilderfe:ioSetup] About to create IO. Namespace: "+i.ioNamespace+", Path: "+i.ioPath+", Transport: ["+i.ioTransport.join(", ")+"]"),i.socketOptions={path:i.ioPath,transports:i.ioTransport,auth:{clientId:i.clientId,connectedNum:i.connectedNum,pathName:window.location.pathname,pageName:i.pageName,clientVersion:i.version},transportOptions:{polling:{extraHeaders:{"x-clientid":`${i.moduleName}; old-iife; ${i.version}; `+i.clientId}}}},i.socket=io(i.ioNamespace,i.socketOptions),i.socket.on("connect",function(){i.connectedNum++,i.socketOptions.auth.connectedNum=i.connectedNum,i.uiDebug("info","[uibuilderfe:ioSetup] SOCKET CONNECTED - # connections: "+i.connectedNum+" Namespace: "+i.ioNamespace," Server Channel: ",i.ioChannels.server," Control Channel: ",i.ioChannels.control),i.set("ioConnected",!0),i.timerid&&(window.clearTimeout(i.timerid),i.timerid=null)}),i.socket.on(i.ioChannels.server,function(e){i.uiDebug("info","[uibuilderfe:ioSetup:on-"+i.ioChannels.server+" (server)] msg received - Namespace: "+i.ioNamespace,e),e=n(e,"payload"),i.checkTimestamp(e),e._auth&&i.updateAuth(e._auth),i.allowScript&&Object.prototype.hasOwnProperty.call(e,"script")&&(i.newScript(e.script),i.removeScript)&&delete e.script,i.allowStyle&&Object.prototype.hasOwnProperty.call(e,"style")&&(i.newStyle(e.style),i.removeStyle)&&delete e.style,i.set("msg",e),i.set("msgsReceived",i.msgsReceived+1)}),i.socket.on(i.ioChannels.control,function(e){var t;switch(i.uiDebug("debug","[uibuilder:ioSetup:on-ctrl-recvd] "+i.ioChannels.control+" (control): msg received - Namespace: "+i.ioNamespace,e),null===e?e={}:"object"!=typeof e&&((t={})["uibuilderCtrl:"+i.ioChannels.control]=e,e=t),Object.prototype.hasOwnProperty.call(e,"debug")&&(i.debug=e.debug),i.checkTimestamp(e),i.set("ctrlMsg",e),i.set("msgsCtrl",i.msgsCtrl+1),e.uibuilderCtrl){case"shutdown":i.uiDebug("info",`[uibuilderfe:ioSetup:${i.ioChannels.control}] Received "shutdown" from server`),i.set("serverShutdown",void 0);break;case"client connect":i.uiDebug("info",`[uibuilderfe:ioSetup:${i.ioChannels.control}] Received "client connect" from server`),i.uiDebug("info",`[uibuilderfe:ioSetup:client-connect] Server: Version=${e.version}, Time=${e.serverTimestamp}.`),i.version.startsWith(e.version.split("-")[0])||console.warn(`[uibuilderfe:ioSetup:client-connect] Server version (${e.version}) not the same as the client version (${i.version})`),!0===i.autoSendReady&&(i.uiDebug("info","[uibuilderfe:ioSetup:client-connect] Auto-sending ready-for-content/replay msg to server"),i.send({uibuilderCtrl:"ready for content",cacheControl:"REPLAY"},i.ioChannels.control));break;case"socket error":console.error(`[uibuilderfe:ioSetup:${i.ioChannels.control}] Received "socket error" from server. `+e.error);break;default:i.uiDebug("info",`[uibuilderfe:ioSetup:${i.ioChannels.control}] Received ${e.uibuilderCtrl} from server`),e._auth&&i.updateAuth(e._auth)}}),i.socket.on("disconnect",function(e){i.uiDebug("info","[uibuilderfe:ioSetup:disconnect] SOCKET DISCONNECTED - Namespace: "+i.ioNamespace+", Reason: "+e),i.set("ioConnected",!1),console.warn("[uibuilderfe:ioSetup:disconnect] Disconnection Reason: "+e),i.checkConnect(i.retryMs,i.retryFactor)}),i.socket.on("connect_error",function(e){console.error(`[uibuilderfe:ioSetup:connect_error] SOCKET CONNECT ERROR - Namespace: ${i.ioNamespace}, ioPath: ${i.ioPath}, Reason: `+e.message,e)}),i.socket.on("error",function(e){console.error("[uibuilderfe:ioSetup:error] SOCKET ERROR from server - MESSAGE: ",e),i.set("socketError",e)}),i.checkConnect(i.retryMs,i.retryFactor)},i.setOriginator=function(e=""){i.originator=e},i.send=function(e,t,o=""){null==t&&(t=i.ioChannels.client),i.uiDebug("log","[uibuilderfe:send] Sending msg - Namespace: "+i.ioNamespace+", Channel: "+t,e),t===i.ioChannels.client?e=n(e,"payload"):t===i.ioChannels.control&&(e=n(e,"uibuilderCtrl"),Object.prototype.hasOwnProperty.call(e,"uibuilderCtrl")||(e.uibuilderCtrl="manual send"),e.from="client"),e._socketId=i.socket.id,t===i.ioChannels.client?(i.set("sentMsg",e),i.set("msgsSent",i.msgsSent+1)):t===i.ioChannels.control&&(i.set("sentCtrlMsg",e),i.set("msgsSentCtrl",i.msgsSentCtrl+1)),""!==(o=""===o&&""!==i.originator?i.originator:o)&&Object.assign(e,{_uib:{originator:o}}),i.socket.emit(t,e)},i.onChange=function(e,t){i.events[e]?i.events[e].push(t):i.events[e]=[t]},i.clearEventListeners=function(){i.events=[]},i.addCSSClass=function(t){if(""!==t&&void 0!==t){Array.isArray(t)||(t=[t]),i.uiDebug("log","[uibuilderfe:addCSSClass] style: "+t);let e=document.getElementById("uibstyle");null===e&&(i.uiDebug("log","[uibuilderfe:addCSSClass] Adding uibstyle stylesheet"),(e=document.createElement("style")).title=e.id="uibstyle",document.head.insertAdjacentElement("afterbegin",e));var o=e.sheet;for(const n of t)i.uiDebug("log","[uibuilderfe:addCSSClass] Adding style "+n),o.insertRule(n)}},i.setPing=function(e=0){const t=new XMLHttpRequest;t.addEventListener("load",function(){var e=t.getAllResponseHeaders().split("\r\n");i.set("ping",{success:201===t.status,status:t.status,headers:e})}),i.pingInterval&&(clearInterval(i.pingInterval),delete i.pingInterval),e<1?(t.open("GET","../uibuilder/ping"),t.send()):i.pingInterval=setInterval(()=>{t.open("GET","../uibuilder/ping"),t.send()},e)},i.events={},i.emit=function(e){var t=i.events[e];if(t)for(var o=Array.prototype.slice.call(arguments,1),n=0;n<t.length;n++)t[n].apply(i,o)},i.newScript=function(e){var t;!0===i.allowScript&&""!==e&&void 0!==e&&(i.uiDebug("log","uibuilderfe: newCode - script: "+e),(t=document.createElement("script")).type="text/javascript",t.defer=!0,t.textContent=e,document.getElementsByTagName("body")[0].appendChild(t))},i.newStyle=function(e){var t;!0===i.allowStyle&&""!==e&&void 0!==e&&(i.uiDebug("log","uibuilderfe: newStyle - style: "+e),(t=document.createElement("style")).textContent=e,document.head.appendChild(t))},i.showToastVanilla=function(e,t){let o=document.getElementById("toaster");null===o&&((o=document.createElement("div")).id="toaster",o.title="Click to clear all notifcations",o.setAttribute("class","uib-toaster"),o.onclick=function(){o.remove()},document.body.insertAdjacentElement("afterbegin",o));const n=document.createElement("div");n.title="Click to clear this notifcation",n.setAttribute("class","uib-toast "+t.variant),t.title&&(e=`<p class="uib-toast-head">${t.title}</p><p>${e}</p>`),n.innerHTML=e,n.onclick=function(e){e.stopPropagation(),n.remove(),o.childElementCount<1&&o.remove()},o.insertAdjacentElement(!0===t.appendToast?"beforeend":"afterbegin",n),!0===t.autohide&&setInterval(()=>{n.remove(),o.childElementCount<1&&o.remove()},t.autoHideDelay)},i.showToast=function(o){if(o._uib&&null!==o._uib&&"Object"===o._uib.constructor.name){let e={},t=(o._uib.options&&(e=Object.assign({},o._uib.options)),"");o.payload&&(t+=o.payload),e.content&&(t+=e.content),e.append&&(e.appendToast=e.append),e.noAutohide&&(e.noAutoHide=e.noAutohide),e.noAutoHide&&(e.autohide=!e.noAutoHide),Object.prototype.hasOwnProperty.call(e,"autohide")||(e.autohide=!0),e.autoHideDelay&&(e.autohide=!0,e.delay=e.autoHideDelay),!0!==e.autohide||e.autoHideDelay||(e.autoHideDelay=1e4),e.variant&&["","primary","secondary","success","info","warn","warning","error","danger"].includes(e.variant)||(e.variant=""),!e.title&&o.topic&&(e.title=o.topic),""===t?console.warn("[uibuilder:toast] Toast content is blank. Not shown."):i.vueApp&&i.vueApp.$bvToast?(i.uiDebug("[uibuilder:showToast] Bootstrap-Vue available, using to create a toast"),i.showToastBVue(t,e)):(i.uiDebug("[uibuilder:showToast] Bootstrap-Vue NOT available, creating a vanilla HTML toast"),i.showToastVanilla(t,e))}else console.warn("[uibuilder:toast] Incoming msg requires msg._uib object, cannot create a toast")},i.showToastBVue=function(e,t){var o,n;i.vueApp?i.vueApp.$bvToast?(n=(o=i.vueApp.$createElement)("p",{domProps:{innerHTML:e}}),t.title&&(t.title=o("p",{domProps:{innerHTML:t.title}})),"error"===t.variant&&(t.variant="danger"),"warn"===t.variant&&(t.variant="warning"),t.solid||(t.solid=!0),i.vueApp.$bvToast.toast(n,t)):(console.warn("[uibuilder:toast] bootstrap-vue toast component not available, cannot create a Bootstrap-Vue toast, falling back to vanilla."),i.showToastVanilla(e,t)):(console.warn("[uibuilder:toast] Vue app object not available, cannot create a Vue toast, falling back to vanilla."),i.showToastVanilla(e,t))},i.showAlert=function(){},i.showComponentDetails=function(t){if(i.vueApp&&i.vueApp.$refs[t]){var o=i.vueApp.$refs[t];let e={};return e=o.$options?{uibuilderCtrl:"vue component details",componentDetails:{ref:t,tag:o.$options._componentTag,props:o.$options._propKeys}}:(i.uiDebug("warn",o=`[uibuilderfe:showComponentDetails] ref="${t}" is not a Vue Component. Details cannot be returned.`),{uibuilderCtrl:"vue component details",componentDetails:{warning:o,ref:t,tag:null,props:null}})}},i.onChange("msg",function(e){if(e._uib&&(!0===e._uib.reload&&(console.log("reloading"),location.reload()),e._uib.componentRef)){const o=e._uib.componentRef;if("globalNotification"===o)i.uiDebug("[uibuilder:internalOnChange] globalNotification triggered - showToast() "),i.showToast(e);else if("globalAlert"===o)i.showAlert(e);else if(i.vueApp){const n=i.vueApp;if(e._uib.requestDetails)(t=i.showComponentDetails(o))&&(e.topic&&(t.topic=e.topic),i.send(t,i.ioChannels.control));else if(o in n.$refs){if(e._uib.options&&(i.uiDebug("log","🔢📈 new component instance options received for ref",o,":",e._uib.options),Object.keys(e._uib.options).forEach(function(t){try{n.$set(n.$refs[o],t,e._uib.options[t])}catch(e){i.uiDebug("warn",`[uibuilderfe:internal:onChange] Could not update prop "${t}" for component ref="${o}". Error: `+e.message)}})),e.payload){i.uiDebug("log","🔢📈 new component instance value received for ref",o,":",e.payload);try{n.$refs[o].$props.config.value=e.payload}catch(e){}}}else{var t=`[uibuilderfe:internal:onChange] ref="${o}" is not a Vue Component. Cannot set props.`,t=(i.uiDebug("warn",t),{uibuilderCtrl:"vue component details",componentDetails:{warning:t,ref:o,tag:null,props:null}});e.topic&&(t.topic=e.topic),i.send(t,i.ioChannels.control)}}}}),i.uiReturn={set:function(e,t){if(-1!==["autoSendReady","clientId","cookies","ctrlMsg","debug","events","httpNodeRoot","ioChannels","ioConnected","ioNamespace","ioPath","ioTransport","isAuthorised","isUnminified","loaded","msgsCtrl","msgsReceived","msgsSent","msgsSentCtrl","moduleName","retryFactor","retryMs","sentMsg","sentCtrlMsg","serverTimeOffset","socket","timerid","url","version","checkConnect","checkTimestamp","emit","get","ioSetup","logon","logoff","markLoggedOut","me","newScript","newStyle","onChange","self","set","send","sendAuth","sendCtrl","setIOnamespace","showComponentDetails","showToast","socket","uiDebug","updateAuth","uiReturn"].indexOf(e))console.warn('[uibuilder:set] Cannot use set() on protected property "'+e+'"'),i.uiDebug("warn",'uibuilderfe:uibuilder:set: "'+e+'" is in list of excluded properties, not set');else{if("_auth"===e){if(!t.id||0===t.id.length)return void console.warn("[uibuilder:set] _auth must contain a valid _auth.id property");t.info||(t.info=i.dummyAuth.info)}i.set(e,t)}},get:function(e){if(-1===["checkConnect","checkTimestamp","emit","get","ioSetup","logon","logoff","markLoggedOut","me","newScript","newStyle","onChange","self","set","send","sendAuth","sendCtrl","setIOnamespace","showComponentDetails","showToast","socket","uiDebug","updateAuth","uiReturn"].indexOf(e))return void 0===i[e]&&console.warn('[uibuilder] get() - property "'+e+'" does not exist'),i[e];console.warn('[uibuilder] Cannot use get() on protected property "'+e+'"'),i.uiDebug("warn",'uibuilderfe:uibuilder:get: "'+e+'" is in list of excluded properties, not get')},onChange:i.onChange,clearEventListeners:i.clearEventListeners,msg:i.msg,send:function(e,t=""){i.send(e,i.ioChannels.client,t)},setOriginator:i.setOriginator,sendCtrl:function(e){i.send(e,i.ioChannels.control)},autoSendReady:function(e){i.autoSendReady=e=!0!==e?!1:e},debug:function(e){if(void 0===e)return i.debug;"boolean"==typeof e&&(i.debug=e)},uiDebug:i.uiDebug,me:i.me,start:function(e,t,o){!0===i.started?i.uiDebug("log","❌ [uibuilderfe:start] Start function already called. Do not call more than once."):(i.uiDebug("log","[uibuilderfe:start] start() called"),"[object Object]"===toString.call(e)?(i.uiDebug("log","✅ [uibuilderfe:start] namespace IS an object!"),e=!0===e._isVue?(i.uiDebug("log","✅ [uibuilderfe:start] Vue instance object IS available!"),void(o=e)):(e.ioPath&&(t=e.ioPath),e.vueApp&&(o=e.vueApp),e.namespace||void 0)):o?"[object Object]"===toString.call(o)&&!0===o._isVue?i.uiDebug("log","✅ [uibuilderfe:start] Vue instance object IS available!"):(i.uiDebug("log","❌ [uibuilderfe:start] Vue instance object not available!"),o=void 0):i.uiDebug("log","❌ [uibuilderfe:start] Vue app not available!"),i.uiDebug("log","[uibuilderfe:start] Calling params - namespace",e,"ioPath",t,"vueApp",o),null!=e&&(i.ioNamespace=e),null!=t&&(i.ioPath=t),null!=o&&(i.vueApp=o),i.uiDebug("log","[uibuilderfe:start] Final Socket.IO params - namespace",i.ioNamespace,"ioPath",i.ioPath),i.ioSetup(),i.started=!0)},showComponentDetails:i.showComponentDetails,showToast:function(e,t="globalNotification",o={}){i.showToast({_uib:{componentRef:t,options:o},payload:e})},eventSend:function(t,o=""){if(t.constructor.name.endsWith("Event")&&t.currentTarget){var n=t.currentTarget;let e="";try{""!==n.textContent&&(e=n.textContent.substring(0,25))}catch(e){}try{""!==n.name&&(e=n.name)}catch(e){}try{""!==n.id&&(e=n.id)}catch(e){}i.send({topic:i.msg.topic,uibDomEvent:{sourceId:e,event:t.type},payload:n.dataset},i.ioChannels.client,o)}else i.uiDebug("log","[uibuilderfe:eventSend] ARGUMENT NOT A DOM EVENT - use data attributes not function arguments to pass data")},setPing:i.setPing},window.addEventListener("load",function(){i.uiDebug("debug","uibuilderfe:load: All resources loaded"),i.loaded=!0}),i.uiReturn}.call(e);o.noConflict=function(){return e.uibuilder=t,o},"undefined"!=typeof exports?(exports="undefined"!=typeof module&&module.exports?module.exports=o:exports).uibuilder=o:e.uibuilder=o}.call(this);