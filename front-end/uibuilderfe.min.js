"use strict";if("undefined"!=typeof require&&"undefined"==typeof io){const io=require("socket.io-client")}!function(){var e=this,t=e.uibuilder;function n(e,t){"string"!=typeof(t=null==t?"payload":t)&&(console.warn("[uibuilderfe:makeMeAnObject] WARNING: property parameter must be a string and not: "+typeof t),t="payload");var o={};return"object"==typeof e?o=e:null!==e&&(o[t]=e),o}var o=function(){String.prototype.endsWith||(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});var e,a=this;return a.version="5.1.1",a.moduleName="uibuilder",a.isUnminified=/param/.test(function(e){}),a.debug=!0===a.isUnminified,a.originator="",a.uiDebug=function(){if(a.debug){let e;e=arguments.length<2?"log":arguments[0],console[e].apply(console,[].slice.call(arguments,1))}},a.cookies={},document.cookie.split(";").forEach(function(e){const t=e.split("=");a.cookies[t[0].trim()]=t[1]}),a.clientId=a.cookies["uibuilder-client-id"],a.me=function(){return!0===a.debug?a:"uibuilderfe.js Version: "+a.version},a.uiDebug("log","\nuibuilderfe: Debug? ",a.debug,"\n\t\tVersion? ",a.version,"\n\t\tRunning Packed version? ",!a.isUnminified,"\n "),a.setIOnamespace=function(){var e,t="";return void 0===(t=a.cookies["uibuilder-namespace"])||""===t?(0<(e=window.location.pathname.split("/").filter(function(e){return""!==e.trim()})).length&&e[e.length-1].endsWith(".html")&&e.pop(),t=e.pop(),a.uiDebug("log","[uibuilderfe:setIOnamespace] Found via url path: "+t)):a.uiDebug("log","[uibuilderfe:setIOnamespace] Found via cookie: "+t),a.uiDebug("log","uibuilderfe: IO Namespace: "+(t="/"+t)),t},a.authToken="",a.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},a.retryMs=2e3,a.retryFactor=1.5,a.timerid=null,a.ioNamespace=a.setIOnamespace(),a.ioTransport=["polling","websocket"],a.loaded=!1,a.storePrefix="uib_",a.dummyAuth={id:"anonymous",jwt:void 0,sessionExpiry:void 0,userValidated:!1,info:{error:void 0,message:void 0,validJwt:void 0}},a._auth=a.dummyAuth,a.started=!1,a.autoSendReady=!0,a.allowScript=!0,a.allowStyle=!0,a.removeScript=!0,a.removeStyle=!0,a.msg={},a.ctrlMsg={},a.sentMsg={},a.sentCtrlMsg={},a.msgsSent=0,a.msgsReceived=0,a.msgsSentCtrl=0,a.msgsCtrl=0,a.ioConnected=!1,a.serverTimeOffset=null,a.isAuthorised=!1,a.authTokenExpiry=null,a.authData={},a.connectedNum=0,"uibuilder-webRoot"in a.cookies?a.httpNodeRoot=a.cookies["uibuilder-webRoot"]:(0<(e=window.location.pathname.split("/").filter(function(e){return""!==e.trim()})).length&&e[e.length-1].endsWith(".html")&&e.pop(),a.url=e.pop(),a.httpNodeRoot="/"+e.join("/")),a.ioPath=function(){return("/"+Array.prototype.slice.call(arguments).map(function(e){return e.replace(/^\/|\/$/g,"")}).filter(function(e){return e}).join("/")).replace("//","/")}(a.httpNodeRoot,a.moduleName,"vendor","socket.io"),a.uiDebug("debug","uibuilderfe: ioPath: "+a.ioPath+", httpNodeRoot: "+a.httpNodeRoot+", uibuilder url (not used): "+a.url),a.setStore=function(e,t){if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return console.error("[uibuilder:setStore] Cannot stringify object, not storing. ",e),!1}try{return localStorage.setItem(a.storePrefix+e,t),!0}catch(e){return console.error("[uibuilder:setStore] Cannot write to localStorage. ",e),!1}},a.set=function(e,t){a[e]=t,a.uiDebug("debug","uibuilderfe: prop set - prop: "+e+", val: "+("object"==typeof t?JSON.stringify(t):t)),a.emit(e,t)},a.checkConnect=function(e,t,o=1){a.uiDebug("debug","uibuilderfe:checkConnect. Reconnect - Depth: "+o+", Delay: "+e+", Factor: "+t,a.ioNamespace,a.ioPath),a.timerid&&window.clearTimeout(a.timerid),a.timerid=window.setTimeout(function(){a.uiDebug("debug","uibuilderfe:checkConnect timeout. SIO reconnect attempt, timeout: "+e+", depth: "+o,a.ioNamespace,a.ioPath),console.info("[uibuilderfe:checkConnect:setTimeout] Socket.IO reconnection attempt. Current delay: "+e),a.socket.close(),a.socket.connect(),a.timerid=null,a.checkConnect(e*t,t,o++)},e)},a.checkTimestamp=function(e){Object.prototype.hasOwnProperty.call(e,"serverTimestamp")&&(e=new Date(e.serverTimestamp),(e=Math.round((new Date-e)/36e5))!==a.serverTimeOffset&&(a.set("serverTimeOffset",e),a.uiDebug("log","uibuilderfe:"+a.ioChannels.server+" (server): Offset changed to: "+e)))},a.ioSetup=function(){a.uiDebug("debug","[uibuilderfe:ioSetup] About to create IO. Namespace: "+a.ioNamespace+", Path: "+a.ioPath+", Transport: ["+a.ioTransport.join(", ")+"]"),a.socketOptions={path:a.ioPath,transports:a.ioTransport,auth:{clientId:a.clientId,connectedNum:a.connectedNum,pageName:window.location.pathname,clientVersion:a.version},transportOptions:{polling:{extraHeaders:{"x-clientid":"uibuilderfe; "+a.clientId}}}},a.socket=io(a.ioNamespace,a.socketOptions),a.socket.on("connect",function(){a.connectedNum++,a.socketOptions.auth.connectedNum=a.connectedNum,a.uiDebug("info","[uibuilderfe:ioSetup] SOCKET CONNECTED - # connections: "+a.connectedNum+" Namespace: "+a.ioNamespace," Server Channel: ",a.ioChannels.server," Control Channel: ",a.ioChannels.control),a.set("ioConnected",!0),a.timerid&&(window.clearTimeout(a.timerid),a.timerid=null)}),a.socket.on(a.ioChannels.server,function(e){a.uiDebug("info","[uibuilderfe:ioSetup:on-"+a.ioChannels.server+" (server)] msg received - Namespace: "+a.ioNamespace,e),e=n(e,"payload"),a.checkTimestamp(e),e._auth&&a.updateAuth(e._auth),a.allowScript&&Object.prototype.hasOwnProperty.call(e,"script")&&(a.newScript(e.script),a.removeScript&&delete e.script),a.allowStyle&&Object.prototype.hasOwnProperty.call(e,"style")&&(a.newStyle(e.style),a.removeStyle&&delete e.style),a.set("msg",e),a.set("msgsReceived",a.msgsReceived+1)}),a.socket.on(a.ioChannels.control,function(e){var t;switch(a.uiDebug("debug","[uibuilder:ioSetup:on-ctrl-recvd] "+a.ioChannels.control+" (control): msg received - Namespace: "+a.ioNamespace,e),null===e?e={}:"object"!=typeof e&&((t={})["uibuilderCtrl:"+a.ioChannels.control]=e,e=t),Object.prototype.hasOwnProperty.call(e,"debug")&&(a.debug=e.debug),a.checkTimestamp(e),a.set("ctrlMsg",e),a.set("msgsCtrl",a.msgsCtrl+1),e.uibuilderCtrl){case"shutdown":a.uiDebug("info",`[uibuilderfe:ioSetup:${a.ioChannels.control}] Received "shutdown" from server`),a.set("serverShutdown",void 0);break;case"client connect":a.uiDebug("info",`[uibuilderfe:ioSetup:${a.ioChannels.control}] Received "client connect" from server`),a.uiDebug("info",`[uibuilderfe:ioSetup:client-connect] Server: Version=${e.version}, Time=${e.serverTimestamp}.`),a.version!==e.version&&console.warn(`[uibuilderfe:ioSetup:client-connect] Server version (${e.version}) not the same as the client version (${a.version})`),!0===a.autoSendReady&&(a.uiDebug("info","[uibuilderfe:ioSetup:client-connect] Auto-sending ready-for-content/replay msg to server"),a.send({uibuilderCtrl:"ready for content",cacheControl:"REPLAY"},a.ioChannels.control));break;case"socket error":console.error(`[uibuilderfe:ioSetup:${a.ioChannels.control}] Received "socket error" from server. `+e.error);break;default:a.uiDebug("info",`[uibuilderfe:ioSetup:${a.ioChannels.control}] Received ${e.uibuilderCtrl} from server`),e._auth&&a.updateAuth(e._auth)}}),a.socket.on("disconnect",function(e){a.uiDebug("info","[uibuilderfe:ioSetup:disconnect] SOCKET DISCONNECTED - Namespace: "+a.ioNamespace+", Reason: "+e),a.set("ioConnected",!1),console.warn("[uibuilderfe:ioSetup:disconnect] Disconnection Reason: "+e),a.checkConnect(a.retryMs,a.retryFactor)}),a.socket.on("connect_error",function(e){console.error(`[uibuilderfe:ioSetup:connect_error] SOCKET CONNECT ERROR - Namespace: ${a.ioNamespace}, ioPath: ${a.ioPath}, Reason: `+e.message,e)}),a.socket.on("error",function(e){console.error("[uibuilderfe:ioSetup:error] SOCKET ERROR from server - MESSAGE: ",e),a.set("socketError",e)}),a.checkConnect(a.retryMs,a.retryFactor)},a.setOriginator=function(e=""){a.originator=e},a.send=function(e,t,o=""){null==t&&(t=a.ioChannels.client),a.uiDebug("log","[uibuilderfe:send] Sending msg - Namespace: "+a.ioNamespace+", Channel: "+t,e),t===a.ioChannels.client?e=n(e,"payload"):t===a.ioChannels.control&&(e=n(e,"uibuilderCtrl"),Object.prototype.hasOwnProperty.call(e,"uibuilderCtrl")||(e.uibuilderCtrl="manual send"),e.from="client"),e._socketId=a.socket.id,t===a.ioChannels.client?(a.set("sentMsg",e),a.set("msgsSent",a.msgsSent+1)):t===a.ioChannels.control&&(a.set("sentCtrlMsg",e),a.set("msgsSentCtrl",a.msgsSentCtrl+1)),""!==(o=""===o&&""!==a.originator?a.originator:o)&&Object.assign(e,{_uib:{originator:o}}),a.socket.emit(t,e)},a.onChange=function(e,t){a.events[e]?a.events[e].push(t):a.events[e]=[t]},a.clearEventListeners=function(){a.events=[]},a.addCSSClass=function(t){if(""!==t&&void 0!==t){Array.isArray(t)||(t=[t]),a.uiDebug("log","[uibuilderfe:addCSSClass] style: "+t);let e=document.getElementById("uibstyle");null===e&&(a.uiDebug("log","[uibuilderfe:addCSSClass] Adding uibstyle stylesheet"),(e=document.createElement("style")).title=e.id="uibstyle",document.head.insertAdjacentElement("afterbegin",e));const o=e.sheet;for(const n of t)a.uiDebug("log","[uibuilderfe:addCSSClass] Adding style "+n),o.insertRule(n)}},a.setPing=function(e=0){const t=new XMLHttpRequest;t.addEventListener("load",function(){var e=t.getAllResponseHeaders().split("\r\n");a.set("ping",{success:201===t.status,status:t.status,headers:e})}),a.pingInterval&&(clearInterval(a.pingInterval),delete a.pingInterval),e<1?(t.open("GET","../uibuilder/ping"),t.send()):a.pingInterval=setInterval(()=>{t.open("GET","../uibuilder/ping"),t.send()},e)},a.events={},a.emit=function(e){var t=a.events[e];if(t)for(var o=Array.prototype.slice.call(arguments,1),n=0;n<t.length;n++)t[n].apply(a,o)},a.newScript=function(e){var t;!0===a.allowScript&&""!==e&&void 0!==e&&(a.uiDebug("log","uibuilderfe: newCode - script: "+e),(t=document.createElement("script")).type="text/javascript",t.defer=!0,t.textContent=e,document.getElementsByTagName("body")[0].appendChild(t))},a.newStyle=function(e){if(!0===a.allowStyle&&""!==e&&void 0!==e){a.uiDebug("log","uibuilderfe: newStyle - style: "+e);const t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}},a.showToastVanilla=function(e,t){let o=document.getElementById("toaster");null===o&&((o=document.createElement("div")).id="toaster",o.title="Click to clear all notifcations",o.setAttribute("class","uib-toaster"),o.onclick=function(){o.remove()},document.body.insertAdjacentElement("afterbegin",o));const n=document.createElement("div");n.title="Click to clear this notifcation",n.setAttribute("class","uib-toast "+t.variant),t.title&&(e=`<p class="uib-toast-head">${t.title}</p><p>${e}</p>`),n.innerHTML=e,n.onclick=function(e){e.stopPropagation(),n.remove(),o.childElementCount<1&&o.remove()},o.insertAdjacentElement(!0===t.appendToast?"beforeend":"afterbegin",n),!0===t.autohide&&setInterval(()=>{n.remove(),o.childElementCount<1&&o.remove()},t.autoHideDelay)},a.showToast=function(o){if(o._uib&&null!==o._uib&&"Object"===o._uib.constructor.name){let e={},t=(o._uib.options&&(e=Object.assign({},o._uib.options)),"");o.payload&&(t+=o.payload),e.content&&(t+=e.content),e.append&&(e.appendToast=e.append),e.noAutohide&&(e.noAutoHide=e.noAutohide),e.noAutoHide&&(e.autohide=!e.noAutoHide),Object.prototype.hasOwnProperty.call(e,"autohide")||(e.autohide=!0),e.autoHideDelay&&(e.autohide=!0,e.delay=e.autoHideDelay),!0!==e.autohide||e.autoHideDelay||(e.autoHideDelay=1e4),e.variant&&["","primary","secondary","success","info","warn","warning","error","danger"].includes(e.variant)||(e.variant=""),!e.title&&o.topic&&(e.title=o.topic),""===t?console.warn("[uibuilder:toast] Toast content is blank. Not shown."):a.vueApp&&a.vueApp.$bvToast?(a.uiDebug("[uibuilder:showToast] Bootstrap-Vue available, using to create a toast"),a.showToastBVue(t,e)):(a.uiDebug("[uibuilder:showToast] Bootstrap-Vue NOT available, creating a vanilla HTML toast"),a.showToastVanilla(t,e))}else console.warn("[uibuilder:toast] Incoming msg requires msg._uib object, cannot create a toast")},a.showToastBVue=function(e,t){if(!a.vueApp)return console.warn("[uibuilder:toast] Vue app object not available, cannot create a Vue toast, falling back to vanilla."),void a.showToastVanilla(e,t);if(!a.vueApp.$bvToast)return console.warn("[uibuilder:toast] bootstrap-vue toast component not available, cannot create a Bootstrap-Vue toast, falling back to vanilla."),void a.showToastVanilla(e,t);const o=a.vueApp.$createElement;e=o("p",{domProps:{innerHTML:e}});t.title&&(t.title=o("p",{domProps:{innerHTML:t.title}})),"error"===t.variant&&(t.variant="danger"),"warn"===t.variant&&(t.variant="warning"),t.solid||(t.solid=!0),a.vueApp.$bvToast.toast(e,t)},a.showAlert=function(){},a.showComponentDetails=function(t){if(a.vueApp&&a.vueApp.$refs[t]){var o=a.vueApp.$refs[t];let e={};return e=o.$options?{uibuilderCtrl:"vue component details",componentDetails:{ref:t,tag:o.$options._componentTag,props:o.$options._propKeys}}:(a.uiDebug("warn",o=`[uibuilderfe:showComponentDetails] ref="${t}" is not a Vue Component. Details cannot be returned.`),{uibuilderCtrl:"vue component details",componentDetails:{warning:o,ref:t,tag:null,props:null}})}},a.onChange("msg",function(e){if(e._uib&&(!0===e._uib.reload&&(console.log("reloading"),location.reload()),e._uib.componentRef)){const o=e._uib.componentRef;if("globalNotification"===o)return a.uiDebug("[uibuilder:internalOnChange] globalNotification triggered - showToast() "),void a.showToast(e);if("globalAlert"===o)a.showAlert(e);else if(a.vueApp){const n=a.vueApp;if(e._uib.requestDetails){const i=a.showComponentDetails(o);void(i&&(e.topic&&(i.topic=e.topic),a.send(i,a.ioChannels.control)))}else if(o in n.$refs){if(e._uib.options&&(a.uiDebug("log","🔢📈 new component instance options received for ref",o,":",e._uib.options),Object.keys(e._uib.options).forEach(function(t){try{n.$set(n.$refs[o],t,e._uib.options[t])}catch(e){a.uiDebug("warn",`[uibuilderfe:internal:onChange] Could not update prop "${t}" for component ref="${o}". Error: `+e.message)}})),e.payload){a.uiDebug("log","🔢📈 new component instance value received for ref",o,":",e.payload);try{n.$refs[o].$props.config.value=e.payload}catch(e){}}}else{var t=`[uibuilderfe:internal:onChange] ref="${o}" is not a Vue Component. Cannot set props.`;a.uiDebug("warn",t);const r={uibuilderCtrl:"vue component details",componentDetails:{warning:t,ref:o,tag:null,props:null}};e.topic&&(r.topic=e.topic),a.send(r,a.ioChannels.control)}}}}),a.uiReturn={set:function(e,t){if(-1!==["autoSendReady","clientId","cookies","ctrlMsg","debug","events","httpNodeRoot","ioChannels","ioConnected","ioNamespace","ioPath","ioTransport","isAuthorised","isUnminified","loaded","msgsCtrl","msgsReceived","msgsSent","msgsSentCtrl","moduleName","retryFactor","retryMs","sentMsg","sentCtrlMsg","serverTimeOffset","socket","timerid","url","version","checkConnect","checkTimestamp","emit","get","ioSetup","logon","logoff","markLoggedOut","me","newScript","newStyle","onChange","self","set","send","sendAuth","sendCtrl","setIOnamespace","showComponentDetails","showToast","socket","uiDebug","updateAuth","uiReturn"].indexOf(e))return console.warn('[uibuilder:set] Cannot use set() on protected property "'+e+'"'),void a.uiDebug("warn",'uibuilderfe:uibuilder:set: "'+e+'" is in list of excluded properties, not set');if("_auth"===e){if(!t.id||0===t.id.length)return void console.warn("[uibuilder:set] _auth must contain a valid _auth.id property");t.info||(t.info=a.dummyAuth.info)}a.set(e,t)},get:function(e){return-1!==["checkConnect","checkTimestamp","emit","get","ioSetup","logon","logoff","markLoggedOut","me","newScript","newStyle","onChange","self","set","send","sendAuth","sendCtrl","setIOnamespace","showComponentDetails","showToast","socket","uiDebug","updateAuth","uiReturn"].indexOf(e)?(console.warn('[uibuilder] Cannot use get() on protected property "'+e+'"'),void a.uiDebug("warn",'uibuilderfe:uibuilder:get: "'+e+'" is in list of excluded properties, not get')):(void 0===a[e]&&console.warn('[uibuilder] get() - property "'+e+'" does not exist'),a[e])},onChange:a.onChange,clearEventListeners:a.clearEventListeners,msg:a.msg,send:function(e,t=""){a.send(e,a.ioChannels.client,t)},setOriginator:a.setOriginator,sendCtrl:function(e){a.send(e,a.ioChannels.control)},autoSendReady:function(e){a.autoSendReady=e=!0!==e?!1:e},debug:function(e){if(void 0===e)return a.debug;"boolean"==typeof e&&(a.debug=e)},uiDebug:a.uiDebug,me:a.me,start:function(e,t,o){!0===a.started?a.uiDebug("log","❌ [uibuilderfe:start] Start function already called. Do not call more than once."):(a.uiDebug("log","[uibuilderfe:start] start() called"),"[object Object]"===toString.call(e)?(a.uiDebug("log","✅ [uibuilderfe:start] namespace IS an object!"),e=!0===e._isVue?(a.uiDebug("log","✅ [uibuilderfe:start] Vue instance object IS available!"),void(o=e)):(e.ioPath&&(t=e.ioPath),e.vueApp&&(o=e.vueApp),e.namespace||void 0)):o?"[object Object]"===toString.call(o)&&!0===o._isVue?a.uiDebug("log","✅ [uibuilderfe:start] Vue instance object IS available!"):(a.uiDebug("log","❌ [uibuilderfe:start] Vue instance object not available!"),o=void 0):a.uiDebug("log","❌ [uibuilderfe:start] Vue app not available!"),a.uiDebug("log","[uibuilderfe:start] Calling params - namespace",e,"ioPath",t,"vueApp",o),null!=e&&(a.ioNamespace=e),null!=t&&(a.ioPath=t),null!=o&&(a.vueApp=o),a.uiDebug("log","[uibuilderfe:start] Final Socket.IO params - namespace",a.ioNamespace,"ioPath",a.ioPath),a.ioSetup(),a.started=!0)},showComponentDetails:a.showComponentDetails,showToast:function(e,t="globalNotification",o={}){a.showToast({_uib:{componentRef:t,options:o},payload:e})},eventSend:function(t,o=""){if(t.constructor.name.endsWith("Event")&&t.currentTarget){const n=t.currentTarget;let e="";try{""!==n.textContent&&(e=n.textContent.substring(0,25))}catch(e){}try{""!==n.name&&(e=n.name)}catch(e){}try{""!==n.id&&(e=n.id)}catch(e){}a.send({topic:a.msg.topic,uibDomEvent:{sourceId:e,event:t.type},payload:n.dataset},a.ioChannels.client,o)}else a.uiDebug("log","[uibuilderfe:eventSend] ARGUMENT NOT A DOM EVENT - use data attributes not function arguments to pass data")},setPing:a.setPing},window.addEventListener("load",function(){a.uiDebug("debug","uibuilderfe:load: All resources loaded"),a.loaded=!0}),a.uiReturn}.call(e);o.noConflict=function(){return e.uibuilder=t,o},"undefined"!=typeof exports?(exports="undefined"!=typeof module&&module.exports?module.exports=o:exports).uibuilder=o:e.uibuilder=o}.call(this);