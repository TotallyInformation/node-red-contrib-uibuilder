{
  "version": 3,
  "sources": ["src/front-end-module/ui.js"],
  "sourcesContent": ["/* Creates HTML UI's based on a standardised data input.\n  Works stand-alone, with uibuilder or with Node.js/jsdom.\n  See: https://totallyinformation.github.io/node-red-contrib-uibuilder/#/client-docs/config-driven-ui\n\n  Author: Julian Knight (Totally Information), March 2023\n\n  License: Apache 2.0\n  Copyright (c) 2022-2024 Julian Knight (Totally Information)\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n  http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n */\n/* globals module:true */\n\n// Namespaces - See https://stackoverflow.com/a/52572048/1309986\n// const NAMESPACES = {\n//     svg: 'http://www.w3.org/2000/svg',\n//     html: 'http://www.w3.org/1999/xhtml',\n//     xml: 'http://www.w3.org/XML/1998/namespace',\n//     xlink: 'http://www.w3.org/1999/xlink',\n//     xmlns: 'http://www.w3.org/2000/xmlns/' // sic for the final slash...\n// }\n\nconst Ui = class Ui {\n    //#region --- Class variables ---\n    version = '7.0.4-src'\n\n    // List of tags and attributes not in sanitise defaults but allowed in uibuilder.\n    sanitiseExtraTags = ['uib-var']\n    sanitiseExtraAttribs = ['variable', 'report', 'undefined']\n\n    /** Reference to DOM window - must be passed in the constructor\n     * Allows for use of this library/class with `jsdom` in Node.JS as well as the browser.\n     * @type {Window}\n     */\n    static win\n\n    /** Reference to the DOM top-level window.document for convenience - set in constructor @type {Document} */\n    static doc\n\n    /** Log function - passed in constructor or will be a dummy function\n     * @type {Function}\n     */\n    static log\n\n    /** Options for Markdown-IT if available (set in constructor) */\n    static mdOpts\n    /** Reference to pre-loaded Markdown-IT library */\n    static md\n    /** Optional Markdown-IT Plugins */\n    ui_md_plugins\n    //#endregion --- class variables ---\n\n    /** Called when `new Ui(...)` is called\n     * @param {globalThis} win Either the browser global window or jsdom dom.window\n     * @param {Function} [extLog] A function that returns a function for logging\n     * @param {Function} [jsonHighlight] A function that returns a highlighted HTML of JSON input\n     */\n    constructor(win, extLog, jsonHighlight) {\n        // window must be passed in as an arg to the constructor\n        // Should either be the global window for a browser or `dom.window` for jsdom in Node.js\n        // @ts-ignore\n        if (win) Ui.win = win\n        else {\n            // Ui.log(0, 'Ui:constructor', 'Current environment does not include `window`, UI functions cannot be used.')()\n            // return\n            throw new Error('Ui:constructor. Current environment does not include `window`, UI functions cannot be used.')\n        }\n\n        // For convenience\n        Ui.doc = Ui.win.document\n\n        // If a suitable function not passed in, create a dummy one\n        if (extLog) Ui.log = extLog\n        else Ui.log = function() { return function() {} }\n\n        // If a JSON HTML highlighting function passed then use it, else a dummy fn\n        if (jsonHighlight) this.syntaxHighlight = jsonHighlight\n        else this.syntaxHighlight = function() {}\n\n        // If Markdown-IT pre-loaded, then configure it now\n        if (Ui.win['markdownit']) {\n            Ui.mdOpts = {\n                html: true,\n                xhtmlOut: false,\n                linkify: true,\n                _highlight: true,\n                _strict: false,\n                _view: 'html',\n                langPrefix: 'language-',\n                // NB: the highlightjs (hljs) library must be loaded before markdown-it for this to work\n                highlight: function(str, lang) {\n                    // https://highlightjs.org\n                    if (lang && window['hljs'] && window['hljs'].getLanguage(lang)) {\n                        try {\n                            return `<pre class=\"\">\n                                    <code class=\"hljs border\">${window['hljs'].highlight(str, { language: lang, ignoreIllegals: true }).value}</code></pre>`\n                        } finally { } // eslint-disable-line no-empty\n                    }\n                    return `<pre class=\"hljs border\"><code>${Ui.md.utils.escapeHtml(str).trim()}</code></pre>`\n                },\n            }\n            Ui.md = Ui.win['markdownit'](Ui.mdOpts)\n        }\n    }\n\n    //#region ---- Internal Methods ----\n\n    _markDownIt() {\n        // If Markdown-IT pre-loaded, then configure it now\n        if (!Ui.win['markdownit']) return\n\n        // If plugins not yet defined, check if uibuilder has set them\n        if (!this.ui_md_plugins && Ui.win['uibuilder'] && Ui.win['uibuilder'].ui_md_plugins) this.ui_md_plugins = Ui.win['uibuilder'].ui_md_plugins\n\n        Ui.mdOpts = {\n            html: true,\n            xhtmlOut: false,\n            linkify: true,\n            _highlight: true,\n            _strict: false,\n            _view: 'html',\n            langPrefix: 'language-',\n            // NB: the highlightjs (hljs) library must be loaded before markdown-it for this to work\n            highlight: function(str, lang) {\n                if (window['hljs']) {\n                    if (lang && window['hljs'].getLanguage(lang)) {\n                        try {\n                            return `<pre><code class=\"hljs border language-${lang}\" data-language=\"${lang}\" title=\"Source language: '${lang}'\">${window['hljs'].highlight(str, { language: lang, ignoreIllegals: true }).value}</code></pre>`\n                        } finally { } // eslint-disable-line no-empty\n                    } else {\n                        try {\n                            const high = window['hljs'].highlightAuto(str)\n                            return `<pre><code class=\"hljs border language-${high.language}\" data-language=\"${high.language}\" title=\"Source language estimated by HighlightJS: '${high.language}'\">${high.value}</code></pre>`\n                        } finally { } // eslint-disable-line no-empty\n                    }\n                }\n                return `<pre><code class=\"border\">${Ui.md.utils.escapeHtml(str).trim()}</code></pre>`\n            },\n        }\n        Ui.md = Ui.win['markdownit'](Ui.mdOpts)\n        // Ui.md.use(Ui.win.markdownitTaskLists, {enabled: true})\n        if (this.ui_md_plugins) {\n            if (!Array.isArray(this.ui_md_plugins)) {\n                Ui.log('error', 'Ui:_markDownIt:plugins', 'Could not load plugins, ui_md_plugins is not an array')()\n                return\n            }\n            this.ui_md_plugins.forEach( plugin => {\n                if (typeof plugin === 'string') {\n                    Ui.md.use(Ui.win[plugin])\n                } else {\n                    const name = Object.keys(plugin)[0]\n                    Ui.md.use(Ui.win[name], plugin[name])\n                }\n            })\n        }\n    }\n\n    /** Show a browser notification if the browser and the user allows it\n     * @param {object} config Notification config data\n     * @returns {Promise} Resolves on close or click event, returns the event.\n     */\n    _showNotification(config) {\n        if ( config.topic && !config.title ) config.title = config.topic\n        if ( !config.title ) config.title = 'uibuilder notification'\n        if ( config.payload && !config.body ) config.body = config.payload\n        if ( !config.body ) config.body = ' No message given.'\n        // Wrap in try/catch since Chrome Android may throw an error\n        try {\n            const notify = new Notification(config.title, config)\n            return new Promise( (resolve, reject) => {\n                // Doesn't ever seem to fire (at least in Chromium)\n                notify.addEventListener('close', ev => {\n                    // @ts-ignore\n                    ev.currentTarget.userAction = 'close'\n                    resolve(ev)\n                })\n                notify.addEventListener('click', ev => {\n                    // @ts-ignore\n                    ev.currentTarget.userAction = 'click'\n                    resolve(ev)\n                })\n                notify.addEventListener('error', ev => {\n                    // @ts-ignore\n                    ev.currentTarget.userAction = 'error'\n                    reject(ev)\n                })\n            })\n        } catch (e) {\n            return Promise.reject(new Error('Browser refused to create a Notification'))\n        }\n    }\n\n    // Vue dynamic inserts Don't really work ...\n    // _uiAddVue(ui, isRecurse) {\n\n    //     // must be Vue\n    //     // must have only 1 root element\n    //     const compToAdd = ui.components[0]\n    //     const newEl = Ui.doc.createElement(compToAdd.type)\n\n    //     if (!compToAdd.slot && ui.payload) compToAdd.slot = ui.payload\n    //     this._uiComposeComponent(newEl, compToAdd)\n\n    //     // If nested components, go again - but don't pass payload to sub-components\n    //     if (compToAdd.components) {\n    //         this._uiExtendEl(newEl, compToAdd.components)\n    //     }\n\n    //     console.log('MAGIC: ', this.magick, newEl, newEl.outerHTML)()\n    //     this.set('magick', newEl.outerHTML)\n\n    //     // if (compToAdd.id) newEl.setAttribute('ref', compToAdd.id)\n    //     // if (elParent.id) newEl.setAttribute('data-parent', elParent.id)\n    // }\n\n    // TODO Add check if ID already exists\n    // TODO Allow single add without using components array\n    /** Handle incoming msg._ui add requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     * @param {boolean} isRecurse Is this a recursive call?\n     */\n    _uiAdd(ui, isRecurse) {\n        Ui.log('trace', 'Ui:_uiManager:add', 'Starting _uiAdd')()\n\n        // Vue dynamic inserts Don't really work ...\n        // if (this.#isVue && !isRecurse) {\n        //     this._uiAddVue(ui, false)\n        //     return\n        // }\n\n        ui.components.forEach((compToAdd, i) => {\n            Ui.log('trace', `Ui:_uiAdd:components-forEach:${i}`, 'Component to add: ', compToAdd)()\n\n            /** @type {*} Create the new component - some kind of HTML element */\n            let newEl\n            switch (compToAdd.type) {\n                // If trying to insert raw html, wrap in a div\n                case 'html': {\n                    compToAdd.ns = 'html'\n                    newEl = Ui.doc.createElement('div')\n                    break\n                }\n\n                // If trying to insert raw svg, need to create in namespace\n                case 'svg': {\n                    compToAdd.ns = 'svg'\n                    newEl = Ui.doc.createElementNS('http://www.w3.org/2000/svg', 'svg')\n                    break\n                }\n\n                default: {\n                    compToAdd.ns = 'dom'\n                    newEl = Ui.doc.createElement(compToAdd.type)\n                    break\n                }\n            }\n\n            if (!compToAdd.slot && ui.payload) compToAdd.slot = ui.payload\n\n            // const parser = new DOMParser()\n            // const newDoc = parser.parseFromString(compToAdd.slot, 'text/html')\n            // console.log(compToAdd, newDoc.body)()\n\n            this._uiComposeComponent(newEl, compToAdd)\n\n            /** @type {HTMLElement} Where to add the new element? */\n            let elParent\n            if (compToAdd.parentEl) {\n                elParent = compToAdd.parentEl\n            } else if (ui.parentEl) {\n                elParent = ui.parentEl\n            } else if (compToAdd.parent) {\n                elParent = Ui.doc.querySelector(compToAdd.parent)\n            } else if (ui.parent) {\n                elParent = Ui.doc.querySelector(ui.parent)\n            }\n            if (!elParent) {\n                Ui.log('info', 'Ui:_uiAdd', 'No parent found, adding to body')()\n                elParent = Ui.doc.querySelector('body')\n            }\n\n            if (compToAdd.position && compToAdd.position === 'first') {\n                // Insert new el before the first child of the parent. Ref: https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore#example_3\n                elParent.insertBefore(newEl, elParent.firstChild)\n            } else if (compToAdd.position && Number.isInteger(Number(compToAdd.position))) {\n                elParent.insertBefore(newEl, elParent.children[compToAdd.position])\n            } else {\n                // Append to the required parent\n                elParent.appendChild(newEl)\n            }\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToAdd.components) {\n                // this._uiAdd({\n                //     method: ui.method,\n                //     parentEl: newEl,\n                //     components: compToAdd.components,\n                // }, true)\n                this._uiExtendEl(newEl, compToAdd.components, compToAdd.ns)\n            }\n        })\n    } // --- end of _uiAdd ---\n\n    /** Enhance an HTML element that is being composed with ui data\n     *  such as ID, attribs, event handlers, custom props, etc.\n     * @param {*} el HTML Element to enhance\n     * @param {*} comp Individual uibuilder ui component spec\n     */\n    _uiComposeComponent(el, comp) {\n        // Add attributes\n        if (comp.attributes) {\n            Object.keys(comp.attributes).forEach((attrib) => {\n                if (attrib === 'class' && Array.isArray(comp.attributes[attrib])) comp.attributes[attrib].join(' ')\n\n                Ui.log('trace', '_uiComposeComponent:attributes-forEach', `Attribute: '${attrib}', value: '${comp.attributes[attrib]}'`)()\n\n                // For values, set the actual value as well since the attrib only changes the DEFAULT value\n                if (attrib === 'value') el.value = comp.attributes[attrib]\n\n                if (attrib.startsWith('xlink:')) el.setAttributeNS('http://www.w3.org/1999/xlink', attrib, comp.attributes[attrib])\n                else el.setAttribute(attrib, comp.attributes[attrib])\n            })\n        }\n\n        // ID if set\n        if (comp.id) el.setAttribute('id', comp.id)\n\n        // If an SVG tag, ensure we have the appropriate namespaces added\n        if (comp.type === 'svg') {\n            el.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns', 'http://www.w3.org/2000/svg')\n            el.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:xlink', 'http://www.w3.org/1999/xlink')\n        }\n\n        // Add event handlers\n        if (comp.events) {\n            Object.keys(comp.events).forEach((type) => {\n                // @ts-ignore  I'm forever getting this wrong!\n                if (type.toLowerCase === 'onclick') type = 'click'\n                // Add the event listener\n                try {\n                    el.addEventListener(type, (evt) => {\n                        // Use new Function to ensure that esbuild works: https://esbuild.github.io/content-types/#direct-eval\n                        (new Function('evt', `${comp.events[type]}(evt)`))(evt) // eslint-disable-line no-new-func\n                    })\n                    // newEl.setAttribute( 'onClick', `${comp.events[type]}()` )\n                } catch (err) {\n                    Ui.log('error', 'Ui:_uiComposeComponent', `Add event '${type}' for element '${comp.type}': Cannot add event handler. ${err.message}`)()\n                }\n            })\n        }\n\n        // Add custom properties to the dataset\n        if (comp.properties) {\n            Object.keys(comp.properties).forEach((prop) => {\n                // TODO break a.b into sub properties\n                el[prop] = comp.properties[prop]\n                // Auto-dispatch events if changing value or changed since DOM does not do this automatically\n                if (['value', 'checked'].includes(prop)) {\n                    el.dispatchEvent(new Event('input'))\n                    el.dispatchEvent(new Event('change'))\n                }\n            })\n        }\n\n        //#region Add Slot content to innerHTML\n        if (comp.slot) {\n            this.replaceSlot(el, comp.slot)\n        }\n        //#endregion\n\n        // TODO Add multi-slot capability (default slot must always be processed first as innerHTML is replaced)\n\n        //#region Add Slot Markdown content to innerHTML IF marked library is available\n        if (comp.slotMarkdown) {\n            this.replaceSlotMarkdown(el, comp)\n        }\n        //#endregion\n    }\n\n    /** Extend an HTML Element with appended elements using ui components\n     * NOTE: This fn follows a strict hierarchy of added components.\n     * @param {HTMLElement} parentEl The parent HTML Element we want to append to\n     * @param {*} components The ui component(s) we want to add\n     * @param {string} [ns] Optional. The namespace to use.\n     */\n    _uiExtendEl(parentEl, components, ns = '') {\n        components.forEach((compToAdd, i) => {\n            Ui.log('trace', `Ui:_uiExtendEl:components-forEach:${i}`, compToAdd)()\n\n            /** @type {HTMLElement} Create the new component */\n            let newEl\n\n            compToAdd.ns = ns\n\n            if (compToAdd.ns === 'html') {\n                newEl = parentEl\n                // newEl.outerHTML = compToAdd.slot\n                // parentEl.innerHTML = compToAdd.slot\n                this.replaceSlot(parentEl, compToAdd.slot)\n            } else if (compToAdd.ns === 'svg') {\n                newEl = Ui.doc.createElementNS('http://www.w3.org/2000/svg', compToAdd.type)\n                // Updates newEl\n                this._uiComposeComponent(newEl, compToAdd)\n                parentEl.appendChild(newEl)\n            } else {\n                newEl = Ui.doc.createElement(compToAdd.type === 'html' ? 'div' : compToAdd.type)\n                // Updates newEl\n                this._uiComposeComponent(newEl, compToAdd)\n                parentEl.appendChild(newEl)\n            }\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToAdd.components) {\n                this._uiExtendEl(newEl, compToAdd.components, compToAdd.ns)\n            }\n        })\n    }\n\n    // TODO Add more error handling and parameter validation\n    /** Handle incoming _ui load requests\n     * Can load JavaScript modules, JavaScript scripts and CSS.\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     */\n    _uiLoad(ui) {\n\n        // Self-loading ECMA Modules (e.g. web components)\n        if (ui.components) {\n            if (!Array.isArray(ui.components)) ui.components = [ui.components]\n\n            ui.components.forEach(async component => {\n                // NOTE: This happens asynchronously but we don't wait\n                import(component)\n            })\n        }\n        // Remote Scripts\n        if (ui.srcScripts) {\n            if (!Array.isArray(ui.srcScripts)) ui.srcScripts = [ui.srcScripts]\n\n            ui.srcScripts.forEach(script => {\n                this.loadScriptSrc(script)\n            })\n        }\n        // Scripts passed as text\n        if (ui.txtScripts) {\n            if (!Array.isArray(ui.txtScripts)) ui.txtScripts = [ui.txtScripts]\n\n            this.loadScriptTxt(ui.txtScripts.join('\\n'))\n        }\n        // Remote Stylesheets\n        if (ui.srcStyles) {\n            if (!Array.isArray(ui.srcStyles)) ui.srcStyles = [ui.srcStyles]\n\n            ui.srcStyles.forEach(sheet => {\n                this.loadStyleSrc(sheet)\n            })\n        }\n        // Styles passed as text\n        if (ui.txtStyles) {\n            if (!Array.isArray(ui.txtStyles)) ui.txtStyles = [ui.txtStyles]\n\n            this.loadStyleTxt(ui.txtStyles.join('\\n'))\n        }\n\n    } // --- end of _uiLoad ---\n\n    /** Handle incoming _ui messages and loaded UI JSON files\n     * Called from start()\n     * @param {*} msg Standardised msg object containing a _ui property object\n     */\n    _uiManager(msg) {\n        if (!msg._ui) return\n\n        // Make sure that _ui is an array\n        if (!Array.isArray(msg._ui)) msg._ui = [msg._ui]\n\n        msg._ui.forEach((ui, i) => {\n            if (ui.mode && !ui.method) ui.method = ui.mode\n            if (!ui.method) {\n                Ui.log('error', 'Ui:_uiManager', `No method defined for msg._ui[${i}]. Ignoring. `, ui)()\n                return\n            }\n\n            ui.payload = msg.payload\n            ui.topic = msg.topic\n            switch (ui.method) {\n                case 'add': {\n                    this._uiAdd(ui, false)\n                    break\n                }\n\n                case 'remove': {\n                    this._uiRemove(ui, false)\n                    break\n                }\n\n                case 'removeAll': {\n                    this._uiRemove(ui, true)\n                    break\n                }\n\n                case 'replace': {\n                    this._uiReplace(ui)\n                    break\n                }\n\n                case 'update': {\n                    this._uiUpdate(ui)\n                    break\n                }\n\n                case 'load': {\n                    this._uiLoad(ui)\n                    break\n                }\n\n                case 'reload': {\n                    this._uiReload()\n                    break\n                }\n\n                case 'notify': {\n                    this.showDialog('notify', ui, msg)\n                    break\n                }\n\n                case 'alert': {\n                    this.showDialog('alert', ui, msg)\n                    break\n                }\n\n                default: {\n                    Ui.log('error', 'Ui:_uiManager', `Invalid msg._ui[${i}].method (${ui.method}). Ignoring`)()\n                    break\n                }\n            }\n        })\n    } // --- end of _uiManager ---\n\n    /** Handle a reload request */\n    _uiReload() {\n        Ui.log('trace', 'Ui:uiManager:reload', 'reloading')()\n        location.reload()\n    }\n\n    // TODO Add better tests for failures (see comments)\n    /** Handle incoming _ui remove requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     * @param {boolean} all Optional, default=false. If true, will remove ALL found elements, otherwise only the 1st is removed\n     */\n    _uiRemove(ui, all = false) {\n        ui.components.forEach((compToRemove) => {\n            let els\n            if (all !== true) els = [Ui.doc.querySelector(compToRemove)]\n            else els = Ui.doc.querySelectorAll(compToRemove)\n\n            els.forEach(el => {\n                try {\n                    el.remove()\n                } catch (err) {\n                    // Could not remove. Cannot read properties of null <= no need to report this one\n                    // Could not remove. Failed to execute 'querySelector' on 'Ui.doc': '##testbutton1' is not a valid selector\n                    Ui.log('trace', 'Ui:_uiRemove', `Could not remove. ${err.message}`)()\n                }\n            })\n        })\n    } // --- end of _uiRemove ---\n\n    /** Handle incoming _ui replace requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     */\n    _uiReplace(ui) {\n        Ui.log('trace', 'Ui:_uiReplace', 'Starting')()\n\n        ui.components.forEach((compToReplace, /** @type {number} */ i) => {\n            Ui.log('trace', `Ui:_uiReplace:components-forEach:${i}`, 'Component to replace: ', compToReplace)()\n\n            /** @type {HTMLElement} */\n            let elToReplace\n\n            // Either the id, CSS selector, name or type (element type) must be given in order to identify the element to change. FIRST element matching is updated.\n            if (compToReplace.id) {\n                elToReplace = Ui.doc.getElementById(compToReplace.id) // .querySelector(`#${compToReplace.id}`)\n            } else if (compToReplace.selector || compToReplace.select) {\n                elToReplace = Ui.doc.querySelector(compToReplace.selector)\n            } else if (compToReplace.name) {\n                elToReplace = Ui.doc.querySelector(`[name=\"${compToReplace.name}\"]`)\n            } else if (compToReplace.type) {\n                elToReplace = Ui.doc.querySelector(compToReplace.type)\n            }\n\n            Ui.log('trace', `Ui:_uiReplace:components-forEach:${i}`, 'Element to replace: ', elToReplace)()\n\n            // Nothing was found so ADD the element instead\n            if (elToReplace === undefined || elToReplace === null) {\n                Ui.log('trace', `Ui:_uiReplace:components-forEach:${i}:noReplace`, 'Cannot find the DOM element. Adding instead.', compToReplace)()\n                this._uiAdd({ components: [compToReplace] }, false)\n                return\n            }\n\n            /** @type {*} Create the new component - some kind of HTML element */\n            let newEl\n            switch (compToReplace.type) {\n                // If trying to insert raw html, wrap in a div\n                case 'html': {\n                    compToReplace.ns = 'html'\n                    newEl = Ui.doc.createElement('div')\n                    break\n                }\n\n                // If trying to insert raw svg, need to create in namespace\n                case 'svg': {\n                    compToReplace.ns = 'svg'\n                    newEl = Ui.doc.createElementNS('http://www.w3.org/2000/svg', 'svg')\n                    break\n                }\n\n                default: {\n                    compToReplace.ns = 'dom'\n                    newEl = Ui.doc.createElement(compToReplace.type)\n                    break\n                }\n            }\n\n            // Updates the newEl and maybe the ui\n            this._uiComposeComponent(newEl, compToReplace)\n\n            // Replace the current element\n            elToReplace.replaceWith(newEl)\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToReplace.components) {\n                this._uiExtendEl(newEl, compToReplace.components, compToReplace.ns)\n            }\n        })\n    } // --- end of _uiReplace ---\n\n    // TODO Allow single add without using components array\n    // TODO Allow sub-components\n    // TODO Add multi-slot capability\n    /** Handle incoming _ui update requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     */\n    _uiUpdate(ui) {\n        Ui.log('trace', 'UI:_uiUpdate:update', 'Starting _uiUpdate', ui)()\n\n        // We allow an update not to actually need to spec a component\n        if (!ui.components) ui.components = [Object.assign({}, ui)]\n\n        ui.components.forEach((compToUpd, i) => {\n            Ui.log('trace', '_uiUpdate:components-forEach', `Start loop #${i}`, compToUpd)()\n\n            /** @type {NodeListOf<Element>} */\n            let elToUpd\n\n            // If a parent element is passed, use that as the update target (only allowed internally)\n            // Otherwise either the id, CSS selector, name or type (element type) must be given in order to identify the element to change. ALL elements matching are updated.\n            if (compToUpd.parentEl) {\n                elToUpd = compToUpd.parentEl\n            } else if (compToUpd.id) {\n                // NB We don't use get by id because this way the code is simpler later on\n                elToUpd = Ui.doc.querySelectorAll(`#${compToUpd.id}`)\n            } else if (compToUpd.selector || compToUpd.select) {\n                elToUpd = Ui.doc.querySelectorAll(compToUpd.selector)\n            } else if (compToUpd.name) {\n                elToUpd = Ui.doc.querySelectorAll(`[name=\"${compToUpd.name}\"]`)\n            } else if (compToUpd.type) {\n                elToUpd = Ui.doc.querySelectorAll(compToUpd.type)\n            }\n\n            // @ts-ignore Nothing was found so give up\n            if (elToUpd === undefined || elToUpd.length < 1) {\n                Ui.log('warn', 'Ui:_uiManager:update', 'Cannot find the DOM element. Ignoring.', compToUpd)()\n                return\n            }\n\n            Ui.log('trace', '_uiUpdate:components-forEach', `Element(s) to update. Count: ${elToUpd.length}`, elToUpd)()\n\n            // If slot not specified but payload is, use the payload in the slot\n            if (!compToUpd.slot && compToUpd.payload) compToUpd.slot = compToUpd.payload\n\n            // Might have >1 element to update - so update them all\n            elToUpd.forEach((el, j) => {\n                Ui.log('trace', '_uiUpdate:components-forEach', `Updating element #${j}`, el)()\n                this._uiComposeComponent(el, compToUpd)\n                // Try to go down another level of nesting if needed\n                // ! NOT CONVINCED THIS ACTUALLY WORKS !\n                if (compToUpd.components) {\n                    Ui.log('trace', '_uiUpdate:nested-component', `Element #${j} - nested-component`, compToUpd, el)()\n                    const nc = { _ui: [] }\n                    compToUpd.components.forEach((nestedComp, k) => {\n                        const method = nestedComp.method || compToUpd.method || ui.method\n                        if (nestedComp.method) delete nestedComp.method\n                        if (!Array.isArray(nestedComp)) nestedComp = [nestedComp]\n                        // nestedComp.parentEl = el\n                        // nestedComp.components = [nestedComp]\n                        Ui.log('trace', '_uiUpdate:nested-component', `Element #${j} - nested-component #${k}`, nestedComp)()\n                        nc._ui.push( {\n                            method: method,\n                            parentEl: el,\n                            components: nestedComp,\n                        })\n                    })\n                    Ui.log('trace', '_uiUpdate:nested-component', `Element #${j} - nested-component new manager`, nc)()\n                    this._uiManager(nc)\n                }\n            })\n\n            // If nested components, apply to every found element - but don't pass payload to sub-components\n            // if (compToUpd.components) {\n            //     compToUpd.components.forEach((el, k) => {\n            //         Ui.log('trace', '_uiUpdate:nested-component', `Updating nested-component #${k}`, el)()\n            //         this._uiUpdate({\n            //             method: el.method || ui.method,\n            //             parentEl: el,\n            //             components: el.components,\n            //         })\n            //     })\n            // }\n        })\n    } // --- end of _uiUpdate ---\n\n    //#endregion ---- -------- ----\n\n    //#region ---- External Methods ----\n\n    /** Simplistic jQuery-like document CSS query selector, returns an HTML Element\n     * NOTE that this fn returns the element itself. Use $$ to get the properties of 1 or more elements.\n     * If the selected element is a <template>, returns the first child element.\n     * type {HTMLElement}\n     * @param {string} cssSelector A CSS Selector that identifies the element to return\n     * @param {\"el\"|\"text\"|\"html\"|\"attributes\"|\"attr\"} [output] Optional. What type of output to return. Defaults to \"el\", the DOM element reference\n     * @returns {HTMLElement|string|InnerHTML|array|null} Selected HTML DOM element, innerText, innerHTML, attribute list or null\n     */\n    $(cssSelector, output) {\n        /** @type {*} Some kind of HTML element */\n        let el = Ui.doc.querySelector(cssSelector)\n\n        if (!el) {\n            Ui.log(1, 'Uib:$', `No element found for CSS selector ${cssSelector}`)()\n            return null\n        }\n\n        if ( el.nodeName === 'TEMPLATE' ) {\n            el = el.content.firstElementChild\n            if (!el) {\n                Ui.log(0, 'Uib:$', `Template selected for CSS selector ${cssSelector} but it is empty`)()\n                return null\n            }\n        }\n\n        if (!output) output = 'el'\n        let out\n\n        try {\n            switch (output.toLowerCase()) {\n                case 'text': {\n                    out = el.innerText\n                    break\n                }\n\n                case 'html': {\n                    out = el.innerHTML\n                    break\n                }\n\n                case 'attr':\n                case 'attributes': {\n                    out = {}\n                    for (const attr of el.attributes) {\n                        out[attr.name] = attr.value\n                    }\n                    break\n                }\n\n                default: {\n                    out = el\n                    break\n                }\n            }\n        } catch (e) {\n            out = el\n            Ui.log(1, 'Uib:$', `Could not process output type \"${output}\" for CSS selector ${cssSelector}, returned the DOM element. ${e.message}`, e)()\n        }\n\n        return out\n    }\n\n    /** CSS query selector that returns ALL found selections. Matches the Chromium DevTools feature of the same name.\n     * NOTE that this fn returns an array showing the PROPERTIES of the elements whereas $ returns the element itself\n     * @param {string} cssSelector A CSS Selector that identifies the elements to return\n     * @returns {HTMLElement[]} Array of DOM elements/nodes. Array is empty if selector is not found.\n     */\n    $$(cssSelector) {\n        return Array.from(Ui.doc.querySelectorAll(cssSelector))\n    }\n\n    /** Add 1 or several class names to an element\n     * @param {string|string[]} classNames Single or array of classnames\n     * @param {HTMLElement} el HTML Element to add class(es) to\n     */\n    addClass(classNames, el) {\n        if (!Array.isArray(classNames)) classNames = [classNames]\n        if (el) el.classList.add(...classNames)\n    }\n\n    /** Apply a source template tag to a target html element\n     * NOTES:\n     * - styles in ALL templates are accessible to all templates.\n     * - scripts in templates are run AT TIME OF APPLICATION (so may run multiple times).\n     * - scripts in templates are applied in order of application, so variables may not yet exist if defined in subsequent templates\n     * @param {string} sourceId The HTML ID of the source element\n     * @param {string} targetId The HTML ID of the target element\n     * @param {object} config Configuration options\n     * @param {boolean=} config.onceOnly If true, the source will be adopted (the source is moved)\n     * @param {object=} config.attributes A set of key:value pairs that will be applied as attributes to the target\n     */\n    applyTemplate(sourceId, targetId, config) {\n        if (!config) config = { onceOnly: false }\n\n        const template = Ui.doc.getElementById(sourceId)\n        const target = Ui.doc.getElementById(targetId)\n\n        if (template && target) {\n            let content\n            try {\n                if (config.onceOnly !== true) content = Ui.doc.importNode(template.content, true)\n                else content = Ui.doc.adoptNode(template.content)\n                // NB content.childElementCount = 0 after adoption\n            } catch (e) {\n                Ui.log('error', 'Ui:applyTemplate', `Source must be a <template>. id='${sourceId}'`)()\n                return\n            }\n            if (content) {\n                // Apply config.attributes to the 1st element of the template content\n                if (config.attributes) {\n                    const el = content.firstElementChild\n                    Object.keys(config.attributes).forEach( attrib => {\n                        // Apply each attribute and value\n                        el.setAttribute(attrib, config.attributes[attrib])\n                    })\n                }\n                // ! TODO Add ability to change slot content\n                // Apply to the target\n                target.appendChild(content)\n            }\n        } else {\n            if (!template) Ui.log('error', 'Ui:applyTemplate', `Source not found: id='${sourceId}'`)()\n            if (!target) Ui.log('error', 'Ui:applyTemplate', `Target not found: id='${targetId}'`)()\n        }\n    }\n\n    /** Builds an HTML table from an array (or object) of objects\n     * 1st row is used for columns. If an object of objects, the outer keys\n     * are used as row ID's (prefixed with \"r-\").\n     * @param {Array<object>|Object} data Input data array or object\n     * @returns {HTMLTableElement|HTMLParagraphElement} Output HTML Element\n     */\n    buildHtmlTable(data) {\n        // If data is an object of objects, convert it to an array of objects\n        let keys\n        if (!Array.isArray(data)) {\n            if (typeof data === 'object') {\n                keys = Object.keys(data)\n                data = Object.values(data)\n            }\n            // Ensure input is an array of objects\n            if (!Array.isArray(data)) {\n                const out = Ui.doc.createElement('p')\n                out.textContent = 'Input data is not an array or an object, cannot create a table.'\n                return out\n            }\n        }\n\n        const tbl = Ui.doc.createElement('table')\n        // Heading row\n        const thead = Ui.doc.createElement('thead')\n        const headerRow = Ui.doc.createElement('tr')\n        // Get the headers from the keys of the first object\n        const headers = Object.keys(data[0])\n        headers.forEach(header => {\n            const th = Ui.doc.createElement('th')\n            th.textContent = header\n            headerRow.appendChild(th)\n        })\n        thead.appendChild(headerRow)\n        tbl.appendChild(thead)\n\n        // body\n        const tbody = Ui.doc.createElement('tbody')\n        data.forEach( (item, i) => {\n            const row = Ui.doc.createElement('tr')\n            if (keys) row.id = `r-${keys[i]}`\n            headers.forEach(header => {\n                const cell = Ui.doc.createElement('td')\n                // cell.textContent = item[header]\n                cell.innerHTML = this.sanitiseHTML(item[header])\n                row.appendChild(cell)\n            })\n            tbody.appendChild(row)\n        })\n        tbl.appendChild(tbody)\n\n        return tbl\n    }\n\n    /** Converts markdown text input to HTML if the Markdown-IT library is loaded\n     * Otherwise simply returns the text\n     * @param {string} mdText The input markdown string\n     * @returns {string} HTML (if Markdown-IT library loaded and parse successful) or original text\n     */\n    convertMarkdown(mdText) {\n        if (!mdText) return ''\n        if (!Ui.win['markdownit']) return mdText\n        if (!Ui.md) this._markDownIt() // To handle case where the library is late loaded\n        // Convert from markdown to HTML\n        try {\n            return Ui.md.render(mdText.trim())\n        } catch (e) {\n            Ui.log(0, 'uibuilder:convertMarkdown', `Could not render Markdown. ${e.message}`, e)()\n            return '<p class=\"border error\">Could not render Markdown<p>'\n        }\n    }\n\n    /** Include HTML fragment, img, video, text, json, form data, pdf or anything else from an external file or API\n     * Wraps the included object in a div tag.\n     * PDF's, text or unknown MIME types are also wrapped in an iFrame.\n     * @param {string} url The URL of the source file to include\n     * @param {object} uiOptions Object containing properties recognised by the _uiReplace function. Must at least contain an id\n     * param {string} uiOptions.id The HTML ID given to the wrapping DIV tag\n     * param {string} uiOptions.parentSelector The CSS selector for a parent element to insert the new HTML under (defaults to 'body')\n     * @returns {Promise<any>} Status\n     */\n    async include(url, uiOptions) { // eslint-disable-line sonarjs/cognitive-complexity\n        // TODO: src, id, parent must all be a strings\n        if (!fetch) {\n            Ui.log(0, 'Ui:include', 'Current environment does not include `fetch`, skipping.')()\n            return 'Current environment does not include `fetch`, skipping.'\n        }\n        if (!url) {\n            Ui.log(0, 'Ui:include', 'url parameter must be provided, skipping.')()\n            return 'url parameter must be provided, skipping.'\n        }\n        if (!uiOptions || !uiOptions.id) {\n            Ui.log(0, 'Ui:include', 'uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.')()\n            return 'uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.'\n        }\n\n        // Try to get the content via the URL\n        let response\n        try {\n            response = await fetch(url)\n        } catch (error) {\n            Ui.log(0, 'Ui:include', `Fetch of file '${url}' failed. `, error.message)()\n            return error.message\n        }\n        if (!response.ok) {\n            Ui.log(0, 'Ui:include', `Fetch of file '${url}' failed. Status='${response.statusText}'`)()\n            return response.statusText\n        }\n\n        // Work out what type of data we got\n        const contentType = await response.headers.get('content-type')\n        let type = null\n        if (contentType) {\n            if (contentType.includes('text/html')) {\n                type = 'html'\n            } else if (contentType.includes('application/json')) {\n                type = 'json'\n            } else if (contentType.includes('multipart/form-data')) {\n                type = 'form'\n            } else if (contentType.includes('image/')) {\n                type = 'image'\n            } else if (contentType.includes('video/')) {\n                type = 'video'\n            } else if (contentType.includes('application/pdf')) {\n                type = 'pdf'\n            } else if (contentType.includes('text/plain')) {\n                type = 'text'\n            } // else type = null\n        }\n\n        // Create the HTML to include on the page based on type\n        let slot = ''\n        let txtReturn = 'Include successful'\n        let data\n        switch (type) {\n            case 'html': {\n                data = await response.text()\n                slot = data\n                break\n            }\n\n            case 'json': {\n                data = await response.json()\n                slot = '<pre class=\"syntax-highlight\">'\n                slot += this.syntaxHighlight(data)\n                slot += '</pre>'\n                break\n            }\n\n            case 'form': {\n                data = await response.formData()\n                slot = '<pre class=\"syntax-highlight\">'\n                slot += this.syntaxHighlight(data)\n                slot += '</pre>'\n                break\n            }\n\n            case 'image': {\n                data = await response.blob()\n                slot = `<img src=\"${URL.createObjectURL(data)}\">`\n                if (Ui.win['DOMPurify']) {\n                    txtReturn = 'Include successful. BUT DOMPurify loaded which may block its use.'\n                    Ui.log('warn', 'Ui:include:image', txtReturn)()\n                }\n                break\n            }\n\n            case 'video': {\n                data = await response.blob()\n                slot = `<video controls autoplay><source src=\"${URL.createObjectURL(data)}\"></video>`\n                if (Ui.win['DOMPurify']) {\n                    txtReturn = 'Include successful. BUT DOMPurify loaded which may block its use.'\n                    Ui.log('warn', 'Ui:include:video', txtReturn)()\n                }\n                break\n            }\n\n            case 'pdf':\n            case 'text':\n            default: {\n                data = await response.blob()\n                slot = `<iframe style=\"resize:both;width:inherit;height:inherit;\" src=\"${URL.createObjectURL(data)}\">`\n                if (Ui.win['DOMPurify']) {\n                    txtReturn = 'Include successful. BUT DOMPurify loaded which may block its use.'\n                    Ui.log('warn', `Ui:include:${type}`, txtReturn)()\n                }\n                break\n            }\n        }\n\n        // Wrap it all in a <div id=\"...\" class=\"included\">\n        uiOptions.type = 'div'\n        uiOptions.slot = slot\n        if (!uiOptions.parent) uiOptions.parent = 'body'\n        if (!uiOptions.attributes) uiOptions.attributes = { class: 'included' }\n\n        // Use uibuilder's standard ui processing to turn the instructions into HTML\n        this._uiReplace({\n            components: [\n                uiOptions\n            ]\n        })\n\n        Ui.log('trace', `Ui:include:${type}`, txtReturn)()\n        return txtReturn\n    } // ---- End of include() ---- //\n\n    /** Attach a new remote script to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} url The url to be used in the script src attribute\n     */\n    loadScriptSrc(url) {\n        const newScript = Ui.doc.createElement('script')\n        newScript.src = url\n        newScript.async = false\n        Ui.doc.head.appendChild(newScript)\n    }\n\n    /** Attach a new text script to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} textFn The text to be loaded as a script\n     */\n    loadScriptTxt(textFn) {\n        const newScript = Ui.doc.createElement('script')\n        newScript.async = false\n        newScript.textContent = textFn\n        Ui.doc.head.appendChild(newScript)\n    }\n\n    /** Attach a new remote stylesheet link to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} url The url to be used in the style link href attribute\n     */\n    loadStyleSrc(url) {\n        const newStyle = Ui.doc.createElement('link')\n        newStyle.href = url\n        newStyle.rel = 'stylesheet'\n        newStyle.type = 'text/css'\n\n        Ui.doc.head.appendChild(newStyle)\n    }\n\n    /** Attach a new text stylesheet to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} textFn The text to be loaded as a stylesheet\n     */\n    loadStyleTxt(textFn) {\n        const newStyle = Ui.doc.createElement('style')\n        newStyle.textContent = textFn\n        Ui.doc.head.appendChild(newStyle)\n    }\n\n    /** Load a dynamic UI from a JSON web reponse\n     * @param {string} url URL that will return the ui JSON\n     */\n    loadui(url) {\n        if (!fetch) {\n            Ui.log(0, 'Ui:loadui', 'Current environment does not include `fetch`, skipping.')()\n            return\n        }\n        if (!url) {\n            Ui.log(0, 'Ui:loadui', 'url parameter must be provided, skipping.')()\n            return\n        }\n\n        fetch(url)\n            .then(response => {\n                if (response.ok === false) {\n                    // Ui.log('warn', 'Ui:loadui:then1', `Could not load '${url}'. Status ${response.status}, Error: ${response.statusText}`)()\n                    throw new Error(`Could not load '${url}'. Status ${response.status}, Error: ${response.statusText}`)\n                }\n\n                Ui.log('trace', 'Ui:loadui:then1', `Loaded '${url}'. Status ${response.status}, ${response.statusText}`)()\n                // Did we get json?\n                const contentType = response.headers.get('content-type')\n                if (!contentType || !contentType.includes('application/json')) {\n                    throw new TypeError(`Fetch '${url}' did not return JSON, ignoring`)\n                }\n                // Returns parsed json to next .then\n                return response.json()\n            })\n            .then(data => {\n                if (data !== undefined) {\n                    Ui.log('trace', 'Ui:loadui:then2', 'Parsed JSON successfully obtained')()\n                    // Call the _uiManager\n                    this._uiManager({ _ui: data })\n                    return true\n                }\n                return false\n            })\n            .catch(err => {\n                Ui.log('warn', 'Ui:loadui:catch', 'Error. ', err)()\n            })\n    } // --- end of loadui\n\n    /** ! NOT COMPLETE Move an element from one position to another\n     * @param {object} opts Options\n     * @param {string} opts.sourceSelector Required, CSS Selector that identifies the element to be moved\n     * @param {string} opts.targetSelector Required, CSS Selector that identifies the element to be moved\n     */\n    moveElement(opts) {\n        const { sourceSelector, targetSelector, moveType, position } = opts\n        const sourceEl = document.querySelector(sourceSelector)\n        if (!sourceEl) {\n            Ui.log(0, 'Ui:moveElement', 'Source element not found')()\n            return\n        }\n        const targetEl = document.querySelector(targetSelector)\n        if (!targetEl) {\n            Ui.log(0, 'Ui:moveElement', 'Target element not found')()\n            return\n        }\n    }\n\n    /** Get standard data from a DOM node.\n     * @param {*} node DOM node to examine\n     * @param {string} cssSelector Identify the DOM element to get data from\n     * @returns {object} Standardised data object\n     */\n    nodeGet(node, cssSelector) {\n        const thisOut = {\n            id: node.id === '' ? undefined : node.id,\n            name: node.name,\n            children: node.childNodes.length,\n            type: node.nodeName,\n            attributes: undefined,\n\n            isUserInput: node.validity ? true : false, // eslint-disable-line no-unneeded-ternary\n            userInput: !node.validity ? undefined : { // eslint-disable-line multiline-ternary\n                value: node.value,\n                validity: undefined,\n                willValidate: node.willValidate,\n                valueAsDate: node.valueAsDate,\n                valueAsNumber: node.valueAsNumber,\n                type: node.type,\n            },\n        }\n\n        if (['UL', 'OL'].includes(node.nodeName)) {\n            const listEntries = Ui.doc.querySelectorAll(`${cssSelector} li`)\n            if (listEntries) {\n                thisOut.list = {\n                    'entries': listEntries.length\n                }\n            }\n        }\n        if (node.nodeName === 'DL') {\n            const listEntries = Ui.doc.querySelectorAll(`${cssSelector} dt`)\n            if (listEntries) {\n                thisOut.list = {\n                    'entries': listEntries.length\n                }\n            }\n        }\n        if (node.nodeName === 'TABLE') {\n            const bodyEntries = Ui.doc.querySelectorAll(`${cssSelector} > tbody > tr`)\n            const headEntries = Ui.doc.querySelectorAll(`${cssSelector} > thead > tr`)\n            const cols = Ui.doc.querySelectorAll(`${cssSelector} > tbody > tr:last-child > *`)  // #eltest > table > tbody > tr:nth-child(3)\n            if (bodyEntries || headEntries || cols) {\n                thisOut.table = {\n                    'headRows': headEntries ? headEntries.length : 0,\n                    'bodyRows': bodyEntries ? bodyEntries.length : 0,\n                    'columns': cols ? cols.length : 0,\n                }\n            }\n        }\n        if (node.nodeName !== '#text' && node.attributes && node.attributes.length > 0) {\n            thisOut.attributes = {}\n            // @ts-ignore\n            for (const attrib of node.attributes) {\n                if (attrib.name !== 'id') {\n                    thisOut.attributes[attrib.name] = node.attributes[attrib.name].value\n                }\n                if (attrib.name === 'class') thisOut.classes = Array.from(node.classList)\n            }\n        }\n        if (node.nodeName === '#text') {\n            thisOut.text = node.textContent\n        }\n        if (node.validity) thisOut.userInput.validity = {}\n        for (const v in node.validity) {\n            thisOut.userInput.validity[v] = node.validity[v]\n        }\n\n        return thisOut\n    } // --- end of nodeGet --- //\n\n    /** Show a browser notification if possible. Returns a promise\n     * Config can be a simple string, a Node-RED msg (topic as title, payload as body)\n     * or a Notifications API options object + config.title string.\n     * Config ref: https://developer.mozilla.org/en-US/docs/Web/API/Notification/Notification\n     * @param {object|string} config Notification config object or simple message string\n     * @returns {Promise} Resolves on close or click event, returns the event.\n     */\n    async notification(config) {\n        if (typeof config === 'string') {\n            config = { body: config }\n        }\n        // Are notifications available?\n        if (typeof Notification === 'undefined') return Promise.reject(new Error('Notifications not available in this browser'))\n        // Do we have permission? If not, ask for permission\n        let permit = Notification.permission\n        if (permit === 'denied') {\n            return Promise.reject(new Error('Notifications not permitted by user')) // eslint-disable-line no-useless-return\n        } else if (permit === 'granted') {\n            return this._showNotification(config)\n        } else { // if (permit === 'default') {\n            permit = await Notification.requestPermission()\n            if (permit === 'granted') {\n                return this._showNotification(config)\n            }\n            return Promise.reject(new Error('Notifications not permitted by user'))\n        }\n    }\n\n    /** Remove All, 1 or more class names from an element\n     * @param {undefined|null|\"\"|string|string[]} classNames Single or array of classnames. If undefined, \"\" or null, remove all classes\n     * @param {HTMLElement} el HTML Element to add class(es) to\n     */\n    removeClass(classNames, el) {\n        if (!classNames) {\n            el.removeAttribute('class')\n            return\n        }\n        if (!Array.isArray(classNames)) classNames = [classNames]\n        if (el) el.classList.remove(...classNames)\n    }\n\n    /** Replace or add an HTML element's slot from text or an HTML string\n     * WARNING: Executes <script> tags! And will process <style> tags.\n     * Will use DOMPurify if that library has been loaded to window.\n     * param {*} ui Single entry from the msg._ui property\n     * @param {Element} el Reference to the element that we want to update\n     * @param {*} slot The slot content we are trying to add/replace (defaults to empty string)\n     */\n    replaceSlot(el, slot) {\n        if (!el) return\n        if (!slot) slot = ''\n\n        // If DOMPurify is loaded, apply it now\n        slot = this.sanitiseHTML(slot)\n\n        // Create doc frag and apply html string (msg.payload or the slot property)\n        const tempFrag = Ui.doc.createRange().createContextualFragment(slot)\n\n        // Remove content of el and replace with tempFrag\n        const elRange = Ui.doc.createRange()\n        elRange.selectNodeContents(el)\n        elRange.deleteContents()\n        el.append(tempFrag)\n    }\n\n    /** Replace or add an HTML element's slot from a Markdown string\n     * Only does something if the markdownit library has been loaded to window.\n     * Will use DOMPurify if that library has been loaded to window.\n     * @param {Element} el Reference to the element that we want to update\n     * @param {*} component The component we are trying to add/replace\n     */\n    replaceSlotMarkdown(el, component) {\n        if (!el) return\n        if (!component.slotMarkdown) return\n\n        // Convert from markdown to HTML\n        component.slotMarkdown = this.convertMarkdown(component.slotMarkdown)\n        // If DOMPurify is loaded, apply it now\n        component.slotMarkdown = this.sanitiseHTML(component.slotMarkdown)\n        // Set the component content to the the converted slotMarkdown property\n        el.innerHTML = component.slotMarkdown\n    }\n\n    /** Sanitise HTML to make it safe - if the DOMPurify library is loaded\n     * Otherwise just returns that HTML as-is.\n     * @param {string} html The input HTML string\n     * @returns {string} The sanitised HTML or the original if DOMPurify not loaded\n     */\n    sanitiseHTML(html) {\n        if (!Ui.win['DOMPurify']) return html\n        return Ui.win['DOMPurify'].sanitize(html, { ADD_TAGS: this.sanitiseExtraTags, ADD_ATTR: this.sanitiseExtraAttribs })\n    }\n\n    /** Show a pop-over \"toast\" dialog or a modal alert // TODO - Allow notify to sit in corners rather than take over the screen\n     * Refs: https://www.w3.org/WAI/ARIA/apg/example-index/dialog-modal/alertdialog.html,\n     *       https://www.w3.org/WAI/ARIA/apg/example-index/dialog-modal/dialog.html,\n     *       https://www.w3.org/WAI/ARIA/apg/patterns/dialogmodal/\n     * @param {\"notify\"|\"alert\"} type Dialog type\n     * @param {object} ui standardised ui data\n     * @param {object} [msg] msg.payload/msg.topic - only used if a string. Optional.\n     * @returns {void}\n     */\n    showDialog(type, ui, msg) { // eslint-disable-line sonarjs/cognitive-complexity\n\n        //#region -- Check properties --\n\n        let content = ''\n        // Main body content\n        if (msg.payload && typeof msg.payload === 'string') content += `<div>${msg.payload}</div>`\n        if (ui.content) content += `<div>${ui.content}</div>`\n        // Toast wont show anyway if content is empty, may as well warn user\n        if (content === '') {\n            Ui.log(1, 'Ui:showDialog', 'Toast content is blank. Not shown.')()\n            return\n        }\n\n        // Use msg.topic as title if no title provided\n        if (!ui.title && msg.topic) ui.title = msg.topic\n        if (ui.title) content = `<p class=\"toast-head\">${ui.title}</p><p>${content}</p>`\n\n        // Allow for variants - @since v6.1 - don't bother - since this now sets CSS class, not tied to bootstrap-vue\n        // if ( !ui.variant || !['', 'primary', 'secondary', 'success', 'info', 'warn', 'warning', 'failure', 'error', 'danger'].includes(ui.variant)) ui.variant = ''\n\n        // Toasts auto-hide by default after 10s but alerts do not auto-hide\n        if (ui.noAutohide) ui.noAutoHide = ui.noAutohide\n        if (ui.noAutoHide) ui.autohide = !ui.noAutoHide\n        // If set, number of ms until toast is auto-hidden\n        if (ui.autoHideDelay) {\n            if (!ui.autohide) ui.autohide = true\n            ui.delay = ui.autoHideDelay\n        } else ui.autoHideDelay = 10000 // default = 10s\n        if (!Object.prototype.hasOwnProperty.call(ui, 'autohide')) ui.autohide = true\n\n        if (type === 'alert') {\n            ui.modal = true\n            ui.autohide = false\n            content = `<svg viewBox=\"0 0 192.146 192.146\" style=\"width:30;background-color:transparent;\"><path d=\"M108.186 144.372c0 7.054-4.729 12.32-12.037 12.32h-.254c-7.054 0-11.92-5.266-11.92-12.32 0-7.298 5.012-12.31 12.174-12.31s11.91 4.992 12.037 12.31zM88.44 125.301h15.447l2.951-61.298H85.46l2.98 61.298zm101.932 51.733c-2.237 3.664-6.214 5.921-10.493 5.921H12.282c-4.426 0-8.51-2.384-10.698-6.233a12.34 12.34 0 0 1 .147-12.349l84.111-149.22c2.208-3.722 6.204-5.96 10.522-5.96h.332c4.445.107 8.441 2.618 10.513 6.546l83.515 149.229c1.993 3.8 1.905 8.363-.352 12.066zm-10.493-6.4L96.354 21.454l-84.062 149.18h167.587z\" /></svg> ${content}`\n        }\n\n        //#endregion -- -- --\n\n        // Create a toaster container element if not already created - or get a ref to it\n        let toaster = Ui.doc.getElementById('toaster')\n        if (toaster === null) {\n            toaster = Ui.doc.createElement('div')\n            toaster.id = 'toaster'\n            toaster.title = 'Click to clear all notifcations'\n            toaster.setAttribute('class', 'toaster')\n            toaster.setAttribute('role', 'dialog')\n            toaster.setAttribute('arial-label', 'Toast message')\n            toaster.onclick = function () {\n                // @ts-ignore\n                toaster.remove()\n            }\n            Ui.doc.body.insertAdjacentElement('afterbegin', toaster)\n        }\n\n        // Create a toast element. Would be nice to use <dialog> but that isn't well supported yet - come on Apple!\n        const toast = Ui.doc.createElement('div')\n        toast.title = 'Click to clear this notifcation'\n        toast.setAttribute('class', `toast ${ui.variant ? ui.variant : ''} ${type}`)\n        toast.innerHTML = content\n        toast.setAttribute('role', 'alertdialog')\n        if (ui.modal) toast.setAttribute('aria-modal', ui.modal)\n        toast.onclick = function (evt) {\n            evt.stopPropagation()\n            toast.remove()\n            // @ts-ignore\n            if (toaster.childElementCount < 1) toaster.remove()\n        }\n\n        // TODO\n        if (type === 'alert') {\n            // newD.setAttribute('aria-labelledby', '')\n            // newD.setAttribute('aria-describedby', '')\n        }\n\n        toaster.insertAdjacentElement(ui.appendToast === true ? 'beforeend' : 'afterbegin', toast)\n\n        // Auto-hide\n        if (ui.autohide === true) {\n            setInterval(() => {\n                toast.remove()\n                // @ts-ignore\n                if (toaster.childElementCount < 1) toaster.remove()\n            }, ui.autoHideDelay)\n        }\n    } // --- End of showDialog ---\n\n    /** Directly manage UI via JSON\n     * @param {object} json Either an object containing {_ui: {}} or simply simple {} containing ui instructions\n     */\n    ui(json) {\n        // Simulate a msg and process\n        let msg = {}\n        if (json._ui) msg = json\n        else msg._ui = json\n\n        this._uiManager(msg)\n    }\n\n    /** Get data from the DOM. Returns selection of useful props unless a specific prop requested.\n     * @param {string} cssSelector Identify the DOM element to get data from\n     * @param {string} [propName] Optional. Specific name of property to get from the element\n     * @returns {Array<*>} Array of objects containing either specific requested property or a selection of useful properties\n     */\n    uiGet(cssSelector, propName = null) {\n        // The type cast below not really correct but it gets rid of the other typescript errors\n        const selection = /** @type {NodeListOf<HTMLInputElement>} */ (Ui.doc.querySelectorAll(cssSelector))\n\n        const out = []\n\n        selection.forEach(node => {\n            // Specific property asked for ...\n            if (propName) {\n                if (propName === 'classes') propName = 'class'\n                // Try assuming the prop is an attribute first (will return null or \"\" if not present)\n                let prop = node.getAttribute(propName)\n                // If not an attribute, try getting as a property of the element\n                if (prop === undefined || prop === null) {\n                    try {\n                        prop = node[propName]\n                    } catch (error) {}\n                }\n                // We didn't find as either an attribute or a property\n                if (prop === undefined || prop === null) {\n                    // If 'value' was requested, return the innerText\n                    if (propName.toLowerCase() === 'value') out.push(node.innerText)\n                    else out.push(`Property '${propName}' not found`)\n                } else {\n                    const p = {}\n                    // Nightmare of different object types in a DOM Element!\n                    const cType = prop.constructor.name.toLowerCase()\n                    if (cType === 'namednodemap') {\n                        for (const key of prop) {\n                            // @ts-ignore\n                            p[key.name] = prop[key.name].value\n                        }\n                    } else if (!cType.includes('map')) { // Ordinary properties (not a mapped type)\n                        p[propName] = prop\n                    } else { // Other MAP types\n                        const p = {}\n                        // @ts-ignore\n                        for (const key in prop) {\n                            p[key] = prop[key]\n                        }\n                    }\n                    if (p.class) p.classes = Array.from(node.classList)\n                    out.push(p)\n                }\n            } else { // Otherwise, grab everything useful\n                out.push(this.nodeGet(node, cssSelector))\n            }\n        })\n\n        return out\n    } // --- end of uiGet --- //\n\n    /** External alias for _uiComposeComponent\n     * @param {*} el HTML Element to enhance\n     * @param {*} comp Individual uibuilder ui component spec\n     */\n    uiEnhanceElement(el, comp) {\n        this._uiComposeComponent(el, comp)\n    }\n\n    //#endregion ---- -------- ----\n}\n\nmodule.exports = Ui\n\n// if (window) window['$ui'] = new Ui(window)\n\n// export Ui\n"],
  "mappings": "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",
  "names": ["require_ui", "__commonJSMin", "exports", "module", "_a", "Ui", "win", "extLog", "jsonHighlight", "__publicField", "str", "lang", "high", "plugin", "name", "config", "notify", "resolve", "reject", "ev", "ui", "isRecurse", "compToAdd", "i", "newEl", "elParent", "el", "comp", "attrib", "type", "evt", "err", "prop", "parentEl", "components", "ns", "component", "__toESM", "__require", "script", "sheet", "msg", "all", "compToRemove", "els", "compToReplace", "elToReplace", "compToUpd", "elToUpd", "j", "nc", "nestedComp", "k", "method", "cssSelector", "output", "out", "attr", "e", "classNames", "sourceId", "targetId", "template", "target", "content", "data", "keys", "tbl", "thead", "headerRow", "headers", "header", "th", "tbody", "item", "row", "cell", "mdText", "url", "uiOptions", "response", "error", "contentType", "slot", "txtReturn", "newScript", "textFn", "newStyle", "opts", "sourceSelector", "targetSelector", "moveType", "position", "node", "thisOut", "listEntries", "bodyEntries", "headEntries", "cols", "v", "permit", "tempFrag", "elRange", "html", "toaster", "toast", "json", "propName", "selection", "p", "cType", "key"]
}
