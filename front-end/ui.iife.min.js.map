{
  "version": 3,
  "sources": ["../src/front-end-module/libs/show-overlay.mjs", "../src/front-end-module/ui.mjs"],
  "sourcesContent": ["/**\n * @description Overlay window for displaying messages and notifications.\n * Included in the UI module and from there into the main uibuilder module.\n * @license Apache-2.0\n * @author Julian Knight (Totally Information)\n * @copyright (c) 2025-2025 Julian Knight (Totally Information)\n */\n\n/** Creates and displays an overlay window with customizable content and behavior\n * @param {object} options - Configuration options for the overlay\n *   @param {string} [options.content] - Main content (text or HTML) to display\n *   @param {string} [options.title] - Optional title above the main content\n *   @param {string} [options.icon] - Optional icon to display left of title (HTML or text)\n *   @param {string} [options.type] - Overlay type: 'success', 'info', 'warning', or 'error'\n *   @param {boolean} [options.showDismiss] - Whether to show dismiss button (auto-determined if not set)\n *   @param {number|null} [options.autoClose] - Auto-close delay in seconds (null for no auto-close)\n *   @param {boolean} [options.time] - Show timestamp in overlay (default: true)\n * @returns {object} Object with close() method to manually close the overlay\n */\nexport function showOverlay(options = {}) {\n    const {\n        content = '',\n        title = '',\n        icon = '',\n        type = 'info',\n        showDismiss,\n        autoClose = 5,\n        time = true,\n    } = options\n\n    const overlayContainerId = 'uib-info-overlay'\n\n    // Get or create the main overlay container\n    let overlayContainer = document.getElementById(overlayContainerId)\n    if (!overlayContainer) {\n        overlayContainer = document.createElement('div')\n        overlayContainer.id = overlayContainerId\n        document.body.appendChild(overlayContainer)\n        console.log('>> SHOW OVERLAY >>', options, document.getElementById(overlayContainerId))\n    }\n\n    // Generate unique ID for this overlay entry\n    const entryId = `overlay-entry-${Date.now()}-${Math.random().toString(36)\n        .substr(2, 9)}`\n\n    // Create individual overlay entry\n    const overlayEntry = document.createElement('div')\n    overlayEntry.id = entryId\n    overlayEntry.style.marginBottom = '0.5rem'\n\n    // Define type-specific styles\n    const typeStyles = {\n        info: {\n            iconDefault: '\u2139\uFE0F',\n            titleDefault: 'Information',\n            color: 'hsl(188.2deg 77.78% 40.59%)',\n        },\n        success: {\n            iconDefault: '\u2705',\n            titleDefault: 'Success',\n            color: 'hsl(133.7deg 61.35% 40.59%)',\n        },\n        warning: {\n            iconDefault: '\u26A0\uFE0F',\n            titleDefault: 'Warning',\n            color: 'hsl(35.19deg 84.38% 62.35%)',\n        },\n        error: {\n            iconDefault: '\u274C',\n            titleDefault: 'Error',\n            color: 'hsl(2.74deg 92.59% 62.94%)',\n        },\n    }\n\n    // @ts-ignore\n    const currentTypeStyle = typeStyles[type] || typeStyles.info\n\n    // Determine if dismiss button should be shown\n    const shouldShowDismiss = showDismiss !== undefined ? showDismiss : (autoClose === null)\n\n    // Create content HTML\n    const iconHtml = icon || currentTypeStyle.iconDefault\n    const titleText = title || currentTypeStyle.titleDefault\n\n    // Generate timestamp if time option is enabled\n    let timeHtml = ''\n    if (time) {\n        const now = new Date()\n        const year = now.getFullYear()\n        const month = String(now.getMonth() + 1).padStart(2, '0')\n        const day = String(now.getDate()).padStart(2, '0')\n        const hours = String(now.getHours()).padStart(2, '0')\n        const minutes = String(now.getMinutes()).padStart(2, '0')\n        const seconds = String(now.getSeconds()).padStart(2, '0')\n        const timestamp = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`\n        timeHtml = `<div class=\"uib-overlay-time\" style=\"font-size: 0.8em; color: var(--text3, #999); margin-left: auto; margin-right: ${shouldShowDismiss ? '0.5rem' : '0'};\">${timestamp}</div>`\n    }\n\n    overlayEntry.innerHTML = /* html */ `\n        <div class=\"uib-overlay-entry\" style=\"--callout-color:${currentTypeStyle.color};\">\n            <div class=\"uib-overlay-header\">\n                <div class=\"uib-overlay-icon\">${iconHtml}</div>\n                <div class=\"uib-overlay-title\">${titleText}</div>\n                ${timeHtml}\n                ${shouldShowDismiss\n                    ? `<button class=\"uib-overlay-dismiss\" data-entry-id=\"${entryId}\" title=\"Close\">\u00D7</button>`\n                    : ''}\n            </div>\n            <div class=\"uib-overlay-content\">\n                ${content}\n            </div>\n        </div>\n    `\n\n    // Add to overlay container at the top, sliding existing entries down\n    if (overlayContainer.children.length > 0) {\n        // Insert new entry at the top\n        overlayContainer.insertBefore(overlayEntry, overlayContainer.firstChild)\n    } else {\n        // First entry, just add it normally\n        overlayContainer.appendChild(overlayEntry)\n    }\n\n    // Close function for this specific entry\n    const closeOverlayEntry = () => {\n        const entry = document.getElementById(entryId)\n        if (!entry) return\n\n        entry.style.animation = 'slideOut 0.3s ease-in'\n        setTimeout(() => {\n            if (entry.parentNode) {\n                entry.remove()\n                // Remove the main container if no entries remain\n                // const container = document.getElementById(overlayContainerId)\n                // if (container && container.children.length === 0) {\n                //     container.remove()\n                // }\n            }\n        }, 300)\n    }\n\n    // Add dismiss button event listener\n    const dismissBtn = overlayEntry.querySelector('.uib-overlay-dismiss')\n    if (dismissBtn) {\n        dismissBtn.addEventListener('click', closeOverlayEntry)\n    }\n\n    // Set up auto-close if specified\n    let autoCloseTimer = null\n    if (autoClose !== null && autoClose > 0) {\n        autoCloseTimer = setTimeout(closeOverlayEntry, autoClose * 1000)\n    }\n\n    // Return control object\n    return {\n        close: () => {\n            if (autoCloseTimer) {\n                clearTimeout(autoCloseTimer)\n            }\n            closeOverlayEntry()\n        },\n        id: entryId,\n    }\n}\n\nexport default showOverlay\n", "// @ts-nocheck\n/* Creates HTML UI's based on a standardised data input.\n  Works stand-alone, with uibuilder or with Node.js/jsdom.\n  See: https://totallyinformation.github.io/node-red-contrib-uibuilder/#/client-docs/config-driven-ui\n\n  Author: Julian Knight (Totally Information), March 2023\n\n  License: Apache 2.0\n  Copyright (c) 2022-2025 Julian Knight (Totally Information)\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n  http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n */\n\n// Namespaces - See https://stackoverflow.com/a/52572048/1309986\n// const NAMESPACES = {\n//     svg: 'http://www.w3.org/2000/svg',\n//     html: 'http://www.w3.org/1999/xhtml',\n//     xml: 'http://www.w3.org/XML/1998/namespace',\n//     xlink: 'http://www.w3.org/1999/xlink',\n//     xmlns: 'http://www.w3.org/2000/xmlns/' // sic for the final slash...\n// }\n\nimport { showOverlay } from './libs/show-overlay.mjs'\n\nconst Ui = class Ui {\n    // #region --- Class variables ---\n    version = '7.5.0-src'\n\n    // List of tags and attributes not in sanitise defaults but allowed in uibuilder.\n    sanitiseExtraTags = ['uib-var']\n    sanitiseExtraAttribs = ['variable', 'report', 'undefined']\n\n    /** Reference to DOM window - must be passed in the constructor\n     * Allows for use of this library/class with `jsdom` in Node.JS as well as the browser.\n     * @type {Window}\n     */\n    static win\n\n    /** Reference to the DOM top-level window.document for convenience - set in constructor @type {Document} */\n    static doc\n\n    /** Log function - passed in constructor or will be a dummy function\n     * @type {Function}\n     */\n    static log\n\n    /** Options for Markdown-IT if available (set in constructor) */\n    static mdOpts\n    /** Reference to pre-loaded Markdown-IT library */\n    static md\n    /** Optional Markdown-IT Plugins */\n    ui_md_plugins\n    // #endregion --- class variables ---\n\n    /** Called when `new Ui(...)` is called\n     * @param {globalThis} win Either the browser global window or jsdom dom.window\n     * @param {Function} [extLog] A function that returns a function for logging\n     * @param {Function} [jsonHighlight] A function that returns a highlighted HTML of JSON input\n     */\n    constructor(win, extLog, jsonHighlight) {\n        // window must be passed in as an arg to the constructor\n        // Should either be the global window for a browser or `dom.window` for jsdom in Node.js\n        // @ts-ignore\n        if (win) Ui.win = win\n        else {\n            // Ui.log(0, 'Ui:constructor', 'Current environment does not include `window`, UI functions cannot be used.')()\n            // return\n            throw new Error('Ui:constructor. Current environment does not include `window`, UI functions cannot be used.')\n        }\n\n        // For convenience\n        Ui.doc = Ui.win.document\n\n        // If a suitable function not passed in, create a dummy one\n        if (extLog) Ui.log = extLog\n        else Ui.log = function() { return function() {} } // eslint-disable-line @stylistic/max-statements-per-line\n\n        // If a JSON HTML highlighting function passed then use it, else a dummy fn\n        if (jsonHighlight) this.syntaxHighlight = jsonHighlight\n        else this.syntaxHighlight = function() {}\n\n        // If Markdown-IT pre-loaded, then configure it now\n        if (Ui.win['markdownit']) {\n            Ui.mdOpts = {\n                html: true,\n                xhtmlOut: false,\n                linkify: true,\n                _highlight: true,\n                _strict: false,\n                _view: 'html',\n                langPrefix: 'language-',\n                // NB: the highlightjs (hljs) library must be loaded before markdown-it for this to work\n                highlight: function(str, lang) {\n                    // https://highlightjs.org\n                    if (lang && window['hljs'] && window['hljs'].getLanguage(lang)) {\n                        try {\n                            return `<pre class=\"\">\n                                    <code class=\"hljs border\">${window['hljs'].highlight(str, { language: lang, ignoreIllegals: true, }).value}</code></pre>`\n                        } finally { } // eslint-disable-line no-empty\n                    }\n                    return `<pre class=\"hljs border\"><code>${Ui.md.utils.escapeHtml(str).trim()}</code></pre>`\n                },\n            }\n            Ui.md = Ui.win['markdownit'](Ui.mdOpts)\n        }\n    }\n\n    // #region ---- Internal Methods ----\n\n    _markDownIt() {\n        // If Markdown-IT pre-loaded, then configure it now\n        if (!Ui.win['markdownit']) return\n\n        // If plugins not yet defined, check if uibuilder has set them\n        if (!this.ui_md_plugins && Ui.win['uibuilder'] && Ui.win['uibuilder'].ui_md_plugins) this.ui_md_plugins = Ui.win['uibuilder'].ui_md_plugins\n\n        Ui.mdOpts = {\n            html: true,\n            xhtmlOut: false,\n            linkify: true,\n            _highlight: true,\n            _strict: false,\n            _view: 'html',\n            langPrefix: 'language-',\n            // NB: the highlightjs (hljs) library must be loaded before markdown-it for this to work\n            highlight: function(str, lang) {\n                if (window['hljs']) {\n                    if (lang && window['hljs'].getLanguage(lang)) {\n                        try {\n                            return `<pre><code class=\"hljs border language-${lang}\" data-language=\"${lang}\" title=\"Source language: '${lang}'\">${window['hljs'].highlight(str, { language: lang, ignoreIllegals: true, }).value}</code></pre>`\n                        } finally { } // eslint-disable-line no-empty\n                    } else {\n                        try {\n                            const high = window['hljs'].highlightAuto(str)\n                            return `<pre><code class=\"hljs border language-${high.language}\" data-language=\"${high.language}\" title=\"Source language estimated by HighlightJS: '${high.language}'\">${high.value}</code></pre>`\n                        } finally { } // eslint-disable-line no-empty\n                    }\n                }\n                return `<pre><code class=\"border\">${Ui.md.utils.escapeHtml(str).trim()}</code></pre>`\n            },\n        }\n        Ui.md = Ui.win['markdownit'](Ui.mdOpts)\n        // Ui.md.use(Ui.win.markdownitTaskLists, {enabled: true})\n        if (this.ui_md_plugins) {\n            if (!Array.isArray(this.ui_md_plugins)) {\n                Ui.log('error', 'Ui:_markDownIt:plugins', 'Could not load plugins, ui_md_plugins is not an array')()\n                return\n            }\n            this.ui_md_plugins.forEach( (plugin) => {\n                if (typeof plugin === 'string') {\n                    Ui.md.use(Ui.win[plugin])\n                } else {\n                    const name = Object.keys(plugin)[0]\n                    Ui.md.use(Ui.win[name], plugin[name])\n                }\n            })\n        }\n    }\n\n    /** Show a browser notification if the browser and the user allows it\n     * @param {object} config Notification config data\n     * @returns {Promise} Resolves on close or click event, returns the event.\n     */\n    _showNotification(config) {\n        if ( config.topic && !config.title ) config.title = config.topic\n        if ( !config.title ) config.title = 'uibuilder notification'\n        if ( config.payload && !config.body ) config.body = config.payload\n        if ( !config.body ) config.body = ' No message given.'\n        // Wrap in try/catch since Chrome Android may throw an error\n        try {\n            const notify = new Notification(config.title, config)\n            return new Promise( (resolve, reject) => {\n                // Doesn't ever seem to fire (at least in Chromium)\n                notify.addEventListener('close', (ev) => {\n                    // @ts-ignore\n                    ev.currentTarget.userAction = 'close'\n                    resolve(ev)\n                })\n                notify.addEventListener('click', (ev) => {\n                    // @ts-ignore\n                    ev.currentTarget.userAction = 'click'\n                    resolve(ev)\n                })\n                notify.addEventListener('error', (ev) => {\n                    // @ts-ignore\n                    ev.currentTarget.userAction = 'error'\n                    reject(ev)\n                })\n            })\n        } catch (e) {\n            return Promise.reject(new Error('Browser refused to create a Notification'))\n        }\n    }\n\n    // Vue dynamic inserts Don't really work ...\n    // _uiAddVue(ui, isRecurse) {\n\n    //     // must be Vue\n    //     // must have only 1 root element\n    //     const compToAdd = ui.components[0]\n    //     const newEl = Ui.doc.createElement(compToAdd.type)\n\n    //     if (!compToAdd.slot && ui.payload) compToAdd.slot = ui.payload\n    //     this._uiComposeComponent(newEl, compToAdd)\n\n    //     // If nested components, go again - but don't pass payload to sub-components\n    //     if (compToAdd.components) {\n    //         this._uiExtendEl(newEl, compToAdd.components)\n    //     }\n\n    //     console.log('MAGIC: ', this.magick, newEl, newEl.outerHTML)()\n    //     this.set('magick', newEl.outerHTML)\n\n    //     // if (compToAdd.id) newEl.setAttribute('ref', compToAdd.id)\n    //     // if (elParent.id) newEl.setAttribute('data-parent', elParent.id)\n    // }\n\n    // TODO Add check if ID already exists\n    // TODO Allow single add without using components array\n    /** Handle incoming msg._ui add requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     * @param {boolean} isRecurse Is this a recursive call?\n     */\n    _uiAdd(ui, isRecurse) {\n        Ui.log('trace', 'Ui:_uiManager:add', 'Starting _uiAdd')()\n\n        // Vue dynamic inserts Don't really work ...\n        // if (this.#isVue && !isRecurse) {\n        //     this._uiAddVue(ui, false)\n        //     return\n        // }\n\n        ui.components.forEach((compToAdd, i) => {\n            Ui.log('trace', `Ui:_uiAdd:components-forEach:${i}`, 'Component to add: ', compToAdd)()\n\n            /** @type {*} Create the new component - some kind of HTML element */\n            let newEl\n            switch (compToAdd.type) {\n                // If trying to insert raw html, wrap in a div\n                case 'html': {\n                    compToAdd.ns = 'html'\n                    newEl = Ui.doc.createElement('div')\n                    break\n                }\n\n                // If trying to insert raw svg, need to create in namespace\n                case 'svg': {\n                    compToAdd.ns = 'svg'\n                    newEl = Ui.doc.createElementNS('http://www.w3.org/2000/svg', 'svg')\n                    break\n                }\n\n                default: {\n                    compToAdd.ns = 'dom'\n                    newEl = Ui.doc.createElement(compToAdd.type)\n                    break\n                }\n            }\n\n            if (!compToAdd.slot && ui.payload) compToAdd.slot = ui.payload\n\n            // const parser = new DOMParser()\n            // const newDoc = parser.parseFromString(compToAdd.slot, 'text/html')\n            // console.log(compToAdd, newDoc.body)()\n\n            this._uiComposeComponent(newEl, compToAdd)\n\n            /** @type {HTMLElement} Where to add the new element? */\n            let elParent\n            if (compToAdd.parentEl) {\n                elParent = compToAdd.parentEl\n            } else if (ui.parentEl) {\n                elParent = ui.parentEl\n            } else if (compToAdd.parent) {\n                elParent = Ui.doc.querySelector(compToAdd.parent)\n            } else if (ui.parent) {\n                elParent = Ui.doc.querySelector(ui.parent)\n            }\n            if (!elParent) {\n                Ui.log('info', 'Ui:_uiAdd', 'No parent found, adding to body')()\n                elParent = Ui.doc.querySelector('body')\n            }\n\n            if (compToAdd.position && compToAdd.position === 'first') {\n                // Insert new el before the first child of the parent. Ref: https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore#example_3\n                elParent.insertBefore(newEl, elParent.firstChild)\n            } else if (compToAdd.position && Number.isInteger(Number(compToAdd.position))) {\n                elParent.insertBefore(newEl, elParent.children[compToAdd.position])\n            } else {\n                // Append to the required parent\n                elParent.appendChild(newEl)\n            }\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToAdd.components) {\n                // this._uiAdd({\n                //     method: ui.method,\n                //     parentEl: newEl,\n                //     components: compToAdd.components,\n                // }, true)\n                this._uiExtendEl(newEl, compToAdd.components, compToAdd.ns)\n            }\n        })\n    } // --- end of _uiAdd ---\n\n    /** Enhance an HTML element that is being composed with ui data\n     *  such as ID, attribs, event handlers, custom props, etc.\n     * @param {*} el HTML Element to enhance\n     * @param {*} comp Individual uibuilder ui component spec\n     */\n    _uiComposeComponent(el, comp) {\n        // Add attributes\n        if (comp.attributes) {\n            Object.keys(comp.attributes).forEach((attrib) => {\n                if (attrib === 'class' && Array.isArray(comp.attributes[attrib])) comp.attributes[attrib].join(' ')\n\n                Ui.log('trace', '_uiComposeComponent:attributes-forEach', `Attribute: '${attrib}', value: '${comp.attributes[attrib]}'`)()\n\n                // For values, set the actual value as well since the attrib only changes the DEFAULT value\n                if (attrib === 'value') el.value = comp.attributes[attrib]\n\n                if (attrib.startsWith('xlink:')) el.setAttributeNS('http://www.w3.org/1999/xlink', attrib, comp.attributes[attrib])\n                else el.setAttribute(attrib, comp.attributes[attrib])\n            })\n        }\n\n        // ID if set\n        if (comp.id) el.setAttribute('id', comp.id)\n\n        // If an SVG tag, ensure we have the appropriate namespaces added\n        if (comp.type === 'svg') {\n            el.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns', 'http://www.w3.org/2000/svg')\n            el.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:xlink', 'http://www.w3.org/1999/xlink')\n        }\n\n        // Add event handlers\n        if (comp.events) {\n            Object.keys(comp.events).forEach((type) => {\n                // @ts-ignore  I'm forever getting this wrong!\n                if (type.toLowerCase === 'onclick') type = 'click'\n                // Add the event listener\n                try {\n                    el.addEventListener(type, (evt) => {\n                        // Use new Function to ensure that esbuild works: https://esbuild.github.io/content-types/#direct-eval\n                        (new Function('evt', `${comp.events[type]}(evt)`))(evt)\n                    })\n                    // newEl.setAttribute( 'onClick', `${comp.events[type]}()` )\n                } catch (err) {\n                    Ui.log('error', 'Ui:_uiComposeComponent', `Add event '${type}' for element '${comp.type}': Cannot add event handler. ${err.message}`)()\n                }\n            })\n        }\n\n        // Add custom properties to the dataset\n        if (comp.properties) {\n            Object.keys(comp.properties).forEach((prop) => {\n                // TODO break a.b into sub properties\n                el[prop] = comp.properties[prop]\n                // Auto-dispatch events if changing value or changed since DOM does not do this automatically\n                if (['value', 'checked'].includes(prop)) {\n                    el.dispatchEvent(new Event('input'))\n                    el.dispatchEvent(new Event('change'))\n                }\n            })\n        }\n\n        // #region Add Slot content to innerHTML\n        if (comp.slot) {\n            this.replaceSlot(el, comp.slot)\n        }\n        //#endregion\n\n        // TODO Add multi-slot capability (default slot must always be processed first as innerHTML is replaced)\n\n        // #region Add Slot Markdown content to innerHTML IF marked library is available\n        if (comp.slotMarkdown) {\n            this.replaceSlotMarkdown(el, comp)\n        }\n        //#endregion\n    }\n\n    /** Extend an HTML Element with appended elements using ui components\n     * NOTE: This fn follows a strict hierarchy of added components.\n     * @param {HTMLElement} parentEl The parent HTML Element we want to append to\n     * @param {*} components The ui component(s) we want to add\n     * @param {string} [ns] Optional. The namespace to use.\n     */\n    _uiExtendEl(parentEl, components, ns = '') {\n        components.forEach((compToAdd, i) => {\n            Ui.log('trace', `Ui:_uiExtendEl:components-forEach:${i}`, compToAdd)()\n\n            /** @type {HTMLElement} Create the new component */\n            let newEl\n\n            compToAdd.ns = ns\n\n            if (compToAdd.ns === 'html') {\n                newEl = parentEl\n                // newEl.outerHTML = compToAdd.slot\n                // parentEl.innerHTML = compToAdd.slot\n                this.replaceSlot(parentEl, compToAdd.slot)\n            } else if (compToAdd.ns === 'svg') {\n                newEl = Ui.doc.createElementNS('http://www.w3.org/2000/svg', compToAdd.type)\n                // Updates newEl\n                this._uiComposeComponent(newEl, compToAdd)\n                parentEl.appendChild(newEl)\n            } else {\n                newEl = Ui.doc.createElement(compToAdd.type === 'html' ? 'div' : compToAdd.type)\n                // Updates newEl\n                this._uiComposeComponent(newEl, compToAdd)\n                parentEl.appendChild(newEl)\n            }\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToAdd.components) {\n                this._uiExtendEl(newEl, compToAdd.components, compToAdd.ns)\n            }\n        })\n    }\n\n    // TODO Add more error handling and parameter validation\n    /** Handle incoming _ui load requests\n     * Can load JavaScript modules, JavaScript scripts and CSS.\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     */\n    _uiLoad(ui) {\n        // Self-loading ECMA Modules (e.g. web components)\n        if (ui.components) {\n            if (!Array.isArray(ui.components)) ui.components = [ui.components]\n\n            ui.components.forEach(async (component) => {\n                // NOTE: This happens asynchronously but we don't wait\n                import(component)\n            })\n        }\n        // Remote Scripts\n        if (ui.srcScripts) {\n            if (!Array.isArray(ui.srcScripts)) ui.srcScripts = [ui.srcScripts]\n\n            ui.srcScripts.forEach((script) => {\n                this.loadScriptSrc(script)\n            })\n        }\n        // Scripts passed as text\n        if (ui.txtScripts) {\n            if (!Array.isArray(ui.txtScripts)) ui.txtScripts = [ui.txtScripts]\n\n            this.loadScriptTxt(ui.txtScripts.join('\\n'))\n        }\n        // Remote Stylesheets\n        if (ui.srcStyles) {\n            if (!Array.isArray(ui.srcStyles)) ui.srcStyles = [ui.srcStyles]\n\n            ui.srcStyles.forEach((sheet) => {\n                this.loadStyleSrc(sheet)\n            })\n        }\n        // Styles passed as text\n        if (ui.txtStyles) {\n            if (!Array.isArray(ui.txtStyles)) ui.txtStyles = [ui.txtStyles]\n\n            this.loadStyleTxt(ui.txtStyles.join('\\n'))\n        }\n    } // --- end of _uiLoad ---\n\n    /** Handle incoming _ui messages and loaded UI JSON files\n     * Called from start()\n     * @param {*} msg Standardised msg object containing a _ui property object\n     */\n    _uiManager(msg) {\n        if (!msg._ui) return\n\n        // Make sure that _ui is an array\n        if (!Array.isArray(msg._ui)) msg._ui = [msg._ui]\n\n        msg._ui.forEach((ui, i) => {\n            if (ui.mode && !ui.method) ui.method = ui.mode\n            if (!ui.method) {\n                Ui.log('error', 'Ui:_uiManager', `No method defined for msg._ui[${i}]. Ignoring. `, ui)()\n                return\n            }\n\n            ui.payload = msg.payload\n            ui.topic = msg.topic\n            switch (ui.method) {\n                case 'add': {\n                    this._uiAdd(ui, false)\n                    break\n                }\n\n                case 'remove': {\n                    this._uiRemove(ui, false)\n                    break\n                }\n\n                case 'removeAll': {\n                    this._uiRemove(ui, true)\n                    break\n                }\n\n                case 'replace': {\n                    this._uiReplace(ui)\n                    break\n                }\n\n                case 'update': {\n                    this._uiUpdate(ui)\n                    break\n                }\n\n                case 'load': {\n                    this._uiLoad(ui)\n                    break\n                }\n\n                case 'reload': {\n                    this._uiReload()\n                    break\n                }\n\n                case 'notify': {\n                    this.showDialog('notify', ui, msg)\n                    break\n                }\n\n                case 'alert': {\n                    this.showDialog('alert', ui, msg)\n                    break\n                }\n\n                default: {\n                    Ui.log('error', 'Ui:_uiManager', `Invalid msg._ui[${i}].method (${ui.method}). Ignoring`)()\n                    break\n                }\n            }\n        })\n    } // --- end of _uiManager ---\n\n    /** Handle a reload request */\n    _uiReload() {\n        Ui.log('trace', 'Ui:uiManager:reload', 'reloading')()\n        location.reload()\n    }\n\n    // TODO Add better tests for failures (see comments)\n    /** Handle incoming _ui remove requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     * @param {boolean} all Optional, default=false. If true, will remove ALL found elements, otherwise only the 1st is removed\n     */\n    _uiRemove(ui, all = false) {\n        ui.components.forEach((compToRemove) => {\n            let els\n            if (all !== true) els = [Ui.doc.querySelector(compToRemove)]\n            else els = Ui.doc.querySelectorAll(compToRemove)\n\n            els.forEach((el) => {\n                try {\n                    el.remove()\n                } catch (err) {\n                    // Could not remove. Cannot read properties of null <= no need to report this one\n                    // Could not remove. Failed to execute 'querySelector' on 'Ui.doc': '##testbutton1' is not a valid selector\n                    Ui.log('trace', 'Ui:_uiRemove', `Could not remove. ${err.message}`)()\n                }\n            })\n        })\n    } // --- end of _uiRemove ---\n\n    /** Handle incoming _ui replace requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     */\n    _uiReplace(ui) {\n        Ui.log('trace', 'Ui:_uiReplace', 'Starting')()\n\n        ui.components.forEach((compToReplace, /** @type {number} */ i) => {\n            Ui.log('trace', `Ui:_uiReplace:components-forEach:${i}`, 'Component to replace: ', compToReplace)()\n\n            /** @type {HTMLElement} */\n            let elToReplace\n\n            // Either the id, CSS selector, name or type (element type) must be given in order to identify the element to change. FIRST element matching is updated.\n            if (compToReplace.id) {\n                elToReplace = Ui.doc.getElementById(compToReplace.id) // .querySelector(`#${compToReplace.id}`)\n            } else if (compToReplace.selector || compToReplace.select) {\n                elToReplace = Ui.doc.querySelector(compToReplace.selector)\n            } else if (compToReplace.name) {\n                elToReplace = Ui.doc.querySelector(`[name=\"${compToReplace.name}\"]`)\n            } else if (compToReplace.type) {\n                elToReplace = Ui.doc.querySelector(compToReplace.type)\n            }\n\n            Ui.log('trace', `Ui:_uiReplace:components-forEach:${i}`, 'Element to replace: ', elToReplace)()\n\n            // Nothing was found so ADD the element instead\n            if (elToReplace === undefined || elToReplace === null) {\n                Ui.log('trace', `Ui:_uiReplace:components-forEach:${i}:noReplace`, 'Cannot find the DOM element. Adding instead.', compToReplace)()\n                this._uiAdd({ components: [compToReplace], }, false)\n                return\n            }\n\n            /** @type {*} Create the new component - some kind of HTML element */\n            let newEl\n            switch (compToReplace.type) {\n                // If trying to insert raw html, wrap in a div\n                case 'html': {\n                    compToReplace.ns = 'html'\n                    newEl = Ui.doc.createElement('div')\n                    break\n                }\n\n                // If trying to insert raw svg, need to create in namespace\n                case 'svg': {\n                    compToReplace.ns = 'svg'\n                    newEl = Ui.doc.createElementNS('http://www.w3.org/2000/svg', 'svg')\n                    break\n                }\n\n                default: {\n                    compToReplace.ns = 'dom'\n                    newEl = Ui.doc.createElement(compToReplace.type)\n                    break\n                }\n            }\n\n            // Updates the newEl and maybe the ui\n            this._uiComposeComponent(newEl, compToReplace)\n\n            // Replace the current element\n            elToReplace.replaceWith(newEl)\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToReplace.components) {\n                this._uiExtendEl(newEl, compToReplace.components, compToReplace.ns)\n            }\n        })\n    } // --- end of _uiReplace ---\n\n    // TODO Allow single add without using components array\n    // TODO Allow sub-components\n    // TODO Add multi-slot capability\n    /** Handle incoming _ui update requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     */\n    _uiUpdate(ui) {\n        Ui.log('trace', 'UI:_uiUpdate:update', 'Starting _uiUpdate', ui)()\n\n        // We allow an update not to actually need to spec a component\n        if (!ui.components) ui.components = [Object.assign({}, ui)]\n\n        ui.components.forEach((compToUpd, i) => {\n            Ui.log('trace', '_uiUpdate:components-forEach', `Start loop #${i}`, compToUpd)()\n\n            /** @type {NodeListOf<Element>} */\n            let elToUpd\n\n            // If a parent element is passed, use that as the update target (only allowed internally)\n            // Otherwise either the id, CSS selector, name or type (element type) must be given in order to identify the element to change. ALL elements matching are updated.\n            if (compToUpd.parentEl) {\n                elToUpd = compToUpd.parentEl\n            } else if (compToUpd.id) {\n                // NB We don't use get by id because this way the code is simpler later on\n                elToUpd = Ui.doc.querySelectorAll(`#${compToUpd.id}`)\n            } else if (compToUpd.selector || compToUpd.select) {\n                elToUpd = Ui.doc.querySelectorAll(compToUpd.selector)\n            } else if (compToUpd.name) {\n                elToUpd = Ui.doc.querySelectorAll(`[name=\"${compToUpd.name}\"]`)\n            } else if (compToUpd.type) {\n                elToUpd = Ui.doc.querySelectorAll(compToUpd.type)\n            }\n\n            // @ts-ignore Nothing was found so give up\n            if (elToUpd === undefined || elToUpd.length < 1) {\n                Ui.log('warn', 'Ui:_uiManager:update', 'Cannot find the DOM element. Ignoring.', compToUpd)()\n                return\n            }\n\n            Ui.log('trace', '_uiUpdate:components-forEach', `Element(s) to update. Count: ${elToUpd.length}`, elToUpd)()\n\n            // If slot not specified but payload is, use the payload in the slot\n            if (!compToUpd.slot && compToUpd.payload) compToUpd.slot = compToUpd.payload\n\n            // Might have >1 element to update - so update them all\n            elToUpd.forEach((el, j) => {\n                Ui.log('trace', '_uiUpdate:components-forEach', `Updating element #${j}`, el)()\n                this._uiComposeComponent(el, compToUpd)\n                // Try to go down another level of nesting if needed\n                // ! NOT CONVINCED THIS ACTUALLY WORKS !\n                if (compToUpd.components) {\n                    Ui.log('trace', '_uiUpdate:nested-component', `Element #${j} - nested-component`, compToUpd, el)()\n                    const nc = { _ui: [], }\n                    compToUpd.components.forEach((nestedComp, k) => {\n                        const method = nestedComp.method || compToUpd.method || ui.method\n                        if (nestedComp.method) delete nestedComp.method\n                        if (!Array.isArray(nestedComp)) nestedComp = [nestedComp]\n                        // nestedComp.parentEl = el\n                        // nestedComp.components = [nestedComp]\n                        Ui.log('trace', '_uiUpdate:nested-component', `Element #${j} - nested-component #${k}`, nestedComp)()\n                        nc._ui.push( {\n                            method: method,\n                            parentEl: el,\n                            components: nestedComp,\n                        })\n                    })\n                    Ui.log('trace', '_uiUpdate:nested-component', `Element #${j} - nested-component new manager`, nc)()\n                    this._uiManager(nc)\n                }\n            })\n\n            // If nested components, apply to every found element - but don't pass payload to sub-components\n            // if (compToUpd.components) {\n            //     compToUpd.components.forEach((el, k) => {\n            //         Ui.log('trace', '_uiUpdate:nested-component', `Updating nested-component #${k}`, el)()\n            //         this._uiUpdate({\n            //             method: el.method || ui.method,\n            //             parentEl: el,\n            //             components: el.components,\n            //         })\n            //     })\n            // }\n        })\n    } // --- end of _uiUpdate ---\n\n    // #endregion ---- -------- ----\n\n    // #region ---- External Methods ----\n\n    /** Simplistic jQuery-like document CSS query selector, returns an HTML Element\n     * NOTE that this fn returns the element itself. Use $$ to get the properties of 1 or more elements.\n     * If the selected element is a <template>, returns the first child element.\n     * type {HTMLElement}\n     * @param {string} cssSelector A CSS Selector that identifies the element to return\n     * @param {\"el\"|\"text\"|\"html\"|\"attributes\"|\"attr\"} [output] Optional. What type of output to return. Defaults to \"el\", the DOM element reference\n     * @param {HTMLElement} [context] Optional. The context to search within. Defaults to the document. Must be a DOM element.\n     * @returns {HTMLElement|string|Array|null} Selected HTML DOM element, innerText, innerHTML, attribute list or null\n     */\n    $(cssSelector, output, context) {\n        if (!context) context = Ui.doc\n        if (!output) output = 'el'\n\n        // if context is not a valid htmlelement, return null\n        if (!context || !context.nodeType) {\n            Ui.log(1, 'Uib:$', `Invalid context element. Must be a valid HTML element.`, context)()\n            return null\n        }\n\n        /** @type {HTMLElement} Some kind of HTML element */\n        let el = (context).querySelector(cssSelector)\n\n        // if no element found or is not a valid htmlelement, return null\n        if (!el || !el.nodeType) {\n            Ui.log(1, 'Uib:$', `No element found or element is not an HTML element for CSS selector ${cssSelector}`)()\n            return null\n        }\n\n        if ( el.nodeName === 'TEMPLATE' ) {\n            el = el.content.firstElementChild\n            if (!el) {\n                Ui.log(0, 'Uib:$', `Template selected for CSS selector ${cssSelector} but it is empty`)()\n                return null\n            }\n        }\n\n        let out\n\n        try {\n            switch (output.toLowerCase()) {\n                case 'text': {\n                    out = el.innerText\n                    break\n                }\n\n                case 'html': {\n                    out = el.innerHTML\n                    break\n                }\n\n                case 'attr':\n                case 'attributes': {\n                    out = {}\n                    for (const attr of el.attributes) {\n                        out[attr.name] = attr.value\n                    }\n                    break\n                }\n\n                default: {\n                    out = el\n                    break\n                }\n            }\n        } catch (e) {\n            out = el\n            Ui.log(1, 'Uib:$', `Could not process output type \"${output}\" for CSS selector ${cssSelector}, returned the DOM element. ${e.message}`, e)()\n        }\n\n        return out\n    }\n\n    /** CSS query selector that returns ALL found selections. Matches the Chromium DevTools feature of the same name.\n     * NOTE that this fn returns an array showing the PROPERTIES of the elements whereas $ returns the element itself\n     * @param {string} cssSelector A CSS Selector that identifies the elements to return\n     * @param {HTMLElement} [context] Optional. The context to search within. Defaults to the document. Must be a DOM element.\n     * @returns {HTMLElement[]} Array of DOM elements/nodes. Array is empty if selector is not found.\n     */\n    $$(cssSelector, context) {\n        if (!context) context = Ui.doc\n\n        // if context is not a valid htmlelement, return null\n        if (!context || !context.nodeType) {\n            Ui.log(1, 'Uib:$$', `Invalid context element. Must be a valid HTML element.`, context)()\n            return null\n        }\n\n        return Array.from((context).querySelectorAll(cssSelector))\n    }\n\n    /** Add 1 or several class names to an element\n     * @param {string|string[]} classNames Single or array of classnames\n     * @param {HTMLElement} el HTML Element to add class(es) to\n     */\n    addClass(classNames, el) {\n        if (!Array.isArray(classNames)) classNames = [classNames]\n        if (el) el.classList.add(...classNames)\n    }\n\n    /** Apply a source template tag to a target html element\n     * NOTES:\n     * - Any attributes are only applied to the 1ST ELEMENT of the template content. Use a wrapper div if you need to apply to multiple elements.\n     * - When using 'wrap' mode, the target content is placed into the template's 1ST <slot> only (if present).\n     * - styles in ALL templates are accessible to all templates & impact the whole page.\n     * - scripts in templates are run AT TIME OF APPLICATION (so may run multiple times).\n     * - scripts in templates are applied in order of application, so variables may not yet exist if defined in subsequent templates\n     * @param {string} sourceId The HTML ID of the source element\n     * @param {string} targetId The HTML ID of the target element\n     * @param {object} config Configuration options\n     *   @param {boolean=} config.onceOnly   If true, the source will be adopted (the source is moved)\n     *   @param {object=}  config.attributes A set of key:value pairs that will be applied as attributes to the 1ST ELEMENT ONLY of the target\n     *   @param {'insert'|'replace'|'wrap'}  config.mode How to apply the template. Default is 'insert'. 'replace' will replace the targets innerHTML. 'wrap' is like 'replace' but will put any target content into the template's 1ST <slot> (if present).\n     */\n    applyTemplate(sourceId, targetId, config) {\n        if (!config) config = {}\n        if (!config.onceOnly) config.onceOnly = false\n        if (!config.mode) config.mode = 'insert'\n\n        const template = Ui.doc.getElementById(sourceId)\n        if (!template || template.tagName !== 'TEMPLATE') {\n            Ui.log('error', 'Ui:applyTemplate', `Source must be a <template>. id='${sourceId}'`)()\n            return\n        }\n\n        const target = Ui.doc.getElementById(targetId)\n        if (!target) {\n            Ui.log('error', 'Ui:applyTemplate', `Target not found: id='${targetId}'`)()\n            return\n        }\n\n        const targetContent = target.innerHTML ?? ''\n        if (targetContent && config.mode === 'replace') {\n            Ui.log('warn', 'Ui:applyTemplate', `Target element is not empty, content is replaced. id='${targetId}'`)()\n        }\n\n        let templateContent\n        if (config.onceOnly === true) templateContent = Ui.doc.adoptNode(template.content) // NB content.childElementCount = 0 after adoption\n        else templateContent = Ui.doc.importNode(template.content, true)\n\n        if (templateContent) {\n            // Apply config.attributes to the 1ST ELEMENT ONLY of the template content\n            if (config.attributes) {\n                const el = templateContent.firstElementChild\n                Object.keys(config.attributes).forEach( (attrib) => {\n                    // Apply each attribute and value\n                    el.setAttribute(attrib, config.attributes[attrib])\n                })\n            }\n\n            if (config.mode === 'insert') {\n                target.appendChild(templateContent)\n            } else if (config.mode === 'replace') {\n                target.innerHTML = ''\n                target.appendChild(templateContent)\n            } else if (config.mode === 'wrap') {\n                target.innerHTML = ''\n                target.appendChild(templateContent)\n                if (targetContent) {\n                    const slot = target.getElementsByTagName('slot')\n                    if (slot.length > 0) {\n                        slot[0].innerHTML = targetContent\n                    }\n                }\n            }\n        } else {\n            Ui.log('warn', 'Ui:applyTemplate', `No valid content found in template`)()\n        }\n    }\n\n    /** Converts markdown text input to HTML if the Markdown-IT library is loaded\n     * Otherwise simply returns the text\n     * @param {string} mdText The input markdown string\n     * @returns {string} HTML (if Markdown-IT library loaded and parse successful) or original text\n     */\n    convertMarkdown(mdText) {\n        if (!mdText) return ''\n        if (!Ui.win['markdownit']) return mdText\n        if (!Ui.md) this._markDownIt() // To handle case where the library is late loaded\n        // Convert from markdown to HTML\n        try {\n            return Ui.md.render(mdText.trim())\n        } catch (e) {\n            Ui.log(0, 'uibuilder:convertMarkdown', `Could not render Markdown. ${e.message}`, e)()\n            return '<p class=\"border error\">Could not render Markdown<p>'\n        }\n    }\n\n    /** Include HTML fragment, img, video, text, json, form data, pdf or anything else from an external file or API\n     * Wraps the included object in a div tag.\n     * PDF's, text or unknown MIME types are also wrapped in an iFrame.\n     * @param {string} url The URL of the source file to include\n     * @param {object} uiOptions Object containing properties recognised by the _uiReplace function. Must at least contain an id\n     * param {string} uiOptions.id The HTML ID given to the wrapping DIV tag\n     * param {string} uiOptions.parentSelector The CSS selector for a parent element to insert the new HTML under (defaults to 'body')\n     * @returns {Promise<any>} Status\n     */\n    async include(url, uiOptions) {\n        // TODO: src, id, parent must all be a strings\n        if (!fetch) {\n            Ui.log(0, 'Ui:include', 'Current environment does not include `fetch`, skipping.')()\n            return 'Current environment does not include `fetch`, skipping.'\n        }\n        if (!url) {\n            Ui.log(0, 'Ui:include', 'url parameter must be provided, skipping.')()\n            return 'url parameter must be provided, skipping.'\n        }\n        if (!uiOptions || !uiOptions.id) {\n            Ui.log(0, 'Ui:include', 'uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.')()\n            return 'uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.'\n        }\n\n        // Try to get the content via the URL\n        let response\n        try {\n            response = await fetch(url)\n        } catch (error) {\n            Ui.log(0, 'Ui:include', `Fetch of file '${url}' failed. `, error.message)()\n            return error.message\n        }\n        if (!response.ok) {\n            Ui.log(0, 'Ui:include', `Fetch of file '${url}' failed. Status='${response.statusText}'`)()\n            return response.statusText\n        }\n\n        // Work out what type of data we got\n        const contentType = await response.headers.get('content-type')\n        let type = null\n        if (contentType) {\n            if (contentType.includes('text/html')) {\n                type = 'html'\n            } else if (contentType.includes('application/json')) {\n                type = 'json'\n            } else if (contentType.includes('multipart/form-data')) {\n                type = 'form'\n            } else if (contentType.includes('image/')) {\n                type = 'image'\n            } else if (contentType.includes('video/')) {\n                type = 'video'\n            } else if (contentType.includes('application/pdf')) {\n                type = 'pdf'\n            } else if (contentType.includes('text/plain')) {\n                type = 'text'\n            } // else type = null\n        }\n\n        // Create the HTML to include on the page based on type\n        let slot = ''\n        let txtReturn = 'Include successful'\n        let data\n        switch (type) {\n            case 'html': {\n                data = await response.text()\n                slot = data\n                break\n            }\n\n            case 'json': {\n                data = await response.json()\n                slot = '<pre class=\"syntax-highlight\">'\n                slot += this.syntaxHighlight(data)\n                slot += '</pre>'\n                break\n            }\n\n            case 'form': {\n                data = await response.formData()\n                slot = '<pre class=\"syntax-highlight\">'\n                slot += this.syntaxHighlight(data)\n                slot += '</pre>'\n                break\n            }\n\n            case 'image': {\n                data = await response.blob()\n                slot = `<img src=\"${URL.createObjectURL(data)}\">`\n                if (Ui.win['DOMPurify']) {\n                    txtReturn = 'Include successful. BUT DOMPurify loaded which may block its use.'\n                    Ui.log('warn', 'Ui:include:image', txtReturn)()\n                }\n                break\n            }\n\n            case 'video': {\n                data = await response.blob()\n                slot = `<video controls autoplay><source src=\"${URL.createObjectURL(data)}\"></video>`\n                if (Ui.win['DOMPurify']) {\n                    txtReturn = 'Include successful. BUT DOMPurify loaded which may block its use.'\n                    Ui.log('warn', 'Ui:include:video', txtReturn)()\n                }\n                break\n            }\n\n            case 'pdf':\n            case 'text':\n            default: {\n                data = await response.blob()\n                slot = `<iframe style=\"resize:both;width:inherit;height:inherit;\" src=\"${URL.createObjectURL(data)}\">`\n                if (Ui.win['DOMPurify']) {\n                    txtReturn = 'Include successful. BUT DOMPurify loaded which may block its use.'\n                    Ui.log('warn', `Ui:include:${type}`, txtReturn)()\n                }\n                break\n            }\n        }\n\n        // Wrap it all in a <div id=\"...\" class=\"included\">\n        uiOptions.type = 'div'\n        uiOptions.slot = slot\n        if (!uiOptions.parent) uiOptions.parent = 'body'\n        if (!uiOptions.attributes) uiOptions.attributes = { class: 'included', }\n\n        // Use uibuilder's standard ui processing to turn the instructions into HTML\n        this._uiReplace({\n            components: [\n                uiOptions\n            ],\n        })\n\n        Ui.log('trace', `Ui:include:${type}`, txtReturn)()\n        return txtReturn\n    } // ---- End of include() ---- //\n\n    /** Attach a new remote script to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} url The url to be used in the script src attribute\n     */\n    loadScriptSrc(url) {\n        const newScript = Ui.doc.createElement('script')\n        newScript.src = url\n        newScript.async = false\n        Ui.doc.head.appendChild(newScript)\n    }\n\n    /** Attach a new text script to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} textFn The text to be loaded as a script\n     */\n    loadScriptTxt(textFn) {\n        const newScript = Ui.doc.createElement('script')\n        newScript.async = false\n        newScript.textContent = textFn\n        Ui.doc.head.appendChild(newScript)\n    }\n\n    /** Attach a new remote stylesheet link to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} url The url to be used in the style link href attribute\n     */\n    loadStyleSrc(url) {\n        const newStyle = Ui.doc.createElement('link')\n        newStyle.href = url\n        newStyle.rel = 'stylesheet'\n        newStyle.type = 'text/css'\n\n        Ui.doc.head.appendChild(newStyle)\n    }\n\n    /** Attach a new text stylesheet to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} textFn The text to be loaded as a stylesheet\n     */\n    loadStyleTxt(textFn) {\n        const newStyle = Ui.doc.createElement('style')\n        newStyle.textContent = textFn\n        Ui.doc.head.appendChild(newStyle)\n    }\n\n    /** Load a dynamic UI from a JSON web reponse\n     * @param {string} url URL that will return the ui JSON\n     */\n    loadui(url) {\n        if (!fetch) {\n            Ui.log(0, 'Ui:loadui', 'Current environment does not include `fetch`, skipping.')()\n            return\n        }\n        if (!url) {\n            Ui.log(0, 'Ui:loadui', 'url parameter must be provided, skipping.')()\n            return\n        }\n\n        fetch(url)\n            .then((response) => {\n                if (response.ok === false) {\n                    // Ui.log('warn', 'Ui:loadui:then1', `Could not load '${url}'. Status ${response.status}, Error: ${response.statusText}`)()\n                    throw new Error(`Could not load '${url}'. Status ${response.status}, Error: ${response.statusText}`)\n                }\n\n                Ui.log('trace', 'Ui:loadui:then1', `Loaded '${url}'. Status ${response.status}, ${response.statusText}`)()\n                // Did we get json?\n                const contentType = response.headers.get('content-type')\n                if (!contentType || !contentType.includes('application/json')) {\n                    throw new TypeError(`Fetch '${url}' did not return JSON, ignoring`)\n                }\n                // Returns parsed json to next .then\n                return response.json()\n            })\n            .then((data) => {\n                if (data !== undefined) {\n                    Ui.log('trace', 'Ui:loadui:then2', 'Parsed JSON successfully obtained')()\n                    // Call the _uiManager\n                    this._uiManager({ _ui: data, })\n                    return true\n                }\n                return false\n            })\n            .catch((err) => {\n                Ui.log('warn', 'Ui:loadui:catch', 'Error. ', err)()\n            })\n    } // --- end of loadui\n\n    /** ! NOT COMPLETE Move an element from one position to another\n     * @param {object} opts Options\n     * @param {string} opts.sourceSelector Required, CSS Selector that identifies the element to be moved\n     * @param {string} opts.targetSelector Required, CSS Selector that identifies the element to be moved\n     */\n    moveElement(opts) {\n        const { sourceSelector, targetSelector, moveType, position, } = opts\n        const sourceEl = document.querySelector(sourceSelector)\n        if (!sourceEl) {\n            Ui.log(0, 'Ui:moveElement', 'Source element not found')()\n            return\n        }\n        const targetEl = document.querySelector(targetSelector)\n        if (!targetEl) {\n            Ui.log(0, 'Ui:moveElement', 'Target element not found')()\n            return\n        }\n    }\n\n    /** Get standard data from a DOM node.\n     * @param {*} node DOM node to examine\n     * @param {string} cssSelector Identify the DOM element to get data from\n     * @returns {object} Standardised data object\n     */\n    nodeGet(node, cssSelector) {\n        const thisOut = {\n            id: node.id === '' ? undefined : node.id,\n            name: node.name,\n            children: node.childNodes.length,\n            type: node.nodeName,\n            attributes: undefined,\n\n            isUserInput: node.validity ? true : false,\n            userInput: !node.validity\n                ? undefined\n                : {\n                    value: node.value,\n                    validity: undefined,\n                    willValidate: node.willValidate,\n                    valueAsDate: node.valueAsDate,\n                    valueAsNumber: node.valueAsNumber,\n                    type: node.type,\n                },\n        }\n\n        if (['UL', 'OL'].includes(node.nodeName)) {\n            const listEntries = Ui.doc.querySelectorAll(`${cssSelector} li`)\n            if (listEntries) {\n                thisOut.list = {\n                    entries: listEntries.length,\n                }\n            }\n        }\n        if (node.nodeName === 'DL') {\n            const listEntries = Ui.doc.querySelectorAll(`${cssSelector} dt`)\n            if (listEntries) {\n                thisOut.list = {\n                    entries: listEntries.length,\n                }\n            }\n        }\n        if (node.nodeName === 'TABLE') {\n            const bodyEntries = Ui.doc.querySelectorAll(`${cssSelector} > tbody > tr`)\n            const headEntries = Ui.doc.querySelectorAll(`${cssSelector} > thead > tr`)\n            const cols = Ui.doc.querySelectorAll(`${cssSelector} > tbody > tr:last-child > *`) // #eltest > table > tbody > tr:nth-child(3)\n            if (bodyEntries || headEntries || cols) {\n                thisOut.table = {\n                    headRows: headEntries ? headEntries.length : 0,\n                    bodyRows: bodyEntries ? bodyEntries.length : 0,\n                    columns: cols ? cols.length : 0,\n                }\n            }\n        }\n        if (node.nodeName !== '#text' && node.attributes && node.attributes.length > 0) {\n            thisOut.attributes = {}\n            // @ts-ignore\n            for (const attrib of node.attributes) {\n                if (attrib.name !== 'id') {\n                    thisOut.attributes[attrib.name] = node.attributes[attrib.name].value\n                }\n                if (attrib.name === 'class') thisOut.classes = Array.from(node.classList)\n            }\n        }\n        if (node.nodeName === '#text') {\n            thisOut.text = node.textContent\n        }\n        if (node.validity) thisOut.userInput.validity = {}\n        for (const v in node.validity) {\n            thisOut.userInput.validity[v] = node.validity[v]\n        }\n\n        return thisOut\n    } // --- end of nodeGet --- //\n\n    /** Show a browser notification if possible. Returns a promise\n     * Config can be a simple string, a Node-RED msg (topic as title, payload as body)\n     * or a Notifications API options object + config.title string.\n     * Config ref: https://developer.mozilla.org/en-US/docs/Web/API/Notification/Notification\n     * @param {object|string} config Notification config object or simple message string\n     * @returns {Promise} Resolves on close or click event, returns the event.\n     */\n    async notification(config) {\n        if (typeof config === 'string') {\n            config = { body: config, }\n        }\n        // Are notifications available?\n        if (typeof Notification === 'undefined') return Promise.reject(new Error('Notifications not available in this browser'))\n        // Do we have permission? If not, ask for permission\n        let permit = Notification.permission\n        if (permit === 'denied') {\n            return Promise.reject(new Error('Notifications not permitted by user'))\n        } else if (permit === 'granted') {\n            return this._showNotification(config)\n        }\n        // if (permit === 'default') {\n        permit = await Notification.requestPermission()\n        if (permit === 'granted') {\n            return this._showNotification(config)\n        }\n        return Promise.reject(new Error('Notifications not permitted by user'))\n    }\n\n    /** Remove All, 1 or more class names from an element\n     * @param {undefined|null|\"\"|string|string[]} classNames Single or array of classnames. If undefined, \"\" or null, remove all classes\n     * @param {HTMLElement} el HTML Element to add class(es) to\n     */\n    removeClass(classNames, el) {\n        if (!classNames) {\n            el.removeAttribute('class')\n            return\n        }\n        if (!Array.isArray(classNames)) classNames = [classNames]\n        if (el) el.classList.remove(...classNames)\n    }\n\n    /** Replace or add an HTML element's slot from text or an HTML string\n     * WARNING: Executes <script> tags! And will process <style> tags.\n     * Will use DOMPurify if that library has been loaded to window.\n     * param {*} ui Single entry from the msg._ui property\n     * @param {Element} el Reference to the element that we want to update\n     * @param {*} slot The slot content we are trying to add/replace (defaults to empty string)\n     */\n    replaceSlot(el, slot) {\n        if (!el) return\n        if (!slot) slot = ''\n\n        // If DOMPurify is loaded, apply it now\n        slot = this.sanitiseHTML(slot)\n\n        // Override for where the el is a template, the normal handler does now work correctly\n        if (el.nodeName === 'TEMPLATE') {\n            el.innerHTML = slot\n            return\n        }\n\n        // Only use innerHTML for templates as the following does not work for them\n        // For everything else use a DocumentFragment for both security and performance.\n        //   It also preserves DOM state and does not destroy event handlers.\n\n        // Create doc frag and apply html string (msg.payload or the slot property)\n        const tempFrag = Ui.doc.createRange().createContextualFragment(slot)\n\n        // Remove content of el and replace with tempFrag\n        const elRange = Ui.doc.createRange()\n        elRange.selectNodeContents(el)\n        elRange.deleteContents()\n        el.append(tempFrag)\n    }\n\n    /** Replace or add an HTML element's slot from a Markdown string\n     * Only does something if the markdownit library has been loaded to window.\n     * Will use DOMPurify if that library has been loaded to window.\n     * @param {Element} el Reference to the element that we want to update\n     * @param {*} component The component we are trying to add/replace\n     */\n    replaceSlotMarkdown(el, component) {\n        if (!el) return\n        if (!component.slotMarkdown) return\n\n        // Convert from markdown to HTML\n        component.slotMarkdown = this.convertMarkdown(component.slotMarkdown)\n        // If DOMPurify is loaded, apply it now\n        component.slotMarkdown = this.sanitiseHTML(component.slotMarkdown)\n        // Set the component content to the the converted slotMarkdown property\n        el.innerHTML = component.slotMarkdown\n    }\n\n    /** Sanitise HTML to make it safe - if the DOMPurify library is loaded\n     * Otherwise just returns that HTML as-is.\n     * @param {string} html The input HTML string\n     * @returns {string} The sanitised HTML or the original if DOMPurify not loaded\n     */\n    sanitiseHTML(html) {\n        if (!Ui.win['DOMPurify']) return html\n        return Ui.win['DOMPurify'].sanitize(html, { ADD_TAGS: this.sanitiseExtraTags, ADD_ATTR: this.sanitiseExtraAttribs, })\n    }\n\n    // TODO - Allow notify to sit in corners rather than take over the screen\n    /** Show a pop-over \"toast\" dialog or a modal alert\n     * Refs: https://www.w3.org/WAI/ARIA/apg/example-index/dialog-modal/alertdialog.html,\n     *       https://www.w3.org/WAI/ARIA/apg/example-index/dialog-modal/dialog.html,\n     *       https://www.w3.org/WAI/ARIA/apg/patterns/dialogmodal/\n     * @param {\"notify\"|\"alert\"|null} type Dialog type. If null, invalid or not provided, defaults to \"notify\".\n     * @param {object|null} ui Standardised ui data. If not provided, defaults to {noAutohide:true,modal:true,appendToast:false}\n     * @param {object} [msg] msg.payload/msg.topic - only used if payload is a string. Optional.\n     * @returns {HTMLDivElement|null} The toast element (which may disappear after a timeout) or null if no content\n     * @example\n     * Ui.showDialog('notify', { title: 'Hello', content: 'This is a notification', noAutohide: true, appendToast: true })\n     * @example\n     * Ui.showDialog('alert', null, msg)\n     */\n    showDialog(type, ui, msg) {\n        // #region -- Check properties --\n\n        if (!type || !['notify', 'alert'].includes(type)) {\n            type = 'notify' // Default to notify\n        }\n\n        if (!ui) {\n            ui = {\n                noAutohide: true,\n                modal: true,\n                appendToast: false,\n            }\n        }\n\n        let body = ''\n        // Main body content\n        if (msg.payload && typeof msg.payload === 'string') body += `<div>${msg.payload}</div>`\n        if (ui.content) body += `<div>${ui.content}</div>`\n        // Toast wont show anyway if content is empty, may as well warn user\n        if (body === '') {\n            Ui.log(1, 'Ui:showDialog', 'Toast content is blank. Not shown.')()\n            return null\n        }\n\n        // Use msg.topic as alert title if no title provided\n        let title = ''\n        if (ui.title) title = ui.title\n        else if (msg.topic) title = msg.topic\n        // if (ui.title) content = `<div class=\"toast-head\">${ui.title}</div><div class=\"toast-body\">${content}</div>`\n\n        // Allow for variants - @since v6.1 - don't bother - since this now sets CSS class, not tied to bootstrap-vue\n\n        // Toasts auto-hide by default after 10s but alerts do not auto-hide\n        if (ui.noAutohide) ui.noAutoHide = ui.noAutohide\n        if (ui.noAutoHide) ui.autohide = !ui.noAutoHide\n        // If set, number of ms until toast is auto-hidden\n        if (ui.autoHideDelay) {\n            if (!ui.autohide) ui.autohide = true\n            ui.delay = ui.autoHideDelay\n        } else ui.autoHideDelay = 10000 // default = 10s\n        if (!Object.prototype.hasOwnProperty.call(ui, 'autohide')) ui.autohide = true\n\n        let content = ''\n        let icon = ''\n        if (type === 'alert') {\n            icon = '<svg viewBox=\"0 0 192.146 192.146\"><path d=\"M108.186 144.372c0 7.054-4.729 12.32-12.037 12.32h-.254c-7.054 0-11.92-5.266-11.92-12.32 0-7.298 5.012-12.31 12.174-12.31s11.91 4.992 12.037 12.31zM88.44 125.301h15.447l2.951-61.298H85.46l2.98 61.298zm101.932 51.733c-2.237 3.664-6.214 5.921-10.493 5.921H12.282c-4.426 0-8.51-2.384-10.698-6.233a12.34 12.34 0 0 1 .147-12.349l84.111-149.22c2.208-3.722 6.204-5.96 10.522-5.96h.332c4.445.107 8.441 2.618 10.513 6.546l83.515 149.229c1.993 3.8 1.905 8.363-.352 12.066zm-10.493-6.4L96.354 21.454l-84.062 149.18h167.587z\" /></svg>'\n            ui.modal = true\n            ui.autohide = false\n        }\n        content = `<div class=\"toast-head\">${icon}${title}</div><div class=\"toast-body\">${body}</div>`\n\n        // #endregion -- -- --\n\n        const removeToaster = () => {\n            if (!toaster) return\n            Ui.doc.body.removeEventListener('keyup', toasterEventHandler)\n            toaster.removeEventListener('keyup', toasterEventHandler)\n            toaster.removeEventListener('touchend', toasterEventHandler)\n            toaster.removeEventListener('click', toasterEventHandler)\n            toaster.remove()\n        }\n\n        const removeToast = (localToast) => {\n            localToast.removeEventListener('keyup', toasterEventHandler)\n            localToast.removeEventListener('touchend', toasterEventHandler)\n            localToast.removeEventListener('click', toasterEventHandler)\n            localToast.remove()\n            // If no more toasts in the toaster, remove the toaster itself\n            if (toaster && toaster.childElementCount === 0) removeToaster()\n        }\n\n        // Prevent toaster events from affecting toast & remote itself\n        const toasterEventHandler = (evt) => {\n            evt.stopPropagation()\n            if (!toaster) return\n            console.log(\n                'toasterEventHandler',\n                evt,\n                toaster.contains(evt.target),\n                newToast.contains(evt.target),\n                newToast === evt.target\n            )\n            // removeToast(evt)\n            removeToaster()\n        }\n\n        const toastEventHandler = (evt) => {\n            evt.stopPropagation()\n\n            // Create a reference to the event target or the targets parent that has a class of 'toast'\n            let localToast\n            if (evt.target.classList.contains('toast')) {\n                localToast = evt.target\n            } else {\n                localToast = evt.target.closest('.toast')\n            }\n            if (!localToast) {\n                Ui.log(1, 'Ui:showDialog', 'Event target is not a (or in a) toast element, ignoring event')()\n                return\n            }\n\n            // Does the toast contain an input, textarea or button element?\n            const hasInteractiveElement = !!localToast.querySelector('input, textarea, button')\n\n            console.log(\n                'toastEventHandler',\n                hasInteractiveElement,\n                evt,\n                localToast.contains(evt.target),\n                localToast === evt.target\n            )\n\n            if (hasInteractiveElement) {\n                // Only respond to Escape key\n                if (evt.key !== 'Escape') return\n                // If hasInteractiveElement is true, then only close on Escape key\n                removeToast(localToast)\n            }\n\n            removeToast(localToast)\n        }\n\n        // Create a toast element (the actual dialog box). Would be nice to use <dialog> but that isn't well supported yet - come on Apple!\n        const newToast = Ui.doc.createElement('div')\n        newToast.title = 'Click or Esc to clear this notifcation'\n        newToast.setAttribute('class', `toast ${type}`)\n        newToast.setAttribute('role', type === 'alert' ? 'alertdialog' : 'dialog')\n        newToast.dataset.modal = ui.modal\n        newToast.dataset.autohide = ui.autohide\n        newToast.dataset.autoHideDelay = ui.autoHideDelay\n        // newToast.dataset.appendToast = ui.appendToast\n        newToast.innerHTML = content\n\n        // toaster.insertAdjacentElement(ui.appendToast === true ? 'beforeend' : 'afterbegin', newToast)\n        if (ui.appendToast === true) {\n            // Insert newToast after the last toast in Ui.doc.body\n            const lastToast = Array.from(Ui.doc.body.querySelectorAll('.toast')).pop()\n            if (lastToast) {\n                lastToast.insertAdjacentElement('afterend', newToast)\n            } else {\n                Ui.doc.body.insertBefore(newToast, Ui.doc.body.firstChild)\n            }\n        } else {\n            // Ui.doc.body.insertAdjacentElement('afterbegin', toaster)\n            Ui.doc.body.insertBefore(newToast, Ui.doc.body.firstChild)\n        }\n\n        // Add event handlers to each toast that still allow esc to close but only close on click if they do not contain an input, textarea or button element\n        newToast.addEventListener('keyup', toastEventHandler)\n        newToast.addEventListener('click', toastEventHandler)\n        newToast.addEventListener('touchend', toastEventHandler)\n\n        // Auto-hide each toast after a delay\n        if (ui.autohide === true) {\n            setInterval(() => {\n                // removeToaster()\n                removeToast(newToast)\n            }, ui.autoHideDelay)\n        }\n\n        // Only needed if using modal\n        let toaster\n        if (ui.modal === true) {\n            // Create a toaster container element if not already created - or get a ref to it\n            toaster = Ui.doc.getElementById('toaster')\n            if (toaster === null) {\n                toaster = Ui.doc.createElement('div')\n                toaster.id = 'toaster'\n                toaster.title = 'Click, touch, or ESC to clear notifcations'\n                toaster.setAttribute('class', 'toaster')\n                toaster.setAttribute('arial-label', 'Toast message')\n\n                toaster.addEventListener('click', toasterEventHandler)\n                toaster.addEventListener('touchend', toasterEventHandler)\n                // default active element is the body, attach the keyup event handler to the body to catch Escape key\n                Ui.doc.body.addEventListener('keyup', toasterEventHandler)\n\n                Ui.doc.body.insertAdjacentElement('afterbegin', toaster)\n            }\n        }\n\n        // Retursn a reference to the new toast element\n        return newToast\n    }\n\n    /** Creates and displays an overlay window with customizable content and behavior\n     * @param {object} options - Configuration options for the overlay\n     *   @param {string} [options.content] - Main content (text or HTML) to display\n     *   @param {string} [options.title] - Optional title above the main content\n     *   @param {string} [options.icon] - Optional icon to display left of title (HTML or text)\n     *   @param {string} [options.type] - Overlay type: 'success', 'info', 'warning', or 'error'\n     *   @param {boolean} [options.showDismiss] - Whether to show dismiss button (auto-determined if not set)\n     *   @param {number|null} [options.autoClose] - Auto-close delay in seconds (null for no auto-close)\n     *   @param {boolean} [options.time] - Show timestamp in overlay (default: true)\n     * @returns {object} Object with close() method to manually close the overlay\n     */\n    showOverlay(options) {\n        return showOverlay(options)\n    }\n\n    /** Directly manage UI via JSON\n     * @param {object} json Either an object containing {_ui: {}} or simply simple {} containing ui instructions\n     */\n    ui(json) {\n        // Simulate a msg and process\n        let msg = {}\n        if (json._ui) msg = json\n        else msg._ui = json\n\n        this._uiManager(msg)\n    }\n\n    /** Get data from the DOM. Returns selection of useful props unless a specific prop requested.\n     * @param {string} cssSelector Identify the DOM element to get data from\n     * @param {string} [propName] Optional. Specific name of property to get from the element\n     * @returns {Array<*>} Array of objects containing either specific requested property or a selection of useful properties\n     */\n    uiGet(cssSelector, propName = null) {\n        // The type cast below not really correct but it gets rid of the other typescript errors\n        const selection = /** @type {NodeListOf<HTMLInputElement>} */ (Ui.doc.querySelectorAll(cssSelector))\n\n        const out = []\n\n        selection.forEach((node) => {\n            // Specific property asked for ...\n            if (propName) {\n                if (propName === 'classes') propName = 'class'\n                // Try assuming the prop is an attribute first (will return null or \"\" if not present)\n                let prop = node.getAttribute(propName)\n                // If not an attribute, try getting as a property of the element\n                if (prop === undefined || prop === null) {\n                    try {\n                        prop = node[propName]\n                    } catch (error) {}\n                }\n                // We didn't find as either an attribute or a property\n                if (prop === undefined || prop === null) {\n                    // If 'value' was requested, return the innerText\n                    if (propName.toLowerCase() === 'value') out.push(node.innerText)\n                    else out.push(`Property '${propName}' not found`)\n                } else {\n                    const p = {}\n                    // Nightmare of different object types in a DOM Element!\n                    const cType = prop.constructor.name.toLowerCase()\n                    if (cType === 'namednodemap') {\n                        for (const key of prop) {\n                            // @ts-ignore\n                            p[key.name] = prop[key.name].value\n                        }\n                    } else if (!cType.includes('map')) { // Ordinary properties (not a mapped type)\n                        p[propName] = prop\n                    } else { // Other MAP types\n                        const p = {}\n                        // @ts-ignore\n                        for (const key in prop) {\n                            p[key] = prop[key]\n                        }\n                    }\n                    if (p.class) p.classes = Array.from(node.classList)\n                    out.push(p)\n                }\n            } else { // Otherwise, grab everything useful\n                out.push(this.nodeGet(node, cssSelector))\n            }\n        })\n\n        return out\n    }\n\n    /** External alias for _uiComposeComponent\n     * @param {*} el HTML Element to enhance\n     * @param {*} comp Individual uibuilder ui component spec\n     */\n    uiEnhanceElement(el, comp) {\n        this._uiComposeComponent(el, comp)\n    }\n\n    // #region --- table handling ---\n\n    /** Column metadata object definition\n     * @typedef columnDefinition\n     * @property {number} index The column index number\n     * @property {boolean} hasName Whether the column has a defined name or not\n     * @property {string} title The title of the column. Shown in the table header row\n     * @property {string=} name Optional. A defined column name that will be added as the `data-col-name` to all cells in the column if defined\n     * @property {string|number=} key Optional. A key value (currently unused)\n     * @property {\"string\"|\"date\"|\"number\"|\"html\"=} dataType FOR FUTURE USE. Optional. What type of data will this column contain?\n     * @property {boolean=} editable FOR FUTURE USE. Optional. Can cells in this column be edited?\n     */\n\n    /** Directly add a table to a parent element.\n     * @param {Array<object>|Array<Array>|object} data  Input data array or object. Object of objects gives named rows. Array of objects named cols. Array of arrays no naming.\n     * @param {object} [opts] Build options\n     *   @param {Array<columnDefinition>=} opts.cols Column metadata. If not provided will be derived from 1st row of data\n     *   @param {HTMLElement|string} opts.parent Default=body. The table will be added as a child. May be an actual HTML element or a CSS Selector\n     *   @param {boolean=} opts.allowHTML Optional, default=false. If true, allows HTML cell content, otherwise only allows text. Always sanitise HTML inputs\n     */\n    createTable(data = [], opts = { parent: 'body', }) {\n        if (!opts.parent) throw new Error('[ui.js:createTable] opts.parent must be provided')\n        this.buildHtmlTable(data, opts)\n    }\n\n    // TODO ...\n    /** Builds & returns an HTML table element from an array (or object) of objects\n     * 1st row is used for columns unless you pass opts.cols to describe them.\n     * If an object of objects, inner keys are used to populate th/td `data-col-name` attribs. Outer keys applied as row ID's.\n     *\n     * TODO\n     * - Allow optional caption, heading, footers, optional collapse\n     * - Multiple headings, footers\n     * - colspans, rowspans\n     * - multiple tbody\n     *\n     * @param {Array<object>|Array<Array>|object} data Input data array or object. Object of objects gives named rows. Array of objects named cols. Array of arrays no naming.\n     * @param {object} opts Table options\n     *   @param {Array<columnDefinition>=} opts.cols Column metadata. If not provided will be derived from 1st row of data\n     *   @param {HTMLElement|string=} opts.parent If provided, the table will be added as a child instead of returned. May be an actual HTML element or a CSS Selector\n     *   @param {boolean=} opts.allowHTML Optional, default=false. If true, allows HTML cell content, otherwise only allows text. Always sanitise HTML inputs\n     * @returns {HTMLTableElement|HTMLParagraphElement} Output HTML Element\n     */\n    buildHtmlTable(data, opts = {}) {\n        // If data is an object of objects, convert it to an array of objects\n        let rowKeys\n        const dataType = Object.prototype.toString.apply(data)\n        if (dataType === '[object Array]' || dataType === '[object Object]') {\n            rowKeys = Object.keys(data)\n            data = Object.values(data)\n        } else {\n            const out = Ui.doc.createElement('p')\n            out.textContent = 'Input data is not an array or an object, cannot create a table.'\n            return out\n        }\n\n        if (rowKeys.length > 1000) Ui.log(1, 'Uib:buildHtmlTable', `Warning, data is ${rowKeys.length} rows. Anything over 1,000 can get very slow to complete.`)()\n\n        const tbl = Ui.doc.createElement('table')\n\n        // Heading row\n        const thead = Ui.doc.createElement('thead')\n        const headerRow = Ui.doc.createElement('tr')\n\n        if (!opts.cols) { // Take the columns from the 1st row of provided data\n            // We have to have data\n            if (data.length < 1) throw new Error('[ui.js:buildHtmlTable] When no opts.cols is provided, data must contain at least 1 row')\n\n            const hasName = Object.prototype.toString.apply(data[0]) !== '[object Array]'\n\n            // Set this row to be the column reference (so we have a fixed ref if we allow more thead rows in the future)\n            headerRow.dataset.colReference = '' // creates attribute data-col-reference\n\n            // Create cols data: Assume 1st row of data\n            opts.cols = []\n            Object.keys(data[0]).forEach( (col, i) => {\n                opts.cols.push({\n                    index: i,\n                    hasName: hasName,\n                    name: hasName ? col : undefined,\n                    key: col ?? i,\n                    title: col,\n                })\n            })\n        }\n        // @ts-ignore Add cols metadata to table element as a custom prop\n        tbl.cols = opts.cols\n\n        // Add the table column headings\n        opts.cols.forEach((col) => {\n            const thEl = Ui.doc.createElement('th')\n            thEl.textContent = col.title\n            // @ts-ignore\n            if (col.hasName === true) thEl.dataset.colName = name\n            headerRow.appendChild(thEl)\n        })\n\n        thead.appendChild(headerRow)\n        tbl.appendChild(thead)\n\n        // body\n        const tbody = Ui.doc.createElement('tbody')\n        tbl.appendChild(tbody)\n\n        const rowOpts = {\n            allowHTML: true,\n            cols: opts.cols, // we only want to get this once\n        }\n\n        // Directly adds rows to the tbl element\n        data.forEach( (item, i) => {\n            if (isNaN(Number(rowKeys[i]))) rowOpts.rowId = rowKeys[i]\n            else rowOpts.rowId = undefined\n            this.tblAddRow(tbl, item, rowOpts)\n        })\n\n        if (opts.parent) {\n            // const parentType = Object.prototype.toString.apply(opts.parent)\n            let parentEl\n            if (typeof opts.parent === 'string') {\n                parentEl = Ui.doc.querySelector(opts.parent)\n            } else {\n                parentEl = opts.parent\n            }\n            try {\n                parentEl.appendChild(tbl)\n            } catch (e) {\n                throw new Error(`[ui.js:buildHtmlTable] Could not add table to parent. ${e.message}`)\n            }\n            return\n        }\n\n        return tbl\n    }\n\n    /** Adds (or replaces) a single row in an existing table>tbody\n     * NOTE: Row numbers use the rowIndex property of the row element.\n     * @param {string|HTMLTableElement} tbl Either a CSS Selector for the table or a reference to the HTML Table Element\n     * @param {object|Array} rowData A single row of column/cell data\n     * @param {object} [options] Additional options\n     *  @param {number=} options.body Optional, default=0. The tbody section to add the row to.\n     *  @param {boolean=} options.allowHTML Optional, default=false. If true, allows HTML cell content, otherwise only allows text. Always sanitise HTML inputs\n     *  @param {string=} options.rowId Optional. HTML element ID for the added row\n     *  @param {number=} options.afterRow Optional. If provided, the new row will be added after this row number\n     *  @param {number=} options.beforeRow Optional. If provided, the new row will be added before this row number. Ignored if afterRow is provided\n     *  @param {number=} options.replaceRow Optional. If provided, the specified row will be REPLACED instead of added. Ignored if afterRow or beforeRow is provided\n     *  @param {Array<columnDefinition>} [options.cols] Optional. Data about each column. If not provided, will be calculated from the table\n     *\n     * @returns {HTMLTableRowElement} Reference to the newly added row. Use the `rowIndex` prop for the row number\n     */\n    tblAddRow(tbl, rowData = {}, options = {}) {\n        const tblType = Object.prototype.toString.apply(tbl)\n\n        if (Object.prototype.toString.apply(options) !== '[object Object]') throw new Error(`[tblAddDataRow] options must be an object`)\n\n        // rowData must be an object or array of column cell data\n        const dataType = Object.prototype.toString.apply(rowData)\n        if (dataType !== '[object Object]' && dataType !== '[object Array]') throw new Error(`[tblAddDataRow] rowData MUST be an object or an array containing column/cell data for each column`)\n\n        /** @type {HTMLTableElement} */\n        let tblEl\n        if (tblType === '[object HTMLTableElement]') { // we were passed an actual table el\n            // @ts-ignore\n            tblEl = tbl\n        } else { // we were passed a css selector\n            // @ts-ignore\n            tblEl = Ui.doc.querySelector(tbl)\n            if (!tblEl) throw new Error(`[tblAddDataRow] Table with CSS Selector \"${tbl}\" not found`)\n        }\n\n        if (!options.body) options.body = 0\n        if (!('allowHTML' in options)) options.allowHTML = false\n\n        const tbodyEl = tblEl.getElementsByTagName('tbody')[options.body]\n        if (!tbodyEl) throw new Error(`[tblAddDataRow] Table must have a tbody tag, tbody section ${options.body} does not exist`)\n        // console.log('rows', tbody.rows.length)\n\n        // Get column meta if not provided\n        if (!options.cols) options.cols = this.tblGetColMeta(tblEl)\n        const colMeta = options.cols\n        // console.log('COL-META:', colMeta, '-- COL-META-LENGTH:', colMeta.length)\n\n        const rowEl = Ui.doc.createElement('tr')\n        if (options.rowId) rowEl.id = options.rowId\n\n        // Pre-create all the columns in an array\n        const cols = []\n        for (const col of colMeta) {\n            const cellEl = Ui.doc.createElement('td')\n            // Attach the col metadata to the col element as a custom prop\n            cellEl.colMeta = col\n            // If we have a name, add `data-col-name` attribute\n            if (col.hasName) cellEl.dataset.colName = col.name\n\n            cols.push(cellEl)\n        }\n        // console.log('COLS:', cols)\n\n        // walk through provided data\n        Object.keys(rowData).forEach( (colKey, i, row) => {\n            // console.log('++ ROW KEY. i=', i, 'rowKey=', rowKey, 'rowData[rowKey]=', rowData[rowKey])\n\n            // Match the new input to one of the columns\n            let foundEl = cols.find( col => col?.colMeta?.name === colKey )\n            let foundRowData\n            if (foundEl) { // Find by name\n                foundRowData = rowData[colKey]\n            } else { // By index\n                let numColKey = Number(colKey)\n                if (isNaN(numColKey)) numColKey = i\n                // NOTE: Ignore if the col index is larger than the number of cols\n                if (numColKey <= cols.length - 1) {\n                    foundEl = cols[numColKey]\n                    foundRowData = Object.values(rowData)[numColKey] // Gets an array even if the original is an object\n                }\n            }\n            if (foundEl) {\n                // Attach the text/html\n                if (options.allowHTML) foundEl.innerHTML = this.sanitiseHTML(foundRowData)\n                else foundEl.textContent = foundRowData\n            }\n            // Ignore not found columns\n        })\n\n        // Append all the columns to the row\n        rowEl.append(...cols)\n\n        // If afterRow is provided, insert the row after the specified row number & return reference to the new row\n        if ('afterRow' in options) {\n            const afterRow = tbodyEl.rows[options.afterRow]\n            if (afterRow) return afterRow.after(rowEl)\n        } else if ('beforeRow' in options) {\n            const beforeRow = tbodyEl.rows[options.beforeRow]\n            if (beforeRow) return beforeRow.before(rowEl)\n        } else if ('replaceRow' in options) {\n            const replaceRow = tbodyEl.rows[options.replaceRow]\n            if (replaceRow) return replaceRow.replaceWith(rowEl)\n        }\n        // Otherwise adds the row to the end of the table and returns the row reference for further processing if needed\n        return tbodyEl.appendChild(rowEl)\n    }\n\n    /** Add table event listener that returns the text or html content of either the full row or a single cell\n     * NOTE: Assumes that the table has a `tbody` element.\n     * If cells have a `data-col-name` attribute, it will be used in the output as the column name.\n     * @example tblAddListener('#eltest-tbl-table', {}, myVar)\n     * @example tblAddListener('#eltest-tbl-table', {eventScope: 'cell'}, myVar2)\n     *\n     * @param {string} tblSelector The table CSS Selector\n     * @param {object} [options] Additional options. Default={}\n     *   @param {\"row\"|\"cell\"=} options.eventScope Optional, default=row. Return data for either the whole row (as an object) or for the single cell clicked\n     *   @param {\"text\"|\"html\"=} options.returnType Optional, default=text. Return text or html data\n     *   @param {number=} options.pad Optional, default=3. Will be used to front-pad unnamed column references with zeros. e.g. 3 => \"C002\"/\"C012\"/\"C342\"\n     *   @param {boolean=} options.send Optional, default=true. If uibuilder is present, will automatically send a message back to Node-RED.\n     *   @param {string|number=} options.logLevel Optional, default=3/info. Numeric or string log level matching uibuilder's log levels.\n     *   @param {string} [options.eventType] Optional, default=click. What event to listen for.\n     * @param {object=} out A variable reference that will be updated with the output data upon a click event\n     */\n    tblAddListener(tblSelector, options = {}, out = {}) {\n        const table = Ui.doc.querySelector(tblSelector)\n        if (!table) throw new Error(`Table with CSS Selector \"${tblSelector}\" not found`)\n        if (typeof out !== 'object') throw new Error('The \"out\" argument MUST be an object')\n\n        if (!options.eventScope) options.eventScope = 'row'\n        if (!options.returnType) options.returnType = 'text'\n        if (!options.eventType) options.eventType = 'click'\n        if (!options.pad) options.pad = 3\n        if (!options.logLevel) options.logLevel = 2 // info\n        if (!('send' in options)) options.send = true\n\n        // Add event listener to the table's <tbody> to capture clicks on any <tr> within it\n        table.querySelector('tbody').addEventListener(options.eventType, (event) => {\n            Object.keys(out).forEach(key => delete out[key]) // empty the out object\n\n            const clickedRow = event.target.closest('tr')\n            const clickedCell = event.target.closest('td')\n            // console.log('element clicked: ', clickedEl)\n\n            if (clickedRow) {\n                out.clickType = options.eventScope\n                out.eventType = options.eventType\n\n                const rowIndex = out.rowIndex = clickedRow.rowIndex\n                const cellIndex = out.cellIndex = clickedCell.cellIndex + 1 // Madness! rowindex starts from 1 but cell index from 0!\n\n                if (clickedRow.id) out.rowId = clickedRow.id\n\n                if (options.eventScope === 'row') {\n                    // Loop through each <td> in the clicked row\n                    clickedRow.querySelectorAll('td').forEach((cell) => {\n                        const colName = this.tblGetCellName(cell, options.pad)\n                        out[colName] = options.returnType === 'text' ? cell.textContent.trim() : cell.innerHTML\n                    })\n                } else {\n                    const colName = this.tblGetCellName(clickedCell, options.pad)\n                    out[colName] = options.returnType === 'text' ? clickedCell.textContent.trim() : clickedCell.innerHTML\n                }\n\n                Ui.log(options.logLevel, 'Ui:tblAddClickListener', `${options.eventScope} ${options.eventType} on row=${rowIndex}, col=${cellIndex}, data: `, out)()\n\n                // If UIBUILDER for Node-RED client library, send a message back to Node-RED\n                if (options.send === true && Ui.win['uibuilder']) Ui.win['uibuilder'].send({\n                    topic: `${tblSelector} ${options.eventScope} ${options.eventType}`,\n                    payload: out,\n                })\n            }\n        })\n    }\n\n    /** Find the column definition for a single column\n     * @param {string|number} rowKey Key or index to use for column search\n     * @param {Array<columnDefinition>=} colMeta Array of column definitions. If not provided, will need the HTML table element.\n     * @param {HTMLTableElement=} tblEl If the colMeta table not provided, provide the HTML table element to do the lookup\n     * @returns {columnDefinition} Column metadata object\n     */\n    tblFindColMeta(rowKey, colMeta, tblEl) {\n        if (!colMeta && !tblEl) throw new Error('[tblFindColMeta] Either the column metadata array or the HTML table element must be provided')\n        if (!colMeta && tblEl) colMeta = this.tblGetColMeta(tblEl)\n\n        let colDef\n        if (colMeta[rowKey]) colDef = colMeta[rowKey]\n        else {\n            const find = colMeta.find( c => c.name === rowKey || c.index === Number(rowKey) )\n            // console.log('FIND:', find)\n            if (find) colDef = find\n        }\n        // console.log('== COL DEF', colDef)\n        return colDef\n    }\n\n    /** Return a standardised table cell name. Either from a `data-col-name` attribute or a numeric reference like `C003`\n     * @param {HTMLTableCellElement} cellEl The cell element to process\n     * @param {number=} pad Optional, default=3. Will be used to front-pad unnamed column references with zeros. e.g. 3 => \"C002\"/\"C012\"/\"C342\"\n     * @returns {string} A cell name\n     */\n    tblGetCellName(cellEl, pad = 3) {\n        return cellEl.getAttribute('data-col-name') ?? `C${String(cellEl.cellIndex + 1).padStart(pad, '0')}`\n    }\n\n    /** Returns either the existing or calculated column metadata given any table\n     * First checks if the data is on the `cols` custom property of the table\n     * If not, then looks 1st for a row with a `data-col-reference` attribute. Then for the first TR of the thead. Then for the first TR of the table.\n     * @param {HTMLTableElement} tblEl DOM table element\n     * @param {object} [options] Additional options. Default={}\n     *   @param {number=} options.pad Optional, default=3. Will be used to front-pad unnamed column references with zeros. e.g. 3 => \"C002\"/\"C012\"/\"C342\"\n     * @returns {Array<columnDefinition>} Column metadata = array of column definitions\n     */\n    tblGetColMeta(tblEl, options = {}) {\n        if (!options.pad) options.pad = 3\n\n        // @ts-ignore If the table already has the cols custom prop, simply return it\n        if (tblEl.cols) return tblEl.cols\n\n        let cols = tblEl.querySelector('tr[data-col-reference]')?.children\n        if (!cols) cols = tblEl.querySelector('thead>tr:first-of-type')?.children\n        if (!cols) cols = tblEl.querySelector('tr:first-of-type')?.children\n\n        if (!cols) {\n            Ui.log(1, 'Ui:tblGetColMeta', 'No columns found in table')()\n            return []\n        }\n\n        const colData = []\n\n        /** @type {HTMLTableCellElement} */ let cellEl\n        for (cellEl of cols) {\n            const hasName = !!cellEl.dataset.colName\n            const colName = cellEl.dataset.colName\n            const colIndex = cellEl.cellIndex + 1\n            const colKey = hasName ? colName : `C${String(cellEl.cellIndex + 1).padStart(options.pad, '0')}`\n\n            colData.push({\n                index: colIndex,\n                hasName: hasName,\n                name: colName,\n                key: colKey,\n                title: cellEl.textContent,\n            })\n        }\n\n        // @ts-ignore Add the custom prop to the table element\n        tblEl.cols = colData\n\n        return colData\n    }\n\n    /** Remove a row from an existing table\n     * @param {string|HTMLTableElement} tbl Either a CSS Selector for the table or a reference to the HTML Table Element\n     * @param {number} rowIndex The row number to remove (1st row is 0, last row is -1)\n     * @param {object} [options] Additional options\n     *  @param {number=} options.body Optional, default=0. The tbody section to add the row to.\n     */\n    tblRemoveRow(tbl, rowIndex, options = {}) {\n        const tblType = Object.prototype.toString.apply(tbl)\n\n        if (Object.prototype.toString.apply(options) !== '[object Object]') throw new Error(`[tblRemoveRow] options must be an object`)\n\n        /** @type {HTMLTableElement} */\n        let tblEl\n        if (tblType === '[object HTMLTableElement]') { // we were passed an actual table el\n            // @ts-ignore\n            tblEl = tbl\n        } else { // we were passed a css selector\n            // @ts-ignore\n            tblEl = Ui.doc.querySelector(tbl)\n            if (!tblEl) throw new Error(`[tblRemoveRow] Table with CSS Selector \"${tbl}\" not found`)\n        }\n\n        if (!options.body) options.body = 0\n\n        const tbodyEl = tblEl.getElementsByTagName('tbody')[options.body]\n        if (!tbodyEl) throw new Error(`[tblAddDataRow] Table must have a tbody tag, tbody section ${options.body} does not exist`)\n\n        tbodyEl.deleteRow(rowIndex)\n    }\n\n    // #endregion --- table handling ---\n}\n\nexport default Ui\n\n// if (window) window['$ui'] = new Ui(window)\n\n// export Ui\n"],
  "mappings": "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",
  "names": ["showOverlay", "options", "content", "title", "icon", "type", "showDismiss", "autoClose", "time", "overlayContainerId", "overlayContainer", "entryId", "overlayEntry", "typeStyles", "currentTypeStyle", "shouldShowDismiss", "iconHtml", "titleText", "timeHtml", "now", "year", "month", "day", "hours", "minutes", "seconds", "timestamp", "closeOverlayEntry", "entry", "dismissBtn", "autoCloseTimer", "_a", "Ui", "win", "extLog", "jsonHighlight", "__publicField", "str", "lang", "high", "plugin", "name", "config", "notify", "resolve", "reject", "ev", "ui", "isRecurse", "compToAdd", "newEl", "elParent", "el", "comp", "attrib", "type", "evt", "err", "prop", "parentEl", "components", "ns", "i", "component", "__toESM", "__require", "script", "sheet", "msg", "all", "compToRemove", "els", "compToReplace", "elToReplace", "compToUpd", "elToUpd", "j", "nc", "nestedComp", "k", "method", "cssSelector", "output", "context", "out", "attr", "e", "classNames", "sourceId", "targetId", "template", "target", "targetContent", "templateContent", "slot", "mdText", "url", "uiOptions", "response", "error", "contentType", "txtReturn", "data", "newScript", "textFn", "newStyle", "opts", "sourceSelector", "targetSelector", "moveType", "position", "node", "thisOut", "listEntries", "bodyEntries", "headEntries", "cols", "v", "permit", "tempFrag", "elRange", "html", "body", "title", "content", "icon", "removeToaster", "toaster", "toasterEventHandler", "removeToast", "localToast", "newToast", "toastEventHandler", "hasInteractiveElement", "lastToast", "options", "showOverlay", "json", "propName", "selection", "p", "cType", "key", "rowKeys", "dataType", "tbl", "thead", "headerRow", "hasName", "col", "thEl", "tbody", "rowOpts", "item", "rowData", "tblType", "tblEl", "tbodyEl", "colMeta", "rowEl", "cellEl", "colKey", "row", "foundEl", "foundRowData", "numColKey", "afterRow", "beforeRow", "replaceRow", "tblSelector", "table", "event", "clickedRow", "clickedCell", "rowIndex", "cellIndex", "cell", "colName", "rowKey", "colDef", "find", "c", "pad", "_b", "_c", "colData", "colIndex", "ui_default"]
}
