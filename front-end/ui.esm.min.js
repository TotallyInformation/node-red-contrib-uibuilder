var g=Object.create;var d=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,v=Object.prototype.hasOwnProperty;var E=(l,e,t)=>e in l?d(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var f=(l=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(l,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):l)(function(l){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+l+'" is not supported')});var S=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports);var k=(l,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of p(e))!v.call(l,r)&&r!==t&&d(l,r,{get:()=>e[r],enumerable:!(i=m(e,r))||i.enumerable});return l};var y=(l,e,t)=>(t=l!=null?g(b(l)):{},k(e||!l||!l.__esModule?d(t,"default",{value:l,enumerable:!0}):t,l));var u=(l,e,t)=>(E(l,typeof e!="symbol"?e+"":e,t),t);var C=S((M,w)=>{var a,x=(a=class{constructor(e,t,i){u(this,"version","6.6.0-esm.min");u(this,"sanitiseExtraTags",["uib-var"]);u(this,"sanitiseExtraAttribs",["variable","report","undefined"]);u(this,"window");if(e)this.window=e;else throw new Error("Ui:constructor. Current environment does not include `window`, UI functions cannot be used.");this.document=this.window.document,t?a.log=t:a.log=function(){return function(){}},i?this.syntaxHighlight=i:this.syntaxHighlight=function(){}}ui(e){let t={};e._ui?t=e:t._ui=e,this._uiManager(t)}replaceSlot(e,t){t.slot&&e&&(this.window.DOMPurify&&(t.slot=this.window.DOMPurify.sanitize(t.slot)),e.innerHTML=t.slot)}convertMarkdown(e){if(!e)return"";if(!this.window.markdownit)return e;let t={html:!0,linkify:!0,_highlight:!0,langPrefix:"language-",highlight(r,n){if(n&&this.window.hljs&&this.window.hljs.getLanguage(n))try{return'<pre class="highlight" data-language="'.concat(n.toUpperCase(),'">\n                                <code class="language-').concat(n,'">').concat(this.window.hljs.highlightAuto(r).value,"</code></pre>")}finally{}return'<pre class="highlight"><code>'.concat(i.utils.escapeHtml(r),"</code></pre>")}},i=this.window.markdownit(t);return i.render(e)}sanitiseHTML(e){return this.window.DOMPurify?this.window.DOMPurify.sanitize(e,{ADD_TAGS:this.sanitiseExtraTags,ADD_ATTR:this.sanitiseExtraAttribs}):e}replaceSlotMarkdown(e,t){e&&t.slotMarkdown&&(t.slotMarkdown=this.convertMarkdown(t.slotMarkdown),t.slotMarkdown=this.sanitiseHTML(t.slotMarkdown),e.innerHTML=t.slotMarkdown)}loadScriptSrc(e){let t=this.document.createElement("script");t.src=e,t.async=!1,this.document.head.appendChild(t)}loadStyleSrc(e){let t=this.document.createElement("link");t.href=e,t.rel="stylesheet",t.type="text/css",this.document.head.appendChild(t)}loadScriptTxt(e){let t=this.document.createElement("script");t.async=!1,t.textContent=e,this.document.head.appendChild(t)}loadStyleTxt(e){let t=this.document.createElement("style");t.textContent=e,this.document.head.appendChild(t)}showDialog(e,t,i){let r="";if(i.payload&&typeof i.payload=="string"&&(r+=i.payload),t.content&&(r+=t.content),r===""){a.log(1,"Ui:showDialog","Toast content is blank. Not shown.")();return}!t.title&&i.topic&&(t.title=i.topic),t.title&&(r='<p class="toast-head">'.concat(t.title,"</p><p>").concat(r,"</p>")),t.noAutohide&&(t.noAutoHide=t.noAutohide),t.noAutoHide&&(t.autohide=!t.noAutoHide),t.autoHideDelay?(t.autohide||(t.autohide=!0),t.delay=t.autoHideDelay):t.autoHideDelay=1e4,Object.prototype.hasOwnProperty.call(t,"autohide")||(t.autohide=!0),e==="alert"&&(t.modal=!0,t.autohide=!1,r='<svg viewBox="0 0 192.146 192.146" style="width:30;background-color:transparent;"><path d="M108.186 144.372c0 7.054-4.729 12.32-12.037 12.32h-.254c-7.054 0-11.92-5.266-11.92-12.32 0-7.298 5.012-12.31 12.174-12.31s11.91 4.992 12.037 12.31zM88.44 125.301h15.447l2.951-61.298H85.46l2.98 61.298zm101.932 51.733c-2.237 3.664-6.214 5.921-10.493 5.921H12.282c-4.426 0-8.51-2.384-10.698-6.233a12.34 12.34 0 0 1 .147-12.349l84.111-149.22c2.208-3.722 6.204-5.96 10.522-5.96h.332c4.445.107 8.441 2.618 10.513 6.546l83.515 149.229c1.993 3.8 1.905 8.363-.352 12.066zm-10.493-6.4L96.354 21.454l-84.062 149.18h167.587z" /></svg> '.concat(r));let n=this.document.getElementById("toaster");n===null&&(n=this.document.createElement("div"),n.id="toaster",n.title="Click to clear all notifcations",n.setAttribute("class","toaster"),n.setAttribute("role","dialog"),n.setAttribute("arial-label","Toast message"),n.onclick=function(){n.remove()},this.document.body.insertAdjacentElement("afterbegin",n));let s=this.document.createElement("div");s.title="Click to clear this notifcation",s.setAttribute("class","toast ".concat(t.variant?t.variant:""," ").concat(e)),s.innerHTML=r,s.setAttribute("role","alertdialog"),t.modal&&s.setAttribute("aria-modal",t.modal),s.onclick=function(c){c.stopPropagation(),s.remove(),n.childElementCount<1&&n.remove()},n.insertAdjacentElement(t.appendToast===!0?"beforeend":"afterbegin",s),t.autohide===!0&&setInterval(()=>{s.remove(),n.childElementCount<1&&n.remove()},t.autoHideDelay)}_showNotification(e){e.topic&&!e.title&&(e.title=e.topic),e.title||(e.title="uibuilder notification"),e.payload&&!e.body&&(e.body=e.payload),e.body||(e.body=" No message given.");try{let t=new Notification(e.title,e);return new Promise((i,r)=>{t.addEventListener("close",n=>{n.currentTarget.userAction="close",i(n)}),t.addEventListener("click",n=>{n.currentTarget.userAction="click",i(n)}),t.addEventListener("error",n=>{n.currentTarget.userAction="error",r(n)})})}catch{return Promise.reject(new Error("Browser refused to create a Notification"))}}async notification(e){if(typeof e=="string"&&(e={body:e}),typeof Notification>"u")return Promise.reject(new Error("Notifications not available in this browser"));let t=Notification.permission;return t==="denied"?Promise.reject(new Error("Notifications not permitted by user")):t==="granted"?this._showNotification(e):(t=await Notification.requestPermission(),t==="granted"?this._showNotification(e):Promise.reject(new Error("Notifications not permitted by user")))}loadui(e){if(!fetch){a.log(0,"Ui:loadui","Current environment does not include `fetch`, skipping.")();return}if(!e){a.log(0,"Ui:loadui","url parameter must be provided, skipping.")();return}fetch(e).then(t=>{if(t.ok===!1)throw new Error("Could not load '".concat(e,"'. Status ").concat(t.status,", Error: ").concat(t.statusText));a.log("trace","Ui:loadui:then1","Loaded '".concat(e,"'. Status ").concat(t.status,", ").concat(t.statusText))();let i=t.headers.get("content-type");if(!i||!i.includes("application/json"))throw new TypeError("Fetch '".concat(e,"' did not return JSON, ignoring"));return t.json()}).then(t=>t!==void 0?(a.log("trace","Ui:loadui:then2","Parsed JSON successfully obtained")(),this._uiManager({_ui:t}),!0):!1).catch(t=>{a.log("warn","Ui:loadui:catch","Error. ",t)()})}_uiComposeComponent(e,t){t.attributes&&Object.keys(t.attributes).forEach(i=>{i==="value"&&(e.value=t.attributes[i]),i.startsWith("xlink:")?e.setAttributeNS("http://www.w3.org/1999/xlink",i,t.attributes[i]):e.setAttribute(i,t.attributes[i])}),t.id&&e.setAttribute("id",t.id),t.type==="svg"&&(e.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),e.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")),t.events&&Object.keys(t.events).forEach(i=>{i.toLowerCase==="onclick"&&(i="click");try{e.addEventListener(i,r=>{new Function("evt","".concat(t.events[i],"(evt)"))(r)})}catch(r){a.log("error","Ui:_uiComposeComponent","Add event '".concat(i,"' for element '").concat(t.type,"': Cannot add event handler. ").concat(r.message))()}}),t.properties&&Object.keys(t.properties).forEach(i=>{e[i]=t.properties[i]}),t.slot&&this.replaceSlot(e,t),t.slotMarkdown&&this.replaceSlotMarkdown(e,t)}uiEnhanceElement(e,t){this._uiComposeComponent(e,t)}_uiExtendEl(e,t,i=""){t.forEach((r,n)=>{a.log("trace","Ui:_uiExtendEl:components-forEach:".concat(n),r)();let s;r.ns=i,r.ns==="html"?(s=e,e.innerHTML=r.slot):r.ns==="svg"?(s=this.document.createElementNS("http://www.w3.org/2000/svg",r.type),this._uiComposeComponent(s,r),e.appendChild(s)):(s=this.document.createElement(r.type==="html"?"div":r.type),this._uiComposeComponent(s,r),e.appendChild(s)),r.components&&this._uiExtendEl(s,r.components,r.ns)})}_uiAdd(e,t){a.log("trace","Ui:_uiManager:add","Starting _uiAdd")(),e.components.forEach((i,r)=>{a.log("trace","Ui:_uiAdd:components-forEach:".concat(r),"Component to add: ",i)();let n;switch(i.type){case"html":{i.ns="html",n=this.document.createElement("div");break}case"svg":{i.ns="svg",n=this.document.createElementNS("http://www.w3.org/2000/svg","svg");break}default:{i.ns="dom",n=this.document.createElement(i.type);break}}!i.slot&&e.payload&&(i.slot=e.payload),this._uiComposeComponent(n,i);let s;i.parentEl?s=i.parentEl:e.parentEl?s=e.parentEl:i.parent?s=this.document.querySelector(i.parent):e.parent&&(s=this.document.querySelector(e.parent)),s||(a.log("info","Ui:_uiAdd","No parent found, adding to body")(),s=this.document.querySelector("body")),i.position&&i.position==="first"?s.insertBefore(n,s.firstChild):i.position&&Number.isInteger(Number(i.position))?s.insertBefore(n,s.children[i.position]):s.appendChild(n),i.components&&this._uiExtendEl(n,i.components,i.ns)})}_uiRemove(e,t=!1){e.components.forEach(i=>{let r;t!==!0?r=[this.document.querySelector(i)]:r=this.document.querySelectorAll(i),r.forEach(n=>{try{n.remove()}catch(s){a.log("trace","Ui:_uiRemove","Could not remove. ".concat(s.message))()}})})}_uiReplace(e){a.log("trace","Ui:_uiReplace","Starting")(),e.components.forEach((t,i)=>{a.log("trace","Ui:_uiReplace:components-forEach:".concat(i),"Component to replace: ",t)();let r;if(t.id?r=this.document.getElementById(t.id):t.selector||t.select?r=this.document.querySelector(t.selector):t.name?r=this.document.querySelector('[name="'.concat(t.name,'"]')):t.type&&(r=this.document.querySelector(t.type)),a.log("trace","Ui:_uiReplace:components-forEach:".concat(i),"Element to replace: ",r)(),r==null){a.log("trace","Ui:_uiReplace:components-forEach:".concat(i,":noReplace"),"Cannot find the DOM element. Adding instead.",t)(),this._uiAdd({components:[t]},!1);return}let n;switch(t.type){case"html":{t.ns="html",n=this.document.createElement("div");break}case"svg":{t.ns="svg",n=this.document.createElementNS("http://www.w3.org/2000/svg","svg");break}default:{t.ns="dom",n=this.document.createElement(t.type);break}}this._uiComposeComponent(n,t),r.replaceWith(n),t.components&&this._uiExtendEl(n,t.components,t.ns)})}_uiUpdate(e){a.log("trace","Ui:_uiManager:update","Starting _uiUpdate")(),e.components||(e.components=[Object.assign({},e)]),e.components.forEach((t,i)=>{a.log("trace","_uiUpdate:components-forEach","Component #".concat(i),t)();let r;if(t.id?r=this.document.querySelectorAll("#".concat(t.id)):t.selector||t.select?r=this.document.querySelectorAll(t.selector):t.name?r=this.document.querySelectorAll('[name="'.concat(t.name,'"]')):t.type&&(r=this.document.querySelectorAll(t.type)),r===void 0||r.length<1){a.log("warn","Ui:_uiManager:update","Cannot find the DOM element. Ignoring.",t)();return}a.log("trace","_uiUpdate:components-forEach","Element(s) to update. Count: ".concat(r.length),r)(),!t.slot&&t.payload&&(t.slot=t.payload),r.forEach(n=>{this._uiComposeComponent(n,t)}),t.components&&r.forEach(n=>{a.log("trace","_uiUpdate:components","el",n)(),this._uiUpdate({method:e.method,parentEl:n,components:t.components})})})}_uiLoad(e){e.components&&(Array.isArray(e.components)||(e.components=[e.components]),e.components.forEach(async t=>{await Promise.resolve().then(()=>y(f(t)))})),e.srcScripts&&(Array.isArray(e.srcScripts)||(e.srcScripts=[e.srcScripts]),e.srcScripts.forEach(t=>{this.loadScriptSrc(t)})),e.txtScripts&&(Array.isArray(e.txtScripts)||(e.txtScripts=[e.txtScripts]),this.loadScriptTxt(e.txtScripts.join("\n"))),e.srcStyles&&(Array.isArray(e.srcStyles)||(e.srcStyles=[e.srcStyles]),e.srcStyles.forEach(t=>{this.loadStyleSrc(t)})),e.txtStyles&&(Array.isArray(e.txtStyles)||(e.txtStyles=[e.txtStyles]),this.loadStyleTxt(e.txtStyles.join("\n")))}_uiReload(){a.log("trace","Ui:uiManager:reload","reloading")(),location.reload()}_uiManager(e){e._ui&&(Array.isArray(e._ui)||(e._ui=[e._ui]),e._ui.forEach((t,i)=>{if(!t.method){a.log("error","Ui:_uiManager","No method defined for msg._ui[".concat(i,"]. Ignoring"))();return}switch(t.payload=e.payload,t.topic=e.topic,t.method){case"add":{this._uiAdd(t,!1);break}case"remove":{this._uiRemove(t,!1);break}case"removeAll":{this._uiRemove(t,!0);break}case"replace":{this._uiReplace(t);break}case"update":{this._uiUpdate(t);break}case"load":{this._uiLoad(t);break}case"reload":{this._uiReload();break}case"notify":{this.showDialog("notify",t,e);break}case"alert":{this.showDialog("alert",t,e);break}default:{a.log("error","Ui:_uiManager","Invalid msg._ui[".concat(i,"].method (").concat(t.method,"). Ignoring"))();break}}}))}nodeGet(e,t){let i={id:e.id===""?void 0:e.id,name:e.name,children:e.childNodes.length,type:e.nodeName,attributes:void 0,isUserInput:!!e.validity,userInput:e.validity?{value:e.value,validity:void 0,willValidate:e.willValidate,valueAsDate:e.valueAsDate,valueAsNumber:e.valueAsNumber,type:e.type}:void 0};if(["UL","OL"].includes(e.nodeName)){let r=this.document.querySelectorAll("".concat(t," li"));r&&(i.list={entries:r.length})}if(e.nodeName==="DL"){let r=this.document.querySelectorAll("".concat(t," dt"));r&&(i.list={entries:r.length})}if(e.nodeName==="TABLE"){let r=this.document.querySelectorAll("".concat(t," > tbody > tr")),n=this.document.querySelectorAll("".concat(t," > thead > tr")),s=this.document.querySelectorAll("".concat(t," > tbody > tr:last-child > *"));(r||n||s)&&(i.table={headRows:n?n.length:0,bodyRows:r?r.length:0,columns:s?s.length:0})}if(e.nodeName!=="#text"&&e.attributes&&e.attributes.length>0){i.attributes={};for(let r of e.attributes)r.name!=="id"&&(i.attributes[r.name]=e.attributes[r.name].value)}e.nodeName==="#text"&&(i.text=e.textContent),e.validity&&(i.userInput.validity={});for(let r in e.validity)i.userInput.validity[r]=e.validity[r];return i}uiGet(e,t=null){let i=this.document.querySelectorAll(e),r=[];return i.forEach(n=>{if(t!==null&&t!==""){let s=n.getAttribute(t);if(s==null)try{s=n[t]}catch{}if(s==null)t.toLowerCase()==="value"?r.push(n.innerText):r.push("Property '".concat(t,"' not found"));else if(s.constructor.name==="NamedNodeMap"){let c={};for(let o of s)c[o.name]=s[o.name].value;r.push(c)}else if(!s.constructor.name.toLowerCase().includes("map"))r.push({[t]:s});else{let c={};for(let o in s)c[o]=s[o];r.push(c)}}else r.push(this.nodeGet(n,e))}),r}async include(e,t){if(!fetch)return a.log(0,"Ui:include","Current environment does not include `fetch`, skipping.")(),"Current environment does not include `fetch`, skipping.";if(!e)return a.log(0,"Ui:include","url parameter must be provided, skipping.")(),"url parameter must be provided, skipping.";if(!t||!t.id)return a.log(0,"Ui:include","uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.")(),"uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.";let i;try{i=await fetch(e)}catch(h){return a.log(0,"Ui:include","Fetch of file '".concat(e,"' failed. "),h.message)(),h.message}if(!i.ok)return a.log(0,"Ui:include","Fetch of file '".concat(e,"' failed. Status='").concat(i.statusText,"'"))(),i.statusText;let r=await i.headers.get("content-type"),n=null;r&&(r.includes("text/html")?n="html":r.includes("application/json")?n="json":r.includes("multipart/form-data")?n="form":r.includes("image/")?n="image":r.includes("video/")?n="video":r.includes("application/pdf")?n="pdf":r.includes("text/plain")&&(n="text"));let s="",c="Include successful",o;switch(n){case"html":{o=await i.text(),s=o;break}case"json":{o=await i.json(),s='<pre class="syntax-highlight">',s+=this.syntaxHighlight(o),s+="</pre>";break}case"form":{o=await i.formData(),s='<pre class="syntax-highlight">',s+=this.syntaxHighlight(o),s+="</pre>";break}case"image":{o=await i.blob(),s='<img src="'.concat(URL.createObjectURL(o),'">'),this.window.DOMPurify&&(c="Include successful. BUT DOMPurify loaded which may block its use.",a.log("warn","Ui:include:image",c)());break}case"video":{o=await i.blob(),s='<video controls autoplay><source src="'.concat(URL.createObjectURL(o),'"></video>'),this.window.DOMPurify&&(c="Include successful. BUT DOMPurify loaded which may block its use.",a.log("warn","Ui:include:video",c)());break}case"pdf":case"text":default:{o=await i.blob(),s='<iframe style="resize:both;width:inherit;height:inherit;" src="'.concat(URL.createObjectURL(o),'">'),this.window.DOMPurify&&(c="Include successful. BUT DOMPurify loaded which may block its use.",a.log("warn","Ui:include:".concat(n),c)());break}}return t.type="div",t.slot=s,t.parent||(t.parent="body"),t.attributes||(t.attributes={class:"included"}),this._uiReplace({components:[t]}),a.log("trace","Ui:include:".concat(n),c)(),c}},u(a,"log"),a);w.exports=x});export default C();
//# sourceMappingURL=ui.esm.min.js.map
