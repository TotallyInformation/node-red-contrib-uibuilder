var b=Object.defineProperty;var w=(n,e,t)=>e in n?b(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>(w(n,typeof e!="symbol"?e+"":e,t),t),h=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var f=(n,e,t)=>(h(n,e,"read from private field"),t?t.call(n):e.get(n)),p=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},m=(n,e,t,r)=>(h(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);var d,s=class{constructor(e){u(this,"config");u(this,"routeContainerEl");u(this,"currentRouteId");u(this,"previousRouteId");p(this,d,!1);if(!fetch)throw new Error("[uibrouter:constructor] UibRouter requires `fetch`. Please use a current browser or load a fetch polyfill.");if(!e)throw new Error("[uibrouter:constructor] No config provided");if(!e.routes)throw new Error("[uibrouter:constructor] No routes provided in routerConfig");e.routeContainer||(e.routeContainer="#uibroutecontainer"),this.config=e,this._setRouteContainer(),Promise.all(Object.values(e.routes).filter(t=>t.type==="url").map(this._loadExternal)).then(this._appendExternalTemplates).then(()=>{this._start()})}_setRouteContainer(){let e=document.getElementsByTagName("body")[0],t=this.routeContainerEl=document.querySelector(this.config.routeContainer);if(!t){let r=document.createElement("div");r.setAttribute("id",this.config.routeContainer.replace("#","")),e.append(r),t=this.routeContainerEl=document.querySelector(this.config.routeContainer)}}_appendExternalTemplates(e){let t=document.getElementsByTagName("head")[0];e.forEach(r=>{Array.isArray(r)?console.error(...r):t.append(r)})}_start(){f(this,d)!==!0&&(window.addEventListener("hashchange",e=>this._hashChange(e)),this.doRoute(),document.dispatchEvent(new CustomEvent("uibrouter:loaded")),uibuilder&&uibuilder.set("uibrouter","loaded"),m(this,d,!0))}_hashChange(e){this.doRoute(e)}_createRouteContent(e){let t=document.querySelector(`#${e}`);if(!t)return console.error(`[uibrouter:createRouteContent] No route template found for route selector '#${e}'. Does the link url match a defined route id?`),!1;let r=t.content.cloneNode(!0);this.isRouteExternal(e)&&this._applyScripts(r);let o=document.createElement("div");o.dataset.route=e,o.append(r);try{this.routeContainerEl.append(o)}catch(i){return console.error(`[uibrouter:createRouteContent] Failed to apply route id '${e}'. 
 ${i.message}`),!1}return!0}_loadExternal(e){let t=e.id;return fetch(e.src).then(r=>r.ok===!1?[e.id,e.src,r.status,r.statusText]:r.text()).then(r=>{if(Array.isArray(r))return r;try{let i=document.querySelector(`#${t}`);i&&i.remove()}catch{}let o=document.createElement("template");return o.innerHTML=r,o.setAttribute("id",t),o}).catch(r=>{console.error(`[uibrouter:loadHTML] Error loading route template HTML from ${e.src}:`,r)})}_applyScripts(e){e.querySelectorAll("script").forEach(r=>{let o=document.createElement("script");o.textContent=r.innerText,e.append(o),r.remove()})}doRoute(e){let t=this.routeContainerEl;if(!t)throw new Error("[uibrouter:doRoute] Cannot route, has router.setup() been called yet?");let r=this.keepHashFromUrl(window.location.hash);e||(e=r);let o,i;if(typeof e=="string"){if(o=this.keepHashFromUrl(e),i=r,o===""&&this.config.defaultRoute&&(o=this.config.defaultRoute),o!==r){window.location.hash=`#${o}`;return}}else if(e.type==="hashchange"){let a=e.newURL;if(a.includes("#"))i=this.keepHashFromUrl(e.oldURL),o=this.keepHashFromUrl(a);else return}else{i=r;try{o=this.keepHashFromUrl(e.target.attributes.href.value)}catch{throw new Error("[uibrouter:doRoute] No valid route found. Event.target does not have an href attribute")}}let l=!1;if(!o||!this.routeList().includes(o))throw document.dispatchEvent(new CustomEvent("uibrouter:route-change-failed",{detail:{newRouteId:o,oldRouteId:i}})),uibuilder&&uibuilder.set("uibrouter","route change failed"),window.location.hash=i?`#${i}`:"",new Error(`[uibrouter:doRoute] No valid route found. Either pass a valid route name or an event from an element having an href of '#routename'. Route id requested: '${o}'`);if(this.config.hide){if(i){let c=document.querySelector(`div[data-route="${i}"]`);c&&(c.style.display="none")}let a=document.querySelector(`div[data-route="${o}"]`);a?(a.style.removeProperty("display"),l=!0):l=this._createRouteContent(o)}else t.replaceChildren(),l=this._createRouteContent(o);if(l===!1){document.dispatchEvent(new CustomEvent("uibrouter:route-change-failed",{detail:{newRouteId:o,oldRouteId:i}})),uibuilder&&uibuilder.set("uibrouter","route change failed"),window.location.hash=i?`#${i}`:"";return}this.currentRouteId=o,this.previousRouteId=i,t.dataset.currentRoute=o,document.dispatchEvent(new CustomEvent("uibrouter:route-changed",{detail:{newRouteId:o,oldRouteId:i}})),uibuilder&&uibuilder.set("uibrouter","route changed")}getRouteConfigById(e){return Object.values(this.config.routes).filter(t=>t.id===e)[0]}isRouteExternal(e){let t=this.getRouteConfigById(e);return!!(t&&t.type==="url")}defaultRoute(){this.config.defaultRoute&&this.doRoute(this.config.defaultRoute)}removeHash(){history.pushState("",document.title,window.location.pathname+window.location.search)}noRoute(){this.removeHash(),this.routeContainerEl.replaceChildren()}keepHashFromUrl(e){return e?e.replace(/^.*#(.*)/,"$1").replace(/\?.*$/,""):""}routeList(e){return Object.values(this.config.routes).map(t=>e===!0?`#${t.id}`:t.id)}addRoutes(e){Array.isArray(e)||(e=[e]),Promise.all(Object.values(e).filter(t=>t.type==="url").map(this._loadExternal)).then(this._appendExternalTemplates).then(()=>{this.config.routes.push(...e),document.dispatchEvent(new CustomEvent("uibrouter:routes-added",{detail:e})),uibuilder&&uibuilder.set("uibrouter","routes added")})}};d=new WeakMap,u(s,"version","1.0.0");var y=s;window.UibRouter?console.warn("`UibRouter` already assigned to window. Have you tried to load it more than once?"):window.UibRouter=s;export{s as UibRouter,y as default};
//# sourceMappingURL=uibrouter.esm.min.js.map
