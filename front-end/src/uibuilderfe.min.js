'use strict';if("undefined"!=typeof require&&"undefined"==typeof io)var io=require("socket.io-client");(function(){function e(e,t){(null===t||void 0===t)&&(t="payload"),"string"!=typeof t&&(console.warn("[uibuilderfe:makeMeAnObject] WARNING: property parameter must be a string and not: "+typeof t),t="payload");var o={};return"object"==typeof e?o=e:null!==e&&(o[t]=e),o}function t(){var e=Array.prototype.slice.call(arguments),t="/"+e.map(function(t){return t.replace(/^\/|\/$/g,"")}).filter(function(t){return t}).join("/");return t.replace("//","/")}var o=this,i=o.uibuilder,n=function(){var o=String.prototype;o.endsWith||(o.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});var n=this;n.version="4.2.0",n.moduleName="uibuilder",n.isUnminified=/param/.test(function(){}),n.debug=!0===n.isUnminified,n.security=!1,n.dummyAuth={id:"anonymous",jwt:void 0,sessionExpiry:void 0,userValidated:!1,info:{error:void 0,message:void 0,validJwt:void 0}},n._auth=n.dummyAuth,n.started=!1,n.uiDebug=function(){if(n.debug){var e=arguments[0];console[e].apply(console,[].slice.call(arguments,1))}},n.me=function(){return!0===n.debug?n:"uibuilderfe.js Version: "+n.version},n.uiDebug("log","\nuibuilderfe: Debug? ",n.debug,"\n\t\tVersion? ",n.version,"\n\t\tRunning Packed version? ",!n.isUnminified,"\n "),n.setIOnamespace=function(){var e="";try{e=document.cookie.match(/uibuilder-namespace\s*=.*?\s*;/g)[0].replace("uibuilder-namespace=","").replace(";","")}catch(t){}if(""===e){var t=window.location.pathname.split("/").filter(function(e){return""!==e.trim()});0<t.length&&t[t.length-1].endsWith(".html")&&t.pop(),e=t.pop(),n.uiDebug("log","uibuilderfe: IO Namespace - Found via url path: "+e)}else n.uiDebug("log","uibuilderfe: IO Namespace - Found via cookie: "+e);return e="/"+e,n.uiDebug("log","uibuilderfe: IO Namespace: "+e),e},n.autoSendReady=!0,n.allowScript=!0,n.allowStyle=!0,n.removeScript=!0,n.removeStyle=!0,n.msg={},n.ctrlMsg={},n.sentMsg={},n.sentCtrlMsg={},n.msgsSent=0,n.msgsReceived=0,n.msgsSentCtrl=0,n.msgsCtrl=0,n.ioConnected=!1,n.serverTimeOffset=null,n.isAuthorised=!1,n.authTokenExpiry=null,n.authData={},n.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},n.retryMs=2e3,n.retryFactor=1.5,n.timerid=null,n.ioNamespace=n.setIOnamespace(),n.ioTransport=["polling","websocket"],n.loaded=!1,n.authToken="";var u=window.location.pathname.split("/").filter(function(e){return""!==e.trim()});return 0<u.length&&u[u.length-1].endsWith(".html")&&u.pop(),n.url=u.pop(),n.httpNodeRoot="/"+u.join("/"),n.ioPath=t(n.httpNodeRoot,n.moduleName,"vendor","socket.io"),n.uiDebug("debug","uibuilderfe: ioPath: "+n.ioPath+", httpNodeRoot: "+n.httpNodeRoot+", uibuilder url (not used): "+n.url),n.set=function(e,t){n[e]=t,n.uiDebug("debug","uibuilderfe: prop set - prop: "+e+", val: "+("object"==typeof t?JSON.stringify(t):t)),n.emit(e,t)},n.checkConnect=function(e,t){var o=o++||1;n.uiDebug("debug","uibuilderfe:checkConnect. Reconnect - Depth: "+o+", Delay: "+e+", Factor: "+t,n.ioNamespace,n.ioPath),n.timerid&&window.clearTimeout(n.timerid),n.timerid=window.setTimeout(function(){n.uiDebug("debug","uibuilderfe:checkConnect timeout. SIO reconnect attempt, timeout: "+e+", depth: "+o,n.ioNamespace,n.ioPath),console.info("[uibuilderfe:checkConnect:setTimeout] Socket.IO reconnection attempt. Current delay: "+e),n.socket.close(),n.socket.connect(),n.timerid=null,n.checkConnect(e*t,t)},e)},n.checkTimestamp=function(e){var t=Math.round;if(e.hasOwnProperty("serverTimestamp")){var o=new Date(e.serverTimestamp),i=t((new Date-o)/36e5);i!==n.serverTimeOffset&&(n.set("serverTimeOffset",i),n.uiDebug("log","uibuilderfe:"+n.ioChannels.server+" (server): Offset changed to: "+i))}},n.ioSetup=function(){n.uiDebug("debug","uibuilderfe:ioSetup: About to create IO. Namespace: "+n.ioNamespace+", Path: "+n.ioPath+", Transport: ["+n.ioTransport.join(", ")+"]"),n.socketOptions={path:n.ioPath,transports:n.ioTransport,transportOptions:{polling:{extraHeaders:{"x-clientid":"uibuilderfe"}}}},n.socket=io(n.ioNamespace,n.socketOptions),n.socket.on("connect",function(){n.uiDebug("info","uibuilderfe:ioSetup: SOCKET CONNECTED - Namespace: "+n.ioNamespace," Server Channel: ",n.ioChannels.server," Control Channel: ",n.ioChannels.control),n.set("ioConnected",!0),n.timerid&&(window.clearTimeout(n.timerid),n.timerid=null)}),n.socket.on(n.ioChannels.server,function(t){n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.server+" (server): msg received - Namespace: "+n.ioNamespace,t),t=e(t,"payload"),n.checkTimestamp(t),t._auth&&n.updateAuth(t._auth),n.allowScript&&t.hasOwnProperty("script")&&(n.newScript(t.script),n.removeScript&&delete t.script),n.allowStyle&&t.hasOwnProperty("style")&&(n.newStyle(t.style),n.removeStyle&&delete t.style),n.set("msg",t),n.set("msgsReceived",n.msgsReceived+1)}),n.socket.on(n.ioChannels.control,function(e){if(n.uiDebug("debug","[uibuilder:ioSetup:on-ctrl-recvd] "+n.ioChannels.control+" (control): msg received - Namespace: "+n.ioNamespace,e),null===e)e={};else if("object"!=typeof e){var t={};t["uibuilderCtrl:"+n.ioChannels.control]=e,e=t}switch(e.hasOwnProperty("debug")&&(n.debug=e.debug),e.hasOwnProperty("security")&&(n.security=e.security,n.uiDebug("warn",`[uibuilderfe:ioSetup:on-ctrl-recvd] Security is ${n.security}`)),n.checkTimestamp(e),n.set("ctrlMsg",e),n.set("msgsCtrl",n.msgsCtrl+1),e.uibuilderCtrl){case"ready for content":e._auth&&n.updateAuth(e._auth),n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.control+" Received \"ready for content\" from server");break;case"shutdown":n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.control+" Received \"shutdown\" from server"),n.set("serverShutdown",void 0);break;case"client connect":e._auth&&n.updateAuth(e._auth),!0===n.autoSendReady&&(n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.control+" Received \"client connect\" from server, auto-sending REPLAY control msg"),n.send({uibuilderCtrl:"ready for content",cacheControl:"REPLAY"},n.ioChannels.control));break;case"authorised":n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.control+" Received \"authorised\" from server"),e._auth?n.updateAuth(e._auth):(n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.control+" Received \"authorised\" from server but without a _auth property - logon failed"),n.markLoggedOut("Logon succeeded but no _auth received, logged out"));break;case"authorisation failure":n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.control+" Received \"authorisation failure\" from server"),n.markLoggedOut("Logon authorisation failure",e._auth.authData);break;case"logged off":n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.control+" Received \"logged off\" from server"),n.markLoggedOut("Logged off by logout() request",e._auth);break;default:n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.control+" Received \""+e.uibuilderCtrl+"\" from server"),e._auth&&n.updateAuth(e._auth);}}),n.socket.on("disconnect",function(e){n.uiDebug("info","uibuilderfe:ioSetup: SOCKET DISCONNECTED - Namespace: "+n.ioNamespace+", Reason: "+e),n.set("ioConnected",!1),console.warn("[uibuilderfe:socket-disconnect] Reason: "+e),n.checkConnect(n.retryMs,n.retryFactor)}),n.socket.on("connect_error",function(e){n.uiDebug("error","uibuilderfe:ioSetup: SOCKET CONNECT ERROR - Namespace: "+n.ioNamespace+" ioPath: "+n.ioPath+", Reason: "+e.message)}),n.socket.on("error",function(e){n.uiDebug("warn","uibuilderfe:ioSetup: SOCKET ERROR from server - MESSAGE: ",e),n.set("socketError",e)}),n.checkConnect(n.retryMs,n.retryFactor)},n.markLoggedOut=function(e,t){void 0===n._auth&&void 0===t||(t=n.dummyAuth,void 0!==e&&(n._auth.info.message=e),n.set("isAuthorised",!1),n.set("_auth",t))},n.logon=function(e,t){if(n.security)return void 0!==n._auth||void 0!==e?(void 0===e&&(e=n._auth),void 0===e.id||null===e.id||0===e.id.length?void console.error("[uibuilder:logon] No logon id supplied, ignoring request."):void(!e.info&&(e.info=n.dummyAuth.info),n.set("_auth",e),t||n.send({uibuilderCtrl:"logon",from:"client",_auth:n._auth},n.ioChannels.control),n.uiDebug("log","[uibuilder:logon] ",n._auth))):void 0},n.logoff=function(e,t){if(n.security)return void 0!==n._auth||void 0!==e?(void 0===e&&(e=n._auth),void 0===e.id||null===e.id||0===e.id.length?void console.error("[uibuilder:logoff] No logoff id supplied, ignoring request."):void(!e.info&&(e.info=n.dummyAuth.info),n._auth=e,t||n.send({uibuilderCtrl:"logoff",from:"client",_auth:n._auth},n.ioChannels.control))):void 0},n.updateAuth=function(e){if(n.security)return void 0!==n._auth||void 0!==e?(void 0===e&&(e=n._auth),e.info&&e.info.error?(n.showToast({_uib:{options:{title:"[uibuilder:updateAuth] Error from Server",variant:"danger",noAutoHide:!0}},payload:`${e.info.error}<br>No authentication.`}),void console.warn("[uibuilder:updateAuth] Error from Server: ",e.info.error)):void 0===e.id||null===e.id||0===e.id.length?(n.showToast({_uib:{options:{title:"[uibuilder:updateAuth] No auth id supplied by server",variant:"danger",noAutoHide:!0}},payload:"Ignoring server response<br>No authentication."}),void console.error("[uibuilder:updateAuth] No auth id supplied by server, ignoring server response.")):void(!e.info&&(e.info=n.dummyAuth.info),e.userValidated&&e.jwt&&!0===e.info.validJwt&&new Date(e.sessionExpiry)>new Date?(n.set("isAuthorised",!0),n.set("_auth",e)):n.markLoggedOut("Logon succeeded but user not valid or no token received, logged out"))):void 0},n.sendAuth=function(){if(n.security)try{return void 0===n._auth?void 0:n.isAuthorised?new Date(n._auth.sessionExpiry)>new Date?n._auth:(n.markLoggedOut("Automatically logged off. Token expired"),n._auth):n._auth}catch(t){return void console.error("[uibuilderfe:sendAuth] Failed to validate auth. Error: ",t.message)}},n.send=function(t,o){(null===o||void 0===o)&&(o=n.ioChannels.client),!n.security||n.isAuthorised||o===n.ioChannels.control&&"logon"===t.uibuilderCtrl||console.error("[uibuilder:send] Message not sent. Security is on but client not authorised - can only send a logon control msg",t,o),n.uiDebug("log","uibuilderfe: sending msg - Namespace: "+n.ioNamespace+", Channel: "+o,t),o===n.ioChannels.client?t=e(t,"payload"):o===n.ioChannels.control&&(t=e(t,"uibuilderCtrl"),!t.hasOwnProperty("uibuilderCtrl")&&(t.uibuilderCtrl="manual send"),t.from="client"),t._socketId=n.socket.id,t._auth=n.sendAuth(),o===n.ioChannels.client?(n.set("sentMsg",t),n.set("msgsSent",n.msgsSent+1)):o===n.ioChannels.control&&(n.set("sentCtrlMsg",t),n.set("msgsSentCtrl",n.msgsSentCtrl+1)),n.socket.emit(o,t)},n.onChange=function(e,t){n.events[e]?n.events[e].push(t):n.events[e]=[t]},n.clearEventListeners=function(){n.events=[]},n.events={},n.emit=function(e){var t=n.events[e];if(t)for(var o=Array.prototype.slice.call(arguments,1),u=0;u<t.length;u++)t[u].apply(n,o)},n.newScript=function(e){if(!0===n.allowScript&&""!==e&&"undefined"!=typeof e){n.uiDebug("log","uibuilderfe: newCode - script: "+e);var t=document.createElement("script");t.type="text/javascript",t.defer=!0,t.textContent=e,document.getElementsByTagName("body")[0].appendChild(t)}},n.newStyle=function(e){if(!0===n.allowStyle&&""!==e&&"undefined"!=typeof e){n.uiDebug("log","uibuilderfe: newStyle - style: "+e);var t=document.createElement("style");t.textContent=e,document.getElementsByTagName("head")[0].appendChild(t)}},n.showToast=function(e){if(!n.vueApp)return void console.warn("[uibuilder:toast] Vue app object not available, cannot create a toast");if(!n.vueApp.$bvToast)return void console.warn("[uibuilder:toast] bootstrap-vue toast component not available, cannot create a toast");if(!e._uib||null===e._uib||"Object"!==e._uib.constructor.name)return void console.warn("[uibuilder:toast] Incoming msg requires msg._uib object, cannot create a toast");const t=n.vueApp.$createElement;let o={};e._uib.options&&(o=Object.assign({},e._uib.options));let i="";e.payload&&(i+=e.payload),o.content&&(i+=o.content);const u=t("p",{domProps:{innerHTML:i}});return o.title&&(o.title=t("p",{domProps:{innerHTML:o.title}})),o.append&&(o.appendToast=o.append),o.autoHideDelay&&(o.autohide=!0,o.delay=o.autoHideDelay),""===i?void console.warn("[uibuilder:toast] Toast content is blank. Not shown."):void n.vueApp.$bvToast.toast(u,o)},n.showAlert=function(){},n.showComponentDetails=function(e){if(!n.vueApp)return;if(!n.vueApp.$refs[e])return;let t=n.vueApp.$refs[e],o={};if(t.$options)o={uibuilderCtrl:"vue component details",componentDetails:{ref:e,tag:t.$options._componentTag,props:t.$options._propKeys}};else{let t=`[uibuilderfe:showComponentDetails] ref="${e}" is not a Vue Component. Details cannot be returned.`;n.uiDebug("warn",t),o={uibuilderCtrl:"vue component details",componentDetails:{warning:t,ref:e,tag:null,props:null}}}return o},n.onChange("msg",function(e){if(!n.vueApp)return;if(!e._uib)return;if(!0===e._uib.reload&&(console.log("reloading"),location.reload()),!e._uib.componentRef)return;let t=n.vueApp,o=e._uib.componentRef;if(e._uib.requestDetails){let t=n.showComponentDetails(o);return void(t&&(e.topic&&(t.topic=e.topic),n.send(t,n.ioChannels.control)))}if("globalNotification"===o)return void n.showToast(e);if("globalAlert"===o)return void n.showAlert(e);if(!(o in t.$refs)){let t=`[uibuilderfe:internal:onChange] ref="${o}" is not a Vue Component. Cannot set props.`;n.uiDebug("warn",t);let i={uibuilderCtrl:"vue component details",componentDetails:{warning:t,ref:o,tag:null,props:null}};e.topic&&(i.topic=e.topic),n.send(i,n.ioChannels.control)}else if(e._uib.options&&(n.uiDebug("log","\uD83D\uDD22\uD83D\uDCC8 new component instance options received for ref",o,":",e._uib.options),Object.keys(e._uib.options).forEach(function(i){try{t.$set(t.$refs[o],i,e._uib.options[i])}catch(t){n.uiDebug("warn",`[uibuilderfe:internal:onChange] Could not update prop "${i}" for component ref="${o}". Error: ${t.message}`)}})),e.payload){n.uiDebug("log","\uD83D\uDD22\uD83D\uDCC8 new component instance value received for ref",o,":",e.payload);try{t.$refs[o].$props.config.value=e.payload}catch(t){}}}),n.uiReturn={set:function(e,t){if(-1!==["autoSendReady","ctrlMsg","debug","events","httpNodeRoot","ioChannels","ioConnected","ioNamespace","ioPath","ioTransport","isAuthorised","isUnminified","loaded","msgsCtrl","msgsReceived","msgsSent","msgsSentCtrl","moduleName","retryFactor","retryMs","sentMsg","sentCtrlMsg","serverTimeOffset","socket","timerid","url","version","checkConnect","checkTimestamp","emit","get","ioSetup","logon","logoff","markLoggedOut","me","newScript","newStyle","onChange","self","set","send","sendAuth","sendCtrl","setIOnamespace","showComponentDetails","showToast","socket","uiDebug","updateAuth","uiReturn"].indexOf(e))return console.warn("[uibuilder:set] Cannot use set() on protected property \""+e+"\""),void n.uiDebug("warn","uibuilderfe:uibuilder:set: \""+e+"\" is in list of excluded properties, not set");if("_auth"===e){if(!t.id||0===t.id.length)return void console.warn("[uibuilder:set] _auth must contain a valid _auth.id property");t.info||(t.info=n.dummyAuth.info)}n.set(e,t)},get:function(e){return-1===["checkConnect","checkTimestamp","emit","get","ioSetup","logon","logoff","markLoggedOut","me","newScript","newStyle","onChange","self","set","send","sendAuth","sendCtrl","setIOnamespace","showComponentDetails","showToast","socket","uiDebug","updateAuth","uiReturn"].indexOf(e)?(void 0===n[e]&&console.warn("[uibuilder] get() - property \""+e+"\" does not exist"),n[e]):(console.warn("[uibuilder] Cannot use get() on protected property \""+e+"\""),void n.uiDebug("warn","uibuilderfe:uibuilder:get: \""+e+"\" is in list of excluded properties, not get"))},onChange:n.onChange,clearEventListeners:n.clearEventListeners,msg:n.msg,send:n.send,sendCtrl:function(e){n.send(e,n.ioChannels.control)},autoSendReady:function(e){!0!==e&&(e=!1),n.autoSendReady=e},debug:function(e){return"undefined"==typeof e?n.debug:void("boolean"==typeof e&&(n.debug=e))},uiDebug:n.uiDebug,me:n.me,start:function(e,t,o){return!0===n.started?void n.uiDebug("log","\u274C [uibuilderfe:start] Start function already called. Do not call more than once."):void(n.uiDebug("log","[uibuilderfe:start] start() called"),"[object Object]"===toString.call(e)?(n.uiDebug("log","\u2705 [uibuilderfe:start] namespace IS an object!"),!0===e._isVue?(n.uiDebug("log","\u2705 [uibuilderfe:start] Vue instance object IS available!"),o=e,e=void 0):(e.ioPath&&(t=e.ioPath),e.vueApp&&(o=e.vueApp),e=e.namespace?e.namespace:void 0)):o?"[object Object]"===toString.call(o)&&!0===o._isVue?n.uiDebug("log","\u2705 [uibuilderfe:start] Vue instance object IS available!"):(n.uiDebug("log","\u274C [uibuilderfe:start] Vue instance object not available!"),o=void 0):n.uiDebug("log","\u274C [uibuilderfe:start] app1 not available!"),n.uiDebug("log","[uibuilderfe:start] Calling params - namespace",e,"ioPath",t,"vueApp",o),void 0!==e&&null!==e&&(n.ioNamespace=e),void 0!==t&&null!==t&&(n.ioPath=t),void 0!==o&&null!==o&&(n.vueApp=o),n.uiDebug("log","[uibuilderfe:start] Final Socket.IO params - namespace",e,"ioPath",t),n.ioSetup(),n.started=!0)},logon:n.logon,logoff:n.logoff,showComponentDetails:n.showComponentDetails,showToast:function(e,t="globalNotification",o={}){n.showToast({_uib:{componentRef:t,options:o},payload:e})},eventSend:function(e){if(!e.constructor.name.endsWith("Event")||!e.currentTarget)return void n.uiDebug("log","[uibuilderfe:eventSend] ARGUMENT NOT A DOM EVENT - use data attributes not function arguments to pass data");const t=e.currentTarget;let o="";try{""!==t.textContent&&(o=t.textContent.substring(0,25))}catch(t){}try{""!==t.name&&(o=t.name)}catch(t){}try{""!==t.id&&(o=t.id)}catch(t){}n.send({topic:n.msg.topic,uibDomEvent:{sourceId:o,event:e.type},payload:t.dataset})},automap:n.automap},window.addEventListener("load",function(){n.uiDebug("debug","uibuilderfe:load: All resources loaded"),n.loaded=!0}),n.uiReturn}.call(o);n.noConflict=function(){return o.uibuilder=i,n},"undefined"==typeof exports?o.uibuilder=n:("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.uibuilder=n)}).call(this);