"use strict";var io;"undefined"!=typeof require&&void 0===io&&(io=require("socket.io-client")),function(){var e=this,t=e.uibuilder;function o(e,t){"string"!=typeof(t=null==t?"payload":t)&&(console.warn("[uibuilderfe:makeMeAnObject] WARNING: property parameter must be a string and not: "+typeof t),t="payload");var o={};return"object"==typeof e?o=e:null!==e&&(o[t]=e),o}var i=function(){String.prototype.endsWith||(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});var n=this;n.version="4.2.0",n.moduleName="uibuilder",n.isUnminified=/param/.test(function(e){}),n.debug=!0===n.isUnminified,n.security=!1,n.dummyAuth={id:"anonymous",jwt:void 0,sessionExpiry:void 0,userValidated:!1,info:{error:void 0,message:void 0,validJwt:void 0}},n._auth=n.dummyAuth,n.started=!1,n.uiDebug=function(){n.debug&&console[arguments[0]].apply(console,[].slice.call(arguments,1))},n.me=function(){return!0===n.debug?n:"uibuilderfe.js Version: "+n.version},n.uiDebug("log","\nuibuilderfe: Debug? ",n.debug,"\n\t\tVersion? ",n.version,"\n\t\tRunning Packed version? ",!n.isUnminified,"\n "),n.setIOnamespace=function(){var e,t="";try{t=document.cookie.match(/uibuilder-namespace\s*=.*?\s*;/g)[0].replace("uibuilder-namespace=","").replace(";","")}catch(e){}return""===t?(0<(e=window.location.pathname.split("/").filter(function(e){return""!==e.trim()})).length&&e[e.length-1].endsWith(".html")&&e.pop(),t=e.pop(),n.uiDebug("log","uibuilderfe: IO Namespace - Found via url path: "+t)):n.uiDebug("log","uibuilderfe: IO Namespace - Found via cookie: "+t),n.uiDebug("log","uibuilderfe: IO Namespace: "+(t="/"+t)),t},n.autoSendReady=!0,n.allowScript=!0,n.allowStyle=!0,n.removeScript=!0,n.removeStyle=!0,n.msg={},n.ctrlMsg={},n.sentMsg={},n.sentCtrlMsg={},n.msgsSent=0,n.msgsReceived=0,n.msgsSentCtrl=0,n.msgsCtrl=0,n.ioConnected=!1,n.serverTimeOffset=null,n.isAuthorised=!1,n.authTokenExpiry=null,n.authData={},n.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},n.retryMs=2e3,n.retryFactor=1.5,n.timerid=null,n.ioNamespace=n.setIOnamespace(),n.ioTransport=["polling","websocket"],n.loaded=!1,n.authToken="";var e=window.location.pathname.split("/").filter(function(e){return""!==e.trim()});return 0<e.length&&e[e.length-1].endsWith(".html")&&e.pop(),n.url=e.pop(),n.httpNodeRoot="/"+e.join("/"),n.ioPath=function(){return("/"+Array.prototype.slice.call(arguments).map(function(e){return e.replace(/^\/|\/$/g,"")}).filter(function(e){return e}).join("/")).replace("//","/")}(n.httpNodeRoot,n.moduleName,"vendor","socket.io"),n.uiDebug("debug","uibuilderfe: ioPath: "+n.ioPath+", httpNodeRoot: "+n.httpNodeRoot+", uibuilder url (not used): "+n.url),n.set=function(e,t){n[e]=t,n.uiDebug("debug","uibuilderfe: prop set - prop: "+e+", val: "+("object"==typeof t?JSON.stringify(t):t)),n.emit(e,t)},n.checkConnect=function(e,t){n.uiDebug("debug","uibuilderfe:checkConnect. Reconnect - Depth: 1, Delay: "+e+", Factor: "+t,n.ioNamespace,n.ioPath),n.timerid&&window.clearTimeout(n.timerid),n.timerid=window.setTimeout(function(){n.uiDebug("debug","uibuilderfe:checkConnect timeout. SIO reconnect attempt, timeout: "+e+", depth: 1",n.ioNamespace,n.ioPath),console.info("[uibuilderfe:checkConnect:setTimeout] Socket.IO reconnection attempt. Current delay: "+e),n.socket.close(),n.socket.connect(),n.timerid=null,n.checkConnect(e*t,t)},e)},n.checkTimestamp=function(e){Object.prototype.hasOwnProperty.call(e,"serverTimestamp")&&(e=new Date(e.serverTimestamp),(e=Math.round((new Date-e)/36e5))!==n.serverTimeOffset&&(n.set("serverTimeOffset",e),n.uiDebug("log","uibuilderfe:"+n.ioChannels.server+" (server): Offset changed to: "+e)))},n.ioSetup=function(){n.uiDebug("debug","uibuilderfe:ioSetup: About to create IO. Namespace: "+n.ioNamespace+", Path: "+n.ioPath+", Transport: ["+n.ioTransport.join(", ")+"]"),n.socketOptions={path:n.ioPath,transports:n.ioTransport,transportOptions:{polling:{extraHeaders:{"x-clientid":"uibuilderfe"}}}},n.socket=io(n.ioNamespace,n.socketOptions),n.socket.on("connect",function(){n.uiDebug("info","uibuilderfe:ioSetup: SOCKET CONNECTED - Namespace: "+n.ioNamespace," Server Channel: ",n.ioChannels.server," Control Channel: ",n.ioChannels.control),n.set("ioConnected",!0),n.timerid&&(window.clearTimeout(n.timerid),n.timerid=null)}),n.socket.on(n.ioChannels.server,function(e){n.uiDebug("info","uibuilderfe:ioSetup:"+n.ioChannels.server+" (server): msg received - Namespace: "+n.ioNamespace,e),e=o(e,"payload"),n.checkTimestamp(e),e._auth&&n.updateAuth(e._auth),n.allowScript&&Object.prototype.hasOwnProperty.call(e,"script")&&(n.newScript(e.script),n.removeScript&&delete e.script),n.allowStyle&&Object.prototype.hasOwnProperty.call(e,"style")&&(n.newStyle(e.style),n.removeStyle&&delete e.style),n.set("msg",e),n.set("msgsReceived",n.msgsReceived+1)}),n.socket.on(n.ioChannels.control,function(e){var t;switch(n.uiDebug("debug","[uibuilder:ioSetup:on-ctrl-recvd] "+n.ioChannels.control+" (control): msg received - Namespace: "+n.ioNamespace,e),null===e?e={}:"object"!=typeof e&&((t={})["uibuilderCtrl:"+n.ioChannels.control]=e,e=t),Object.prototype.hasOwnProperty.call(e,"debug")&&(n.debug=e.debug),Object.prototype.hasOwnProperty.call(e,"security")&&(n.security=e.security,n.uiDebug("warn",`[uibuilderfe:ioSetup:on-ctrl-recvd] Security is ${n.security}`)),n.checkTimestamp(e),n.set("ctrlMsg",e),n.set("msgsCtrl",n.msgsCtrl+1),e.uibuilderCtrl){case"ready for content":e._auth&&n.updateAuth(e._auth),n.uiDebug("info","uibuilderfe:ioSetup:"+n.ioChannels.control+' Received "ready for content" from server');break;case"shutdown":n.uiDebug("info","uibuilderfe:ioSetup:"+n.ioChannels.control+' Received "shutdown" from server'),n.set("serverShutdown",void 0);break;case"client connect":e._auth&&n.updateAuth(e._auth,"init"),!0===n.autoSendReady&&(n.uiDebug("info","uibuilderfe:ioSetup:"+n.ioChannels.control+' Received "client connect" from server, auto-sending REPLAY control msg'),n.send({uibuilderCtrl:"ready for content",cacheControl:"REPLAY"},n.ioChannels.control));break;case"authorised":n.uiDebug("info","uibuilderfe:ioSetup:"+n.ioChannels.control+' Received "authorised" from server'),e._auth?n.updateAuth(e._auth):(n.uiDebug("debug","uibuilderfe:ioSetup:"+n.ioChannels.control+' Received "authorised" from server but without a _auth property - logon failed'),n.markLoggedOut("Logon succeeded but no _auth received, logged out"));break;case"authorisation failure":n.uiDebug("info","uibuilderfe:ioSetup:"+n.ioChannels.control+' Received "authorisation failure" from server'),n.markLoggedOut("Logon authorisation failure",e._auth.authData);break;case"logged off":n.uiDebug("info","uibuilderfe:ioSetup:"+n.ioChannels.control+' Received "logged off" from server'),n.markLoggedOut("Logged off by logout() request",e._auth);break;default:n.uiDebug("info","uibuilderfe:ioSetup:"+n.ioChannels.control+' Received "'+e.uibuilderCtrl+'" from server'),e._auth&&n.updateAuth(e._auth)}}),n.socket.on("disconnect",function(e){n.uiDebug("info","uibuilderfe:ioSetup: SOCKET DISCONNECTED - Namespace: "+n.ioNamespace+", Reason: "+e),n.set("ioConnected",!1),console.warn("[uibuilderfe:socket-disconnect] Reason: "+e),n.checkConnect(n.retryMs,n.retryFactor)}),n.socket.on("connect_error",function(e){n.uiDebug("error","uibuilderfe:ioSetup: SOCKET CONNECT ERROR - Namespace: "+n.ioNamespace+" ioPath: "+n.ioPath+", Reason: "+e.message)}),n.socket.on("error",function(e){n.uiDebug("warn","uibuilderfe:ioSetup: SOCKET ERROR from server - MESSAGE: ",e),n.set("socketError",e)}),n.checkConnect(n.retryMs,n.retryFactor)},n.markLoggedOut=function(e,t){void 0===n._auth&&void 0===t||(t=n.dummyAuth,void 0!==e&&(n._auth.info.message=e),n.set("isAuthorised",!1),n.set("_auth",t))},n.logon=function(e,t){n.security&&(void 0===n._auth&&void 0===e||(void 0!==(e=void 0===e?n._auth:e).id&&null!==e.id&&0!==e.id.length?(e.info||(e.info=n.dummyAuth.info),n.set("_auth",e),t||n.send({uibuilderCtrl:"logon",from:"client",_auth:n._auth},n.ioChannels.control),n.uiDebug("log","[uibuilder:logon] ",n._auth)):console.error("[uibuilder:logon] No logon id supplied, ignoring request.")))},n.logoff=function(e,t){n.security&&(void 0===n._auth&&void 0===e||(void 0!==(e=void 0===e?n._auth:e).id&&null!==e.id&&0!==e.id.length?(e.info||(e.info=n.dummyAuth.info),n._auth=e,t||n.send({uibuilderCtrl:"logoff",from:"client",_auth:n._auth},n.ioChannels.control)):console.error("[uibuilder:logoff] No logoff id supplied, ignoring request.")))},n.updateAuth=function(e,t){if(n.security&&(void 0!==n._auth||void 0!==e)&&(void 0===e&&(e=n._auth),"init"!==t))return e.info&&e.info.error?(n.showToast({_uib:{options:{title:"[uibuilder:updateAuth] Error from Server",variant:"danger",noAutoHide:!0}},payload:`${e.info.error}<br>No authentication.`}),void console.warn("[uibuilder:updateAuth] Error from Server: ",e.info.error)):void 0===e.id||null===e.id||0===e.id.length?(n.showToast({_uib:{options:{title:"[uibuilder:updateAuth] No auth id supplied by server",variant:"danger",noAutoHide:!0}},payload:"Ignoring server response<br>No authentication."}),void console.error("[uibuilder:updateAuth] No auth id supplied by server, ignoring server response.")):(e.info||(e.info=n.dummyAuth.info),void(e.userValidated&&e.jwt&&!0===e.info.validJwt&&new Date(e.sessionExpiry)>new Date?(n.set("isAuthorised",!0),n.set("_auth",e)):n.markLoggedOut("Logon succeeded but user not valid or no token received, logged out")))},n.sendAuth=function(){if(n.security)try{return void 0===n._auth?void 0:(n.isAuthorised&&(new Date(n._auth.sessionExpiry)>new Date||n.markLoggedOut("Automatically logged off. Token expired")),n._auth)}catch(e){return void console.error("[uibuilderfe:sendAuth] Failed to validate auth. Error: ",e.message)}},n.send=function(e,t){null==t&&(t=n.ioChannels.client),n.uiDebug("log","uibuilderfe: sending msg - Namespace: "+n.ioNamespace+", Channel: "+t,e),t===n.ioChannels.client?e=o(e,"payload"):t===n.ioChannels.control&&(e=o(e,"uibuilderCtrl"),Object.prototype.hasOwnProperty.call(e,"uibuilderCtrl")||(e.uibuilderCtrl="manual send"),e.from="client"),e._socketId=n.socket.id,e._auth=n.sendAuth(),t===n.ioChannels.client?(n.set("sentMsg",e),n.set("msgsSent",n.msgsSent+1)):t===n.ioChannels.control&&(n.set("sentCtrlMsg",e),n.set("msgsSentCtrl",n.msgsSentCtrl+1)),n.socket.emit(t,e)},n.onChange=function(e,t){n.events[e]?n.events[e].push(t):n.events[e]=[t]},n.clearEventListeners=function(){n.events=[]},n.events={},n.emit=function(e){var t=n.events[e];if(t)for(var o=Array.prototype.slice.call(arguments,1),i=0;i<t.length;i++)t[i].apply(n,o)},n.newScript=function(e){var t;!0===n.allowScript&&""!==e&&void 0!==e&&(n.uiDebug("log","uibuilderfe: newCode - script: "+e),(t=document.createElement("script")).type="text/javascript",t.defer=!0,t.textContent=e,document.getElementsByTagName("body")[0].appendChild(t))},n.newStyle=function(e){var t;!0===n.allowStyle&&""!==e&&void 0!==e&&(n.uiDebug("log","uibuilderfe: newStyle - style: "+e),(t=document.createElement("style")).textContent=e,document.getElementsByTagName("head")[0].appendChild(t))},n.showToast=function(o){if(n.vueApp)if(n.vueApp.$bvToast)if(o._uib&&null!==o._uib&&"Object"===o._uib.constructor.name){const i=n.vueApp.$createElement;let e={};o._uib.options&&(e=Object.assign({},o._uib.options));let t="";o.payload&&(t+=o.payload),e.content&&(t+=e.content);o=i("p",{domProps:{innerHTML:t}});e.title&&(e.title=i("p",{domProps:{innerHTML:e.title}})),e.append&&(e.appendToast=e.append),e.autoHideDelay&&(e.autohide=!0,e.delay=e.autoHideDelay),""!==t?n.vueApp.$bvToast.toast(o,e):console.warn("[uibuilder:toast] Toast content is blank. Not shown.")}else console.warn("[uibuilder:toast] Incoming msg requires msg._uib object, cannot create a toast");else console.warn("[uibuilder:toast] bootstrap-vue toast component not available, cannot create a toast");else console.warn("[uibuilder:toast] Vue app object not available, cannot create a toast")},n.showAlert=function(){},n.showComponentDetails=function(t){if(n.vueApp&&n.vueApp.$refs[t]){var o=n.vueApp.$refs[t];let e={};return e=o.$options?{uibuilderCtrl:"vue component details",componentDetails:{ref:t,tag:o.$options._componentTag,props:o.$options._propKeys}}:(n.uiDebug("warn",o=`[uibuilderfe:showComponentDetails] ref="${t}" is not a Vue Component. Details cannot be returned.`),{uibuilderCtrl:"vue component details",componentDetails:{warning:o,ref:t,tag:null,props:null}}),e}},n.onChange("msg",function(i){if(n.vueApp&&i._uib&&(!0===i._uib.reload&&(console.log("reloading"),location.reload()),i._uib.componentRef)){let e=n.vueApp,o=i._uib.componentRef;if(i._uib.requestDetails){let e=n.showComponentDetails(o);e&&(i.topic&&(e.topic=i.topic),n.send(e,n.ioChannels.control))}else if("globalNotification"!==o)if("globalAlert"!==o)if(o in e.$refs){if(i._uib.options&&(n.uiDebug("log","🔢📈 new component instance options received for ref",o,":",i._uib.options),Object.keys(i._uib.options).forEach(function(t){try{e.$set(e.$refs[o],t,i._uib.options[t])}catch(e){n.uiDebug("warn",`[uibuilderfe:internal:onChange] Could not update prop "${t}" for component ref="${o}". Error: ${e.message}`)}})),i.payload){n.uiDebug("log","🔢📈 new component instance value received for ref",o,":",i.payload);try{e.$refs[o].$props.config.value=i.payload}catch(e){}}}else{var t=`[uibuilderfe:internal:onChange] ref="${o}" is not a Vue Component. Cannot set props.`;n.uiDebug("warn",t);let e={uibuilderCtrl:"vue component details",componentDetails:{warning:t,ref:o,tag:null,props:null}};i.topic&&(e.topic=i.topic),n.send(e,n.ioChannels.control)}else n.showAlert(i);else n.showToast(i)}}),n.uiReturn={set:function(e,t){if(-1!==["autoSendReady","ctrlMsg","debug","events","httpNodeRoot","ioChannels","ioConnected","ioNamespace","ioPath","ioTransport","isAuthorised","isUnminified","loaded","msgsCtrl","msgsReceived","msgsSent","msgsSentCtrl","moduleName","retryFactor","retryMs","sentMsg","sentCtrlMsg","serverTimeOffset","socket","timerid","url","version","checkConnect","checkTimestamp","emit","get","ioSetup","logon","logoff","markLoggedOut","me","newScript","newStyle","onChange","self","set","send","sendAuth","sendCtrl","setIOnamespace","showComponentDetails","showToast","socket","uiDebug","updateAuth","uiReturn"].indexOf(e))return console.warn('[uibuilder:set] Cannot use set() on protected property "'+e+'"'),void n.uiDebug("warn",'uibuilderfe:uibuilder:set: "'+e+'" is in list of excluded properties, not set');if("_auth"===e){if(!t.id||0===t.id.length)return void console.warn("[uibuilder:set] _auth must contain a valid _auth.id property");t.info||(t.info=n.dummyAuth.info)}n.set(e,t)},get:function(e){return-1!==["checkConnect","checkTimestamp","emit","get","ioSetup","logon","logoff","markLoggedOut","me","newScript","newStyle","onChange","self","set","send","sendAuth","sendCtrl","setIOnamespace","showComponentDetails","showToast","socket","uiDebug","updateAuth","uiReturn"].indexOf(e)?(console.warn('[uibuilder] Cannot use get() on protected property "'+e+'"'),void n.uiDebug("warn",'uibuilderfe:uibuilder:get: "'+e+'" is in list of excluded properties, not get')):(void 0===n[e]&&console.warn('[uibuilder] get() - property "'+e+'" does not exist'),n[e])},onChange:n.onChange,clearEventListeners:n.clearEventListeners,msg:n.msg,send:n.send,sendCtrl:function(e){n.send(e,n.ioChannels.control)},autoSendReady:function(e){n.autoSendReady=e=!0!==e?!1:e},debug:function(e){if(void 0===e)return n.debug;"boolean"==typeof e&&(n.debug=e)},uiDebug:n.uiDebug,me:n.me,start:function(e,t,o){!0!==n.started?(n.uiDebug("log","[uibuilderfe:start] start() called"),"[object Object]"===toString.call(e)?(n.uiDebug("log","✅ [uibuilderfe:start] namespace IS an object!"),e=!0===e._isVue?(n.uiDebug("log","✅ [uibuilderfe:start] Vue instance object IS available!"),void(o=e)):(e.ioPath&&(t=e.ioPath),e.vueApp&&(o=e.vueApp),e.namespace||void 0)):o?"[object Object]"===toString.call(o)&&!0===o._isVue?n.uiDebug("log","✅ [uibuilderfe:start] Vue instance object IS available!"):(n.uiDebug("log","❌ [uibuilderfe:start] Vue instance object not available!"),o=void 0):n.uiDebug("log","❌ [uibuilderfe:start] Vue app not available!"),n.uiDebug("log","[uibuilderfe:start] Calling params - namespace",e,"ioPath",t,"vueApp",o),null!=e&&(n.ioNamespace=e),null!=t&&(n.ioPath=t),null!=o&&(n.vueApp=o),n.uiDebug("log","[uibuilderfe:start] Final Socket.IO params - namespace",e,"ioPath",t),n.ioSetup(),n.started=!0):n.uiDebug("log","❌ [uibuilderfe:start] Start function already called. Do not call more than once.")},logon:n.logon,logoff:n.logoff,showComponentDetails:n.showComponentDetails,showToast:function(e,t="globalNotification",o={}){n.showToast({_uib:{componentRef:t,options:o},payload:e})},eventSend:function(t){if(t.constructor.name.endsWith("Event")&&t.currentTarget){const o=t.currentTarget;let e="";try{""!==o.textContent&&(e=o.textContent.substring(0,25))}catch(e){}try{""!==o.name&&(e=o.name)}catch(e){}try{""!==o.id&&(e=o.id)}catch(e){}n.send({topic:n.msg.topic,uibDomEvent:{sourceId:e,event:t.type},payload:o.dataset})}else n.uiDebug("log","[uibuilderfe:eventSend] ARGUMENT NOT A DOM EVENT - use data attributes not function arguments to pass data")},automap:n.automap},window.addEventListener("load",function(){n.uiDebug("debug","uibuilderfe:load: All resources loaded"),n.loaded=!0}),n.uiReturn}.call(e);i.noConflict=function(){return e.uibuilder=t,i},"undefined"!=typeof exports?(exports="undefined"!=typeof module&&module.exports?module.exports=i:exports).uibuilder=i:e.uibuilder=i}.call(this);