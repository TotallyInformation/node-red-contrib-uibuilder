{
  "version": 3,
  "sources": ["src/front-end-module/ui.js"],
  "sourcesContent": ["/* Creates HTML UI's based on a standardised data input.\n  Works stand-alone, with uibuilder or with Node.js/jsdom.\n  See: https://totallyinformation.github.io/node-red-contrib-uibuilder/#/client-docs/config-driven-ui\n\n  Author: Julian Knight (Totally Information), March 2023\n  \n  License: Apache 2.0\n  Copyright (c) 2022-2023 Julian Knight (Totally Information)\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n  http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n */\n/* globals module:true */\n\n// Namespaces - See https://stackoverflow.com/a/52572048/1309986\n// const NAMESPACES = {\n//     svg: 'http://www.w3.org/2000/svg',\n//     html: 'http://www.w3.org/1999/xhtml',\n//     xml: 'http://www.w3.org/XML/1998/namespace',\n//     xlink: 'http://www.w3.org/1999/xlink',\n//     xmlns: 'http://www.w3.org/2000/xmlns/' // sic for the final slash...\n// }\n\nconst Ui = class Ui {\n    version = '6.8.2-src'\n\n    // List of tags and attributes not in sanitise defaults but allowed in uibuilder.\n    sanitiseExtraTags = ['uib-var']\n    sanitiseExtraAttribs = ['variable', 'report', 'undefined']\n\n    // Reference to DOM window - must be passed in the constructor\n    // Allows for use of this library/class with `jsdom` in Node.JS as well as the browser.\n    window\n\n    /** Log function - passed in constructor or will be a dummy function\n     * @type {function}\n     */\n    static log\n\n    /** Called when `new Ui(...)` is called\n     * @param {globalThis} win Either the browser global window or jsdom dom.window\n     * @param {function} [extLog] A function that returns a function for logging\n     * @param {function} [jsonHighlight] A function that returns a highlighted HTML of JSON input\n     */\n    constructor(win, extLog, jsonHighlight) {\n        // window must be passed in as an arg to the constructor\n        // Should either be the global window for a browser or `dom.window` for jsdom in Node.js\n        if (win) this.window = win\n        else {\n            // Ui.log(0, 'Ui:constructor', 'Current environment does not include `window`, UI functions cannot be used.')()\n            // return\n            throw new Error('Ui:constructor. Current environment does not include `window`, UI functions cannot be used.')\n        }\n\n        // For convenience\n        this.document = this.window.document\n\n        // If a suitable function not passed in, create a dummy one\n        if (extLog) Ui.log = extLog\n        else Ui.log = function(){return function(){}}\n\n        // If a JSON HTML highlighting function passed then use it, else a dummy fn\n        if (jsonHighlight) this.syntaxHighlight = jsonHighlight\n        else this.syntaxHighlight = function(){}\n    }\n\n    //#region ---- Internal Methods ----\n\n    /** Show a browser notification if the browser and the user allows it\n     * @param {object} config Notification config data\n     * @returns {Promise} Resolves on close or click event, returns the event.\n     */\n    _showNotification(config) {\n        if ( config.topic && !config.title ) config.title = config.topic\n        if ( !config.title ) config.title = 'uibuilder notification'\n        if ( config.payload && !config.body ) config.body = config.payload\n        if ( !config.body ) config.body = ' No message given.'\n        // Wrap in try/catch since Chrome Android may throw an error\n        try {\n            const notify = new Notification(config.title, config)\n            return new Promise( (resolve, reject) => {\n                // Doesn't ever seem to fire (at least in Chromium)\n                notify.addEventListener('close', ev => {\n                    ev.currentTarget.userAction = 'close'\n                    resolve(ev)\n                })\n                notify.addEventListener('click', ev => {\n                    ev.currentTarget.userAction = 'click'\n                    resolve(ev)\n                })\n                notify.addEventListener('error', ev => {\n                    ev.currentTarget.userAction = 'error'\n                    reject(ev)\n                })\n            })\n        } catch (e) {\n            return Promise.reject(new Error('Browser refused to create a Notification'))\n        }\n    }\n\n    // Vue dynamic inserts Don't really work ...\n    // _uiAddVue(ui, isRecurse) {\n\n    //     // must be Vue\n    //     // must have only 1 root element\n    //     const compToAdd = ui.components[0]\n    //     const newEl = this.document.createElement(compToAdd.type)\n\n    //     if (!compToAdd.slot && ui.payload) compToAdd.slot = ui.payload\n    //     this._uiComposeComponent(newEl, compToAdd)\n\n    //     // If nested components, go again - but don't pass payload to sub-components\n    //     if (compToAdd.components) {\n    //         this._uiExtendEl(newEl, compToAdd.components)\n    //     }\n\n    //     console.log('MAGIC: ', this.magick, newEl, newEl.outerHTML)()\n    //     this.set('magick', newEl.outerHTML)\n\n    //     // if (compToAdd.id) newEl.setAttribute('ref', compToAdd.id)\n    //     // if (elParent.id) newEl.setAttribute('data-parent', elParent.id)\n    // }\n\n    // TODO Add check if ID already exists\n    // TODO Allow single add without using components array\n    /** Handle incoming msg._ui add requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     * @param {boolean} isRecurse Is this a recursive call?\n     */\n    _uiAdd(ui, isRecurse) {\n        Ui.log('trace', 'Ui:_uiManager:add', 'Starting _uiAdd')()\n\n        // Vue dynamic inserts Don't really work ...\n        // if (this.#isVue && !isRecurse) {\n        //     this._uiAddVue(ui, false)\n        //     return\n        // }\n\n        ui.components.forEach((compToAdd, i) => {\n            Ui.log('trace', `Ui:_uiAdd:components-forEach:${i}`, 'Component to add: ', compToAdd)()\n\n            /** @type {*} Create the new component - some kind of HTML element */\n            let newEl\n            switch (compToAdd.type) {\n                // If trying to insert raw html, wrap in a div\n                case 'html': {\n                    compToAdd.ns = 'html'\n                    newEl = this.document.createElement('div')\n                    break\n                }\n\n                // If trying to insert raw svg, need to create in namespace\n                case 'svg': {\n                    compToAdd.ns = 'svg'\n                    newEl = this.document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n                    break\n                }\n\n                default: {\n                    compToAdd.ns = 'dom'\n                    newEl = this.document.createElement(compToAdd.type)\n                    break\n                }\n            }\n\n            if (!compToAdd.slot && ui.payload) compToAdd.slot = ui.payload\n\n            // const parser = new DOMParser()\n            // const newDoc = parser.parseFromString(compToAdd.slot, 'text/html')\n            // console.log(compToAdd, newDoc.body)()\n\n            this._uiComposeComponent(newEl, compToAdd)\n\n            /** @type {HTMLElement} Where to add the new element? */\n            let elParent\n            if (compToAdd.parentEl) {\n                elParent = compToAdd.parentEl\n            } else if (ui.parentEl) {\n                elParent = ui.parentEl\n            } else if (compToAdd.parent) {\n                elParent = this.document.querySelector(compToAdd.parent)\n            } else if (ui.parent) {\n                elParent = this.document.querySelector(ui.parent)\n            }\n            if (!elParent) {\n                Ui.log('info', 'Ui:_uiAdd', 'No parent found, adding to body')()\n                elParent = this.document.querySelector('body')\n            }\n\n            if (compToAdd.position && compToAdd.position === 'first') {\n                // Insert new el before the first child of the parent. Ref: https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore#example_3\n                elParent.insertBefore(newEl, elParent.firstChild)\n            } else if (compToAdd.position && Number.isInteger(Number(compToAdd.position))) {\n                elParent.insertBefore(newEl, elParent.children[compToAdd.position])\n            } else {\n                // Append to the required parent\n                elParent.appendChild(newEl)\n            }\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToAdd.components) {\n                // this._uiAdd({\n                //     method: ui.method,\n                //     parentEl: newEl,\n                //     components: compToAdd.components,\n                // }, true)\n                this._uiExtendEl(newEl, compToAdd.components, compToAdd.ns)\n            }\n        })\n    } // --- end of _uiAdd ---\n\n    /** Enhance an HTML element that is being composed with ui data\n     *  such as ID, attribs, event handlers, custom props, etc.\n     * @param {*} el HTML Element to enhance\n     * @param {*} comp Individual uibuilder ui component spec\n     */\n    _uiComposeComponent(el, comp) {\n        // Add attributes\n        if (comp.attributes) {\n            Object.keys(comp.attributes).forEach((attrib) => {\n                if (attrib === 'class' && Array.isArray(comp.attributes[attrib])) comp.attributes[attrib].join(' ')\n                // For values, set the actual value as well since the attrib only changes the DEFAULT value\n                if (attrib === 'value') el.value = comp.attributes[attrib]\n\n                if (attrib.startsWith('xlink:')) el.setAttributeNS('http://www.w3.org/1999/xlink', attrib, comp.attributes[attrib])\n                else el.setAttribute(attrib, comp.attributes[attrib])\n            })\n        }\n\n        // ID if set\n        if (comp.id) el.setAttribute('id', comp.id)\n\n        // If an SVG tag, ensure we have the appropriate namespaces added\n        if (comp.type === 'svg') {\n            el.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns', 'http://www.w3.org/2000/svg')\n            el.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:xlink', 'http://www.w3.org/1999/xlink')\n        }\n\n        // Add event handlers\n        if (comp.events) {\n            Object.keys(comp.events).forEach((type) => {\n                // @ts-ignore  I'm forever getting this wrong!\n                if (type.toLowerCase === 'onclick') type = 'click'\n                // Add the event listener\n                try {\n                    el.addEventListener(type, (evt) => {\n                        // Use new Function to ensure that esbuild works: https://esbuild.github.io/content-types/#direct-eval\n                        (new Function('evt', `${comp.events[type]}(evt)`))(evt) // eslint-disable-line no-new-func\n                    })\n                    // newEl.setAttribute( 'onClick', `${comp.events[type]}()` )\n                } catch (err) {\n                    Ui.log('error', 'Ui:_uiComposeComponent', `Add event '${type}' for element '${comp.type}': Cannot add event handler. ${err.message}`)()\n                }\n            })\n        }\n\n        // Add custom properties to the dataset\n        if (comp.properties) {\n            Object.keys(comp.properties).forEach((prop) => {\n                // TODO break a.b into sub properties\n                el[prop] = comp.properties[prop]\n            })\n        }\n\n        //#region Add Slot content to innerHTML\n        if (comp.slot) {\n            this.replaceSlot(el, comp)\n        }\n        //#endregion\n\n        // TODO Add multi-slot capability (default slot must always be processed first as innerHTML is replaced)\n\n        //#region Add Slot Markdown content to innerHTML IF marked library is available\n        if (comp.slotMarkdown) {\n            this.replaceSlotMarkdown(el, comp)\n        }\n        //#endregion\n    }\n\n    /** Extend an HTML Element with appended elements using ui components\n     * NOTE: This fn follows a strict hierarchy of added components.\n     * @param {HTMLElement} parentEl The parent HTML Element we want to append to\n     * @param {*} components The ui component(s) we want to add\n     * @param {string} [ns] Optional. The namespace to use.\n     */\n    _uiExtendEl(parentEl, components, ns = '') {\n        components.forEach((compToAdd, i) => {\n            Ui.log('trace', `Ui:_uiExtendEl:components-forEach:${i}`, compToAdd)()\n\n            /** @type {HTMLElement} Create the new component */\n            let newEl\n\n            compToAdd.ns = ns\n\n            if (compToAdd.ns === 'html') {\n                newEl = parentEl\n                // newEl.outerHTML = compToAdd.slot\n                parentEl.innerHTML = compToAdd.slot\n            } else if (compToAdd.ns === 'svg') {\n                newEl = this.document.createElementNS('http://www.w3.org/2000/svg', compToAdd.type)\n                // Updates newEl\n                this._uiComposeComponent(newEl, compToAdd)\n                parentEl.appendChild(newEl)\n            } else {\n                newEl = this.document.createElement(compToAdd.type === 'html' ? 'div' : compToAdd.type)\n                // Updates newEl\n                this._uiComposeComponent(newEl, compToAdd)\n                parentEl.appendChild(newEl)\n            }\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToAdd.components) {\n                this._uiExtendEl(newEl, compToAdd.components, compToAdd.ns)\n            }\n        })\n    }\n\n    // TODO Add more error handling and parameter validation\n    /** Handle incoming _ui load requests\n     * Can load JavaScript modules, JavaScript scripts and CSS.\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     */\n    _uiLoad(ui) {\n\n        // Self-loading ECMA Modules (e.g. web components)\n        if (ui.components) {\n            if (!Array.isArray(ui.components)) ui.components = [ui.components]\n\n            ui.components.forEach(async component => {\n                await import(component)\n            })\n        }\n        // Remote Scripts\n        if (ui.srcScripts) {\n            if (!Array.isArray(ui.srcScripts)) ui.srcScripts = [ui.srcScripts]\n\n            ui.srcScripts.forEach(script => {\n                this.loadScriptSrc(script)\n            })\n        }\n        // Scripts passed as text\n        if (ui.txtScripts) {\n            if (!Array.isArray(ui.txtScripts)) ui.txtScripts = [ui.txtScripts]\n\n            this.loadScriptTxt(ui.txtScripts.join('\\n'))\n        }\n        // Remote Stylesheets\n        if (ui.srcStyles) {\n            if (!Array.isArray(ui.srcStyles)) ui.srcStyles = [ui.srcStyles]\n\n            ui.srcStyles.forEach(sheet => {\n                this.loadStyleSrc(sheet)\n            })\n        }\n        // Styles passed as text\n        if (ui.txtStyles) {\n            if (!Array.isArray(ui.txtStyles)) ui.txtStyles = [ui.txtStyles]\n\n            this.loadStyleTxt(ui.txtStyles.join('\\n'))\n        }\n\n    } // --- end of _uiLoad ---\n\n    /** Handle incoming _ui messages and loaded UI JSON files\n     * Called from start()\n     * @param {*} msg Standardised msg object containing a _ui property object\n     */\n    _uiManager(msg) {\n        if (!msg._ui) return\n\n        // Make sure that _ui is an array\n        if (!Array.isArray(msg._ui)) msg._ui = [msg._ui]\n\n        msg._ui.forEach((ui, i) => {\n            if (!ui.method) {\n                Ui.log('error', 'Ui:_uiManager', `No method defined for msg._ui[${i}]. Ignoring`)()\n                return\n            }\n\n            ui.payload = msg.payload\n            ui.topic = msg.topic\n            switch (ui.method) {\n                case 'add': {\n                    this._uiAdd(ui, false)\n                    break\n                }\n\n                case 'remove': {\n                    this._uiRemove(ui, false)\n                    break\n                }\n\n                case 'removeAll': {\n                    this._uiRemove(ui, true)\n                    break\n                }\n\n                case 'replace': {\n                    this._uiReplace(ui)\n                    break\n                }\n\n                case 'update': {\n                    this._uiUpdate(ui)\n                    break\n                }\n\n                case 'load': {\n                    this._uiLoad(ui)\n                    break\n                }\n\n                case 'reload': {\n                    this._uiReload()\n                    break\n                }\n\n                case 'notify': {\n                    this.showDialog('notify', ui, msg)\n                    break\n                }\n\n                case 'alert': {\n                    this.showDialog('alert', ui, msg)\n                    break\n                }\n\n                default: {\n                    Ui.log('error', 'Ui:_uiManager', `Invalid msg._ui[${i}].method (${ui.method}). Ignoring`)()\n                    break\n                }\n            }\n        })\n    } // --- end of _uiManager ---\n\n    /** Handle a reload request */\n    _uiReload() {\n        Ui.log('trace', 'Ui:uiManager:reload', 'reloading')()\n        location.reload()\n    }\n\n    // TODO Add better tests for failures (see comments)\n    /** Handle incoming _ui remove requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     * @param {boolean} all Optional, default=false. If true, will remove ALL found elements, otherwise only the 1st is removed\n     */\n    _uiRemove(ui, all = false) {\n        ui.components.forEach((compToRemove) => {\n            let els\n            if (all !== true) els = [this.document.querySelector(compToRemove)]\n            else els = this.document.querySelectorAll(compToRemove)\n\n            els.forEach(el => {\n                try {\n                    el.remove()\n                } catch (err) {\n                    // Could not remove. Cannot read properties of null <= no need to report this one\n                    // Could not remove. Failed to execute 'querySelector' on 'this.document': '##testbutton1' is not a valid selector\n                    Ui.log('trace', 'Ui:_uiRemove', `Could not remove. ${err.message}`)()\n                }\n            })\n        })\n    } // --- end of _uiRemove ---\n\n    /** Handle incoming _ui replace requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     */\n    _uiReplace(ui) {\n        Ui.log('trace', 'Ui:_uiReplace', 'Starting')()\n\n        ui.components.forEach((compToReplace, /** @type {number} */ i) => {\n            Ui.log('trace', `Ui:_uiReplace:components-forEach:${i}`, 'Component to replace: ', compToReplace)()\n\n            /** @type {HTMLElement} */\n            let elToReplace\n\n            // Either the id, CSS selector, name or type (element type) must be given in order to identify the element to change. FIRST element matching is updated.\n            if (compToReplace.id) {\n                elToReplace = this.document.getElementById(compToReplace.id) // .querySelector(`#${compToReplace.id}`)\n            } else if (compToReplace.selector || compToReplace.select) {\n                elToReplace = this.document.querySelector(compToReplace.selector)\n            } else if (compToReplace.name) {\n                elToReplace = this.document.querySelector(`[name=\"${compToReplace.name}\"]`)\n            } else if (compToReplace.type) {\n                elToReplace = this.document.querySelector(compToReplace.type)\n            }\n\n            Ui.log('trace', `Ui:_uiReplace:components-forEach:${i}`, 'Element to replace: ', elToReplace)()\n\n            // Nothing was found so ADD the element instead\n            if (elToReplace === undefined || elToReplace === null) {\n                Ui.log('trace', `Ui:_uiReplace:components-forEach:${i}:noReplace`, 'Cannot find the DOM element. Adding instead.', compToReplace)()\n                this._uiAdd({ components: [compToReplace] }, false)\n                return\n            }\n\n            /** @type {*} Create the new component - some kind of HTML element */\n            let newEl\n            switch (compToReplace.type) {\n                // If trying to insert raw html, wrap in a div\n                case 'html': {\n                    compToReplace.ns = 'html'\n                    newEl = this.document.createElement('div')\n                    break\n                }\n\n                // If trying to insert raw svg, need to create in namespace\n                case 'svg': {\n                    compToReplace.ns = 'svg'\n                    newEl = this.document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n                    break\n                }\n\n                default: {\n                    compToReplace.ns = 'dom'\n                    newEl = this.document.createElement(compToReplace.type)\n                    break\n                }\n            }\n\n            // Updates the newEl and maybe the ui\n            this._uiComposeComponent(newEl, compToReplace)\n\n            // Replace the current element\n            elToReplace.replaceWith(newEl)\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToReplace.components) {\n                this._uiExtendEl(newEl, compToReplace.components, compToReplace.ns)\n            }\n        })\n    } // --- end of _uiReplace ---\n\n    // TODO Allow single add without using components array\n    // TODO Allow sub-components\n    // TODO Add multi-slot capability\n    /** Handle incoming _ui update requests\n     * @param {*} ui Standardised msg._ui property object. Note that payload and topic are appended to this object\n     */\n    _uiUpdate(ui) {\n        Ui.log('trace', 'Ui:_uiManager:update', 'Starting _uiUpdate')()\n\n        // We allow an update not to actually need to spec a component\n        if (!ui.components) ui.components = [Object.assign({}, ui)]\n\n        ui.components.forEach((compToUpd, i) => {\n            Ui.log('trace', '_uiUpdate:components-forEach', `Component #${i}`, compToUpd)()\n\n            /** @type {NodeListOf<Element>} */\n            let elToUpd\n\n            // Either the id, CSS selector, name or type (element type) must be given in order to identify the element to change. ALL elements matching are updated.\n            if (compToUpd.id) {\n                // NB We don't use get by id because this way the code is simpler later on\n                elToUpd = this.document.querySelectorAll(`#${compToUpd.id}`)\n            } else if (compToUpd.selector || compToUpd.select) {\n                elToUpd = this.document.querySelectorAll(compToUpd.selector)\n            } else if (compToUpd.name) {\n                elToUpd = this.document.querySelectorAll(`[name=\"${compToUpd.name}\"]`)\n            } else if (compToUpd.type) {\n                elToUpd = this.document.querySelectorAll(compToUpd.type)\n            }\n\n            // @ts-ignore Nothing was found so give up\n            if (elToUpd === undefined || elToUpd.length < 1) {\n                Ui.log('warn', 'Ui:_uiManager:update', 'Cannot find the DOM element. Ignoring.', compToUpd)()\n                return\n            }\n\n            Ui.log('trace', '_uiUpdate:components-forEach', `Element(s) to update. Count: ${elToUpd.length}`, elToUpd)()\n\n            // If slot not specified but payload is, use the payload in the slot\n            if (!compToUpd.slot && compToUpd.payload) compToUpd.slot = compToUpd.payload\n\n            // Might have >1 element to update - so update them all\n            elToUpd.forEach(el => {\n                this._uiComposeComponent(el, compToUpd)\n            })\n\n            // If nested components, go again - but don't pass payload to sub-components\n            if (compToUpd.components) {\n                elToUpd.forEach(el => {\n                    Ui.log('trace', '_uiUpdate:components', 'el', el)()\n                    this._uiUpdate({\n                        method: ui.method,\n                        parentEl: el,\n                        components: compToUpd.components,\n                    })\n                })\n            }\n\n        })\n    } // --- end of _uiUpdate ---\n\n    //#endregion ---- -------- ----\n    //#region ---- External Methods ----\n\n    /** Simplistic jQuery-like document CSS query selector, returns an HTML Element\n     * NOTE that this fn returns the element itself. Use $$ to get the properties of 1 or more elements.\n     * If the selected element is a <template>, returns the first child element.\n     * type {HTMLElement}\n     * @param {string} cssSelector A CSS Selector that identifies the element to return\n     * @returns {HTMLElement|null} Selected HTML element or null\n     */\n    $(cssSelector) {\n        /** @type {*} Some kind of HTML element */\n        let el = document.querySelector(cssSelector)\n\n        if (!el) {\n            Ui.log(1, 'Uib:$', `No element found for CSS selector ${cssSelector}`)()\n            return null\n        }\n\n        if ( el.nodeName === 'TEMPLATE' ) {\n            el = el.content.firstElementChild\n            if (!el) {\n                Ui.log(0, 'Uib:$', `Template selected for CSS selector ${cssSelector} but it is empty`)()\n                return null\n            }\n        }\n\n        return el\n    }\n\n    /** CSS query selector that returns ALL found selections. Matches the Chromium DevTools feature of the same name.\n     * NOTE that this fn returns an array showing the PROPERTIES of the elements whereas $ returns the element itself\n     * @param {string} cssSelector A CSS Selector that identifies the elements to return\n     * @returns {HTMLElement[]} Array of DOM elements/nodes. Array is empty if selector is not found.\n     */\n    $$(cssSelector) {\n        return Array.from(document.querySelectorAll(cssSelector))\n    }\n\n    /** Add 1 or several class names to an element\n     * @param {string|string[]} classNames Single or array of classnames\n     * @param {HTMLElement} el HTML Element to add class(es) to\n     */\n    addClass(classNames, el) {\n        if (!Array.isArray(classNames)) classNames = [classNames]\n        if (el) el.classList.add(...classNames)\n    }\n\n    /** Converts markdown text input to HTML if the Markdown-IT library is loaded\n     * Otherwise simply returns the text\n     * @param {string} mdText The input markdown string\n     * @returns {string} HTML (if Markdown-IT library loaded and parse successful) or original text\n     */\n    convertMarkdown(mdText) {\n        if (!mdText) return ''\n        if (!this.window['markdownit']) return mdText\n\n        const opts = { // eslint-disable-line object-shorthand\n            html: true,\n            linkify: true,\n            _highlight: true,\n            langPrefix: 'language-',\n            highlight(str, lang) {\n                if (lang && this.window['hljs'] && this.window['hljs'].getLanguage(lang)) {\n                    try {\n                        return `<pre class=\"highlight\" data-language=\"${lang.toUpperCase()}\">\n                                <code class=\"language-${lang}\">${this.window['hljs'].highlightAuto(str).value}</code></pre>`\n                    } finally { } // eslint-disable-line no-empty\n                }\n                return `<pre class=\"highlight\"><code>${md.utils.escapeHtml(str)}</code></pre>`\n            },\n        }\n        const md = this.window['markdownit'](opts)\n        // Convert from markdown to HTML\n        return md.render(mdText)\n    }\n\n    /** Include HTML fragment, img, video, text, json, form data, pdf or anything else from an external file or API\n     * Wraps the included object in a div tag.\n     * PDF's, text or unknown MIME types are also wrapped in an iFrame.\n     * @param {string} url The URL of the source file to include\n     * @param {object} uiOptions Object containing properties recognised by the _uiReplace function. Must at least contain an id\n     * param {string} uiOptions.id The HTML ID given to the wrapping DIV tag\n     * param {string} uiOptions.parentSelector The CSS selector for a parent element to insert the new HTML under (defaults to 'body')\n     * @returns {Promise<any>} Status\n     */\n    async include(url, uiOptions) { // eslint-disable-line sonarjs/cognitive-complexity\n        // TODO: src, id, parent must all be a strings\n        if (!fetch) {\n            Ui.log(0, 'Ui:include', 'Current environment does not include `fetch`, skipping.')()\n            return 'Current environment does not include `fetch`, skipping.'\n        }\n        if (!url) {\n            Ui.log(0, 'Ui:include', 'url parameter must be provided, skipping.')()\n            return 'url parameter must be provided, skipping.'\n        }\n        if (!uiOptions || !uiOptions.id) {\n            Ui.log(0, 'Ui:include', 'uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.')()\n            return 'uiOptions parameter MUST be provided and must contain at least an `id` property, skipping.'\n        }\n\n        // Try to get the content via the URL\n        let response\n        try {\n            response = await fetch(url)\n        } catch (error) {\n            Ui.log(0, 'Ui:include', `Fetch of file '${url}' failed. `, error.message)()\n            return error.message\n        }\n        if (!response.ok) {\n            Ui.log(0, 'Ui:include', `Fetch of file '${url}' failed. Status='${response.statusText}'`)()\n            return response.statusText\n        }\n\n        // Work out what type of data we got\n        const contentType = await response.headers.get('content-type')\n        let type = null\n        if (contentType) {\n            if (contentType.includes('text/html')) {\n                type = 'html'\n            } else if (contentType.includes('application/json')) {\n                type = 'json'\n            } else if (contentType.includes('multipart/form-data')) {\n                type = 'form'\n            } else if (contentType.includes('image/')) {\n                type = 'image'\n            } else if (contentType.includes('video/')) {\n                type = 'video'\n            } else if (contentType.includes('application/pdf')) {\n                type = 'pdf'\n            } else if (contentType.includes('text/plain')) {\n                type = 'text'\n            } // else type = null\n        }\n\n        // Create the HTML to include on the page based on type\n        let slot = ''\n        let txtReturn = 'Include successful'\n        let data\n        switch (type) {\n            case 'html': {\n                data = await response.text()\n                slot = data\n                break\n            }\n\n            case 'json': {\n                data = await response.json()\n                slot = '<pre class=\"syntax-highlight\">'\n                slot += this.syntaxHighlight(data)\n                slot += '</pre>'\n                break\n            }\n\n            case 'form': {\n                data = await response.formData()\n                slot = '<pre class=\"syntax-highlight\">'\n                slot += this.syntaxHighlight(data)\n                slot += '</pre>'\n                break\n            }\n\n            case 'image': {\n                data = await response.blob()\n                slot = `<img src=\"${URL.createObjectURL(data)}\">`\n                if (this.window['DOMPurify']) {\n                    txtReturn = 'Include successful. BUT DOMPurify loaded which may block its use.'\n                    Ui.log('warn', 'Ui:include:image', txtReturn)()\n                }\n                break\n            }\n\n            case 'video': {\n                data = await response.blob()\n                slot = `<video controls autoplay><source src=\"${URL.createObjectURL(data)}\"></video>`\n                if (this.window['DOMPurify']) {\n                    txtReturn = 'Include successful. BUT DOMPurify loaded which may block its use.'\n                    Ui.log('warn', 'Ui:include:video', txtReturn)()\n                }\n                break\n            }\n\n            case 'pdf':\n            case 'text':\n            default: {\n                data = await response.blob()\n                slot = `<iframe style=\"resize:both;width:inherit;height:inherit;\" src=\"${URL.createObjectURL(data)}\">`\n                if (this.window['DOMPurify']) {\n                    txtReturn = 'Include successful. BUT DOMPurify loaded which may block its use.'\n                    Ui.log('warn', `Ui:include:${type}`, txtReturn)()\n                }\n                break\n            }\n        }\n\n        // Wrap it all in a <div id=\"...\" class=\"included\">\n        uiOptions.type = 'div'\n        uiOptions.slot = slot\n        if (!uiOptions.parent) uiOptions.parent = 'body'\n        if (!uiOptions.attributes) uiOptions.attributes = { class: 'included' }\n\n        // Use uibuilder's standard ui processing to turn the instructions into HTML\n        this._uiReplace({\n            components: [\n                uiOptions\n            ]\n        })\n\n        Ui.log('trace', `Ui:include:${type}`, txtReturn)()\n        return txtReturn\n    } // ---- End of include() ---- //\n\n    /** Attach a new remote script to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} url The url to be used in the script src attribute\n     */\n    loadScriptSrc(url) {\n        const newScript = this.document.createElement('script')\n        newScript.src = url\n        newScript.async = false\n        this.document.head.appendChild(newScript)\n    }\n\n    /** Attach a new text script to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} textFn The text to be loaded as a script\n     */\n    loadScriptTxt(textFn) {\n        const newScript = this.document.createElement('script')\n        newScript.async = false\n        newScript.textContent = textFn\n        this.document.head.appendChild(newScript)\n    }\n\n    /** Attach a new remote stylesheet link to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} url The url to be used in the style link href attribute\n     */\n    loadStyleSrc(url) {\n        const newStyle = this.document.createElement('link')\n        newStyle.href = url\n        newStyle.rel = 'stylesheet'\n        newStyle.type = 'text/css'\n\n        this.document.head.appendChild(newStyle)\n    }\n\n    /** Attach a new text stylesheet to the end of HEAD synchronously\n     * NOTE: It takes too long for most scripts to finish loading\n     *       so this is pretty useless to work with the dynamic UI features directly.\n     * @param {string} textFn The text to be loaded as a stylesheet\n     */\n    loadStyleTxt(textFn) {\n        const newStyle = this.document.createElement('style')\n        newStyle.textContent = textFn\n        this.document.head.appendChild(newStyle)\n    }\n\n    /** Load a dynamic UI from a JSON web reponse\n     * @param {string} url URL that will return the ui JSON\n     */\n    loadui(url) {\n        if (!fetch) {\n            Ui.log(0, 'Ui:loadui', 'Current environment does not include `fetch`, skipping.')()\n            return\n        }\n        if (!url) {\n            Ui.log(0, 'Ui:loadui', 'url parameter must be provided, skipping.')()\n            return\n        }\n\n        fetch(url)\n            .then(response => {\n                if (response.ok === false) {\n                    // Ui.log('warn', 'Ui:loadui:then1', `Could not load '${url}'. Status ${response.status}, Error: ${response.statusText}`)()\n                    throw new Error(`Could not load '${url}'. Status ${response.status}, Error: ${response.statusText}`)\n                }\n\n                Ui.log('trace', 'Ui:loadui:then1', `Loaded '${url}'. Status ${response.status}, ${response.statusText}`)()\n                // Did we get json?\n                const contentType = response.headers.get('content-type')\n                if (!contentType || !contentType.includes('application/json')) {\n                    throw new TypeError(`Fetch '${url}' did not return JSON, ignoring`)\n                }\n                // Returns parsed json to next .then\n                return response.json()\n            })\n            .then(data => {\n                if (data !== undefined) {\n                    Ui.log('trace', 'Ui:loadui:then2', 'Parsed JSON successfully obtained')()\n                    // Call the _uiManager\n                    this._uiManager({ _ui: data })\n                    return true\n                }\n                return false\n            })\n            .catch(err => {\n                Ui.log('warn', 'Ui:loadui:catch', 'Error. ', err)()\n            })\n    } // --- end of loadui\n\n    /** Get standard data from a DOM node.\n     * @param {*} node DOM node to examine\n     * @param {string} cssSelector Identify the DOM element to get data from\n     * @returns {object} Standardised data object\n     */\n    nodeGet(node, cssSelector) {\n        const thisOut = {\n            id: node.id === '' ? undefined : node.id,\n            name: node.name,\n            children: node.childNodes.length,\n            type: node.nodeName,\n            attributes: undefined,\n\n            isUserInput: node.validity ? true : false, // eslint-disable-line no-unneeded-ternary\n            userInput: !node.validity ? undefined : { // eslint-disable-line multiline-ternary\n                value: node.value,\n                validity: undefined,\n                willValidate: node.willValidate,\n                valueAsDate: node.valueAsDate,\n                valueAsNumber: node.valueAsNumber,\n                type: node.type,\n            },\n        }\n\n        if (['UL', 'OL'].includes(node.nodeName)) {\n            const listEntries = this.document.querySelectorAll(`${cssSelector} li`)\n            if (listEntries) {\n                thisOut.list = {\n                    'entries': listEntries.length\n                }\n            }\n        }\n        if (node.nodeName === 'DL') {\n            const listEntries = this.document.querySelectorAll(`${cssSelector} dt`)\n            if (listEntries) {\n                thisOut.list = {\n                    'entries': listEntries.length\n                }\n            }\n        }\n        if (node.nodeName === 'TABLE') {\n            const bodyEntries = this.document.querySelectorAll(`${cssSelector} > tbody > tr`)\n            const headEntries = this.document.querySelectorAll(`${cssSelector} > thead > tr`)\n            const cols = this.document.querySelectorAll(`${cssSelector} > tbody > tr:last-child > *`)  // #eltest > table > tbody > tr:nth-child(3)\n            if (bodyEntries || headEntries || cols) {\n                thisOut.table = {\n                    'headRows': headEntries ? headEntries.length : 0,\n                    'bodyRows': bodyEntries ? bodyEntries.length : 0,\n                    'columns': cols ? cols.length : 0,\n                }\n            }\n        }\n        if (node.nodeName !== '#text' && node.attributes && node.attributes.length > 0) {\n            thisOut.attributes = {}\n            // @ts-ignore\n            for (const attrib of node.attributes) {\n                if (attrib.name !== 'id') {\n                    thisOut.attributes[attrib.name] = node.attributes[attrib.name].value\n                }\n                if (attrib.name === 'class') thisOut.classes = Array.from(node.classList)\n            }\n        }\n        if (node.nodeName === '#text') {\n            thisOut.text = node.textContent\n        }\n        if (node.validity) thisOut.userInput.validity = {}\n        for (const v in node.validity) {\n            thisOut.userInput.validity[v] = node.validity[v]\n        }\n\n        return thisOut\n    } // --- end of nodeGet --- //\n\n    /** Show a browser notification if possible. Returns a promise\n     * Config can be a simple string, a Node-RED msg (topic as title, payload as body)\n     * or a Notifications API options object + config.title string.\n     * Config ref: https://developer.mozilla.org/en-US/docs/Web/API/Notification/Notification\n     * @param {object|string} config Notification config object or simple message string\n     * @returns {Promise} Resolves on close or click event, returns the event.\n     */\n    async notification(config) {\n        if (typeof config === 'string') {\n            config = { body: config }\n        }\n        // Are notifications available?\n        if (typeof Notification === 'undefined') return Promise.reject(new Error('Notifications not available in this browser'))\n        // Do we have permission? If not, ask for permission\n        let permit = Notification.permission\n        if (permit === 'denied') {\n            return Promise.reject(new Error('Notifications not permitted by user')) // eslint-disable-line no-useless-return\n        } else if (permit === 'granted') {\n            return this._showNotification(config)\n        } else { // if (permit === 'default') {\n            permit = await Notification.requestPermission()\n            if (permit === 'granted') {\n                return this._showNotification(config)\n            }\n            return Promise.reject(new Error('Notifications not permitted by user'))\n        }\n    }\n\n    /** Remove All, 1 or more class names from an element\n     * @param {undefined|null|\"\"|string|string[]} classNames Single or array of classnames. If undefined, \"\" or null, remove all classes\n     * @param {HTMLElement} el HTML Element to add class(es) to\n     */\n    removeClass(classNames, el) {\n        if (!classNames) {\n            el.removeAttribute('class')\n            return\n        }\n        if (!Array.isArray(classNames)) classNames = [classNames]\n        if (el) el.classList.remove(...classNames)\n    }\n\n    // TODO Add multi-slot\n    /** Replace or add an HTML element's slot from text or an HTML string\n     * Will use DOMPurify if that library has been loaded to window.\n     * param {*} ui Single entry from the msg._ui property\n     * @param {Element} el Reference to the element that we want to update\n     * @param {*} component The component we are trying to add/replace\n     */\n    replaceSlot(el, component) {\n        if (!component.slot) return\n        if (!el) return\n\n        // If DOMPurify is loaded, apply it now\n        if (this.window['DOMPurify']) component.slot = this.window['DOMPurify'].sanitize(component.slot)\n        // Set the component content to the msg.payload or the slot property\n        el.innerHTML = component.slot\n    }\n\n    /** Replace or add an HTML element's slot from a Markdown string\n     * Only does something if the markdownit library has been loaded to window.\n     * Will use DOMPurify if that library has been loaded to window.\n     * @param {Element} el Reference to the element that we want to update\n     * @param {*} component The component we are trying to add/replace\n     */\n    replaceSlotMarkdown(el, component) {\n        if (!el) return\n        if (!component.slotMarkdown) return\n\n        // Convert from markdown to HTML\n        component.slotMarkdown = this.convertMarkdown(component.slotMarkdown)\n        // If DOMPurify is loaded, apply it now\n        component.slotMarkdown = this.sanitiseHTML(component.slotMarkdown)\n        // Set the component content to the the converted slotMarkdown property\n        el.innerHTML = component.slotMarkdown\n    }\n\n    /** Sanitise HTML to make it safe - if the DOMPurify library is loaded\n     * Otherwise just returns that HTML as-is.\n     * @param {string} html The input HTML string\n     * @returns {string} The sanitised HTML or the original if DOMPurify not loaded\n     */\n    sanitiseHTML(html) {\n        if (!this.window['DOMPurify']) return html\n        return this.window['DOMPurify'].sanitize(html, { ADD_TAGS: this.sanitiseExtraTags, ADD_ATTR: this.sanitiseExtraAttribs })\n    }\n\n    /** Show a pop-over \"toast\" dialog or a modal alert // TODO - Allow notify to sit in corners rather than take over the screen\n     * Refs: https://www.w3.org/WAI/ARIA/apg/example-index/dialog-modal/alertdialog.html,\n     *       https://www.w3.org/WAI/ARIA/apg/example-index/dialog-modal/dialog.html,\n     *       https://www.w3.org/WAI/ARIA/apg/patterns/dialogmodal/\n     * @param {\"notify\"|\"alert\"} type Dialog type\n     * @param {object} ui standardised ui data\n     * @param {object} [msg] msg.payload/msg.topic - only used if a string. Optional.\n     * @returns {void}\n     */\n    showDialog(type, ui, msg) { // eslint-disable-line sonarjs/cognitive-complexity\n\n        //#region -- Check properties --\n\n        let content = ''\n        // Main body content\n        if (msg.payload && typeof msg.payload === 'string') content += `<div>${msg.payload}</div>`\n        if (ui.content) content += `<div>${ui.content}</div>`\n        // Toast wont show anyway if content is empty, may as well warn user\n        if (content === '') {\n            Ui.log(1, 'Ui:showDialog', 'Toast content is blank. Not shown.')()\n            return\n        }\n\n        // Use msg.topic as title if no title provided\n        if (!ui.title && msg.topic) ui.title = msg.topic\n        if (ui.title) content = `<p class=\"toast-head\">${ui.title}</p><p>${content}</p>`\n\n        // Allow for variants - @since v6.1 - don't bother - since this now sets CSS class, not tied to bootstrap-vue\n        // if ( !ui.variant || !['', 'primary', 'secondary', 'success', 'info', 'warn', 'warning', 'failure', 'error', 'danger'].includes(ui.variant)) ui.variant = ''\n\n        // Toasts auto-hide by default after 10s but alerts do not auto-hide\n        if (ui.noAutohide) ui.noAutoHide = ui.noAutohide\n        if (ui.noAutoHide) ui.autohide = !ui.noAutoHide\n        // If set, number of ms until toast is auto-hidden\n        if (ui.autoHideDelay) {\n            if (!ui.autohide) ui.autohide = true\n            ui.delay = ui.autoHideDelay\n        } else ui.autoHideDelay = 10000 // default = 10s\n        if (!Object.prototype.hasOwnProperty.call(ui, 'autohide')) ui.autohide = true\n\n        if (type === 'alert') {\n            ui.modal = true\n            ui.autohide = false\n            content = `<svg viewBox=\"0 0 192.146 192.146\" style=\"width:30;background-color:transparent;\"><path d=\"M108.186 144.372c0 7.054-4.729 12.32-12.037 12.32h-.254c-7.054 0-11.92-5.266-11.92-12.32 0-7.298 5.012-12.31 12.174-12.31s11.91 4.992 12.037 12.31zM88.44 125.301h15.447l2.951-61.298H85.46l2.98 61.298zm101.932 51.733c-2.237 3.664-6.214 5.921-10.493 5.921H12.282c-4.426 0-8.51-2.384-10.698-6.233a12.34 12.34 0 0 1 .147-12.349l84.111-149.22c2.208-3.722 6.204-5.96 10.522-5.96h.332c4.445.107 8.441 2.618 10.513 6.546l83.515 149.229c1.993 3.8 1.905 8.363-.352 12.066zm-10.493-6.4L96.354 21.454l-84.062 149.18h167.587z\" /></svg> ${content}`\n        }\n\n        //#endregion -- -- --\n\n        // Create a toaster container element if not already created - or get a ref to it\n        let toaster = this.document.getElementById('toaster')\n        if (toaster === null) {\n            toaster = this.document.createElement('div')\n            toaster.id = 'toaster'\n            toaster.title = 'Click to clear all notifcations'\n            toaster.setAttribute('class', 'toaster')\n            toaster.setAttribute('role', 'dialog')\n            toaster.setAttribute('arial-label', 'Toast message')\n            toaster.onclick = function () {\n                // @ts-ignore\n                toaster.remove()\n            }\n            this.document.body.insertAdjacentElement('afterbegin', toaster)\n        }\n\n        // Create a toast element. Would be nice to use <dialog> but that isn't well supported yet - come on Apple!\n        const toast = this.document.createElement('div')\n        toast.title = 'Click to clear this notifcation'\n        toast.setAttribute('class', `toast ${ui.variant ? ui.variant : ''} ${type}`)\n        toast.innerHTML = content\n        toast.setAttribute('role', 'alertdialog')\n        if (ui.modal) toast.setAttribute('aria-modal', ui.modal)\n        toast.onclick = function (evt) {\n            evt.stopPropagation()\n            toast.remove()\n            // @ts-ignore\n            if (toaster.childElementCount < 1) toaster.remove()\n        }\n\n        // TODO\n        if (type === 'alert') {\n            // newD.setAttribute('aria-labelledby', '')\n            // newD.setAttribute('aria-describedby', '')\n        }\n\n        toaster.insertAdjacentElement(ui.appendToast === true ? 'beforeend' : 'afterbegin', toast)\n\n        // Auto-hide\n        if (ui.autohide === true) {\n            setInterval(() => {\n                toast.remove()\n                // @ts-ignore\n                if (toaster.childElementCount < 1) toaster.remove()\n            }, ui.autoHideDelay)\n        }\n    } // --- End of showDialog ---\n\n    /** Directly manage UI via JSON\n     * @param {object} json Either an object containing {_ui: {}} or simply simple {} containing ui instructions\n     */\n    ui(json) {\n        // Simulate a msg and process\n        let msg = {}\n        if (json._ui) msg = json\n        else msg._ui = json\n\n        console.log(this)\n        this._uiManager(msg)\n    }\n\n    /** Get data from the DOM. Returns selection of useful props unless a specific prop requested.\n     * @param {string} cssSelector Identify the DOM element to get data from\n     * @param {string} [propName] Optional. Specific name of property to get from the element\n     * @returns {Array<*>} Array of objects containing either specific requested property or a selection of useful properties\n     */\n    uiGet(cssSelector, propName = null) {\n        // The type cast below not really correct but it gets rid of the other typescript errors\n        const selection = /** @type {NodeListOf<HTMLInputElement>} */ (this.document.querySelectorAll(cssSelector))\n\n        const out = []\n\n        selection.forEach(node => {\n            // Specific property asked for ...\n            if (propName) {\n                if (propName === 'classes') propName = 'class'\n                // Try assuming the prop is an attribute first (will return null or \"\" if not present)\n                let prop = node.getAttribute(propName)\n                // If not an attribute, try getting as a property of the element\n                if (prop === undefined || prop === null) {\n                    try {\n                        prop = node[propName]\n                    } catch (error) {}\n                }\n                // We didn't find as either an attribute or a property\n                if (prop === undefined || prop === null) {\n                    // If 'value' was requested, return the innerText\n                    if (propName.toLowerCase() === 'value') out.push(node.innerText)\n                    else out.push(`Property '${propName}' not found`)\n                } else {\n                    const p = {}\n                    // Nightmare of different object types in a DOM Element!\n                    const cType = prop.constructor.name.toLowerCase()\n                    if (cType === 'namednodemap') {\n                        for (const key of prop) {\n                            // @ts-ignore\n                            p[key.name] = prop[key.name].value\n                        }\n                    } else if (!cType.includes('map')) { // Ordinary properties (not a mapped type)\n                        p[propName] = prop\n                    } else { // Other MAP types\n                        const p = {}\n                        // @ts-ignore\n                        for (const key in prop) {\n                            p[key] = prop[key]\n                        }\n                    }\n                    if (p.class) p.classes = Array.from(node.classList)\n                    out.push(p)\n                }\n            } else { // Otherwise, grab everything useful\n                out.push(this.nodeGet(node, cssSelector))\n            }\n        })\n\n        return out\n    } // --- end of uiGet --- //\n\n    /** External alias for _uiComposeComponent\n     * @param {*} el HTML Element to enhance\n     * @param {*} comp Individual uibuilder ui component spec\n     */\n    uiEnhanceElement(el, comp) {\n        this._uiComposeComponent(el, comp)\n    }\n\n    //#endregion ---- -------- ----\n}\n\nmodule.exports = Ui\n\n// if (window) window['$ui'] = new Ui(window)\n\n// export Ui\n"],
  "mappings": "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",
  "names": ["require_ui", "__commonJSMin", "exports", "module", "_a", "Ui", "win", "extLog", "jsonHighlight", "__publicField", "config", "notify", "resolve", "reject", "ev", "ui", "isRecurse", "compToAdd", "i", "newEl", "elParent", "el", "comp", "attrib", "type", "evt", "err", "prop", "parentEl", "components", "ns", "component", "__toESM", "__require", "script", "sheet", "msg", "all", "compToRemove", "els", "compToReplace", "elToReplace", "compToUpd", "elToUpd", "cssSelector", "classNames", "mdText", "opts", "str", "lang", "md", "url", "uiOptions", "response", "error", "contentType", "slot", "txtReturn", "data", "newScript", "textFn", "newStyle", "node", "thisOut", "listEntries", "bodyEntries", "headEntries", "cols", "v", "permit", "html", "content", "toaster", "toast", "json", "propName", "selection", "out", "p", "cType", "key"]
}
